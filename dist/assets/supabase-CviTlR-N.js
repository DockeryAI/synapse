import{A as T,P as m,S as v,F as p,R as O}from"./vendor-misc-Ce8oRwJD.js";const _="2.81.1";let f="";typeof Deno<"u"?f="deno":typeof document<"u"?f="web":typeof navigator<"u"&&navigator.product==="ReactNative"?f="react-native":f="node";const A={"X-Client-Info":`supabase-js-${f}/${_}`},w={headers:A},U={schema:"public"},S={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},k={},E=a=>a?(...e)=>a(...e):(...e)=>fetch(...e),j=()=>Headers,C=(a,e,s)=>{const t=E(s),c=j();return async(l,r)=>{var n;const u=(n=await e())!==null&&n!==void 0?n:a;let o=new c(r==null?void 0:r.headers);return o.has("apikey")||o.set("apikey",a),o.has("Authorization")||o.set("Authorization",`Bearer ${u}`),t(l,Object.assign(Object.assign({},r),{headers:o}))}};function L(a){return a.endsWith("/")?a:a+"/"}function y(a,e){var s,t;const{db:c,auth:l,realtime:r,global:n}=a,{db:u,auth:o,realtime:i,global:h}=e,d={db:Object.assign(Object.assign({},u),c),auth:Object.assign(Object.assign({},o),l),realtime:Object.assign(Object.assign({},i),r),storage:{},global:Object.assign(Object.assign(Object.assign({},h),n),{headers:Object.assign(Object.assign({},(s=h==null?void 0:h.headers)!==null&&s!==void 0?s:{}),(t=n==null?void 0:n.headers)!==null&&t!==void 0?t:{})}),accessToken:async()=>""};return a.accessToken?d.accessToken=a.accessToken:delete d.accessToken,d}function R(a){const e=a==null?void 0:a.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(L(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}class D extends T{constructor(e){super(e)}}class I{constructor(e,s,t){var c,l,r;this.supabaseUrl=e,this.supabaseKey=s;const n=R(e);if(!s)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",n),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",n),this.storageUrl=new URL("storage/v1",n),this.functionsUrl=new URL("functions/v1",n);const u=`sb-${n.hostname.split(".")[0]}-auth-token`,o={db:U,realtime:k,auth:Object.assign(Object.assign({},S),{storageKey:u}),global:w},i=y(t??{},o);this.storageKey=(c=i.auth.storageKey)!==null&&c!==void 0?c:"",this.headers=(l=i.global.headers)!==null&&l!==void 0?l:{},i.accessToken?(this.accessToken=i.accessToken,this.auth=new Proxy({},{get:(h,d)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(d)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((r=i.auth)!==null&&r!==void 0?r:{},this.headers,i.global.fetch),this.fetch=C(s,this._getAccessToken.bind(this),i.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},i.realtime)),this.accessToken&&this.accessToken().then(h=>this.realtime.setAuth(h)).catch(h=>console.warn("Failed to set initial Realtime auth token:",h)),this.rest=new m(new URL("rest/v1",n).href,{headers:this.headers,schema:i.db.schema,fetch:this.fetch}),this.storage=new v(this.storageUrl.href,this.headers,this.fetch,t==null?void 0:t.storage),i.accessToken||this._listenForAuthEvents()}get functions(){return new p(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,s={},t={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,s,t)}channel(e,s={config:{}}){return this.realtime.channel(e,s)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e,s;if(this.accessToken)return await this.accessToken();const{data:t}=await this.auth.getSession();return(s=(e=t.session)===null||e===void 0?void 0:e.access_token)!==null&&s!==void 0?s:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:s,detectSessionInUrl:t,storage:c,userStorage:l,storageKey:r,flowType:n,lock:u,debug:o,throwOnError:i},h,d){const g={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new D({url:this.authUrl.href,headers:Object.assign(Object.assign({},g),h),storageKey:r,autoRefreshToken:e,persistSession:s,detectSessionInUrl:t,storage:c,userStorage:l,flowType:n,lock:u,debug:o,throwOnError:i,fetch:d,hasCustomAuthorizationHeader:Object.keys(this.headers).some(b=>b.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new O(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((s,t)=>{this._handleTokenChanged(s,"CLIENT",t==null?void 0:t.access_token)})}_handleTokenChanged(e,s,t){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==t?(this.changedAccessToken=t,this.realtime.setAuth(t)):e==="SIGNED_OUT"&&(this.realtime.setAuth(),s=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const P=(a,e,s)=>new I(a,e,s);function F(){if(typeof window<"u"||typeof process>"u")return!1;const a=process.version;if(a==null)return!1;const e=a.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}F()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");export{P as c};
//# sourceMappingURL=supabase-CviTlR-N.js.map
