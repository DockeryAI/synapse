{"version":3,"file":"analytics-BeoNQ3KZ.js","sources":["../../src/lib/supabase.ts","../../src/services/analytics/funnel-tracker.service.ts","../../src/services/analytics.service.ts"],"sourcesContent":["// Supabase client configuration and utilities\n\nimport { createClient } from '@supabase/supabase-js';\nimport type { Database } from '@/types/database.types';\n\nconst supabaseUrl = import.meta.env.VITE_SUPABASE_URL;\nconst supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;\n\n// Demo mode flag\nexport const isDemoMode = !supabaseUrl || !supabaseAnonKey;\n\nif (isDemoMode) {\n  console.warn('ðŸ”” Running in DEMO MODE - Supabase not configured. Data will not persist.');\n}\n\n// Create Supabase client (or mock for demo mode)\nexport const supabase = isDemoMode\n  ? createMockSupabaseClient()\n  : createClient<Database>(supabaseUrl, supabaseAnonKey, {\n      auth: {\n        persistSession: true,\n        autoRefreshToken: true,\n        detectSessionInUrl: true,\n      },\n      global: {\n        headers: {\n          'Accept': 'application/json',\n          'Content-Type': 'application/json',\n        },\n      },\n      db: {\n        schema: 'public',\n      },\n    });\n\n// Mock Supabase client for demo mode\nfunction createMockSupabaseClient(): any {\n  const mockError = {\n    data: null,\n    error: {\n      message: 'Supabase not configured. Please set VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY in your .env file.',\n      code: 'SUPABASE_NOT_CONFIGURED',\n      details: 'Running in demo mode without database connection.',\n      hint: 'Check NAICS_MIGRATION_GUIDE.md for setup instructions.'\n    }\n  };\n\n  const mockQuery = {\n    select: () => mockQuery,\n    insert: () => mockQuery,\n    update: () => mockQuery,\n    delete: () => mockQuery,\n    eq: () => mockQuery,\n    single: () => Promise.resolve(mockError),\n    order: () => mockQuery,\n    limit: () => mockQuery,\n    then: (resolve: any) => resolve(mockError),\n  };\n\n  return {\n    from: () => mockQuery,\n    auth: {\n      getUser: () => Promise.resolve(mockError),\n      signInWithPassword: () => Promise.resolve(mockError),\n      signUp: () => Promise.resolve(mockError),\n      signOut: () => Promise.resolve(mockError),\n      resetPasswordForEmail: () => Promise.resolve(mockError),\n      updateUser: () => Promise.resolve(mockError),\n    },\n    storage: {\n      from: () => ({\n        upload: () => Promise.resolve(mockError),\n        getPublicUrl: () => ({ data: { publicUrl: '' }, error: mockError.error }),\n        remove: () => Promise.resolve(mockError),\n        list: () => Promise.resolve(mockError),\n      }),\n    },\n    functions: {\n      invoke: () => Promise.resolve(mockError),\n    },\n    channel: () => ({\n      on: () => ({ subscribe: () => ({}) }),\n    }),\n    removeChannel: () => {},\n  };\n}\n\n// Auth helpers\nexport const auth = {\n  /**\n   * Get the current user\n   */\n  async getCurrentUser() {\n    const { data: { user }, error } = await supabase.auth.getUser();\n    if (error) throw error;\n    return user;\n  },\n\n  /**\n   * Sign in with email and password\n   */\n  async signIn(email: string, password: string) {\n    const { data, error } = await supabase.auth.signInWithPassword({\n      email,\n      password,\n    });\n    if (error) throw error;\n    return data;\n  },\n\n  /**\n   * Sign up with email and password\n   */\n  async signUp(email: string, password: string, metadata?: Record<string, any>) {\n    const { data, error } = await supabase.auth.signUp({\n      email,\n      password,\n      options: {\n        data: metadata,\n      },\n    });\n    if (error) throw error;\n    return data;\n  },\n\n  /**\n   * Sign out\n   */\n  async signOut() {\n    const { error } = await supabase.auth.signOut();\n    if (error) throw error;\n  },\n\n  /**\n   * Reset password\n   */\n  async resetPassword(email: string) {\n    const { error } = await supabase.auth.resetPasswordForEmail(email, {\n      redirectTo: `${window.location.origin}/reset-password`,\n    });\n    if (error) throw error;\n  },\n\n  /**\n   * Update password\n   */\n  async updatePassword(newPassword: string) {\n    const { error } = await supabase.auth.updateUser({\n      password: newPassword,\n    });\n    if (error) throw error;\n  },\n};\n\n// Storage helpers\nexport const storage = {\n  /**\n   * Upload a file to storage\n   */\n  async uploadFile(bucket: string, path: string, file: File) {\n    const { data, error } = await supabase.storage\n      .from(bucket)\n      .upload(path, file, {\n        cacheControl: '3600',\n        upsert: false,\n      });\n\n    if (error) throw error;\n    return data;\n  },\n\n  /**\n   * Get public URL for a file\n   */\n  getPublicUrl(bucket: string, path: string) {\n    const { data } = supabase.storage\n      .from(bucket)\n      .getPublicUrl(path);\n\n    return data.publicUrl;\n  },\n\n  /**\n   * Delete a file from storage\n   */\n  async deleteFile(bucket: string, path: string) {\n    const { error } = await supabase.storage\n      .from(bucket)\n      .remove([path]);\n\n    if (error) throw error;\n  },\n\n  /**\n   * List files in a bucket\n   */\n  async listFiles(bucket: string, path?: string) {\n    const { data, error } = await supabase.storage\n      .from(bucket)\n      .list(path, {\n        limit: 100,\n        offset: 0,\n        sortBy: { column: 'created_at', order: 'desc' },\n      });\n\n    if (error) throw error;\n    return data;\n  },\n};\n\n// Edge Functions helpers\nexport const functions = {\n  /**\n   * Invoke an edge function\n   */\n  async invoke<T = any>(functionName: string, payload?: any): Promise<T> {\n    const { data, error } = await supabase.functions.invoke(functionName, {\n      body: payload,\n    });\n\n    if (error) throw error;\n    return data as T;\n  },\n\n  /**\n   * Analyze mirror section\n   */\n  async analyzeMirror(brandId: string, section: string, forceRefresh = false) {\n    return this.invoke('analyze-mirror', {\n      brandId,\n      section,\n      forceRefresh,\n    });\n  },\n\n  /**\n   * Send message to Marbs assistant\n   */\n  async askMarbs(message: string, context: any, conversationId?: string) {\n    return this.invoke('marbs-assistant', {\n      message,\n      context,\n      conversationId,\n    });\n  },\n\n  /**\n   * Generate content (MARBA or Synapse mode)\n   */\n  async generateContent(\n    brandId: string,\n    platform: string,\n    topic: string,\n    mode: 'marba' | 'synapse',\n    options?: any\n  ) {\n    return this.invoke('generate-content', {\n      brandId,\n      platform,\n      topic,\n      mode,\n      ...options,\n    });\n  },\n\n  /**\n   * Enrich content with Synapse\n   */\n  async enrichWithSynapse(content: string, enrichmentType = 'full') {\n    return this.invoke('enrich-with-synapse', {\n      content,\n      enrichmentType,\n    });\n  },\n\n  /**\n   * Publish content to platform\n   */\n  async publishToPlatform(\n    contentItemId: string,\n    platform: string,\n    content: string,\n    imageUrl?: string\n  ) {\n    return this.invoke('publish-to-platforms', {\n      contentItemId,\n      platform,\n      content,\n      imageUrl,\n    });\n  },\n\n  /**\n   * Collect analytics from platform\n   */\n  async collectAnalytics(brandId: string, platform: string, dateRange: any) {\n    return this.invoke('collect-analytics', {\n      brandId,\n      platform,\n      dateRange,\n    });\n  },\n};\n\n// Real-time subscription helpers\nexport const realtime = {\n  /**\n   * Subscribe to table changes\n   */\n  subscribeToTable(\n    table: string,\n    callback: (payload: any) => void,\n    filter?: string\n  ) {\n    const channel = supabase\n      .channel(`${table}_changes`)\n      .on(\n        'postgres_changes',\n        {\n          event: '*',\n          schema: 'public',\n          table,\n          filter,\n        },\n        callback\n      )\n      .subscribe();\n\n    return () => {\n      supabase.removeChannel(channel);\n    };\n  },\n\n  /**\n   * Subscribe to content calendar changes\n   */\n  subscribeToContentCalendar(brandId: string, callback: (payload: any) => void) {\n    return this.subscribeToTable(\n      'content_calendar_items',\n      callback,\n      `brand_id=eq.${brandId}`\n    );\n  },\n\n  /**\n   * Subscribe to Marbs conversations\n   */\n  subscribeToMarbsConversations(userId: string, callback: (payload: any) => void) {\n    return this.subscribeToTable(\n      'marbs_conversations',\n      callback,\n      `user_id=eq.${userId}`\n    );\n  },\n\n  /**\n   * Subscribe to intelligence opportunities\n   */\n  subscribeToOpportunities(brandId: string, callback: (payload: any) => void) {\n    return this.subscribeToTable(\n      'intelligence_opportunities',\n      callback,\n      `brand_id=eq.${brandId}`\n    );\n  },\n};\n\n// Query helpers\nexport const db = {\n  /**\n   * Get a single record by ID\n   */\n  async getById<T>(table: string, id: string): Promise<T | null> {\n    const { data, error } = await supabase\n      .from(table)\n      .select('*')\n      .eq('id', id)\n      .single();\n\n    if (error) {\n      if (error.code === 'PGRST116') return null; // Not found\n      throw error;\n    }\n\n    return data as T;\n  },\n\n  /**\n   * Get all records from a table\n   */\n  async getAll<T>(table: string, filters?: Record<string, any>): Promise<T[]> {\n    let query = supabase.from(table).select('*');\n\n    if (filters) {\n      Object.entries(filters).forEach(([key, value]) => {\n        query = query.eq(key, value);\n      });\n    }\n\n    const { data, error } = await query;\n\n    if (error) throw error;\n    return (data as T[]) || [];\n  },\n\n  /**\n   * Insert a record\n   */\n  async insert<T>(table: string, record: Partial<T>): Promise<T> {\n    const { data, error } = await supabase\n      .from(table)\n      .insert(record)\n      .select()\n      .single();\n\n    if (error) throw error;\n    return data as T;\n  },\n\n  /**\n   * Update a record\n   */\n  async update<T>(table: string, id: string, updates: Partial<T>): Promise<T> {\n    const { data, error } = await supabase\n      .from(table)\n      .update(updates)\n      .eq('id', id)\n      .select()\n      .single();\n\n    if (error) throw error;\n    return data as T;\n  },\n\n  /**\n   * Delete a record\n   */\n  async delete(table: string, id: string): Promise<void> {\n    const { error } = await supabase\n      .from(table)\n      .delete()\n      .eq('id', id);\n\n    if (error) throw error;\n  },\n};\n\nexport default supabase;\n","/**\n * Funnel Tracker Service\n *\n * Tracks user journey through onboarding, campaign generation, and publishing funnels.\n * Stores all events in Supabase analytics_events table for conversion analysis.\n *\n * Funnels Tracked:\n * 1. Onboarding: URL input â†’ extraction â†’ confirmation â†’ insights â†’ suggestions â†’ generation\n * 2. Campaign Generation: Type selection â†’ generation â†’ editing â†’ scheduling\n * 3. Publishing: Scheduling â†’ publishing success/failure\n */\n\nimport { supabase } from '@/lib/supabase';\n\n//=============================================================================\n// Types & Interfaces\n//=============================================================================\n\n/**\n * Onboarding funnel steps\n */\nexport type OnboardingStep =\n  | 'url_input'\n  | 'extraction_started'\n  | 'extraction_complete'\n  | 'confirmation_viewed'\n  | 'confirmation_confirmed'\n  | 'insights_viewed'\n  | 'suggestions_viewed'\n  | 'campaign_selected'\n  | 'post_selected'\n  | 'generation_started'\n  | 'generation_complete'\n  | 'preview_viewed';\n\n/**\n * Campaign generation funnel steps\n */\nexport type CampaignStep =\n  | 'type_selector_viewed'\n  | 'type_selected'\n  | 'customization_viewed'\n  | 'generation_started'\n  | 'generation_complete'\n  | 'preview_viewed'\n  | 'editing_started'\n  | 'post_edited'\n  | 'schedule_started'\n  | 'schedule_complete';\n\n/**\n * Publishing funnel steps\n */\nexport type PublishingStep =\n  | 'schedule_initiated'\n  | 'schedule_success'\n  | 'schedule_failed'\n  | 'publish_started'\n  | 'publish_success'\n  | 'publish_failed'\n  | 'retry_attempted';\n\n/**\n * Combined event type\n */\nexport type FunnelEventType = 'onboarding' | 'campaign' | 'publishing';\n\n/**\n * Funnel event interface\n */\nexport interface FunnelEvent {\n  eventType: FunnelEventType;\n  step: OnboardingStep | CampaignStep | PublishingStep;\n  userId?: string;\n  brandId?: string;\n  sessionId?: string;\n  metadata?: Record<string, any>;\n  timestamp?: Date;\n}\n\n/**\n * Conversion metrics for a funnel\n */\nexport interface FunnelMetrics {\n  funnelType: FunnelEventType;\n  totalSessions: number;\n  stepMetrics: StepMetrics[];\n  overallConversionRate: number;\n  dropOffPoints: DropOffPoint[];\n  averageTimeToComplete: number; // in seconds\n}\n\n/**\n * Metrics for a specific step\n */\nexport interface StepMetrics {\n  step: string;\n  entered: number;\n  completed: number;\n  conversionRate: number;\n  averageTimeSpent: number; // seconds\n  dropOffRate: number;\n}\n\n/**\n * Drop-off point analysis\n */\nexport interface DropOffPoint {\n  fromStep: string;\n  toStep: string;\n  dropOffCount: number;\n  dropOffRate: number;\n  priority: 'high' | 'medium' | 'low';\n}\n\n/**\n * Session summary\n */\nexport interface SessionSummary {\n  sessionId: string;\n  userId?: string;\n  brandId?: string;\n  startedAt: Date;\n  completedAt?: Date;\n  steps: string[];\n  completed: boolean;\n  funnelType: FunnelEventType;\n}\n\n//=============================================================================\n// Funnel Tracker Service\n//=============================================================================\n\nexport class FunnelTracker {\n  private sessionId: string;\n  private userId?: string;\n  private brandId?: string;\n\n  constructor(sessionId?: string, userId?: string, brandId?: string) {\n    this.sessionId = sessionId || this.generateSessionId();\n    this.userId = userId;\n    this.brandId = brandId;\n  }\n\n  /**\n   * Track onboarding event\n   */\n  async trackOnboardingStep(\n    step: OnboardingStep,\n    metadata?: Record<string, any>\n  ): Promise<void> {\n    await this.trackEvent({\n      eventType: 'onboarding',\n      step,\n      metadata,\n    });\n  }\n\n  /**\n   * Track campaign generation event\n   */\n  async trackCampaignStep(\n    step: CampaignStep,\n    metadata?: Record<string, any>\n  ): Promise<void> {\n    await this.trackEvent({\n      eventType: 'campaign',\n      step,\n      metadata,\n    });\n  }\n\n  /**\n   * Track publishing event\n   */\n  async trackPublishingStep(\n    step: PublishingStep,\n    metadata?: Record<string, any>\n  ): Promise<void> {\n    await this.trackEvent({\n      eventType: 'publishing',\n      step,\n      metadata,\n    });\n  }\n\n  /**\n   * Core event tracking method\n   */\n  private async trackEvent(event: FunnelEvent): Promise<void> {\n    try {\n      const { error } = await supabase\n        .from('analytics_events')\n        .insert({\n          event_type: `funnel_${event.eventType}`,\n          event_data: {\n            step: event.step,\n            sessionId: this.sessionId,\n            userId: this.userId,\n            brandId: this.brandId,\n            metadata: event.metadata,\n            timestamp: new Date().toISOString(),\n          },\n          brand_id: this.brandId,\n        });\n\n      if (error) {\n        console.error('[FunnelTracker] Failed to track event:', error);\n        // Don't throw - analytics failures shouldn't break the app\n      } else {\n        console.log(`[FunnelTracker] ${event.eventType}/${event.step} tracked`);\n      }\n    } catch (error) {\n      console.error('[FunnelTracker] Track event error:', error);\n    }\n  }\n\n  /**\n   * Get session ID for current user\n   */\n  getSessionId(): string {\n    return this.sessionId;\n  }\n\n  /**\n   * Set user ID for tracking\n   */\n  setUserId(userId: string): void {\n    this.userId = userId;\n  }\n\n  /**\n   * Set brand ID for tracking\n   */\n  setBrandId(brandId: string): void {\n    this.brandId = brandId;\n  }\n\n  /**\n   * Generate unique session ID\n   */\n  private generateSessionId(): string {\n    return `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n  }\n\n  //===========================================================================\n  // Static Analysis Methods\n  //===========================================================================\n\n  /**\n   * Get funnel metrics for a specific funnel type\n   */\n  static async getFunnelMetrics(\n    funnelType: FunnelEventType,\n    brandId?: string,\n    timeframe: '7d' | '30d' | '90d' = '30d'\n  ): Promise<FunnelMetrics> {\n    const daysAgo = timeframe === '7d' ? 7 : timeframe === '30d' ? 30 : 90;\n    const cutoffDate = new Date();\n    cutoffDate.setDate(cutoffDate.getDate() - daysAgo);\n\n    try {\n      let query = supabase\n        .from('analytics_events')\n        .select('event_data, created_at')\n        .eq('event_type', `funnel_${funnelType}`)\n        .gte('created_at', cutoffDate.toISOString())\n        .order('created_at', { ascending: true });\n\n      if (brandId) {\n        query = query.eq('brand_id', brandId);\n      }\n\n      const { data, error } = await query;\n\n      if (error) {\n        console.error('[FunnelTracker] Failed to fetch metrics:', error);\n        throw error;\n      }\n\n      // Group events by session\n      const sessionMap = new Map<string, any[]>();\n      data?.forEach((event) => {\n        const sessionId = event.event_data?.sessionId;\n        if (sessionId) {\n          if (!sessionMap.has(sessionId)) {\n            sessionMap.set(sessionId, []);\n          }\n          sessionMap.get(sessionId)!.push(event);\n        }\n      });\n\n      const totalSessions = sessionMap.size;\n\n      // Calculate step metrics\n      const stepCounts = new Map<string, { entered: number; completed: number }>();\n      const stepTimes = new Map<string, number[]>();\n\n      sessionMap.forEach((events) => {\n        events.sort((a, b) => new Date(a.created_at).getTime() - new Date(b.created_at).getTime());\n\n        events.forEach((event, index) => {\n          const step = event.event_data?.step;\n          if (!step) return;\n\n          // Count entries\n          if (!stepCounts.has(step)) {\n            stepCounts.set(step, { entered: 0, completed: 0 });\n          }\n          stepCounts.get(step)!.entered++;\n\n          // Calculate time spent\n          if (index < events.length - 1) {\n            const timeSpent =\n              (new Date(events[index + 1].created_at).getTime() -\n                new Date(event.created_at).getTime()) /\n              1000;\n            if (!stepTimes.has(step)) {\n              stepTimes.set(step, []);\n            }\n            stepTimes.get(step)!.push(timeSpent);\n          }\n        });\n\n        // Mark last step as completed\n        if (events.length > 0) {\n          const lastStep = events[events.length - 1].event_data?.step;\n          if (lastStep && stepCounts.has(lastStep)) {\n            stepCounts.get(lastStep)!.completed++;\n          }\n        }\n      });\n\n      // Build step metrics\n      const stepMetrics: StepMetrics[] = Array.from(stepCounts.entries()).map(\n        ([step, counts]) => {\n          const times = stepTimes.get(step) || [];\n          const avgTime = times.length > 0 ? times.reduce((a, b) => a + b, 0) / times.length : 0;\n\n          return {\n            step,\n            entered: counts.entered,\n            completed: counts.completed,\n            conversionRate: counts.entered > 0 ? (counts.completed / counts.entered) * 100 : 0,\n            averageTimeSpent: avgTime,\n            dropOffRate: counts.entered > 0 ? ((counts.entered - counts.completed) / counts.entered) * 100 : 0,\n          };\n        }\n      );\n\n      // Sort by order of steps\n      stepMetrics.sort((a, b) => {\n        const stepOrder = this.getStepOrder(funnelType);\n        return stepOrder.indexOf(a.step) - stepOrder.indexOf(b.step);\n      });\n\n      // Calculate overall conversion rate\n      const firstStep = stepMetrics[0];\n      const lastStep = stepMetrics[stepMetrics.length - 1];\n      const overallConversionRate =\n        firstStep && lastStep && firstStep.entered > 0\n          ? (lastStep.completed / firstStep.entered) * 100\n          : 0;\n\n      // Identify drop-off points\n      const dropOffPoints = this.calculateDropOffPoints(stepMetrics);\n\n      // Calculate average time to complete\n      const completedSessions = Array.from(sessionMap.values()).filter(\n        (events) => events.length > 1\n      );\n      const completionTimes = completedSessions.map((events) => {\n        const first = new Date(events[0].created_at);\n        const last = new Date(events[events.length - 1].created_at);\n        return (last.getTime() - first.getTime()) / 1000;\n      });\n      const averageTimeToComplete =\n        completionTimes.length > 0\n          ? completionTimes.reduce((a, b) => a + b, 0) / completionTimes.length\n          : 0;\n\n      return {\n        funnelType,\n        totalSessions,\n        stepMetrics,\n        overallConversionRate,\n        dropOffPoints,\n        averageTimeToComplete,\n      };\n    } catch (error) {\n      console.error('[FunnelTracker] Get funnel metrics error:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Get sessions for a funnel type\n   */\n  static async getSessions(\n    funnelType: FunnelEventType,\n    brandId?: string,\n    limit: number = 100\n  ): Promise<SessionSummary[]> {\n    try {\n      let query = supabase\n        .from('analytics_events')\n        .select('event_data, created_at')\n        .eq('event_type', `funnel_${funnelType}`)\n        .order('created_at', { ascending: false })\n        .limit(limit * 10); // Get more events to account for multiple events per session\n\n      if (brandId) {\n        query = query.eq('brand_id', brandId);\n      }\n\n      const { data, error } = await query;\n\n      if (error) {\n        console.error('[FunnelTracker] Failed to fetch sessions:', error);\n        return [];\n      }\n\n      // Group by session\n      const sessionMap = new Map<string, any[]>();\n      data?.forEach((event) => {\n        const sessionId = event.event_data?.sessionId;\n        if (sessionId) {\n          if (!sessionMap.has(sessionId)) {\n            sessionMap.set(sessionId, []);\n          }\n          sessionMap.get(sessionId)!.push(event);\n        }\n      });\n\n      // Build session summaries\n      const sessions: SessionSummary[] = Array.from(sessionMap.entries())\n        .map(([sessionId, events]) => {\n          events.sort((a, b) => new Date(a.created_at).getTime() - new Date(b.created_at).getTime());\n\n          const firstEvent = events[0];\n          const lastEvent = events[events.length - 1];\n          const steps = events.map((e) => e.event_data?.step).filter(Boolean);\n\n          // Determine if session is completed (reached final step)\n          const finalSteps = this.getFinalSteps(funnelType);\n          const completed = steps.some((step) => finalSteps.includes(step));\n\n          return {\n            sessionId,\n            userId: firstEvent.event_data?.userId,\n            brandId: firstEvent.event_data?.brandId,\n            startedAt: new Date(firstEvent.created_at),\n            completedAt: completed ? new Date(lastEvent.created_at) : undefined,\n            steps,\n            completed,\n            funnelType,\n          };\n        })\n        .slice(0, limit);\n\n      return sessions;\n    } catch (error) {\n      console.error('[FunnelTracker] Get sessions error:', error);\n      return [];\n    }\n  }\n\n  /**\n   * Helper: Get step order for a funnel type\n   */\n  private static getStepOrder(funnelType: FunnelEventType): string[] {\n    switch (funnelType) {\n      case 'onboarding':\n        return [\n          'url_input',\n          'extraction_started',\n          'extraction_complete',\n          'confirmation_viewed',\n          'confirmation_confirmed',\n          'insights_viewed',\n          'suggestions_viewed',\n          'campaign_selected',\n          'post_selected',\n          'generation_started',\n          'generation_complete',\n          'preview_viewed',\n        ];\n      case 'campaign':\n        return [\n          'type_selector_viewed',\n          'type_selected',\n          'customization_viewed',\n          'generation_started',\n          'generation_complete',\n          'preview_viewed',\n          'editing_started',\n          'post_edited',\n          'schedule_started',\n          'schedule_complete',\n        ];\n      case 'publishing':\n        return [\n          'schedule_initiated',\n          'schedule_success',\n          'schedule_failed',\n          'publish_started',\n          'publish_success',\n          'publish_failed',\n          'retry_attempted',\n        ];\n      default:\n        return [];\n    }\n  }\n\n  /**\n   * Helper: Get final steps for a funnel\n   */\n  private static getFinalSteps(funnelType: FunnelEventType): string[] {\n    switch (funnelType) {\n      case 'onboarding':\n        return ['generation_complete', 'preview_viewed'];\n      case 'campaign':\n        return ['schedule_complete'];\n      case 'publishing':\n        return ['publish_success'];\n      default:\n        return [];\n    }\n  }\n\n  /**\n   * Helper: Calculate drop-off points\n   */\n  private static calculateDropOffPoints(stepMetrics: StepMetrics[]): DropOffPoint[] {\n    const dropOffPoints: DropOffPoint[] = [];\n\n    for (let i = 0; i < stepMetrics.length - 1; i++) {\n      const currentStep = stepMetrics[i];\n      const nextStep = stepMetrics[i + 1];\n\n      const dropOffCount = currentStep.entered - nextStep.entered;\n      const dropOffRate = currentStep.entered > 0 ? (dropOffCount / currentStep.entered) * 100 : 0;\n\n      // Only include significant drop-offs (>10%)\n      if (dropOffRate > 10) {\n        dropOffPoints.push({\n          fromStep: currentStep.step,\n          toStep: nextStep.step,\n          dropOffCount,\n          dropOffRate,\n          priority: dropOffRate > 40 ? 'high' : dropOffRate > 25 ? 'medium' : 'low',\n        });\n      }\n    }\n\n    // Sort by drop-off rate (highest first)\n    dropOffPoints.sort((a, b) => b.dropOffRate - a.dropOffRate);\n\n    return dropOffPoints;\n  }\n}\n\n//=============================================================================\n// Utility Functions\n//=============================================================================\n\n/**\n * Create singleton instance for global use\n */\nlet funnelTrackerInstance: FunnelTracker | null = null;\n\nexport function getFunnelTracker(userId?: string, brandId?: string): FunnelTracker {\n  if (!funnelTrackerInstance) {\n    funnelTrackerInstance = new FunnelTracker(undefined, userId, brandId);\n  } else {\n    if (userId) funnelTrackerInstance.setUserId(userId);\n    if (brandId) funnelTrackerInstance.setBrandId(brandId);\n  }\n  return funnelTrackerInstance;\n}\n\n/**\n * Reset singleton instance (useful for testing)\n */\nexport function resetFunnelTracker(): void {\n  funnelTrackerInstance = null;\n}\n\n/**\n * Format time duration\n */\nexport function formatDuration(seconds: number): string {\n  if (seconds < 60) return `${Math.round(seconds)}s`;\n  if (seconds < 3600) return `${Math.round(seconds / 60)}m`;\n  return `${Math.round(seconds / 3600)}h`;\n}\n\n/**\n * Get conversion rate color\n */\nexport function getConversionRateColor(rate: number): string {\n  if (rate >= 80) return 'green';\n  if (rate >= 60) return 'yellow';\n  if (rate >= 40) return 'orange';\n  return 'red';\n}\n","/**\n * Analytics Service\n * Track content generation events for product metrics\n */\n\nexport interface AnalyticsEvent {\n  event: string;\n  properties?: Record<string, any>;\n  timestamp: Date;\n}\n\nclass AnalyticsService {\n  private events: AnalyticsEvent[] = [];\n  private isProduction = import.meta.env.PROD;\n\n  /**\n   * Track an event\n   */\n  track(event: string, properties?: Record<string, any>): void {\n    const analyticsEvent: AnalyticsEvent = {\n      event,\n      properties,\n      timestamp: new Date(),\n    };\n\n    this.events.push(analyticsEvent);\n\n    // Log in development\n    if (!this.isProduction) {\n      console.log('[Analytics]', event, properties);\n    }\n\n    // In production, send to analytics service\n    // TODO: Integrate with Mixpanel, Amplitude, or PostHog\n    if (this.isProduction) {\n      this.sendToAnalytics(analyticsEvent);\n    }\n  }\n\n  /**\n   * Track content generation\n   */\n  trackContentGeneration(params: {\n    count: number;\n    industry: string;\n    duration: number;\n    avgScore: number;\n    successCount: number;\n  }): void {\n    this.track('content_generated', {\n      count: params.count,\n      industry: params.industry,\n      duration_ms: params.duration,\n      avg_score: params.avgScore,\n      success_count: params.successCount,\n      success_rate: (params.successCount / params.count) * 100,\n    });\n  }\n\n  /**\n   * Track regeneration\n   */\n  trackRegeneration(params: { platform: string; reason?: string }): void {\n    this.track('content_regenerated', {\n      platform: params.platform,\n      reason: params.reason || 'user_request',\n    });\n  }\n\n  /**\n   * Track content publishing\n   */\n  trackPublish(params: { platform: string; scheduledDate?: string }): void {\n    this.track('content_published', {\n      platform: params.platform,\n      scheduled: !!params.scheduledDate,\n      scheduled_date: params.scheduledDate,\n    });\n  }\n\n  /**\n   * Track industry selection\n   */\n  trackIndustrySelected(industry: string): void {\n    this.track('industry_selected', { industry });\n  }\n\n  /**\n   * Track errors\n   */\n  trackError(error: {\n    type: string;\n    message: string;\n    context?: Record<string, any>;\n  }): void {\n    this.track('error_occurred', {\n      error_type: error.type,\n      error_message: error.message,\n      ...error.context,\n    });\n  }\n\n  /**\n   * Get all events (for debugging)\n   */\n  getEvents(): AnalyticsEvent[] {\n    return [...this.events];\n  }\n\n  /**\n   * Clear events\n   */\n  clearEvents(): void {\n    this.events = [];\n  }\n\n  /**\n   * Send to analytics service (production)\n   */\n  private sendToAnalytics(event: AnalyticsEvent): void {\n    // TODO: Implement actual analytics integration\n    // Example: Mixpanel\n    // mixpanel.track(event.event, event.properties);\n\n    // Example: PostHog\n    // posthog.capture(event.event, event.properties);\n\n    // Example: Amplitude\n    // amplitude.track(event.event, event.properties);\n\n    // For now, just log in production\n    console.log('[Analytics - Production]', event.event, event.properties);\n  }\n}\n\nexport const analyticsService = new AnalyticsService();\n"],"names":["supabaseUrl","supabaseAnonKey","supabase","createClient","functions","functionName","payload","data","error","brandId","section","forceRefresh","message","context","conversationId","platform","topic","mode","options","content","enrichmentType","contentItemId","imageUrl","dateRange","db","table","id","filters","query","key","value","record","updates","FunnelTracker","sessionId","userId","__publicField","step","metadata","event","funnelType","timeframe","daysAgo","cutoffDate","sessionMap","_a","totalSessions","stepCounts","stepTimes","events","a","b","index","timeSpent","lastStep","stepMetrics","counts","times","avgTime","stepOrder","firstStep","overallConversionRate","dropOffPoints","completionTimes","first","averageTimeToComplete","limit","firstEvent","lastEvent","steps","e","finalSteps","completed","_b","i","currentStep","nextStep","dropOffCount","dropOffRate","funnelTrackerInstance","getFunnelTracker","AnalyticsService","properties","analyticsEvent","params","industry","analyticsService"],"mappings":"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"}