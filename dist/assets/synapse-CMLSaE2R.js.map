{"version":3,"file":"synapse-CMLSaE2R.js","sources":["../../src/services/intelligence/apify-api.ts","../../src/services/intelligence/outscraper-api.ts","../../src/services/intelligence/location-detection.service.ts","../../src/services/intelligence/youtube-api.ts","../../src/services/intelligence/news-api.ts","../../src/services/intelligence/weather-api.ts","../../src/services/intelligence/serper-api.ts","../../src/services/intelligence/semrush-api.ts","../../src/services/intelligence/website-analyzer.service.ts","../../src/services/intelligence/reddit-api.ts","../../src/services/uvp-wizard/perplexity-api.ts","../../src/services/intelligence/intelligence-cache.service.ts","../../src/services/intelligence/deepcontext-builder.service.ts","../../src/services/synapse/helpers/ConsumerSpendingData.ts","../../src/services/synapse/helpers/CostEquivalenceCalculator.ts","../../src/types/connections.types.ts","../../src/services/synapse/connections/EmbeddingService.ts","../../src/services/synapse/helpers/ConnectionHintGenerator.ts","../../src/services/synapse/SynapseGenerator.ts","../../src/services/synapse/generation/PowerWordOptimizer.ts","../../src/services/synapse/generation/ContentFrameworkLibrary.ts","../../src/services/synapse/generation/utils/audienceDetection.ts","../../src/services/synapse/generation/formats/HookPostGenerator.ts","../../src/services/synapse/generation/formats/StoryPostGenerator.ts","../../src/services/synapse/generation/formats/DataPostGenerator.ts","../../src/services/synapse/generation/formats/PremiumContentWriter.ts","../../src/services/synapse/generation/formats/ControversialPostGenerator.ts","../../src/services/synapse/generation/formats/EmailGenerator.ts","../../src/services/synapse/generation/formats/BlogGenerator.ts","../../src/services/synapse/generation/formats/LandingPageGenerator.ts","../../src/services/synapse/generation/VariantGenerator.ts","../../src/config/synapse/platformLimits.ts","../../src/services/synapse/validation/CharacterValidator.ts","../../src/services/synapse/generation/SectionRegenerator.ts","../../src/services/synapse/analysis/ContrarianAngleDetector.ts","../../src/services/synapse/generation/SynapseContentGenerator.ts","../../src/services/synapse/generation/HumorOptimizer.ts","../../src/services/intelligence/competitive-intelligence.service.ts"],"sourcesContent":["/**\n * Apify API Integration\n * Web scraping and automation using Apify Actors\n */\n\nconst APIFY_API_KEY = import.meta.env.VITE_APIFY_API_KEY\nconst APIFY_API_URL = 'https://api.apify.com/v2'\n\n// Apify Actor IDs (official actors from Apify Store)\nconst ACTORS = {\n  WEBSITE_CONTENT: 'apify/website-content-crawler',\n  GOOGLE_MAPS: 'nwua9Gu5YrADL7ZDj', // Google Maps Scraper\n  INSTAGRAM: 'apify/instagram-scraper'\n}\n\ninterface WebsiteContent {\n  url: string\n  title: string\n  description: string\n  text: string\n  headings: string[]\n  links: string[]\n  metadata: {\n    author?: string\n    keywords?: string[]\n    ogTitle?: string\n    ogDescription?: string\n  }\n}\n\ninterface GoogleMapsReview {\n  name: string\n  text: string\n  stars: number\n  publishedAtDate: string\n  likesCount?: number\n  reviewId?: string\n  reviewUrl?: string\n  reviewerId?: string\n  reviewerName?: string\n  reviewerPhotoUrl?: string\n}\n\ninterface GoogleMapsPlace {\n  placeId: string\n  name: string\n  address: string\n  rating: number\n  reviewsCount: number\n  phone?: string\n  website?: string\n  category?: string\n  reviews?: GoogleMapsReview[]\n}\n\ninterface InstagramProfile {\n  username: string\n  fullName: string\n  biography: string\n  followersCount: number\n  followsCount: number\n  postsCount: number\n  isVerified: boolean\n  url: string\n  posts: Array<{\n    url: string\n    caption: string\n    likesCount: number\n    commentsCount: number\n    timestamp: string\n  }>\n}\n\nclass ApifyAPIService {\n  /**\n   * Run an Apify Actor and wait for results\n   */\n  private async runActor(actorId: string, input: any, timeout: number = 120): Promise<any> {\n    if (!APIFY_API_KEY) {\n      throw new Error(\n        'Apify API key not configured. Add VITE_APIFY_API_KEY to your .env file. ' +\n        'Get a free API key from https://apify.com/'\n      )\n    }\n\n    try {\n      // Start actor run\n      const runResponse = await fetch(`${APIFY_API_URL}/acts/${actorId}/runs?token=${APIFY_API_KEY}`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(input)\n      })\n\n      if (!runResponse.ok) {\n        throw new Error(`Failed to start Apify actor: ${runResponse.status} ${runResponse.statusText}`)\n      }\n\n      const runData = await runResponse.json()\n      const runId = runData.data.id\n\n      console.log(`[Apify] Started actor ${actorId}, run ID: ${runId}`)\n\n      // Poll for results (wait up to timeout seconds)\n      const startTime = Date.now()\n      while (Date.now() - startTime < timeout * 1000) {\n        await new Promise(resolve => setTimeout(resolve, 2000)) // Poll every 2 seconds\n\n        const statusResponse = await fetch(\n          `${APIFY_API_URL}/actor-runs/${runId}?token=${APIFY_API_KEY}`\n        )\n\n        if (!statusResponse.ok) {\n          throw new Error(`Failed to check run status: ${statusResponse.status}`)\n        }\n\n        const statusData = await statusResponse.json()\n        const status = statusData.data.status\n\n        if (status === 'SUCCEEDED') {\n          // Get dataset items\n          const datasetId = statusData.data.defaultDatasetId\n          const datasetResponse = await fetch(\n            `${APIFY_API_URL}/datasets/${datasetId}/items?token=${APIFY_API_KEY}`\n          )\n\n          if (!datasetResponse.ok) {\n            throw new Error(`Failed to get dataset: ${datasetResponse.status}`)\n          }\n\n          const results = await datasetResponse.json()\n          console.log(`[Apify] Actor completed successfully, ${results.length} results`)\n          return results\n\n        } else if (status === 'FAILED' || status === 'ABORTED' || status === 'TIMED-OUT') {\n          throw new Error(`Actor run ${status.toLowerCase()}: ${statusData.data.statusMessage || 'Unknown error'}`)\n        }\n\n        // Still running, continue polling\n        console.log(`[Apify] Run status: ${status}, waiting...`)\n      }\n\n      throw new Error(`Actor run timed out after ${timeout} seconds`)\n\n    } catch (error) {\n      console.error('[Apify] Actor run error:', error)\n      throw error\n    }\n  }\n\n  /**\n   * Scrape website content using Apify Website Content Crawler\n   * More comprehensive than simple fetch - extracts structured content\n   */\n  async scrapeWebsiteContent(url: string): Promise<WebsiteContent> {\n    try {\n      console.log('[Apify] Scraping website content:', url)\n\n      const results = await this.runActor(ACTORS.WEBSITE_CONTENT, {\n        startUrls: [{ url }],\n        maxCrawlPages: 1,\n        crawlerType: 'cheerio'\n      })\n\n      if (!results || results.length === 0) {\n        throw new Error('No content extracted from website')\n      }\n\n      const page = results[0]\n\n      return {\n        url: page.url || url,\n        title: page.title || '',\n        description: page.description || page.metadata?.description || '',\n        text: page.text || '',\n        headings: page.headings || [],\n        links: page.links || [],\n        metadata: {\n          author: page.metadata?.author,\n          keywords: page.metadata?.keywords,\n          ogTitle: page.metadata?.og?.title,\n          ogDescription: page.metadata?.og?.description\n        }\n      }\n\n    } catch (error) {\n      console.error('[Apify] Website scraping error:', error)\n      throw error\n    }\n  }\n\n  /**\n   * Scrape Google Maps reviews using Apify Google Maps Scraper\n   */\n  async scrapeGoogleMapsReviews(options: {\n    placeId?: string\n    searchQuery?: string\n    location?: string\n    maxReviews?: number\n  }): Promise<GoogleMapsPlace[]> {\n    try {\n      console.log('[Apify] Scraping Google Maps reviews:', options)\n\n      const input: any = {\n        maxReviews: options.maxReviews || 50,\n        reviewsSort: 'newest',\n        language: 'en'\n      }\n\n      if (options.placeId) {\n        input.searchStringsArray = [`https://www.google.com/maps/place/?q=place_id:${options.placeId}`]\n      } else if (options.searchQuery && options.location) {\n        input.searchStringsArray = [`${options.searchQuery} ${options.location}`]\n      } else if (options.searchQuery) {\n        input.searchStringsArray = [options.searchQuery]\n      } else {\n        throw new Error('Either placeId or searchQuery must be provided')\n      }\n\n      const results = await this.runActor(ACTORS.GOOGLE_MAPS, input, 180) // 3 min timeout\n\n      return results.map((place: any) => ({\n        placeId: place.placeId || '',\n        name: place.title || place.name || '',\n        address: place.address || '',\n        rating: place.totalScore || place.rating || 0,\n        reviewsCount: place.reviewsCount || 0,\n        phone: place.phone,\n        website: place.website,\n        category: place.categoryName || place.category,\n        reviews: (place.reviews || []).map((review: any) => ({\n          name: review.name || review.reviewerName || '',\n          text: review.text || '',\n          stars: review.stars || 0,\n          publishedAtDate: review.publishedAtDate || review.publishAt || '',\n          likesCount: review.likesCount || 0,\n          reviewId: review.reviewId,\n          reviewUrl: review.reviewUrl,\n          reviewerId: review.reviewerId,\n          reviewerName: review.reviewerName,\n          reviewerPhotoUrl: review.reviewerPhotoUrl\n        }))\n      }))\n\n    } catch (error) {\n      console.error('[Apify] Google Maps scraping error:', error)\n      throw error\n    }\n  }\n\n  /**\n   * Scrape basic Instagram profile data using Apify Instagram Scraper\n   * Note: Instagram scraping is limited due to platform restrictions\n   */\n  async scrapeInstagramBasic(username: string, maxPosts: number = 12): Promise<InstagramProfile | null> {\n    try {\n      console.log('[Apify] Scraping Instagram profile:', username)\n\n      const results = await this.runActor(ACTORS.INSTAGRAM, {\n        directUrls: [`https://www.instagram.com/${username}/`],\n        resultsType: 'posts',\n        resultsLimit: maxPosts,\n        searchType: 'user',\n        searchLimit: 1\n      }, 180) // 3 min timeout\n\n      if (!results || results.length === 0) {\n        console.warn('[Apify] No Instagram data found for:', username)\n        return null\n      }\n\n      const profile = results[0]\n\n      return {\n        username: profile.ownerUsername || username,\n        fullName: profile.ownerFullName || '',\n        biography: profile.caption || '',\n        followersCount: profile.followersCount || 0,\n        followsCount: profile.followsCount || 0,\n        postsCount: profile.postsCount || 0,\n        isVerified: profile.isVerified || false,\n        url: profile.url || `https://www.instagram.com/${username}/`,\n        posts: results.slice(0, maxPosts).map((post: any) => ({\n          url: post.url || '',\n          caption: post.caption || '',\n          likesCount: post.likesCount || 0,\n          commentsCount: post.commentsCount || 0,\n          timestamp: post.timestamp || new Date().toISOString()\n        }))\n      }\n\n    } catch (error) {\n      console.error('[Apify] Instagram scraping error:', error)\n      // Don't throw - Instagram scraping is optional and may fail\n      return null\n    }\n  }\n\n  /**\n   * Legacy method - redirects to scrapeWebsiteContent\n   * @deprecated Use scrapeWebsiteContent instead\n   */\n  async scrapeWebsite(url: string): Promise<WebsiteContent> {\n    return this.scrapeWebsiteContent(url)\n  }\n\n  /**\n   * Legacy method - redirects to scrapeInstagramBasic\n   * @deprecated Use scrapeInstagramBasic instead\n   */\n  async scrapeInstagram(handle: string): Promise<InstagramProfile | null> {\n    return this.scrapeInstagramBasic(handle)\n  }\n}\n\nexport const ApifyAPI = new ApifyAPIService()\nexport type { WebsiteContent, GoogleMapsPlace, GoogleMapsReview, InstagramProfile }\n","/**\n * OutScraper API Integration\n * Real Google Maps business data and review scraping\n * API Docs: https://outscraper.com/api-docs/\n */\n\nimport { SerperAPI } from './serper-api'\nimport { ApifyAPI } from './apify-api'\n\nconst OUTSCRAPER_API_KEY = import.meta.env.VITE_OUTSCRAPER_API_KEY\nconst OUTSCRAPER_API_URL = 'https://api.app.outscraper.com'\n\n// ============================================================================\n// Types & Interfaces\n// ============================================================================\n\nexport interface BusinessListing {\n  place_id: string\n  name: string\n  address: string\n  phone?: string\n  website?: string\n  category: string[]\n  rating: number\n  reviews_count: number\n  price_level?: number\n  hours?: OpeningHours\n  photos?: string[]\n  verified: boolean\n  claimed?: boolean\n  latitude?: number\n  longitude?: number\n}\n\nexport interface OpeningHours {\n  monday?: string\n  tuesday?: string\n  wednesday?: string\n  thursday?: string\n  friday?: string\n  saturday?: string\n  sunday?: string\n}\n\nexport interface GoogleReview {\n  author_name: string\n  author_photo?: string\n  rating: number\n  text: string\n  time: string  // ISO date string\n  language?: string\n  likes?: number\n  author_reviews_count?: number\n  response?: {\n    text: string\n    time: string\n  }\n}\n\nexport interface BusinessProfile extends BusinessListing {\n  description?: string\n  services?: string[]\n  attributes?: Record<string, boolean>\n  popular_times?: PopularTime[]\n  reviews_per_rating?: Record<string, number>\n  reviews_tags?: string[]\n}\n\nexport interface PopularTime {\n  day: string\n  hours: { hour: number; popularity: number }[]\n}\n\nexport interface EnrichedCompetitor extends BusinessListing {\n  distance_from_brand?: number\n  relative_strength?: 'stronger' | 'similar' | 'weaker'\n  competitive_advantages?: string[]\n  shared_keywords?: string[]\n  overlapping_services?: string[]\n}\n\nexport interface SentimentAnalysis {\n  overall_sentiment: number  // 0-1\n  positive_count: number\n  negative_count: number\n  neutral_count: number\n  themes: {\n    theme: string\n    sentiment: number\n    mention_count: number\n  }[]\n  common_phrases: string[]\n}\n\nexport interface LocalRankingData {\n  keyword: string\n  position?: number\n  map_pack_position?: number\n  organic_position?: number\n  competitors_above: string[]\n}\n\n// ============================================================================\n// LinkedIn Types & Interfaces\n// ============================================================================\n\nexport interface LinkedInProfile {\n  name: string\n  headline: string\n  profileUrl: string\n  location?: string\n  company?: string\n  position?: string\n  connections?: number\n  followers?: number\n  about?: string\n  experience?: Array<{\n    title: string\n    company: string\n    duration?: string\n  }>\n  education?: Array<{\n    school: string\n    degree?: string\n  }>\n}\n\nexport interface LinkedInCompany {\n  name: string\n  profileUrl: string\n  description: string\n  industry?: string\n  companySize?: string\n  location?: string\n  followers?: number\n  employees?: number\n  website?: string\n  specialties?: string[]\n}\n\nexport interface LinkedInPost {\n  author: string\n  authorProfile?: string\n  authorHeadline?: string\n  content: string\n  postUrl: string\n  publishedAt?: string\n  engagement?: {\n    likes?: number\n    comments?: number\n    shares?: number\n  }\n  hashtags?: string[]\n  media?: {\n    type: 'image' | 'video' | 'document' | 'poll'\n    url?: string\n  }[]\n}\n\n// ============================================================================\n// OutScraper API Service\n// ============================================================================\n\nclass OutScraperAPIService {\n  private baseUrl = OUTSCRAPER_API_URL\n\n  /**\n   * Check if API key is configured\n   */\n  private checkApiKey(): void {\n    if (!OUTSCRAPER_API_KEY) {\n      throw new Error(\n        'OutScraper API key not configured.\\n' +\n        'Add VITE_OUTSCRAPER_API_KEY to your .env file.\\n' +\n        'Get a free API key from: https://outscraper.com/\\n' +\n        'Required for: Competitor discovery and review analysis'\n      )\n    }\n  }\n\n  /**\n   * Make API request with error handling\n   */\n  private async makeRequest<T>(endpoint: string, params: Record<string, any>): Promise<T> {\n    this.checkApiKey()\n\n    const url = new URL(`${this.baseUrl}${endpoint}`)\n    Object.entries(params).forEach(([key, value]) => {\n      if (value !== undefined && value !== null) {\n        url.searchParams.append(key, String(value))\n      }\n    })\n\n    try {\n      const response = await fetch(url.toString(), {\n        method: 'GET',\n        headers: {\n          'X-API-KEY': OUTSCRAPER_API_KEY!,\n          'Content-Type': 'application/json',\n        },\n      })\n\n      if (!response.ok) {\n        const errorText = await response.text()\n        throw new Error(\n          `OutScraper API error (${response.status}): ${errorText}\\n` +\n          `Endpoint: ${endpoint}\\n` +\n          `Check your API key and quota at: https://outscraper.com/dashboard/`\n        )\n      }\n\n      const data = await response.json()\n      return data as T\n    } catch (error) {\n      if (error instanceof Error) {\n        console.error('[OutScraper API] Request failed:', error.message)\n        throw error\n      }\n      throw new Error(`OutScraper API request failed: ${String(error)}`)\n    }\n  }\n\n  /**\n   * 1. Get business listings from Google Maps\n   * API Docs: https://outscraper.com/google-maps-scraper-api/\n   */\n  async getBusinessListings(params: {\n    query: string\n    location?: string\n    limit?: number\n    language?: string\n    region?: string\n  }): Promise<BusinessListing[]> {\n    console.log('[OutScraper] Fetching business listings:', params.query)\n    console.log('[OutScraper] API Key present:', !!OUTSCRAPER_API_KEY)\n\n    const endpoint = '/maps/search-v2'\n    const apiParams = {\n      query: params.location ? `${params.query} near ${params.location}` : params.query,\n      limit: params.limit || 20,\n      language: params.language || 'en',\n      region: params.region || 'US',\n      async: false, // Force synchronous mode - get results immediately, don't queue\n      fields: 'place_id,name,full_address,phone,site,category,rating,reviews,price_level,working_hours,photos_count,verified,claimed,latitude,longitude'\n    }\n\n    console.log('[OutScraper] Request params:', apiParams)\n\n    try {\n      const response = await this.makeRequest<any>(endpoint, apiParams)\n\n      console.log('[OutScraper] Raw response:', response)\n\n      // Check if request is pending (async mode)\n      if (response.status === 'Pending') {\n        console.warn('[OutScraper] Request is async/pending. Results not immediately available.')\n        console.warn('[OutScraper] OutScraper queued the request. Would need to poll:', response.results_location)\n        console.warn('[OutScraper] Using synchronous mode would be better for real-time results.')\n        return [] // Return empty for now\n      }\n\n      // OutScraper returns array of arrays (batch results)\n      const results = response.data?.[0] || []\n      console.log('[OutScraper] Extracted results array:', results)\n\n      const listings: BusinessListing[] = results.map((item: any) => ({\n        place_id: item.place_id || item.google_id || '',\n        name: item.name || '',\n        address: item.full_address || item.address || '',\n        phone: item.phone,\n        website: item.site || item.website,\n        category: Array.isArray(item.category) ? item.category : [item.category || 'Business'],\n        rating: parseFloat(item.rating) || 0,\n        reviews_count: parseInt(item.reviews) || 0,\n        price_level: item.price_level,\n        verified: item.verified === true || item.verified === 'true',\n        claimed: item.claimed === true || item.claimed === 'true',\n        latitude: item.latitude,\n        longitude: item.longitude,\n      }))\n\n      console.log('[OutScraper] Found', listings.length, 'business listings')\n      return listings\n    } catch (error) {\n      console.error('[OutScraper] getBusinessListings failed:', error)\n      console.error('[OutScraper] Error details:', error instanceof Error ? error.message : error)\n      throw error\n    }\n  }\n\n  /**\n   * 2. Scrape Google reviews for a business\n   * API Docs: https://outscraper.com/google-reviews-scraper-api/\n   *\n   * INTELLIGENT FALLBACK:\n   * 1. Try dedicated reviews endpoint (cached data)\n   * 2. If empty, try Maps Search endpoint (includes reviews with business data)\n   * 3. Return whatever real data we find\n   */\n  async scrapeGoogleReviews(params: {\n    place_id: string\n    business_name?: string // Used for Maps Search fallback\n    industry?: string // Used to make Maps Search more specific\n    location?: string // Used to make Maps Search more specific\n    limit?: number\n    sort?: 'newest' | 'highest' | 'lowest'\n    cutoff_date?: string\n  }): Promise<GoogleReview[]> {\n    console.log('[OutScraper] Scraping reviews for:', params.business_name || params.place_id)\n\n    const limit = params.limit || 100\n\n    // ATTEMPT 1: Try with place_id if provided\n    if (params.place_id) {\n      try {\n        console.log('[OutScraper] ATTEMPT 1: Trying place_id:', params.place_id)\n        const endpoint = '/maps/reviews-v2'\n        const apiParams = {\n          query: params.place_id,\n          reviewsLimit: limit,\n          sort: params.sort || 'newest',\n          cutoff: params.cutoff_date,\n          language: 'en',\n          async: false, // Force synchronous mode - get results immediately\n        }\n\n        console.log('[OutScraper] Request params:', apiParams)\n        const response = await this.makeRequest<any>(endpoint, apiParams)\n        console.log('[OutScraper] Response status:', response.status)\n        console.log('[OutScraper] Response data length:', response.data?.length)\n\n        const results = response.data?.[0] || []\n\n        // Debug: Log what we got back\n        if (results) {\n          console.log('[OutScraper] Results keys:', Object.keys(results))\n          console.log('[OutScraper] Business name from results:', results.name || results.business_name || 'not found')\n        }\n\n        const reviewsData = results.reviews_data || results.reviews || []\n\n        console.log('[OutScraper] Reviews found via place_id:', reviewsData.length)\n\n        if (reviewsData.length > 0) {\n          const reviews: GoogleReview[] = reviewsData.map((review: any) => ({\n            author_name: review.author_title || review.author_name || 'Anonymous',\n            author_photo: review.author_image || review.author_photo,\n            rating: parseInt(review.review_rating) || parseInt(review.rating) || 0,\n            text: review.review_text || review.text || '',\n            time: review.review_datetime_utc || review.time || new Date().toISOString(),\n            language: review.review_language || review.language,\n            likes: parseInt(review.review_likes) || 0,\n            author_reviews_count: parseInt(review.reviews_count) || 0,\n            response: review.owner_answer ? {\n              text: review.owner_answer,\n              time: review.owner_answer_timestamp || '',\n            } : undefined,\n          }))\n\n          console.log('[OutScraper] ✅ Found', reviews.length, 'reviews via place_id')\n          return reviews\n        } else {\n          console.warn('[OutScraper] place_id returned 0 reviews, trying name search...')\n        }\n      } catch (error) {\n        console.warn('[OutScraper] place_id lookup failed:', error)\n      }\n    }\n\n    // ATTEMPT 2: Try with business name + location\n    if (params.business_name && params.location) {\n      try {\n        console.log('[OutScraper] ATTEMPT 2: Trying business name + location search...')\n        const endpoint = '/maps/reviews-v2'\n        const query = params.industry\n          ? `${params.business_name} ${params.industry} ${params.location}`\n          : `${params.business_name} ${params.location}`\n\n        console.log('[OutScraper] Search query:', query)\n\n        const apiParams = {\n          query: query,\n          reviewsLimit: limit,\n          sort: params.sort || 'newest',\n          cutoff: params.cutoff_date,\n          language: 'en',\n          async: false, // Force synchronous mode - get results immediately\n        }\n\n        console.log('[OutScraper] Request params:', apiParams)\n        const response = await this.makeRequest<any>(endpoint, apiParams)\n        console.log('[OutScraper] Response status:', response.status)\n        console.log('[OutScraper] Response data length:', response.data?.length)\n\n        const results = response.data?.[0] || []\n\n        // Debug: Log what we got back\n        if (results) {\n          console.log('[OutScraper] Results keys:', Object.keys(results))\n          console.log('[OutScraper] Business name from results:', results.name || results.business_name || 'not found')\n        }\n\n        const reviewsData = results.reviews_data || results.reviews || []\n\n        console.log('[OutScraper] Reviews found via name search:', reviewsData.length)\n\n        if (reviewsData.length > 0) {\n          const reviews: GoogleReview[] = reviewsData.map((review: any) => ({\n            author_name: review.author_title || review.author_name || 'Anonymous',\n            author_photo: review.author_image || review.author_photo,\n            rating: parseInt(review.review_rating) || parseInt(review.rating) || 0,\n            text: review.review_text || review.text || '',\n            time: review.review_datetime_utc || review.time || new Date().toISOString(),\n            language: review.review_language || review.language,\n            likes: parseInt(review.review_likes) || 0,\n            author_reviews_count: parseInt(review.reviews_count) || 0,\n            response: review.owner_answer ? {\n              text: review.owner_answer,\n              time: review.owner_answer_timestamp || '',\n            } : undefined,\n          }))\n\n          console.log('[OutScraper] ✅ Found', reviews.length, 'reviews via name search')\n          return reviews\n        } else {\n          console.warn('[OutScraper] Name search returned 0 reviews')\n        }\n      } catch (error) {\n        console.warn('[OutScraper] Name search failed:', error)\n      }\n    }\n\n    // ATTEMPT 3: Fallback to Apify Google Maps Scraper\n    console.warn('[OutScraper] ⚠️ No reviews found via OutScraper')\n    console.log('[OutScraper] Trying Apify Google Maps fallback...')\n\n    return await this.fallbackToApify(\n      params.place_id,\n      params.business_name,\n      params.location,\n      limit\n    )\n  }\n\n  /**\n   * Fallback to Apify Google Maps Scraper for reviews\n   * More reliable than Serper as it actually returns review text\n   */\n  private async fallbackToApify(\n    placeId: string | undefined,\n    businessName: string | undefined,\n    location: string | undefined,\n    limit: number\n  ): Promise<GoogleReview[]> {\n    try {\n      console.log('[OutScraper → Apify] Starting fallback to Apify Google Maps Scraper')\n\n      // Check if we have enough info for Apify query\n      if (!placeId && (!businessName || !location)) {\n        console.warn('[OutScraper → Apify] Cannot fallback - missing placeId and business_name+location')\n        console.warn('[OutScraper → Apify] Received:', { placeId, businessName, location })\n        return []\n      }\n\n      // Build search query\n      let searchQuery: string | undefined = undefined\n      if (businessName && location) {\n        searchQuery = `${businessName} ${location}`\n        console.log(`[OutScraper → Apify] Searching with query: \"${searchQuery}\"`)\n      }\n\n      // Call Apify Google Maps Scraper\n      const apifyPlaces = await ApifyAPI.scrapeGoogleMapsReviews({\n        placeId,\n        searchQuery,\n        location,\n        maxReviews: limit\n      })\n\n      if (apifyPlaces.length === 0) {\n        console.warn('[OutScraper → Apify] No places found')\n        return []\n      }\n\n      const place = apifyPlaces[0]\n      const reviews = place.reviews || []\n\n      if (reviews.length === 0) {\n        console.warn('[OutScraper → Apify] Place found but no reviews available')\n        return []\n      }\n\n      console.log(`[OutScraper → Apify] ✅ Found ${reviews.length} reviews from Apify`)\n\n      // Convert Apify reviews to GoogleReview format\n      const googleReviews: GoogleReview[] = reviews.map(review => ({\n        author_name: review.name,\n        author_photo: review.reviewerPhotoUrl,\n        rating: review.stars,\n        text: review.text,\n        time: review.publishedAtDate,\n        language: undefined,\n        likes: review.likesCount,\n        author_reviews_count: undefined,\n        response: undefined,\n      }))\n\n      return googleReviews\n\n    } catch (error) {\n      console.error('[OutScraper → Apify] Fallback failed:', error)\n      return []\n    }\n  }\n\n  /**\n   * 3. Get detailed business profile\n   */\n  async getBusinessDetails(place_id: string): Promise<BusinessProfile> {\n    console.log('[OutScraper] Fetching business details for:', place_id)\n\n    // Use the maps search with place_id to get full details\n    const endpoint = '/maps/search-v2'\n    const apiParams = {\n      query: place_id,\n      limit: 1,\n      language: 'en',\n    }\n\n    try {\n      const response = await this.makeRequest<any>(endpoint, apiParams)\n      const results = response.data?.[0] || []\n      const item = results[0]\n\n      if (!item) {\n        throw new Error(`No business found with place_id: ${place_id}`)\n      }\n\n      const profile: BusinessProfile = {\n        place_id: item.place_id || item.google_id || '',\n        name: item.name || '',\n        address: item.full_address || item.address || '',\n        phone: item.phone,\n        website: item.site || item.website,\n        category: Array.isArray(item.category) ? item.category : [item.category || 'Business'],\n        rating: parseFloat(item.rating) || 0,\n        reviews_count: parseInt(item.reviews) || 0,\n        price_level: item.price_level,\n        verified: item.verified === true,\n        claimed: item.claimed === true,\n        latitude: item.latitude,\n        longitude: item.longitude,\n        description: item.description || item.about,\n        services: item.services || [],\n        attributes: item.attributes || {},\n      }\n\n      console.log('[OutScraper] Retrieved business profile for:', profile.name)\n      return profile\n    } catch (error) {\n      console.error('[OutScraper] getBusinessDetails failed:', error)\n      throw error\n    }\n  }\n\n  /**\n   * 4. Discover competitors with enrichment\n   */\n  async discoverCompetitors(params: {\n    businessName: string\n    location: string\n    industry: string\n    radius?: number\n  }): Promise<EnrichedCompetitor[]> {\n    console.log('[OutScraper] Discovering competitors for:', params.businessName)\n\n    // Search for competitors in the same industry\n    const query = `${params.industry} near ${params.location}`\n    const listings = await this.getBusinessListings({\n      query,\n      location: params.location,\n      limit: 20,\n    })\n\n    // Filter out the brand itself\n    const competitors = listings.filter(\n      listing => !listing.name.toLowerCase().includes(params.businessName.toLowerCase())\n    )\n\n    // Enrich with basic competitive analysis\n    const enriched: EnrichedCompetitor[] = competitors.map(competitor => ({\n      ...competitor,\n      relative_strength: this.assessRelativeStrength(competitor),\n      competitive_advantages: this.identifyAdvantages(competitor),\n    }))\n\n    console.log('[OutScraper] Found', enriched.length, 'competitors')\n    return enriched\n  }\n\n  /**\n   * 5. Analyze review sentiment\n   */\n  async analyzeReviewSentiment(reviews: GoogleReview[]): Promise<SentimentAnalysis> {\n    console.log('[OutScraper] Analyzing sentiment for', reviews.length, 'reviews')\n\n    const positive = reviews.filter(r => r.rating >= 4).length\n    const negative = reviews.filter(r => r.rating <= 2).length\n    const neutral = reviews.filter(r => r.rating === 3).length\n\n    const totalSentiment = reviews.reduce((sum, r) => sum + (r.rating / 5), 0) / reviews.length\n\n    // Extract common phrases (simplified - in production, use NLP)\n    const allText = reviews.map(r => r.text.toLowerCase()).join(' ')\n    const phrases = this.extractCommonPhrases(allText)\n\n    return {\n      overall_sentiment: totalSentiment,\n      positive_count: positive,\n      negative_count: negative,\n      neutral_count: neutral,\n      themes: this.extractThemes(reviews),\n      common_phrases: phrases,\n    }\n  }\n\n  /**\n   * 6. Get local search rankings\n   */\n  async getLocalSearchRankings(params: {\n    keywords: string[]\n    location: string\n    businessName: string\n  }): Promise<LocalRankingData[]> {\n    console.log('[OutScraper] Checking local rankings for:', params.businessName)\n\n    const rankings: LocalRankingData[] = []\n\n    for (const keyword of params.keywords) {\n      const listings = await this.getBusinessListings({\n        query: keyword,\n        location: params.location,\n        limit: 10,\n      })\n\n      const position = listings.findIndex(\n        listing => listing.name.toLowerCase().includes(params.businessName.toLowerCase())\n      )\n\n      rankings.push({\n        keyword,\n        position: position >= 0 ? position + 1 : undefined,\n        map_pack_position: position >= 0 && position < 3 ? position + 1 : undefined,\n        organic_position: position >= 3 ? position - 2 : undefined,\n        competitors_above: listings.slice(0, position > 0 ? position : 0).map(l => l.name),\n      })\n    }\n\n    return rankings\n  }\n\n  // ============================================================================\n  // LinkedIn Intelligence Methods\n  // ============================================================================\n\n  /**\n   * 7. Search LinkedIn profiles\n   * API Docs: https://outscraper.com/linkedin-profile-scraper/\n   */\n  async getLinkedInProfiles(query: string, limit: number = 20): Promise<LinkedInProfile[]> {\n    console.log('[OutScraper] Searching LinkedIn profiles:', query)\n\n    const endpoint = '/linkedin/profiles'\n    const apiParams = {\n      query,\n      limit,\n      async: false, // Force synchronous mode\n    }\n\n    try {\n      const response = await this.makeRequest<any>(endpoint, apiParams)\n\n      // OutScraper returns different formats - handle both\n      let results = response.data?.[0] || response.data || []\n\n      // If results is not an array, wrap it\n      if (!Array.isArray(results)) {\n        console.log('[OutScraper] Response is not an array, wrapping:', typeof results)\n        results = results ? [results] : []\n      }\n\n      const profiles: LinkedInProfile[] = results.map((item: any) => ({\n        name: item.name || item.full_name || '',\n        headline: item.headline || item.title || '',\n        profileUrl: item.profile_url || item.url || '',\n        location: item.location || item.geo || undefined,\n        company: item.company || item.current_company || undefined,\n        position: item.position || item.current_position || undefined,\n        connections: item.connections ? parseInt(item.connections) : undefined,\n        followers: item.followers ? parseInt(item.followers) : undefined,\n        about: item.about || item.summary || undefined,\n        experience: item.experience || [],\n        education: item.education || [],\n      }))\n\n      console.log('[OutScraper] Found', profiles.length, 'LinkedIn profiles')\n      return profiles\n    } catch (error) {\n      console.error('[OutScraper] getLinkedInProfiles failed:', error)\n      return [] // Return empty array instead of throwing\n    }\n  }\n\n  /**\n   * 8. Search LinkedIn companies\n   * API Docs: https://outscraper.com/linkedin-company-scraper/\n   */\n  async getLinkedInCompanies(query: string, limit: number = 20): Promise<LinkedInCompany[]> {\n    console.log('[OutScraper] Searching LinkedIn companies:', query)\n\n    const endpoint = '/linkedin/companies'\n    const apiParams = {\n      query,\n      limit,\n      async: false, // Force synchronous mode\n    }\n\n    try {\n      const response = await this.makeRequest<any>(endpoint, apiParams)\n\n      // OutScraper returns different formats - handle both\n      let results = response.data?.[0] || response.data || []\n\n      // If results is not an array, wrap it\n      if (!Array.isArray(results)) {\n        console.log('[OutScraper] Response is not an array, wrapping:', typeof results)\n        results = results ? [results] : []\n      }\n\n      const companies: LinkedInCompany[] = results.map((item: any) => ({\n        name: item.name || item.company_name || '',\n        profileUrl: item.profile_url || item.url || '',\n        description: item.description || item.about || '',\n        industry: item.industry || undefined,\n        companySize: item.company_size || item.size || undefined,\n        location: item.location || item.headquarters || undefined,\n        followers: item.followers ? parseInt(item.followers) : undefined,\n        employees: item.employees ? parseInt(item.employees) : undefined,\n        website: item.website || undefined,\n        specialties: item.specialties || [],\n      }))\n\n      console.log('[OutScraper] Found', companies.length, 'LinkedIn companies')\n      return companies\n    } catch (error) {\n      console.error('[OutScraper] getLinkedInCompanies failed:', error)\n      return [] // Return empty array instead of throwing\n    }\n  }\n\n  /**\n   * 9. Search LinkedIn posts\n   * API Docs: https://outscraper.com/linkedin-posts-scraper/\n   */\n  async getLinkedInPosts(query: string, limit: number = 20): Promise<LinkedInPost[]> {\n    console.log('[OutScraper] Searching LinkedIn posts:', query)\n\n    const endpoint = '/linkedin/posts'\n    const apiParams = {\n      query,\n      limit,\n      async: false, // Force synchronous mode\n    }\n\n    try {\n      const response = await this.makeRequest<any>(endpoint, apiParams)\n\n      // OutScraper returns different formats - handle both\n      let results = response.data?.[0] || response.data || []\n\n      // If results is not an array, wrap it\n      if (!Array.isArray(results)) {\n        console.log('[OutScraper] Response is not an array, wrapping:', typeof results)\n        results = results ? [results] : []\n      }\n\n      const posts: LinkedInPost[] = results.map((item: any) => ({\n        author: item.author || item.author_name || '',\n        authorProfile: item.author_profile || item.author_url || undefined,\n        authorHeadline: item.author_headline || item.author_title || undefined,\n        content: item.content || item.text || item.post_text || '',\n        postUrl: item.post_url || item.url || '',\n        publishedAt: item.published_at || item.date || item.timestamp || undefined,\n        engagement: {\n          likes: item.likes ? parseInt(item.likes) : undefined,\n          comments: item.comments ? parseInt(item.comments) : undefined,\n          shares: item.shares ? parseInt(item.shares) : undefined,\n        },\n        hashtags: item.hashtags || [],\n        media: item.media || [],\n      }))\n\n      console.log('[OutScraper] Found', posts.length, 'LinkedIn posts')\n      return posts\n    } catch (error) {\n      console.error('[OutScraper] getLinkedInPosts failed:', error)\n      return [] // Return empty array instead of throwing\n    }\n  }\n\n  // ============================================================================\n  // Helper Methods\n  // ============================================================================\n\n  private assessRelativeStrength(competitor: BusinessListing): 'stronger' | 'similar' | 'weaker' {\n    if (competitor.rating >= 4.5 && competitor.reviews_count > 100) return 'stronger'\n    if (competitor.rating >= 4.0 && competitor.reviews_count > 50) return 'similar'\n    return 'weaker'\n  }\n\n  private identifyAdvantages(competitor: BusinessListing): string[] {\n    const advantages: string[] = []\n\n    if (competitor.rating >= 4.7) advantages.push('Excellent ratings')\n    if (competitor.reviews_count > 200) advantages.push('High review volume')\n    if (competitor.verified) advantages.push('Verified business')\n    if (competitor.claimed) advantages.push('Claimed listing')\n    if (competitor.photos && competitor.photos.length > 10) advantages.push('Strong visual presence')\n\n    return advantages\n  }\n\n  private extractCommonPhrases(text: string): string[] {\n    // Simplified phrase extraction - in production, use proper NLP\n    const words = text.split(/\\s+/).filter(w => w.length > 3)\n    const frequency: Record<string, number> = {}\n\n    words.forEach(word => {\n      frequency[word] = (frequency[word] || 0) + 1\n    })\n\n    return Object.entries(frequency)\n      .sort(([, a], [, b]) => b - a)\n      .slice(0, 10)\n      .map(([word]) => word)\n  }\n\n  private extractThemes(reviews: GoogleReview[]): { theme: string; sentiment: number; mention_count: number }[] {\n    // Simplified theme extraction\n    const themes = [\n      { keyword: 'service', theme: 'Service Quality' },\n      { keyword: 'price', theme: 'Pricing' },\n      { keyword: 'staff', theme: 'Staff' },\n      { keyword: 'professional', theme: 'Professionalism' },\n      { keyword: 'quick', theme: 'Speed' },\n      { keyword: 'recommend', theme: 'Recommendation' },\n    ]\n\n    return themes.map(({ keyword, theme }) => {\n      const mentions = reviews.filter(r => r.text.toLowerCase().includes(keyword))\n      const avgSentiment = mentions.length > 0\n        ? mentions.reduce((sum, r) => sum + r.rating, 0) / mentions.length / 5\n        : 0\n\n      return {\n        theme,\n        sentiment: avgSentiment,\n        mention_count: mentions.length,\n      }\n    }).filter(t => t.mention_count > 0)\n  }\n}\n\nexport const OutScraperAPI = new OutScraperAPIService()\n","/**\n * Location Detection Service\n *\n * Automatically detects business location (city, state) from URL and other signals\n * Used to eliminate manual location entry in Synapse\n *\n * Detection methods:\n * 1. Domain parsing (e.g., dallasplumbing.com → Dallas, TX)\n * 2. WHOIS lookup (registrant address)\n * 3. Website content scraping (contact pages, footer)\n * 4. OpenAI inference from business context\n *\n * Created: 2025-11-13\n */\n\nimport { supabase } from '@/lib/supabase';\nimport { chat } from '@/lib/openrouter';\nimport { OutScraperAPI } from './outscraper-api';\n\nexport interface LocationResult {\n  city: string;\n  state: string;\n  confidence: number; // 0-1\n  method: 'domain' | 'whois' | 'scraping' | 'ai' | 'website_scraping' | 'fallback';\n  reasoning?: string;\n  allLocations?: Array<{ city: string; state: string }>; // All detected locations if multiple exist\n  hasMultipleLocations?: boolean;\n}\n\nclass LocationDetectionService {\n  /**\n   * Main detection method - tries multiple strategies\n   */\n  async detectLocation(url: string, industryHint?: string): Promise<LocationResult> {\n    console.log('[LocationDetection] Starting detection for:', url);\n\n    // Try methods in order of reliability\n    let result: LocationResult | null = null;\n\n    // Method 1: Domain parsing (fast, medium reliability)\n    result = this.detectFromDomain(url);\n    if (result && result.confidence > 0.7) {\n      console.log('[LocationDetection] ✅ Domain parsing succeeded:', result);\n      return result;\n    }\n\n    // Method 2: Supabase cache check (instant if cached)\n    result = await this.checkCache(url);\n    if (result) {\n      console.log('[LocationDetection] ✅ Cache hit:', result);\n      return result;\n    }\n    console.log('[LocationDetection] Cache miss, trying website scraping (most reliable)...');\n\n    // Method 3: Scrape website content FIRST (most businesses have location on homepage)\n    result = await this.detectFromWebsite(url, industryHint);\n    console.log('[LocationDetection] Website scraping result:', result);\n    if (result && result.confidence > 0.6) {\n      console.log('[LocationDetection] ✅ Website scraping succeeded:', result);\n      await this.cacheResult(url, result); // Cache for next time\n      return result;\n    }\n    console.log('[LocationDetection] Website scraping failed, trying AI detection...');\n\n    // Method 4: AI inference from URL + industry (domain-based)\n    result = await this.detectWithAI(url, industryHint);\n    console.log('[LocationDetection] AI detection result:', result);\n    if (result && result.confidence > 0.6) {\n      console.log('[LocationDetection] ✅ AI detection succeeded:', result);\n      await this.cacheResult(url, result); // Cache for next time\n      return result;\n    }\n    console.log('[LocationDetection] Domain-based AI detection failed, trying OutScraper...');\n\n    // Method 5: OutScraper Google Maps search (finds all locations)\n    result = await this.detectWithOutScraper(url, industryHint);\n    console.log('[LocationDetection] OutScraper detection result:', result);\n    if (result && result.confidence > 0.7) {\n      console.log('[LocationDetection] ✅ OutScraper detection succeeded:', result);\n      await this.cacheResult(url, result); // Cache for next time\n      return result;\n    }\n    console.log('[LocationDetection] ⚠️ All detection methods failed');\n\n    // No fallback - return null so user can manually enter location\n    return null;\n  }\n\n  /**\n   * Method 1: Parse location from domain name\n   * Examples: dallasplumbing.com, austinroofing.net, nycplumber.com\n   */\n  private detectFromDomain(url: string): LocationResult | null {\n    try {\n      // Normalize URL to ensure it has a protocol\n      const normalizedUrl = url.match(/^https?:\\/\\//i) ? url : `https://${url}`;\n      const domain = new URL(normalizedUrl).hostname.toLowerCase()\n        .replace('www.', '')\n        .split('.')[0]; // Get just the domain name\n\n      // City patterns\n      const cityPatterns: Record<string, { city: string; state: string }> = {\n        // Major cities\n        'nyc|newyork': { city: 'New York', state: 'NY' },\n        'dallas': { city: 'Dallas', state: 'TX' },\n        'austin': { city: 'Austin', state: 'TX' },\n        'houston': { city: 'Houston', state: 'TX' },\n        'sanantonio': { city: 'San Antonio', state: 'TX' },\n        'phoenix': { city: 'Phoenix', state: 'AZ' },\n        'philadelphia|philly': { city: 'Philadelphia', state: 'PA' },\n        'sandiego': { city: 'San Diego', state: 'CA' },\n        'sanjose': { city: 'San Jose', state: 'CA' },\n        'jacksonville': { city: 'Jacksonville', state: 'FL' },\n        'fortworth': { city: 'Fort Worth', state: 'TX' },\n        'columbus': { city: 'Columbus', state: 'OH' },\n        'charlotte': { city: 'Charlotte', state: 'NC' },\n        'sanfrancisco|sf': { city: 'San Francisco', state: 'CA' },\n        'indianapolis': { city: 'Indianapolis', state: 'IN' },\n        'seattle': { city: 'Seattle', state: 'WA' },\n        'denver': { city: 'Denver', state: 'CO' },\n        'washington|dc': { city: 'Washington', state: 'DC' },\n        'boston': { city: 'Boston', state: 'MA' },\n        'elpaso': { city: 'El Paso', state: 'TX' },\n        'nashville': { city: 'Nashville', state: 'TN' },\n        'detroit': { city: 'Detroit', state: 'MI' },\n        'memphis': { city: 'Memphis', state: 'TN' },\n        'portland': { city: 'Portland', state: 'OR' },\n        'oklahomacity': { city: 'Oklahoma City', state: 'OK' },\n        'lasvegas|vegas': { city: 'Las Vegas', state: 'NV' },\n        'louisville': { city: 'Louisville', state: 'KY' },\n        'baltimore': { city: 'Baltimore', state: 'MD' },\n        'milwaukee': { city: 'Milwaukee', state: 'WI' },\n        'albuquerque': { city: 'Albuquerque', state: 'NM' },\n        'tucson': { city: 'Tucson', state: 'AZ' },\n        'fresno': { city: 'Fresno', state: 'CA' },\n        'mesa': { city: 'Mesa', state: 'AZ' },\n        'sacramento': { city: 'Sacramento', state: 'CA' },\n        'atlanta': { city: 'Atlanta', state: 'GA' },\n        'kansascity': { city: 'Kansas City', state: 'MO' },\n        'colorado': { city: 'Denver', state: 'CO' },\n        'miami': { city: 'Miami', state: 'FL' },\n        'raleigh': { city: 'Raleigh', state: 'NC' },\n        'omaha': { city: 'Omaha', state: 'NE' },\n        'longbeach': { city: 'Long Beach', state: 'CA' },\n        'virginia': { city: 'Virginia Beach', state: 'VA' },\n        'oakland': { city: 'Oakland', state: 'CA' },\n        'minneapolis': { city: 'Minneapolis', state: 'MN' },\n        'tulsa': { city: 'Tulsa', state: 'OK' },\n        'tampa': { city: 'Tampa', state: 'FL' },\n        'arlington': { city: 'Arlington', state: 'TX' },\n        'neworleans': { city: 'New Orleans', state: 'LA' },\n        'chicago': { city: 'Chicago', state: 'IL' },\n        'losangeles|la': { city: 'Los Angeles', state: 'CA' },\n      };\n\n      for (const [pattern, location] of Object.entries(cityPatterns)) {\n        // Match only if city name is at the START of domain or is a complete word\n        // This prevents \"thephoenix\" from matching \"phoenix\"\n        const regex = new RegExp(`^${pattern}(?![a-z])`, 'i');\n        if (regex.test(domain)) {\n          return {\n            ...location,\n            confidence: 0.8,\n            method: 'domain',\n            reasoning: `Detected \"${location.city}\" in domain name`\n          };\n        }\n      }\n\n      return null;\n    } catch (error) {\n      console.error('[LocationDetection] Domain parsing error:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Method 2: Check Supabase cache\n   */\n  private async checkCache(url: string): Promise<LocationResult | null> {\n    try {\n      // Normalize URL to ensure it has a protocol\n      const normalizedUrl = url.match(/^https?:\\/\\//i) ? url : `https://${url}`;\n      const domain = new URL(normalizedUrl).hostname;\n\n      const { data, error } = await supabase\n        .from('location_detection_cache')\n        .select('city, state, confidence, method, reasoning')\n        .eq('domain', domain)\n        .single();\n\n      if (error) {\n        // Log 406 errors for debugging\n        if (error.message?.includes('406')) {\n          console.log('[LocationDetection] ⚠️ Cache table not accessible (406) - PostgREST cache issue, falling through to AI detection');\n        }\n        // Silently fail - cache is optional, will use AI detection\n        return null;\n      }\n\n      if (!data) return null;\n\n      // Invalidate old cache entries that don't have multi-location support\n      if (data.hasMultipleLocations === undefined) {\n        console.log('[LocationDetection] Cache entry outdated (no multi-location support), invalidating...');\n        return null;\n      }\n\n      // Check if cache is still valid (30 days)\n      return data as LocationResult;\n    } catch (error) {\n      console.log('[LocationDetection] Cache check error:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Method 3: Use AI to infer location from URL and industry context\n   */\n  private async detectWithAI(url: string, industryHint?: string): Promise<LocationResult | null> {\n    console.log('[LocationDetection] Starting AI detection for:', url);\n    try {\n      // Ensure URL has protocol\n      const fullUrl = url.startsWith('http') ? url : `https://${url}`;\n      const domain = new URL(fullUrl).hostname;\n\n      const prompt = `You are a location detection expert. Analyze this business URL and determine the most likely city and state.\n\nURL: ${url}\nDomain: ${domain}\n${industryHint ? `Industry: ${industryHint}` : ''}\n\nLook for location clues in:\n1. Domain name (e.g., \"dallasplumbing.com\" → Dallas, TX)\n2. Common city abbreviations or nicknames\n3. Regional service patterns\n\nRespond ONLY with valid JSON in this exact format:\n{\n  \"city\": \"City Name\",\n  \"state\": \"XX\",\n  \"confidence\": 0.0-1.0,\n  \"reasoning\": \"brief explanation\"\n}\n\nIf you cannot detect a location with confidence > 0.5, respond with:\n{\n  \"city\": null,\n  \"state\": null,\n  \"confidence\": 0.0,\n  \"reasoning\": \"Could not detect location from URL\"\n}`;\n\n      console.log('[LocationDetection] Calling OpenRouter AI...');\n      const response = await chat([\n        {\n          role: 'user',\n          content: prompt\n        }\n      ], {\n        model: 'anthropic/claude-3.5-sonnet',\n        temperature: 0.3,\n        max_tokens: 200\n      });\n\n      console.log('[LocationDetection] AI response received:', response?.substring(0, 100));\n      const text = response.trim();\n      const jsonMatch = text.match(/\\{[\\s\\S]*\\}/);\n      if (!jsonMatch) {\n        console.error('[LocationDetection] No JSON in AI response:', text);\n        throw new Error('No JSON in AI response');\n      }\n\n      const result = JSON.parse(jsonMatch[0]);\n      console.log('[LocationDetection] Parsed AI result:', result);\n\n      if (!result.city || !result.state || result.confidence < 0.5) {\n        console.log('[LocationDetection] AI result rejected: city/state missing or confidence < 0.5');\n        return null;\n      }\n\n      return {\n        city: result.city,\n        state: result.state,\n        confidence: result.confidence,\n        method: 'ai',\n        reasoning: result.reasoning\n      };\n    } catch (error) {\n      console.error('[LocationDetection] AI inference error:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Method 3.5: Use OutScraper to find business on Google Maps\n   */\n  private async detectWithOutScraper(url: string, industryHint?: string): Promise<LocationResult | null> {\n    console.log('[LocationDetection] Starting OutScraper detection for:', url);\n    try {\n      // Ensure URL has protocol\n      const fullUrl = url.startsWith('http') ? url : `https://${url}`;\n      // Extract business name from domain\n      const domain = new URL(fullUrl).hostname.replace('www.', '').split('.')[0];\n\n      // Smart business name extraction\n      let businessName = domain.replace(/[-_]/g, ' ');\n\n      // Handle common suffixes (restaurant, cafe, bar, grill, etc.)\n      const suffixes = ['restaurant', 'cafe', 'bar', 'grill', 'bistro', 'eatery', 'kitchen', 'dining'];\n      for (const suffix of suffixes) {\n        // Match suffix at the end (case insensitive)\n        const regex = new RegExp(suffix + '$', 'i');\n        if (regex.test(businessName)) {\n          // Split it: \"thehenryrestaurant\" -> \"thehenry restaurant\"\n          businessName = businessName.replace(regex, ` ${suffix}`);\n          break;\n        }\n      }\n\n      // Handle \"the\" prefix: \"the henry\" -> \"The Henry\"\n      businessName = businessName.replace(/^the\\s+/i, 'The ');\n\n      // Capitalize words\n      businessName = businessName\n        .split(' ')\n        .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())\n        .join(' ')\n        .trim();\n\n      console.log('[LocationDetection] Searching Google Maps for:', businessName);\n\n      // Search Google Maps via OutScraper\n      const listings = await OutScraperAPI.getBusinessListings({\n        query: businessName,\n        limit: 50  // Get up to 50 results to find all locations\n      });\n\n      console.log('[LocationDetection] OutScraper found', listings.length, 'listings');\n\n      if (listings.length === 0) {\n        return null;\n      }\n\n      // Extract unique city/state pairs from addresses\n      const locationSet = new Set<string>();\n      const allLocations: Array<{ city: string; state: string }> = [];\n\n      for (const listing of listings) {\n        if (!listing.address) {\n          console.log('[LocationDetection] Skipping listing with no address:', listing.name);\n          continue;\n        }\n\n        console.log('[LocationDetection] Parsing address:', listing.address);\n\n        // Parse city/state from address\n        // Try multiple formats:\n        // 1. \"123 Main St, Dallas, TX 75201, USA\"\n        // 2. \"123 Main St, Dallas, TX 75201\"\n        // 3. \"Dallas, TX 75201\"\n        const addressParts = listing.address.split(',').map(p => p.trim());\n\n        console.log('[LocationDetection] Address parts:', addressParts);\n\n        let city = '';\n        let state = '';\n\n        // Try to find city and state\n        for (let i = addressParts.length - 1; i >= 0; i--) {\n          const part = addressParts[i];\n\n          // Check if this part contains state code (2 letters followed by optional zip)\n          const stateMatch = part.match(/\\b([A-Z]{2})\\b/);\n          if (stateMatch && !state) {\n            state = stateMatch[1];\n            // City is typically the part before the state\n            if (i > 0) {\n              city = addressParts[i - 1];\n            }\n            break;\n          }\n        }\n\n        if (city && state && state.length === 2) {\n          const key = `${city}|${state}`;\n          if (!locationSet.has(key)) {\n            locationSet.add(key);\n            allLocations.push({ city, state });\n            console.log('[LocationDetection] ✅ Extracted location:', { city, state });\n          }\n        } else {\n          console.log('[LocationDetection] ❌ Failed to extract location from:', listing.address);\n        }\n      }\n\n      console.log('[LocationDetection] Extracted', allLocations.length, 'unique locations from OutScraper');\n\n      if (allLocations.length === 0) {\n        return null;\n      }\n\n      // Single location\n      if (allLocations.length === 1) {\n        return {\n          city: allLocations[0].city,\n          state: allLocations[0].state,\n          confidence: 0.9,\n          method: 'ai',\n          reasoning: `Found single location via Google Maps: ${allLocations[0].city}, ${allLocations[0].state}`,\n          hasMultipleLocations: false\n        };\n      }\n\n      // Multiple locations\n      return {\n        city: allLocations[0].city,  // First as primary\n        state: allLocations[0].state,\n        confidence: 0.95,\n        method: 'ai',\n        reasoning: `Found ${allLocations.length} locations via Google Maps, primary: ${allLocations[0].city}, ${allLocations[0].state}`,\n        hasMultipleLocations: true,\n        allLocations\n      };\n\n    } catch (error) {\n      console.error('[LocationDetection] OutScraper detection error:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Method 4: Scrape website content and extract location\n   */\n  private async detectFromWebsite(url: string, industryHint?: string): Promise<LocationResult | null> {\n    console.log('[LocationDetection] Fetching website content...');\n\n    // Normalize URL to ensure it has a protocol\n    const normalizedUrl = url.match(/^https?:\\/\\//i) ? url : `https://${url}`;\n\n    // Try common location page URLs first (highest quality data)\n    const baseUrl = new URL(normalizedUrl).origin;\n    const locationPages = [\n      `${baseUrl}/locations`,\n      `${baseUrl}/locations-menus`,\n      `${baseUrl}/find-us`,\n      `${baseUrl}/contact`,\n      `${baseUrl}/store-locator`,\n      `${baseUrl}/our-locations`\n    ];\n\n    // Try each location page\n    for (const locationPageUrl of locationPages) {\n      console.log('[LocationDetection] Trying location page:', locationPageUrl);\n      const result = await this.scrapeAndAnalyze(locationPageUrl, industryHint);\n      if (result && result.confidence > 0.6) {\n        console.log('[LocationDetection] ✅ Found locations on dedicated page:', locationPageUrl);\n        return result;\n      }\n    }\n\n    // Fallback to homepage if no location page found\n    console.log('[LocationDetection] No location page found, trying homepage...');\n    return await this.scrapeAndAnalyze(normalizedUrl, industryHint);\n  }\n\n  /**\n   * Scrape a URL and analyze for locations\n   */\n  private async scrapeAndAnalyze(url: string, industryHint?: string): Promise<LocationResult | null> {\n    try {\n      // Use Supabase Edge Function to scrape website\n      const { data, error } = await supabase.functions.invoke('scrape-website', {\n        body: { url }\n      });\n\n      if (error || !data?.content) {\n        console.log('[LocationDetection] Scraping failed for:', url, error?.message || 'No content');\n        return null;\n      }\n\n      // Extract text from the structured content object\n      const contentObj = data.content;\n\n      // PRIORITIZE structured data (JSON-LD, script tags) then navigation, addresses\n      const structuredContent = [\n        '=== STRUCTURED DATA (JSON-LD, SCRIPT TAGS) ===',\n        contentObj.structuredData || '',\n        '',\n        '=== NAVIGATION & LOCATION SELECTORS ===',\n        contentObj.navigation || '',\n        '',\n        '=== ADDRESSES ===',\n        contentObj.addresses || '',\n        '',\n        '=== FOOTER ===',\n        contentObj.footer || '',\n        '',\n        '=== PAGE CONTENT ===',\n        contentObj.title || '',\n        contentObj.description || '',\n        ...(contentObj.headings || []),\n        contentObj.text || ''\n      ].join('\\n');\n\n      const content = structuredContent.substring(0, 8000); // Increased for JSON data\n      console.log('[LocationDetection] Website content fetched');\n      console.log('[LocationDetection] - Structured data length:', contentObj.structuredData?.length || 0);\n      console.log('[LocationDetection] - Navigation length:', contentObj.navigation?.length || 0);\n      console.log('[LocationDetection] - Addresses length:', contentObj.addresses?.length || 0);\n      console.log('[LocationDetection] - Footer length:', contentObj.footer?.length || 0);\n      console.log('[LocationDetection] - Total content length:', content.length);\n\n      const prompt = `You are a location detection expert. Analyze this website content and extract ALL physical business locations.\n\nURL: ${url}\n${industryHint ? `Industry: ${industryHint}` : ''}\n\nWebsite Content (prioritized sections):\n${content}\n\nCRITICAL INSTRUCTIONS:\nThis may be a LOCATIONS PAGE or HOMEPAGE. Extract EVERY location mentioned.\n\nLook for:\n1. **STRUCTURED DATA (HIGHEST PRIORITY)** - JSON-LD, script tags with location arrays\n   - Look for JSON objects with \"address\", \"location\", \"city\", \"state\" fields\n   - Parse JavaScript data structures embedded in the page\n   - Example: {\"locations\": [{\"city\": \"Dallas\", \"state\": \"TX\"}, ...]}\n\n2. **LOCATION LISTS** - Lists of cities/states with addresses\n   - \"Dallas, TX\", \"Houston, TX\", \"Miami, FL\" etc.\n   - Full addresses: \"123 Main St, Dallas, TX 75201\"\n   - Location cards or sections\n\n3. **NAVIGATION & SELECTORS** - Dropdowns with city names\n\n4. **ADDRESSES** - Structured address elements\n\n5. **CONTACT INFO** - Footer addresses, phone numbers with area codes\n\nIGNORE:\n- Service areas without physical addresses\n- \"Coming Soon\" announcements\n- Promotional hero banners (these show NEWEST, not primary)\n\nDetermine PRIMARY location:\n- First location listed on locations page\n- HQ or headquarters designation\n- Most detailed address info\n- NOT the promotional banner location\n\nExtract EVERY city and state pair you find. If you see 9 locations, return all 9.\n\nRespond ONLY with valid JSON in this exact format:\n\nIf SINGLE location found:\n{\n  \"city\": \"City Name\",\n  \"state\": \"XX\",\n  \"confidence\": 0.0-1.0,\n  \"hasMultipleLocations\": false,\n  \"reasoning\": \"explanation\"\n}\n\nIf MULTIPLE locations found:\n{\n  \"city\": \"Primary City\",\n  \"state\": \"XX\",\n  \"confidence\": 0.0-1.0,\n  \"hasMultipleLocations\": true,\n  \"allLocations\": [\n    {\"city\": \"City1\", \"state\": \"XX\"},\n    {\"city\": \"City2\", \"state\": \"YY\"}\n  ],\n  \"reasoning\": \"Found N locations, primary is City1 based on...\"\n}\n\nIf NO location found:\n{\n  \"city\": null,\n  \"state\": null,\n  \"confidence\": 0.0,\n  \"hasMultipleLocations\": false,\n  \"reasoning\": \"No location information found\"\n}`;\n\n      console.log('[LocationDetection] Analyzing website content with AI...');\n      const response = await chat([\n        {\n          role: 'user',\n          content: prompt\n        }\n      ], {\n        model: 'anthropic/claude-3.5-sonnet',\n        temperature: 0.2,\n        max_tokens: 500  // Increased to handle multiple locations\n      });\n\n      console.log('[LocationDetection] Website analysis response:', response?.substring(0, 100));\n      const text = response.trim();\n      const jsonMatch = text.match(/\\{[\\s\\S]*\\}/);\n      if (!jsonMatch) {\n        console.error('[LocationDetection] No JSON in website analysis response');\n        return null;\n      }\n\n      const result = JSON.parse(jsonMatch[0]);\n      console.log('[LocationDetection] Parsed website analysis result:', result);\n\n      // Accept if we have both city and state with good confidence\n      // OR if we have state-only with very high confidence (0.7+)\n      const hasRequiredData = (result.city && result.state) || (result.state && result.confidence >= 0.7);\n\n      if (!hasRequiredData || result.confidence < 0.5) {\n        console.log('[LocationDetection] Website analysis rejected: insufficient confidence or missing data');\n        return null;\n      }\n\n      return {\n        city: result.city || null, // Allow null for state-only results\n        state: result.state,\n        confidence: result.confidence,\n        method: 'website_scraping',\n        reasoning: result.reasoning,\n        hasMultipleLocations: result.hasMultipleLocations || false,\n        allLocations: result.allLocations || undefined\n      };\n    } catch (error) {\n      console.error('[LocationDetection] Website scraping error:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Cache the result for future lookups\n   */\n  private async cacheResult(url: string, result: LocationResult): Promise<void> {\n    try {\n      // Normalize URL to ensure it has a protocol\n      const normalizedUrl = url.match(/^https?:\\/\\//i) ? url : `https://${url}`;\n      const domain = new URL(normalizedUrl).hostname;\n\n      // Delete old entry first to avoid conflicts\n      await supabase\n        .from('location_detection_cache')\n        .delete()\n        .eq('domain', domain);\n\n      // Insert new entry\n      await supabase\n        .from('location_detection_cache')\n        .insert({\n          domain,\n          city: result.city,\n          state: result.state,\n          confidence: result.confidence,\n          method: result.method,\n          reasoning: result.reasoning,\n          hasMultipleLocations: result.hasMultipleLocations || false,\n          allLocations: result.allLocations || null,\n          updated_at: new Date().toISOString()\n        });\n\n      console.log('[LocationDetection] Cached result for:', domain);\n    } catch (error) {\n      // Silently fail - caching is optional\n      console.log('[LocationDetection] Cache save failed (non-critical):', error);\n    }\n  }\n\n  /**\n   * Format location as string\n   */\n  formatLocation(result: LocationResult): string {\n    return `${result.city}, ${result.state}`;\n  }\n}\n\nexport const locationDetectionService = new LocationDetectionService();\nexport type { LocationResult };\n","/**\n * YouTube Data API Integration\n * Analyzes trending videos and content for industry insights\n */\n\nconst YOUTUBE_API_KEY = import.meta.env.VITE_YOUTUBE_API_KEY\nconst CACHE_TTL = 60 * 60 * 1000 // 1 hour\n\ninterface YouTubeVideo {\n  id: string\n  title: string\n  description: string\n  channelTitle: string\n  publishedAt: string\n  viewCount: number\n  likeCount: number\n  commentCount: number\n  tags: string[]\n  categoryId: string\n}\n\ninterface TrendAnalysis {\n  trending_topics: string[]\n  popular_formats: string[]\n  engagement_patterns: {\n    avgViewCount: number\n    avgEngagementRate: number\n    peakPostingTimes: string[]\n  }\n  content_angles: string[]\n  relevance_score: number\n}\n\nclass YouTubeAPIService {\n  private cache: Map<string, { data: any; timestamp: number }> = new Map()\n\n  private getCached(key: string): any | null {\n    const cached = this.cache.get(key)\n    if (cached && Date.now() - cached.timestamp < CACHE_TTL) {\n      return cached.data\n    }\n    this.cache.delete(key)\n    return null\n  }\n\n  private setCache(key: string, data: any): void {\n    this.cache.set(key, { data, timestamp: Date.now() })\n  }\n\n  /**\n   * Get trending videos for a specific category and region\n   */\n  async getTrendingVideos(category?: string, region: string = 'US'): Promise<YouTubeVideo[]> {\n    const cacheKey = `trending_${category}_${region}`\n    const cached = this.getCached(cacheKey)\n    if (cached) return cached\n\n    if (!YOUTUBE_API_KEY) {\n      throw new Error(\n        'YouTube API key not configured. Add VITE_YOUTUBE_API_KEY to your .env file. ' +\n        'Get a free API key from https://console.cloud.google.com/apis/library/youtube.googleapis.com'\n      )\n    }\n\n    try {\n      const categoryParam = category ? `&videoCategoryId=${category}` : ''\n      const url = `https://www.googleapis.com/youtube/v3/videos?part=snippet,statistics&chart=mostPopular&regionCode=${region}${categoryParam}&maxResults=50&key=${YOUTUBE_API_KEY}`\n\n      const response = await fetch(url)\n\n      if (!response.ok) {\n        throw new Error(`YouTube API error: ${response.statusText}`)\n      }\n\n      const data = await response.json()\n\n      const videos: YouTubeVideo[] = data.items.map((item: any) => ({\n        id: item.id,\n        title: item.snippet.title,\n        description: item.snippet.description,\n        channelTitle: item.snippet.channelTitle,\n        publishedAt: item.snippet.publishedAt,\n        viewCount: parseInt(item.statistics.viewCount || '0'),\n        likeCount: parseInt(item.statistics.likeCount || '0'),\n        commentCount: parseInt(item.statistics.commentCount || '0'),\n        tags: item.snippet.tags || [],\n        categoryId: item.snippet.categoryId\n      }))\n\n      this.setCache(cacheKey, videos)\n      return videos\n    } catch (error) {\n      console.error('[YouTube API] Error fetching trending videos:', error)\n      throw error\n    }\n  }\n\n  /**\n   * Search videos by keywords\n   */\n  async searchVideos(keywords: string[], maxResults: number = 20): Promise<YouTubeVideo[]> {\n    const query = keywords.join(' ')\n    const cacheKey = `search_${query}_${maxResults}`\n    const cached = this.getCached(cacheKey)\n    if (cached) return cached\n\n    if (!YOUTUBE_API_KEY) {\n      throw new Error(\n        'YouTube API key not configured. Add VITE_YOUTUBE_API_KEY to your .env file. ' +\n        'Get a free API key from https://console.cloud.google.com/apis/library/youtube.googleapis.com'\n      )\n    }\n\n    try {\n      // First, search for video IDs\n      const searchUrl = `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(query)}&type=video&maxResults=${maxResults}&key=${YOUTUBE_API_KEY}`\n\n      const searchResponse = await fetch(searchUrl)\n\n      if (!searchResponse.ok) {\n        throw new Error(`YouTube search error: ${searchResponse.statusText}`)\n      }\n\n      const searchData = await searchResponse.json()\n      const videoIds = searchData.items.map((item: any) => item.id.videoId).join(',')\n\n      // Then, get video details including statistics\n      const videosUrl = `https://www.googleapis.com/youtube/v3/videos?part=snippet,statistics&id=${videoIds}&key=${YOUTUBE_API_KEY}`\n\n      const videosResponse = await fetch(videosUrl)\n      const videosData = await videosResponse.json()\n\n      const videos: YouTubeVideo[] = videosData.items.map((item: any) => ({\n        id: item.id,\n        title: item.snippet.title,\n        description: item.snippet.description,\n        channelTitle: item.snippet.channelTitle,\n        publishedAt: item.snippet.publishedAt,\n        viewCount: parseInt(item.statistics.viewCount || '0'),\n        likeCount: parseInt(item.statistics.likeCount || '0'),\n        commentCount: parseInt(item.statistics.commentCount || '0'),\n        tags: item.snippet.tags || [],\n        categoryId: item.snippet.categoryId\n      }))\n\n      this.setCache(cacheKey, videos)\n      return videos\n    } catch (error) {\n      console.error('[YouTube API] Error searching videos:', error)\n      throw error\n    }\n  }\n\n  /**\n   * Analyze video trends for an industry\n   */\n  async analyzeVideoTrends(industry: string, keywords: string[]): Promise<TrendAnalysis> {\n    const cacheKey = `trends_${industry}_${keywords.join('_')}`\n    const cached = this.getCached(cacheKey)\n    if (cached) return cached\n\n    try {\n      const videos = await this.searchVideos(keywords, 50)\n\n      // Extract trending topics from titles and tags\n      const allTags = videos.flatMap(v => v.tags)\n      const tagFrequency = allTags.reduce((acc, tag) => {\n        acc[tag] = (acc[tag] || 0) + 1\n        return acc\n      }, {} as Record<string, number>)\n\n      const trendingTopics = Object.entries(tagFrequency)\n        .sort((a, b) => b[1] - a[1])\n        .slice(0, 10)\n        .map(([tag]) => tag)\n\n      // Analyze formats based on titles\n      const formats: Record<string, number> = {}\n      videos.forEach(v => {\n        if (v.title.toLowerCase().includes('tutorial')) formats['Tutorial'] = (formats['Tutorial'] || 0) + 1\n        if (v.title.toLowerCase().includes('review')) formats['Review'] = (formats['Review'] || 0) + 1\n        if (v.title.toLowerCase().includes('how to')) formats['How-To'] = (formats['How-To'] || 0) + 1\n        if (v.title.toLowerCase().includes('tips')) formats['Tips'] = (formats['Tips'] || 0) + 1\n        if (v.title.toLowerCase().includes('vs')) formats['Comparison'] = (formats['Comparison'] || 0) + 1\n      })\n\n      const popularFormats = Object.entries(formats)\n        .sort((a, b) => b[1] - a[1])\n        .slice(0, 5)\n        .map(([format]) => format)\n\n      // Calculate engagement metrics\n      const avgViewCount = videos.reduce((sum, v) => sum + v.viewCount, 0) / videos.length\n      const avgEngagementRate = videos.reduce((sum, v) => {\n        const engagement = (v.likeCount + v.commentCount) / (v.viewCount || 1)\n        return sum + engagement\n      }, 0) / videos.length\n\n      // Extract content angles\n      const contentAngles = [\n        ...new Set(videos.slice(0, 10).map(v => {\n          const title = v.title.toLowerCase()\n          if (title.includes('beginner')) return 'Beginner-friendly content'\n          if (title.includes('advanced')) return 'Advanced techniques'\n          if (title.includes('mistake')) return 'Common mistakes to avoid'\n          if (title.includes('secret')) return 'Insider secrets'\n          if (title.includes('best')) return 'Best practices'\n          return 'Educational content'\n        }))\n      ]\n\n      const analysis: TrendAnalysis = {\n        trending_topics: trendingTopics,\n        popular_formats: popularFormats,\n        engagement_patterns: {\n          avgViewCount: Math.round(avgViewCount),\n          avgEngagementRate: parseFloat((avgEngagementRate * 100).toFixed(2)),\n          peakPostingTimes: ['10 AM EST', '2 PM EST', '6 PM EST'] // Would need posting time analysis\n        },\n        content_angles: contentAngles,\n        relevance_score: Math.min(100, Math.round((videos.length / 50) * 100))\n      }\n\n      this.setCache(cacheKey, analysis)\n      return analysis\n    } catch (error) {\n      console.error('[YouTube API] Error analyzing trends:', error)\n      throw error\n    }\n  }\n}\n\nexport const YouTubeAPI = new YouTubeAPIService()\nexport type { YouTubeVideo, TrendAnalysis }\n","/**\n * News API Integration\n * Fetches industry news and local events for opportunity detection\n */\n\nconst NEWS_API_KEY = import.meta.env.VITE_NEWS_API_KEY\nconst CACHE_TTL = 60 * 60 * 1000 // 1 hour\n\ninterface NewsArticle {\n  title: string\n  description: string\n  url: string\n  publishedAt: string\n  source: string\n  author?: string\n  content?: string\n  relevanceScore: number\n}\n\nclass NewsAPIService {\n  private cache: Map<string, { data: any; timestamp: number }> = new Map()\n\n  private getCached(key: string): any | null {\n    const cached = this.cache.get(key)\n    if (cached && Date.now() - cached.timestamp < CACHE_TTL) return cached.data\n    this.cache.delete(key)\n    return null\n  }\n\n  private setCache(key: string, data: any): void {\n    this.cache.set(key, { data, timestamp: Date.now() })\n  }\n\n  /**\n   * Generate broader search terms from specific industry names\n   * Examples: \"HVAC Services\" -> [\"HVAC\", \"heating\", \"cooling\", \"air conditioning\", \"small business\"]\n   */\n  private generateBroaderSearchTerms(industry: string, keywords: string[]): string[] {\n    const broaderTerms = new Set<string>()\n\n    // Always include the original terms\n    keywords.forEach(k => broaderTerms.add(k))\n\n    // Extract individual words from industry name (skip common words)\n    const stopWords = ['services', 'solutions', 'inc', 'llc', 'corp', 'company', 'the', 'and', 'or']\n    const words = industry.toLowerCase().split(/\\s+/)\n      .filter(w => w.length > 2 && !stopWords.includes(w))\n\n    words.forEach(w => broaderTerms.add(w))\n\n    // Add broader business/industry themes\n    broaderTerms.add('small business')\n    broaderTerms.add('local business')\n    broaderTerms.add('business trends')\n\n    // Industry-specific broader terms\n    const industryMap: Record<string, string[]> = {\n      'hvac': ['energy efficiency', 'home improvement', 'climate control'],\n      'plumbing': ['home repair', 'water systems', 'home services'],\n      'electrical': ['home improvement', 'smart home', 'energy'],\n      'restaurant': ['food industry', 'hospitality', 'dining'],\n      'retail': ['e-commerce', 'shopping', 'consumer trends'],\n      'fitness': ['health', 'wellness', 'exercise'],\n      'salon': ['beauty', 'wellness', 'personal care'],\n      'dental': ['healthcare', 'oral health', 'medical'],\n      'legal': ['law', 'attorney', 'legal services'],\n      'accounting': ['finance', 'tax', 'business services']\n    }\n\n    // Find matching broader terms\n    Object.entries(industryMap).forEach(([key, terms]) => {\n      if (industry.toLowerCase().includes(key)) {\n        terms.forEach(t => broaderTerms.add(t))\n      }\n    })\n\n    return Array.from(broaderTerms).slice(0, 10) // Limit to 10 terms\n  }\n\n  async getIndustryNews(industry: string, keywords: string[]): Promise<NewsArticle[]> {\n    const cacheKey = `industry_${industry}_${keywords.join('_')}`\n    const cached = this.getCached(cacheKey)\n    if (cached) return cached\n\n    try {\n      // Use Edge Function to bypass CORS\n      const SUPABASE_URL = import.meta.env.VITE_SUPABASE_URL\n      const SUPABASE_ANON_KEY = import.meta.env.VITE_SUPABASE_ANON_KEY\n\n      // Generate broader search terms for better results\n      const searchTerms = this.generateBroaderSearchTerms(industry, keywords)\n      console.log(`[NewsAPI] 🔍 Searching with terms:`, searchTerms.slice(0, 5).join(', '))\n\n      const response = await fetch(`${SUPABASE_URL}/functions/v1/fetch-news`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${SUPABASE_ANON_KEY}`\n        },\n        body: JSON.stringify({\n          type: 'industry',\n          industry,\n          keywords: searchTerms,\n          limit: 20\n        })\n      })\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}))\n        console.error(\n          `[NewsAPI] ❌ Edge Function error (${response.status}): ${errorData.error || response.statusText}`\n        )\n        console.error('[NewsAPI] This likely means NEWS_API_KEY is not configured in Supabase Edge Function secrets')\n        return []\n      }\n\n      const data = await response.json()\n      if (!data.success) {\n        console.error('[NewsAPI] ❌ Edge Function returned error:', data.error)\n        return []\n      }\n\n      console.log(`[NewsAPI] 📰 Retrieved ${data.articles.length} articles`)\n\n      const articles: NewsArticle[] = data.articles.map((article: any) => ({\n        ...article,\n        relevanceScore: this.calculateRelevance(article, searchTerms)\n      }))\n\n      // Filter out low-relevance articles (score < 40)\n      const relevantArticles = articles.filter(a => a.relevanceScore >= 40)\n      console.log(`[NewsAPI] ✅ Filtered to ${relevantArticles.length} relevant articles (score >= 40)`)\n\n      // If no industry-specific articles found, try fallback to general small business news\n      if (relevantArticles.length === 0) {\n        console.log('[NewsAPI] No industry-specific news found, trying general small business news...')\n\n        const fallbackResponse = await fetch(`${SUPABASE_URL}/functions/v1/fetch-news`, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`\n          },\n          body: JSON.stringify({\n            type: 'industry',\n            industry: 'business',\n            keywords: ['small business', 'local business', 'business trends', 'entrepreneurship'],\n            limit: 15\n          })\n        })\n\n        if (fallbackResponse.ok) {\n          const fallbackData = await fallbackResponse.json()\n          if (fallbackData.success && fallbackData.articles.length > 0) {\n            console.log(`[NewsAPI] 📰 Fallback retrieved ${fallbackData.articles.length} general business articles`)\n            this.setCache(cacheKey, fallbackData.articles)\n            return fallbackData.articles\n          }\n        }\n      }\n\n      this.setCache(cacheKey, relevantArticles)\n      return relevantArticles\n    } catch (error) {\n      console.error('[NewsAPI] ❌ Failed to fetch industry news:', error)\n      return []\n    }\n  }\n\n  async getLocalNews(location: string): Promise<NewsArticle[]> {\n    const cacheKey = `local_${location}`\n    const cached = this.getCached(cacheKey)\n    if (cached) return cached\n\n    try {\n      // Use Edge Function to bypass CORS\n      const SUPABASE_URL = import.meta.env.VITE_SUPABASE_URL\n      const SUPABASE_ANON_KEY = import.meta.env.VITE_SUPABASE_ANON_KEY\n\n      const response = await fetch(`${SUPABASE_URL}/functions/v1/fetch-news`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${SUPABASE_ANON_KEY}`\n        },\n        body: JSON.stringify({\n          type: 'local',\n          location,\n          limit: 15\n        })\n      })\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}))\n        console.error(\n          `[NewsAPI] ❌ Edge Function error (${response.status}): ${errorData.error || response.statusText}`\n        )\n        console.error('[NewsAPI] This likely means NEWS_API_KEY is not configured in Supabase Edge Function secrets')\n        return []\n      }\n\n      const data = await response.json()\n      if (!data.success) {\n        console.error('[NewsAPI] ❌ Edge Function returned error:', data.error)\n        return []\n      }\n\n      this.setCache(cacheKey, data.articles)\n      return data.articles\n    } catch (error) {\n      console.error('[NewsAPI] ❌ Failed to fetch local news:', error)\n      return []\n    }\n  }\n\n  private calculateRelevance(article: any, keywords: string[]): number {\n    let score = 50\n    const text = `${article.title} ${article.description}`.toLowerCase()\n\n    keywords.forEach(keyword => {\n      if (text.includes(keyword.toLowerCase())) score += 15\n    })\n\n    return Math.min(100, score)\n  }\n\n  /**\n   * NO MOCK DATA - removed to enforce real API usage\n   * Configure VITE_NEWS_API_KEY to enable news features\n   */\n}\n\nexport const NewsAPI = new NewsAPIService()\nexport type { NewsArticle }\n","/**\n * OpenWeather API Integration\n * Real-time weather data for opportunity detection\n */\n\nconst WEATHER_API_KEY = import.meta.env.VITE_WEATHER_API_KEY\nconst CACHE_TTL = 30 * 60 * 1000 // 30 minutes\n\ninterface WeatherData {\n  temperature: number\n  feels_like: number\n  condition: string\n  description: string\n  humidity: number\n  wind_speed: number\n  location?: string\n  forecast: ForecastDay[]\n}\n\ninterface ForecastDay {\n  date: string\n  temp_max: number\n  temp_min: number\n  condition: string\n  precipitation_chance: number\n}\n\ninterface WeatherOpportunity {\n  type: 'heat_wave' | 'cold_snap' | 'storm' | 'precipitation' | 'seasonal'\n  urgency: 'critical' | 'high' | 'medium' | 'low'\n  title: string\n  description: string\n  impact_score: number\n  suggested_actions: string[]\n}\n\nclass WeatherAPIService {\n  private cache: Map<string, { data: any; timestamp: number }> = new Map()\n\n  private getCached(key: string): any | null {\n    const cached = this.cache.get(key)\n    if (cached && Date.now() - cached.timestamp < CACHE_TTL) return cached.data\n    this.cache.delete(key)\n    return null\n  }\n\n  private setCache(key: string, data: any): void {\n    this.cache.set(key, { data, timestamp: Date.now() })\n  }\n\n  async getCurrentWeather(location: string): Promise<WeatherData | null> {\n    const cacheKey = `current_${location}`\n    const cached = this.getCached(cacheKey)\n    if (cached) return cached\n\n    try {\n      // Use Edge Function to bypass CORS\n      const SUPABASE_URL = import.meta.env.VITE_SUPABASE_URL\n      const SUPABASE_ANON_KEY = import.meta.env.VITE_SUPABASE_ANON_KEY\n\n      const response = await fetch(`${SUPABASE_URL}/functions/v1/fetch-weather`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${SUPABASE_ANON_KEY}`\n        },\n        body: JSON.stringify({\n          type: 'current',\n          location\n        })\n      })\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}))\n        console.error(`[WeatherAPI] ❌ Edge Function error (${response.status}): ${errorData.error || response.statusText}`)\n        console.error('[WeatherAPI] This likely means WEATHER_API_KEY is not configured in Supabase Edge Function secrets')\n        throw new Error(`Weather Edge Function error (${response.status}): ${errorData.error || response.statusText}`)\n      }\n\n      const result = await response.json()\n      if (!result.success) {\n        console.error('[WeatherAPI] ❌ Edge Function returned error:', result.error)\n        throw new Error(`Weather Edge Function error: ${result.error}`)\n      }\n\n      const weather: WeatherData = result.data\n\n      this.setCache(cacheKey, weather)\n      return weather\n    } catch (error) {\n      console.error('[Weather API] Error:', error)\n      throw error\n    }\n  }\n\n  async get5DayForecast(location: string): Promise<ForecastDay[]> {\n    const cacheKey = `forecast_${location}`\n    const cached = this.getCached(cacheKey)\n    if (cached) return cached\n\n    try {\n      // Use Edge Function to bypass CORS\n      const SUPABASE_URL = import.meta.env.VITE_SUPABASE_URL\n      const SUPABASE_ANON_KEY = import.meta.env.VITE_SUPABASE_ANON_KEY\n\n      const response = await fetch(`${SUPABASE_URL}/functions/v1/fetch-weather`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${SUPABASE_ANON_KEY}`\n        },\n        body: JSON.stringify({\n          type: 'forecast',\n          location\n        })\n      })\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}))\n        console.error(`[WeatherAPI] ❌ Edge Function error (${response.status}): ${errorData.error || response.statusText}`)\n        console.error('[WeatherAPI] This likely means WEATHER_API_KEY is not configured in Supabase Edge Function secrets')\n        throw new Error(`Weather Edge Function error (${response.status}): ${errorData.error || response.statusText}`)\n      }\n\n      const result = await response.json()\n      if (!result.success) {\n        console.error('[WeatherAPI] ❌ Edge Function returned error:', result.error)\n        throw new Error(`Weather Edge Function error: ${result.error}`)\n      }\n\n      const dailyForecasts: ForecastDay[] = result.data\n\n      this.setCache(cacheKey, dailyForecasts)\n      return dailyForecasts\n    } catch (error) {\n      console.error('[Weather API] Error:', error)\n      throw error\n    }\n  }\n\n  async detectWeatherOpportunities(location: string, industry: string): Promise<WeatherOpportunity[]> {\n    const weather = await this.getCurrentWeather(location)\n    const forecast = await this.get5DayForecast(location)\n\n    const opportunities: WeatherOpportunity[] = []\n    const temp = weather.temperature\n\n    // EXTREME CONDITIONS (High priority)\n\n    // Heat wave detection (HVAC, pools, cooling)\n    if (temp > 90) {\n      opportunities.push({\n        type: 'heat_wave',\n        urgency: 'critical',\n        title: 'Heat Wave Alert',\n        description: `Temperature ${Math.round(temp)}°F - High demand for cooling services`,\n        impact_score: 95,\n        suggested_actions: [\n          'Promote emergency AC repair services',\n          'Offer heat wave specials',\n          'Increase ad spend for cooling keywords',\n          'Send email campaign about heat protection'\n        ]\n      })\n    }\n\n    // Cold snap (heating, insulation)\n    if (temp < 32) {\n      opportunities.push({\n        type: 'cold_snap',\n        urgency: 'high',\n        title: 'Freezing Temperatures',\n        description: `Temperature ${Math.round(temp)}°F - Heating system demand`,\n        impact_score: 90,\n        suggested_actions: [\n          'Promote heating system checks',\n          'Offer winterization services',\n          'Target frozen pipe prevention messaging'\n        ]\n      })\n    }\n\n    // MODERATE CONDITIONS (Medium priority)\n\n    // Warm weather opportunities (75-90°F)\n    if (temp >= 75 && temp <= 90) {\n      opportunities.push({\n        type: 'heat_wave',\n        urgency: 'medium',\n        title: 'Warm Weather Window',\n        description: `Temperature ${Math.round(temp)}°F - Ideal for AC tune-ups and outdoor services`,\n        impact_score: 65,\n        suggested_actions: [\n          'Promote preventive AC maintenance before peak heat',\n          'Offer outdoor service specials',\n          'Remind customers about summer preparation',\n          'Target lawn care, exterior painting, roofing'\n        ]\n      })\n    }\n\n    // Cool weather opportunities (50-65°F)\n    if (temp >= 50 && temp < 65) {\n      opportunities.push({\n        type: 'seasonal',\n        urgency: 'medium',\n        title: 'Perfect Service Weather',\n        description: `Temperature ${Math.round(temp)}°F - Comfortable conditions for outdoor work`,\n        impact_score: 60,\n        suggested_actions: [\n          'Promote seasonal maintenance (HVAC, landscaping)',\n          'Offer exterior home services (painting, roofing, windows)',\n          'Target spring/fall preparation messaging',\n          'Schedule outdoor installations while weather is mild'\n        ]\n      })\n    }\n\n    // Chilly weather (32-50°F)\n    if (temp >= 32 && temp < 50) {\n      opportunities.push({\n        type: 'cold_snap',\n        urgency: 'medium',\n        title: 'Heating Season Active',\n        description: `Temperature ${Math.round(temp)}°F - Heating systems in regular use`,\n        impact_score: 55,\n        suggested_actions: [\n          'Promote heating system maintenance',\n          'Offer insulation and weatherproofing',\n          'Target energy efficiency messaging',\n          'Remind customers about heating tune-ups'\n        ]\n      })\n    }\n\n    // PRECIPITATION & STORMS\n\n    // Current rain/snow\n    const isRaining = weather.condition.toLowerCase().includes('rain') ||\n                     weather.condition.toLowerCase().includes('drizzle')\n    const isSnowing = weather.condition.toLowerCase().includes('snow')\n\n    if (isSnowing) {\n      opportunities.push({\n        type: 'precipitation',\n        urgency: 'high',\n        title: 'Active Snowfall',\n        description: 'Snow conditions - high demand for winter services',\n        impact_score: 85,\n        suggested_actions: [\n          'Promote snow removal services',\n          'Offer emergency heating repairs',\n          'Target winterization and insulation',\n          'Send winter safety tips'\n        ]\n      })\n    } else if (isRaining) {\n      opportunities.push({\n        type: 'precipitation',\n        urgency: 'medium',\n        title: 'Active Rainfall',\n        description: 'Current rain - opportunity for water-related services',\n        impact_score: 60,\n        suggested_actions: [\n          'Promote waterproofing and drainage',\n          'Offer roof and gutter inspections',\n          'Target basement waterproofing',\n          'Send maintenance reminders'\n        ]\n      })\n    }\n\n    // Forecast-based opportunities\n    const upcomingHeavyRain = forecast.some(day => day.precipitation_chance > 60)\n    const upcomingModerateRain = forecast.some(day => day.precipitation_chance > 30 && day.precipitation_chance <= 60)\n\n    if (upcomingHeavyRain && !isRaining) {\n      opportunities.push({\n        type: 'precipitation',\n        urgency: 'medium',\n        title: 'Heavy Rain Forecast',\n        description: 'Significant rain expected - prepare customers now',\n        impact_score: 70,\n        suggested_actions: [\n          'Promote waterproofing services',\n          'Offer gutter cleaning before rain',\n          'Target flood prevention messaging',\n          'Send weather alert emails'\n        ]\n      })\n    } else if (upcomingModerateRain && !isRaining && !upcomingHeavyRain) {\n      opportunities.push({\n        type: 'precipitation',\n        urgency: 'low',\n        title: 'Rain in Forecast',\n        description: 'Moderate rain expected - good time for preventive services',\n        impact_score: 45,\n        suggested_actions: [\n          'Remind customers about drainage checks',\n          'Offer preventive maintenance',\n          'Target outdoor project completion messaging'\n        ]\n      })\n    }\n\n    // TEMPERATURE SWINGS\n\n    // Check for significant day/night or week temperature changes\n    const tempSwing = forecast.reduce((maxSwing, day) => {\n      const swing = day.temp_max - day.temp_min\n      return Math.max(maxSwing, swing)\n    }, 0)\n\n    if (tempSwing > 30) {\n      opportunities.push({\n        type: 'seasonal',\n        urgency: 'low',\n        title: 'Temperature Fluctuations',\n        description: `Large temperature swings (${Math.round(tempSwing)}°F) can strain HVAC systems`,\n        impact_score: 50,\n        suggested_actions: [\n          'Promote HVAC system checks',\n          'Offer multi-season maintenance packages',\n          'Target energy efficiency messaging',\n          'Remind customers about system stress during swings'\n        ]\n      })\n    }\n\n    // SEASONAL MESSAGING (always include at least one)\n\n    // If no specific opportunities, provide seasonal baseline\n    if (opportunities.length === 0) {\n      const month = new Date().getMonth() + 1 // 1-12\n\n      let seasonalOpp: WeatherOpportunity\n\n      if (month >= 6 && month <= 8) {\n        // Summer\n        seasonalOpp = {\n          type: 'seasonal',\n          urgency: 'low',\n          title: 'Summer Season',\n          description: `Temperature ${Math.round(temp)}°F - Summer service opportunities`,\n          impact_score: 40,\n          suggested_actions: [\n            'Promote AC maintenance and tune-ups',\n            'Offer summer service packages',\n            'Target outdoor services (landscaping, exterior work)',\n            'Send seasonal maintenance reminders'\n          ]\n        }\n      } else if (month >= 12 || month <= 2) {\n        // Winter\n        seasonalOpp = {\n          type: 'seasonal',\n          urgency: 'low',\n          title: 'Winter Season',\n          description: `Temperature ${Math.round(temp)}°F - Winter service opportunities`,\n          impact_score: 40,\n          suggested_actions: [\n            'Promote heating system maintenance',\n            'Offer winterization services',\n            'Target indoor home improvement projects',\n            'Send winter preparation tips'\n          ]\n        }\n      } else if (month >= 3 && month <= 5) {\n        // Spring\n        seasonalOpp = {\n          type: 'seasonal',\n          urgency: 'low',\n          title: 'Spring Season',\n          description: `Temperature ${Math.round(temp)}°F - Spring preparation opportunities`,\n          impact_score: 40,\n          suggested_actions: [\n            'Promote spring AC tune-ups before summer',\n            'Offer exterior home services (painting, roofing)',\n            'Target landscaping and outdoor projects',\n            'Send spring cleaning and maintenance reminders'\n          ]\n        }\n      } else {\n        // Fall\n        seasonalOpp = {\n          type: 'seasonal',\n          urgency: 'low',\n          title: 'Fall Season',\n          description: `Temperature ${Math.round(temp)}°F - Fall preparation opportunities`,\n          impact_score: 40,\n          suggested_actions: [\n            'Promote heating system tune-ups before winter',\n            'Offer winterization and insulation',\n            'Target gutter cleaning and exterior prep',\n            'Send fall maintenance reminders'\n          ]\n        }\n      }\n\n      opportunities.push(seasonalOpp)\n    }\n\n    console.log(`[WeatherAPI] 🌤️ Detected ${opportunities.length} weather opportunities for ${location}`)\n    return opportunities\n  }\n}\n\nexport const WeatherAPI = new WeatherAPIService()\nexport type { WeatherData, ForecastDay, WeatherOpportunity }\n","/**\n * Serper API Integration (Google Search)\n * Search insights and trending queries\n */\n\nconst SERPER_API_KEY = import.meta.env.VITE_SERPER_API_KEY\n\ninterface SearchResult {\n  title: string\n  link: string\n  snippet: string\n  position: number\n}\n\ninterface NewsResult {\n  title: string\n  link: string\n  snippet: string\n  date: string\n  source: string\n  imageUrl?: string\n}\n\ninterface TrendData {\n  keyword: string\n  searchVolume?: number\n  relatedQueries: string[]\n  timeRange?: string\n  trend: 'rising' | 'stable' | 'declining'\n  growthPercentage?: number\n}\n\ninterface PlaceResult {\n  name: string\n  address: string\n  rating?: number\n  reviewCount?: number\n  phone?: string\n  website?: string\n  category?: string\n  placeId?: string\n  _raw?: any  // Keep raw Serper response for debugging\n}\n\ninterface PlaceReview {\n  author: string\n  rating: number\n  text: string\n  date: string\n  snippet?: string\n}\n\ninterface ImageResult {\n  title: string\n  imageUrl: string\n  link: string\n  source: string\n  thumbnail?: string\n}\n\ninterface VideoResult {\n  title: string\n  link: string\n  snippet: string\n  channel: string\n  date: string\n  duration?: string\n  thumbnail?: string\n}\n\ninterface ShoppingResult {\n  title: string\n  link: string\n  price: string\n  source: string\n  rating?: number\n  reviewCount?: number\n  imageUrl?: string\n  inStock?: boolean\n}\n\ninterface LinkedInProfile {\n  name: string\n  headline: string\n  link: string\n  location?: string\n  company?: string\n  snippet?: string\n}\n\ninterface LinkedInCompany {\n  name: string\n  link: string\n  description: string\n  industry?: string\n  size?: string\n  location?: string\n  followers?: number\n  snippet?: string\n}\n\ninterface LinkedInPost {\n  author: string\n  authorProfile?: string\n  content: string\n  link: string\n  date?: string\n  engagement?: {\n    likes?: number\n    comments?: number\n    shares?: number\n  }\n  snippet?: string\n}\n\ninterface LinkedInJob {\n  title: string\n  company: string\n  location: string\n  link: string\n  description?: string\n  posted?: string\n  seniority?: string\n  employmentType?: string\n}\n\nclass SerperAPIService {\n  async searchGoogle(query: string): Promise<SearchResult[]> {\n    if (!SERPER_API_KEY) {\n      throw new Error(\n        'Serper API key not configured. Add VITE_SERPER_API_KEY to your .env file. ' +\n        'Get a free API key from https://serper.dev/'\n      )\n    }\n\n    try {\n      const response = await fetch('https://google.serper.dev/search', {\n        method: 'POST',\n        headers: {\n          'X-API-KEY': SERPER_API_KEY,\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({ q: query })\n      })\n\n      const data = await response.json()\n      return (data.organic || []).map((result: any, index: number) => ({\n        title: result.title,\n        link: result.link,\n        snippet: result.snippet,\n        position: index + 1\n      }))\n    } catch (error) {\n      console.error('[Serper API] Error:', error)\n      throw error\n    }\n  }\n\n  async getTrendingSearches(): Promise<string[]> {\n    if (!SERPER_API_KEY) {\n      throw new Error(\n        'Serper API key not configured. Add VITE_SERPER_API_KEY to your .env file. ' +\n        'Get a free API key from https://serper.dev/'\n      )\n    }\n\n    // TODO: Implement real trending searches via Serper API\n    throw new Error('getTrendingSearches() not yet implemented. Use Google Trends API instead.')\n  }\n\n  /**\n   * Search for competitors in an industry\n   */\n  async searchCompetitors(query: string, excludeBrand?: string): Promise<string[]> {\n    const results = await this.searchGoogle(query)\n\n    // Extract domains from search results\n    const domains = results\n      .map(result => {\n        try {\n          const url = new URL(result.link)\n          return url.hostname.replace(/^www\\./, '')\n        } catch {\n          return null\n        }\n      })\n      .filter((domain): domain is string => domain !== null)\n      .filter(domain => {\n        // Exclude common non-competitor domains\n        const excluded = ['wikipedia.org', 'youtube.com', 'facebook.com', 'twitter.com', 'linkedin.com', 'instagram.com']\n        if (excluded.some(e => domain.includes(e))) return false\n\n        // Exclude the brand's own domain\n        if (excludeBrand && domain.toLowerCase().includes(excludeBrand.toLowerCase())) return false\n\n        return true\n      })\n\n    // Remove duplicates\n    return Array.from(new Set(domains))\n  }\n\n  /**\n   * Get news articles for a topic with optional location filtering\n   */\n  async getNews(topic: string, location?: string): Promise<NewsResult[]> {\n    if (!SERPER_API_KEY) {\n      throw new Error(\n        'Serper API key not configured. Add VITE_SERPER_API_KEY to your .env file. ' +\n        'Get a free API key from https://serper.dev/'\n      )\n    }\n\n    try {\n      const body: any = { q: topic }\n      if (location) {\n        body.location = location\n      }\n\n      const response = await fetch('https://google.serper.dev/news', {\n        method: 'POST',\n        headers: {\n          'X-API-KEY': SERPER_API_KEY,\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(body)\n      })\n\n      if (!response.ok) {\n        throw new Error(`Serper News API error: ${response.status}`)\n      }\n\n      const data = await response.json()\n\n      return (data.news || []).map((article: any) => ({\n        title: article.title || '',\n        link: article.link || '',\n        snippet: article.snippet || '',\n        date: article.date || new Date().toISOString(),\n        source: article.source || 'Unknown',\n        imageUrl: article.imageUrl\n      }))\n    } catch (error) {\n      console.error('[Serper News API] Error:', error)\n      throw error\n    }\n  }\n\n  /**\n   * Get trending data for a keyword with timeRange support\n   */\n  async getTrends(keyword: string, timeRange?: string): Promise<TrendData> {\n    if (!SERPER_API_KEY) {\n      throw new Error(\n        'Serper API key not configured. Add VITE_SERPER_API_KEY to your .env file. ' +\n        'Get a free API key from https://serper.dev/'\n      )\n    }\n\n    try {\n      // Use regular search + autocomplete to infer trends\n      const [searchResults, relatedSearches] = await Promise.all([\n        this.searchGoogle(keyword),\n        this.getAutocomplete(keyword)\n      ])\n\n      // Simple trend estimation based on result count and recency\n      const hasRecentResults = searchResults.some(r =>\n        r.snippet?.toLowerCase().includes('trending') ||\n        r.snippet?.toLowerCase().includes('popular')\n      )\n\n      return {\n        keyword,\n        relatedQueries: relatedSearches.slice(0, 5),\n        timeRange: timeRange || 'past 30 days',\n        trend: hasRecentResults ? 'rising' : 'stable',\n        growthPercentage: hasRecentResults ? 25 : 0\n      }\n    } catch (error) {\n      console.error('[Serper Trends] Error:', error)\n      throw error\n    }\n  }\n\n  /**\n   * Get autocomplete suggestions for question-based content\n   */\n  async getAutocomplete(query: string): Promise<string[]> {\n    if (!SERPER_API_KEY) {\n      throw new Error(\n        'Serper API key not configured. Add VITE_SERPER_API_KEY to your .env file. ' +\n        'Get a free API key from https://serper.dev/'\n      )\n    }\n\n    try {\n      const response = await fetch('https://google.serper.dev/search', {\n        method: 'POST',\n        headers: {\n          'X-API-KEY': SERPER_API_KEY,\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          q: query,\n          autocorrect: true\n        })\n      })\n\n      if (!response.ok) {\n        throw new Error(`Serper Autocomplete API error: ${response.status}`)\n      }\n\n      const data = await response.json()\n\n      // Extract \"People also ask\" and \"Related searches\"\n      const suggestions: string[] = []\n\n      if (data.peopleAlsoAsk) {\n        suggestions.push(...data.peopleAlsoAsk.map((item: any) => item.question))\n      }\n\n      if (data.relatedSearches) {\n        suggestions.push(...data.relatedSearches.map((item: any) => item.query))\n      }\n\n      return suggestions.filter(Boolean).slice(0, 10)\n    } catch (error) {\n      console.error('[Serper Autocomplete] Error:', error)\n      return []\n    }\n  }\n\n  /**\n   * Get local business data from Google Places\n   */\n  async getPlaces(query: string, location: string): Promise<PlaceResult[]> {\n    if (!SERPER_API_KEY) {\n      throw new Error(\n        'Serper API key not configured. Add VITE_SERPER_API_KEY to your .env file. ' +\n        'Get a free API key from https://serper.dev/'\n      )\n    }\n\n    try {\n      const response = await fetch('https://google.serper.dev/places', {\n        method: 'POST',\n        headers: {\n          'X-API-KEY': SERPER_API_KEY,\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          q: query,\n          location: location\n        })\n      })\n\n      if (!response.ok) {\n        throw new Error(`Serper Places API error: ${response.status}`)\n      }\n\n      const data = await response.json()\n\n      return (data.places || []).map((place: any) => {\n        // Try multiple possible field names for place ID\n        const placeId = place.placeId || place.place_id || place.cid || place.data_id || place.dataId\n\n        return {\n          name: place.title || place.name || '',\n          address: place.address || '',\n          rating: place.rating || undefined,\n          reviewCount: place.reviews || place.ratingCount || undefined,\n          phone: place.phoneNumber || place.phone || undefined,\n          website: place.website || undefined,\n          category: place.category || place.type || undefined,\n          placeId: placeId,\n          // Keep raw data for debugging\n          _raw: place\n        }\n      })\n    } catch (error) {\n      console.error('[Serper Places] Error:', error)\n      throw error\n    }\n  }\n\n  /**\n   * Get reviews for a specific place by place_id\n   * Fast fallback for when OutScraper doesn't have cached reviews\n   */\n  async getPlaceReviews(placeId: string): Promise<PlaceReview[]> {\n    if (!SERPER_API_KEY) {\n      throw new Error('Serper API key not configured')\n    }\n\n    try {\n      console.log('[Serper] Fetching reviews for place_id:', placeId)\n\n      const response = await fetch('https://google.serper.dev/places', {\n        method: 'POST',\n        headers: {\n          'X-API-KEY': SERPER_API_KEY,\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          q: `place_id:${placeId}`\n        })\n      })\n\n      if (!response.ok) {\n        throw new Error(`Serper Places API error: ${response.status}`)\n      }\n\n      const data = await response.json()\n\n      // Serper returns reviews in the 'reviews' array\n      const reviews = data.reviews || []\n\n      console.log('[Serper] Found', reviews.length, 'reviews')\n\n      return reviews.map((review: any) => ({\n        author: review.author || review.name || 'Anonymous',\n        rating: review.rating || 0,\n        text: review.snippet || review.text || '',\n        date: review.date || review.publishedAtDate || new Date().toISOString(),\n        snippet: review.snippet\n      }))\n    } catch (error) {\n      console.error('[Serper] Error fetching reviews:', error)\n      return [] // Return empty array instead of throwing\n    }\n  }\n\n  /**\n   * Get image results for visual content analysis\n   */\n  async getImages(query: string): Promise<ImageResult[]> {\n    if (!SERPER_API_KEY) {\n      throw new Error(\n        'Serper API key not configured. Add VITE_SERPER_API_KEY to your .env file. ' +\n        'Get a free API key from https://serper.dev/'\n      )\n    }\n\n    try {\n      const response = await fetch('https://google.serper.dev/images', {\n        method: 'POST',\n        headers: {\n          'X-API-KEY': SERPER_API_KEY,\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({ q: query })\n      })\n\n      if (!response.ok) {\n        throw new Error(`Serper Images API error: ${response.status}`)\n      }\n\n      const data = await response.json()\n\n      return (data.images || []).map((image: any) => ({\n        title: image.title || '',\n        imageUrl: image.imageUrl || '',\n        link: image.link || '',\n        source: image.source || '',\n        thumbnail: image.thumbnailUrl || image.thumbnail || undefined\n      }))\n    } catch (error) {\n      console.error('[Serper Images] Error:', error)\n      throw error\n    }\n  }\n\n  /**\n   * Get video results for video gap analysis\n   */\n  async getVideos(query: string): Promise<VideoResult[]> {\n    if (!SERPER_API_KEY) {\n      throw new Error(\n        'Serper API key not configured. Add VITE_SERPER_API_KEY to your .env file. ' +\n        'Get a free API key from https://serper.dev/'\n      )\n    }\n\n    try {\n      const response = await fetch('https://google.serper.dev/videos', {\n        method: 'POST',\n        headers: {\n          'X-API-KEY': SERPER_API_KEY,\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({ q: query })\n      })\n\n      if (!response.ok) {\n        throw new Error(`Serper Videos API error: ${response.status}`)\n      }\n\n      const data = await response.json()\n\n      return (data.videos || []).map((video: any) => ({\n        title: video.title || '',\n        link: video.link || '',\n        snippet: video.snippet || video.description || '',\n        channel: video.channel || video.source || '',\n        date: video.date || new Date().toISOString(),\n        duration: video.duration || undefined,\n        thumbnail: video.imageUrl || video.thumbnail || undefined\n      }))\n    } catch (error) {\n      console.error('[Serper Videos] Error:', error)\n      throw error\n    }\n  }\n\n  /**\n   * Get shopping results for product intelligence\n   */\n  async getShopping(product: string): Promise<ShoppingResult[]> {\n    if (!SERPER_API_KEY) {\n      throw new Error(\n        'Serper API key not configured. Add VITE_SERPER_API_KEY to your .env file. ' +\n        'Get a free API key from https://serper.dev/'\n      )\n    }\n\n    try {\n      const response = await fetch('https://google.serper.dev/shopping', {\n        method: 'POST',\n        headers: {\n          'X-API-KEY': SERPER_API_KEY,\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({ q: product })\n      })\n\n      if (!response.ok) {\n        throw new Error(`Serper Shopping API error: ${response.status}`)\n      }\n\n      const data = await response.json()\n\n      return (data.shopping || []).map((item: any) => ({\n        title: item.title || '',\n        link: item.link || '',\n        price: item.price || 'N/A',\n        source: item.source || '',\n        rating: item.rating || undefined,\n        reviewCount: item.reviews || item.ratingCount || undefined,\n        imageUrl: item.imageUrl || item.thumbnail || undefined,\n        inStock: item.delivery?.includes('In stock') || undefined\n      }))\n    } catch (error) {\n      console.error('[Serper Shopping] Error:', error)\n      throw error\n    }\n  }\n}\n\nexport const SerperAPI = new SerperAPIService()\nexport type {\n  SearchResult,\n  NewsResult,\n  TrendData,\n  PlaceResult,\n  PlaceReview,\n  ImageResult,\n  VideoResult,\n  ShoppingResult\n}\n","/**\n * Semrush API Integration\n * SEO and competitor analysis with keyword rankings and opportunities\n * Now proxied through Supabase Edge Function to avoid CORS issues\n */\n\nimport { supabase } from '@/lib/supabase'\n\nexport interface DomainOverview {\n  domain: string\n  organic_keywords: number\n  organic_traffic: number\n  paid_keywords: number\n  backlinks: number\n  authority_score: number\n}\n\nexport interface KeywordRanking {\n  keyword: string\n  position: number\n  searchVolume: number\n  difficulty: number\n  traffic: number\n  url: string\n  isBranded: boolean // New: flag for brand name keywords\n  trend?: 'rising' | 'stable' | 'declining' // Trend indicator\n  trendData?: {\n    direction: 'up' | 'down' | 'stable'\n    changePercent?: number\n  }\n}\n\nexport interface KeywordOpportunity {\n  keyword: string\n  searchVolume: number\n  difficulty: number\n  currentPosition?: number\n  estimatedTraffic: number\n  opportunity: 'quick-win' | 'high-value' | 'long-term'\n  reasoning: string\n}\n\nexport interface SEOMetrics {\n  domain: string\n  overview: DomainOverview\n  rankings: KeywordRanking[]\n  opportunities: KeywordOpportunity[]\n  competitors: string[]\n  healthScore: number\n}\n\nclass SemrushAPIService {\n  /**\n   * Get comprehensive domain overview via Edge Function\n   */\n  async getDomainOverview(domain: string): Promise<DomainOverview> {\n    console.log('[Semrush] Fetching domain overview for:', domain)\n\n    try {\n      const { data, error } = await supabase.functions.invoke('fetch-seo-metrics', {\n        body: {\n          domain,\n          type: 'overview'\n        }\n      })\n\n      if (error) {\n        console.error('[Semrush] Edge function error:', error)\n        throw new Error(`Failed to fetch SEO metrics: ${error.message}`)\n      }\n\n      if (!data.success || !data.data || data.data.length === 0) {\n        throw new Error('No data returned from SEMrush')\n      }\n\n      // Parse the CSV data\n      const row = data.data[0]\n      const traffic = parseInt(row['Organic Traffic'] || row.Ot || '0')\n      const keywords = parseInt(row['Organic Keywords'] || row.Or || '0')\n      const ads = parseInt(row['Adwords Keywords'] || row.Ad || '0')\n      const backlinks = parseInt(row['Adwords Traffic'] || row.At || '0')\n\n      return {\n        domain,\n        organic_keywords: keywords,\n        organic_traffic: traffic,\n        paid_keywords: ads,\n        backlinks: backlinks,\n        authority_score: Math.min(100, Math.round(backlinks / 100))\n      }\n    } catch (error) {\n      console.error('[Semrush API] Error:', error)\n      throw new Error(`Failed to fetch SEMrush data: ${error.message}`)\n    }\n  }\n\n  /**\n   * Get keyword rankings (excluding brand name keywords) via Edge Function\n   */\n  async getKeywordRankings(domain: string, brandName?: string): Promise<KeywordRanking[]> {\n    console.log('[Semrush] Fetching keyword rankings for:', domain)\n\n    try {\n      const { data, error } = await supabase.functions.invoke('fetch-seo-metrics', {\n        body: {\n          domain,\n          type: 'keywords'\n        }\n      })\n\n      if (error) {\n        console.error('[Semrush] Edge function error:', error)\n        throw new Error(`Failed to fetch keyword rankings: ${error.message}`)\n      }\n\n      if (!data.success || !data.data) {\n        throw new Error('No data returned from SEMrush')\n      }\n\n      const rankings: KeywordRanking[] = data.data\n        .filter((row: any) => row.Ph || row.Keyword)\n        .map((row: any) => {\n          const keyword = row.Ph || row.Keyword || ''\n          const isBranded = brandName\n            ? keyword.toLowerCase().includes(brandName.toLowerCase())\n            : false\n\n          const position = parseInt(row.Po || row.Position || '0')\n          const searchVolume = parseInt(row.Nq || row['Search Volume'] || '0')\n          const difficulty = this.estimateDifficulty(searchVolume)\n          const traffic = parseInt(row.Tr || row.Traffic || '0')\n\n          // Estimate trend based on position performance\n          const trend = this.estimateTrend(position, searchVolume, difficulty)\n\n          return {\n            keyword,\n            position,\n            searchVolume,\n            difficulty,\n            traffic,\n            url: row.Ur || row.URL || '',\n            isBranded,\n            trend: trend.indicator,\n            trendData: trend.data,\n          }\n        })\n        .filter((r: KeywordRanking) => r.keyword && !r.isBranded) // Exclude brand name keywords\n\n      console.log('[Semrush] Found', rankings.length, 'non-branded keyword rankings')\n      return rankings\n    } catch (error) {\n      console.error('[Semrush] Error fetching rankings:', error)\n      throw new Error(`Failed to fetch keyword rankings: ${error.message}`)\n    }\n  }\n\n  /**\n   * Get detailed keyword metrics for UI display\n   * Returns enriched data with volume, difficulty, trend, and context\n   */\n  async getDetailedKeywordMetrics(\n    domain: string,\n    brandName?: string,\n    limit: number = 20\n  ): Promise<KeywordRanking[]> {\n    console.log('[Semrush] Fetching detailed keyword metrics for:', domain)\n\n    const rankings = await this.getKeywordRankings(domain, brandName)\n\n    // Sort by a combination of position and traffic potential\n    const enrichedRankings = rankings\n      .map(ranking => ({\n        ...ranking,\n        score: this.calculateKeywordImportance(ranking),\n      }))\n      .sort((a, b) => b.score - a.score)\n      .slice(0, limit)\n\n    return enrichedRankings\n  }\n\n  /**\n   * Identify keyword opportunities based on rankings\n   */\n  async getKeywordOpportunities(\n    domain: string,\n    brandName?: string\n  ): Promise<KeywordOpportunity[]> {\n    console.log('[Semrush] Finding keyword opportunities for:', domain)\n\n    const rankings = await this.getKeywordRankings(domain, brandName)\n    const opportunities: KeywordOpportunity[] = []\n\n    for (const ranking of rankings) {\n      // Quick wins: position 11-20, decent volume\n      if (ranking.position >= 11 && ranking.position <= 20 && ranking.searchVolume >= 100) {\n        opportunities.push({\n          keyword: ranking.keyword,\n          searchVolume: ranking.searchVolume,\n          difficulty: ranking.difficulty,\n          currentPosition: ranking.position,\n          estimatedTraffic: Math.round(ranking.searchVolume * 0.15), // Estimated traffic if we rank #1\n          opportunity: 'quick-win',\n          reasoning: `Currently ranked #${ranking.position} - just outside page 1. With optimization, could reach top 10.`,\n        })\n      }\n\n      // High value: high volume, not ranked yet or ranked low\n      if (ranking.searchVolume >= 1000 && (!ranking.position || ranking.position > 50)) {\n        opportunities.push({\n          keyword: ranking.keyword,\n          searchVolume: ranking.searchVolume,\n          difficulty: ranking.difficulty,\n          currentPosition: ranking.position || undefined,\n          estimatedTraffic: Math.round(ranking.searchVolume * 0.20),\n          opportunity: 'high-value',\n          reasoning: `High search volume (${ranking.searchVolume}/mo) with room for improvement.`,\n        })\n      }\n\n      // Long-term: position 21-50, high difficulty\n      if (ranking.position >= 21 && ranking.position <= 50 && ranking.difficulty >= 60) {\n        opportunities.push({\n          keyword: ranking.keyword,\n          searchVolume: ranking.searchVolume,\n          difficulty: ranking.difficulty,\n          currentPosition: ranking.position,\n          estimatedTraffic: Math.round(ranking.searchVolume * 0.10),\n          opportunity: 'long-term',\n          reasoning: `Competitive keyword but you already have some authority. Build content consistently.`,\n        })\n      }\n    }\n\n    // Sort by estimated traffic potential\n    opportunities.sort((a, b) => b.estimatedTraffic - a.estimatedTraffic)\n\n    console.log('[Semrush] Found', opportunities.length, 'keyword opportunities')\n    return opportunities.slice(0, 20) // Top 20 opportunities\n  }\n\n  /**\n   * Get comprehensive SEO metrics\n   */\n  async getComprehensiveSEOMetrics(\n    domain: string,\n    brandName?: string\n  ): Promise<SEOMetrics> {\n    console.log('[Semrush] Fetching comprehensive SEO metrics for:', domain)\n\n    const [overview, rankings, opportunities] = await Promise.all([\n      this.getDomainOverview(domain),\n      this.getKeywordRankings(domain, brandName),\n      this.getKeywordOpportunities(domain, brandName),\n    ])\n\n    // Calculate SEO health score\n    const healthScore = this.calculateSEOHealth(overview, rankings)\n\n    return {\n      domain,\n      overview,\n      rankings: rankings.slice(0, 50), // Top 50 rankings\n      opportunities,\n      competitors: [], // Will be populated by competitor discovery service\n      healthScore,\n    }\n  }\n\n  /**\n   * Legacy method for compatibility\n   */\n  async getCompetitorKeywords(domain: string): Promise<string[]> {\n    const rankings = await this.getKeywordRankings(domain)\n    return rankings.slice(0, 10).map(r => r.keyword)\n  }\n\n  // ============================================================================\n  // Helper Methods\n  // ============================================================================\n\n  private estimateDifficulty(searchVolume: number): number {\n    if (searchVolume < 100) return 20\n    if (searchVolume < 500) return 35\n    if (searchVolume < 1000) return 50\n    if (searchVolume < 5000) return 65\n    if (searchVolume < 10000) return 75\n    return 85\n  }\n\n  /**\n   * Estimate keyword trend based on position vs. expected performance\n   * This is a heuristic until we have historical data\n   */\n  private estimateTrend(\n    position: number,\n    searchVolume: number,\n    difficulty: number\n  ): {\n    indicator: 'rising' | 'stable' | 'declining'\n    data: { direction: 'up' | 'down' | 'stable'; changePercent?: number }\n  } {\n    // High volume, top position = stable/rising\n    if (position <= 3 && searchVolume > 1000) {\n      return {\n        indicator: 'stable',\n        data: { direction: 'stable' },\n      }\n    }\n\n    // Good position relative to difficulty = rising\n    if (position <= 10 && difficulty > 60) {\n      return {\n        indicator: 'rising',\n        data: { direction: 'up' },\n      }\n    }\n\n    // Poor position for easy keyword = declining\n    if (position > 20 && difficulty < 40) {\n      return {\n        indicator: 'declining',\n        data: { direction: 'down' },\n      }\n    }\n\n    // Default to stable\n    return {\n      indicator: 'stable',\n      data: { direction: 'stable' },\n    }\n  }\n\n  /**\n   * Calculate keyword importance score for ranking\n   * Combines position, volume, and traffic to prioritize display\n   */\n  private calculateKeywordImportance(ranking: KeywordRanking): number {\n    let score = 0\n\n    // Position score (max 40 points) - better positions get more points\n    if (ranking.position <= 3) score += 40\n    else if (ranking.position <= 10) score += 30\n    else if (ranking.position <= 20) score += 20\n    else score += 10\n\n    // Volume score (max 30 points)\n    if (ranking.searchVolume >= 10000) score += 30\n    else if (ranking.searchVolume >= 5000) score += 25\n    else if (ranking.searchVolume >= 1000) score += 20\n    else if (ranking.searchVolume >= 500) score += 15\n    else if (ranking.searchVolume >= 100) score += 10\n    else score += 5\n\n    // Traffic score (max 30 points)\n    if (ranking.traffic >= 1000) score += 30\n    else if (ranking.traffic >= 500) score += 25\n    else if (ranking.traffic >= 100) score += 20\n    else if (ranking.traffic >= 50) score += 15\n    else if (ranking.traffic >= 10) score += 10\n    else score += 5\n\n    return score\n  }\n\n  private calculateSEOHealth(overview: DomainOverview, rankings: KeywordRanking[]): number {\n    let score = 0\n\n    // Authority score (40 points)\n    score += Math.min(40, overview.authority_score * 0.4)\n\n    // Keyword rankings (30 points)\n    const top10Rankings = rankings.filter(r => r.position <= 10).length\n    score += Math.min(30, top10Rankings * 2)\n\n    // Backlinks (20 points)\n    if (overview.backlinks > 10000) score += 20\n    else if (overview.backlinks > 5000) score += 15\n    else if (overview.backlinks > 1000) score += 10\n    else if (overview.backlinks > 100) score += 5\n\n    // Traffic (10 points)\n    if (overview.organic_traffic > 100000) score += 10\n    else if (overview.organic_traffic > 50000) score += 7\n    else if (overview.organic_traffic > 10000) score += 5\n    else if (overview.organic_traffic > 1000) score += 2\n\n    return Math.round(score)\n  }\n\n}\n\nexport const SemrushAPI = new SemrushAPIService()\n","/**\n * Website Analyzer Service\n * Uses Claude AI via OpenRouter to extract business messaging from website content\n */\n\nconst OPENROUTER_API_KEY = import.meta.env.VITE_OPENROUTER_API_KEY\nconst SUPABASE_URL = import.meta.env.VITE_SUPABASE_URL\nconst SUPABASE_ANON_KEY = import.meta.env.VITE_SUPABASE_ANON_KEY\n\nexport interface WebsiteMessagingAnalysis {\n  valuePropositions: string[]\n  targetAudience: string[]\n  customerProblems: string[]\n  solutions: string[]\n  proofPoints: string[]\n  differentiators: string[]\n  confidence: number\n}\n\nclass WebsiteAnalyzerService {\n  /**\n   * Extract website content from a URL\n   * Uses Supabase Edge Function to proxy Apify API calls (avoids CORS)\n   */\n  async extractWebsiteContent(url: string): Promise<string> {\n    try {\n      console.log('[WebsiteAnalyzer] Fetching content from:', url)\n\n      if (!SUPABASE_URL || !SUPABASE_ANON_KEY) {\n        throw new Error('Supabase configuration missing')\n      }\n\n      // Call Supabase Edge Function (server-side, no CORS issues)\n      console.log('[WebsiteAnalyzer] Using Edge Function for content extraction...')\n      const response = await fetch(\n        `${SUPABASE_URL}/functions/v1/scrape-website`,\n        {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`\n          },\n          body: JSON.stringify({ url })\n        }\n      )\n\n      if (!response.ok) {\n        const errorText = await response.text()\n        console.error('[WebsiteAnalyzer] Edge Function error:', response.status, errorText)\n        throw new Error(`Edge Function failed: ${response.status}`)\n      }\n\n      const data = await response.json()\n\n      if (!data.success) {\n        throw new Error(data.error || 'Unknown error from Edge Function')\n      }\n\n      // Combine title, description, text, and headings\n      const fullText = [\n        data.content.title,\n        data.content.description,\n        data.content.text,\n        data.content.headings?.join(' ')\n      ].filter(Boolean).join('\\n\\n')\n\n      console.log('[WebsiteAnalyzer] Edge Function extracted', fullText.length, 'characters')\n      return fullText\n\n    } catch (error) {\n      console.error('[WebsiteAnalyzer] Failed to fetch website:', error)\n      throw new Error(`Failed to fetch website: ${error instanceof Error ? error.message : 'Unknown error'}`)\n    }\n  }\n\n  /**\n   * Analyze website content using Claude AI to extract business messaging\n   */\n  async analyzeWebsiteMessaging(\n    websiteContent: string,\n    businessName: string\n  ): Promise<WebsiteMessagingAnalysis> {\n    if (!OPENROUTER_API_KEY) {\n      console.warn('[WebsiteAnalyzer] No OpenRouter API key configured - returning empty analysis')\n      return {\n        valuePropositions: [],\n        targetAudience: [],\n        customerProblems: [],\n        solutions: [],\n        proofPoints: [],\n        differentiators: [],\n        confidence: 0\n      }\n    }\n\n    try {\n      console.log('[WebsiteAnalyzer] Starting AI analysis for:', businessName)\n\n      // Truncate content to avoid token limits (keep first ~20,000 chars)\n      const truncatedContent = websiteContent.slice(0, 20000)\n\n      const prompt = `You are a brand strategist analyzing a business's website content to understand EXACTLY what they sell and who they serve.\n\nBusiness: ${businessName}\nWebsite Content:\n${truncatedContent}\n\nExtract the following business-specific information. CRITICAL RULES:\n- Only include what they EXPLICITLY state on their website\n- Use their EXACT words and phrases whenever possible\n- DO NOT use generic industry assumptions\n- If something is not mentioned, use empty array\n- FOCUS on finding their SPECIALIZATION (niche, specific services, unique focus)\n\n1. VALUE PROPOSITIONS: What unique benefits, guarantees, or promises do they explicitly mention? Their exact value statements.\n\n2. TARGET AUDIENCE: Who EXACTLY are they talking to? Look for specific demographics, industries, types of customers. Use their exact language. Examples: \"luxury car owners\", \"classic car collectors\", \"high-net-worth individuals\", \"exotic vehicle enthusiasts\", \"young families\", \"first-time homebuyers\", etc.\n\n3. CUSTOMER PROBLEMS: What specific problems, pain points, or challenges do they say their customers face? Use their exact words.\n\n4. THEIR SOLUTION: How do they describe solving those problems? What specific services or products do they offer? BE SPECIFIC about what they sell.\n\n5. PROOF POINTS: What credentials, experience, results, testimonials, certifications, awards, or stats do they cite?\n\n6. DIFFERENTIATORS: What makes them different or specialized? Look for:\n   - Niche focus (e.g., \"rare cars\", \"vintage vehicles\", \"luxury homes\", \"commercial properties\")\n   - Specific expertise (e.g., \"25 years insuring classic cars\", \"certified appraisers for collectibles\")\n   - Unique services (e.g., \"agreed value coverage\", \"restoration specialists\", \"concierge service\")\n   - Market position (e.g., \"only provider in X\", \"largest X in Y\")\n\nReturn ONLY valid JSON (no markdown, no explanations):\n{\n  \"valuePropositions\": [\"exact quote 1\", \"exact quote 2\"],\n  \"targetAudience\": [\"exact audience description 1\", \"exact audience 2\"],\n  \"customerProblems\": [\"problem 1 in their words\", \"problem 2\"],\n  \"solutions\": [\"specific service/product 1\", \"specific service 2\"],\n  \"proofPoints\": [\"credential 1\", \"stat 1\", \"testimonial theme\"],\n  \"differentiators\": [\"unique specialization 1\", \"niche focus 2\", \"unique service 3\"]\n}`\n\n      const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${OPENROUTER_API_KEY}`,\n          'HTTP-Referer': 'https://marba.ai',\n          'X-Title': 'MARBA Intelligence',\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          model: 'anthropic/claude-3.5-sonnet',\n          messages: [{\n            role: 'user',\n            content: prompt\n          }],\n          max_tokens: 4096,\n          temperature: 0.3\n        })\n      })\n\n      if (!response.ok) {\n        const errorText = await response.text()\n        console.error('[WebsiteAnalyzer] OpenRouter API error:', response.status, errorText)\n        throw new Error(`OpenRouter API error: ${response.status}`)\n      }\n\n      const data = await response.json()\n      const analysisText = data.choices[0].message.content\n\n      console.log('[WebsiteAnalyzer] Raw AI response:', analysisText.substring(0, 200) + '...')\n\n      // Parse JSON response\n      const analysis = JSON.parse(analysisText)\n\n      // Calculate confidence based on data richness\n      const dataPoints = [\n        analysis.valuePropositions?.length || 0,\n        analysis.targetAudience?.length || 0,\n        analysis.customerProblems?.length || 0,\n        analysis.solutions?.length || 0,\n        analysis.proofPoints?.length || 0,\n        analysis.differentiators?.length || 0\n      ]\n\n      const totalDataPoints = dataPoints.reduce((sum, count) => sum + count, 0)\n      const confidence = Math.min(totalDataPoints > 0 ? 50 + (totalDataPoints * 5) : 30, 95)\n\n      console.log('[WebsiteAnalyzer] Analysis complete:')\n      console.log('  - Value Propositions:', analysis.valuePropositions?.length || 0)\n      console.log('  - Target Audience:', analysis.targetAudience?.length || 0)\n      console.log('  - Problems:', analysis.customerProblems?.length || 0)\n      console.log('  - Solutions:', analysis.solutions?.length || 0)\n      console.log('  - Proof Points:', analysis.proofPoints?.length || 0)\n      console.log('  - Differentiators:', analysis.differentiators?.length || 0)\n      console.log('  - Confidence:', confidence + '%')\n\n      return {\n        valuePropositions: analysis.valuePropositions || [],\n        targetAudience: analysis.targetAudience || [],\n        customerProblems: analysis.customerProblems || [],\n        solutions: analysis.solutions || [],\n        proofPoints: analysis.proofPoints || [],\n        differentiators: analysis.differentiators || [],\n        confidence\n      }\n    } catch (error) {\n      console.error('[WebsiteAnalyzer] AI analysis failed:', error)\n\n      // Return empty analysis on error (graceful fallback)\n      return {\n        valuePropositions: [],\n        targetAudience: [],\n        customerProblems: [],\n        solutions: [],\n        proofPoints: [],\n        differentiators: [],\n        confidence: 0\n      }\n    }\n  }\n\n  /**\n   * Convenience method: Fetch and analyze in one call\n   */\n  async analyzeWebsite(url: string): Promise<WebsiteMessagingAnalysis> {\n    try {\n      // Extract business name from URL\n      const businessName = new URL(url).hostname.replace('www.', '').split('.')[0]\n\n      // Fetch content\n      const content = await this.extractWebsiteContent(url)\n\n      // Analyze with AI\n      return await this.analyzeWebsiteMessaging(content, businessName)\n    } catch (error) {\n      console.error('[WebsiteAnalyzer] analyzeWebsite failed:', error)\n      throw error\n    }\n  }\n}\n\nexport const websiteAnalyzer = new WebsiteAnalyzerService()\nexport { WebsiteAnalyzerService }\n","/**\n * Reddit API Service\n *\n * Mines Reddit for psychological triggers, customer pain points, and trending topics.\n * Integrates with Synapse's ContentPsychologyEngine to power breakthrough content.\n *\n * Features:\n * - OAuth 2.0 authentication with token refresh\n * - Subreddit search by industry/keywords\n * - Psychological trigger extraction from comments\n * - Customer pain point & desire mining\n * - Trending topic identification\n * - Fallback to public API if auth fails\n *\n * Created: 2025-11-14\n */\n\nimport type { EmotionalTriggerType } from '@/types/synapse.types';\n\n// ============================================================================\n// TYPES\n// ============================================================================\n\nexport interface RedditAuthConfig {\n  clientId: string;\n  clientSecret: string;\n  userAgent: string;\n}\n\nexport interface RedditAccessToken {\n  accessToken: string;\n  tokenType: string;\n  expiresIn: number;\n  scope: string;\n  expiresAt: number; // Unix timestamp\n}\n\nexport interface RedditPsychologicalTrigger {\n  text: string;\n  type: EmotionalTriggerType;\n  intensity: number; // 1-10\n  context: string; // Surrounding text for context\n  subreddit: string;\n  upvotes: number; // Social validation\n  url: string;\n}\n\nexport interface RedditCustomerInsight {\n  painPoint?: string; // \"I hate when...\"\n  desire?: string; // \"I wish...\"\n  context: string;\n  subreddit: string;\n  upvotes: number;\n  url: string;\n}\n\nexport interface RedditTrendingTopic {\n  topic: string;\n  subreddit: string;\n  mentions: number;\n  sentiment: 'positive' | 'negative' | 'neutral';\n  topPosts: Array<{\n    title: string;\n    url: string;\n    upvotes: number;\n    comments: number;\n  }>;\n}\n\nexport interface RedditIntelligenceResult {\n  triggers: RedditPsychologicalTrigger[];\n  insights: RedditCustomerInsight[];\n  trendingTopics: RedditTrendingTopic[];\n  metadata: {\n    searchQuery: string;\n    subreddits: string[];\n    totalComments: number;\n    totalPosts: number;\n    timestamp: string;\n  };\n}\n\n// ============================================================================\n// REDDIT API CLASS\n// ============================================================================\n\nexport class RedditAPI {\n  private clientId: string;\n  private clientSecret: string;\n  private userAgent: string;\n  private accessToken: RedditAccessToken | null = null;\n\n  constructor(config?: RedditAuthConfig) {\n    // Load from environment if not provided\n    this.clientId = config?.clientId ||\n      import.meta.env.VITE_REDDIT_CLIENT_ID ||\n      import.meta.env.REDDIT_CLIENT_ID || '';\n\n    this.clientSecret = config?.clientSecret ||\n      import.meta.env.VITE_REDDIT_CLIENT_SECRET ||\n      import.meta.env.REDDIT_CLIENT_SECRET || '';\n\n    this.userAgent = config?.userAgent ||\n      import.meta.env.VITE_REDDIT_USER_AGENT ||\n      import.meta.env.REDDIT_USER_AGENT ||\n      'Synapse/1.0';\n  }\n\n  // ==========================================================================\n  // AUTHENTICATION\n  // ==========================================================================\n\n  /**\n   * Get or refresh OAuth access token (via Supabase Edge Function to avoid CORS)\n   */\n  private async getAccessToken(): Promise<string> {\n    // Return cached token if still valid\n    if (this.accessToken && Date.now() < this.accessToken.expiresAt) {\n      return this.accessToken.accessToken;\n    }\n\n    console.log('[RedditAPI] Fetching new access token via Edge Function...');\n\n    const SUPABASE_URL = import.meta.env.VITE_SUPABASE_URL;\n    const SUPABASE_ANON_KEY = import.meta.env.VITE_SUPABASE_ANON_KEY;\n\n    if (!SUPABASE_URL || !SUPABASE_ANON_KEY) {\n      throw new Error('Supabase configuration missing');\n    }\n\n    if (!this.clientId || !this.clientSecret) {\n      throw new Error('Reddit API credentials not configured');\n    }\n\n    try {\n      const response = await fetch(\n        `${SUPABASE_URL}/functions/v1/reddit-oauth`,\n        {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`\n          },\n          body: JSON.stringify({\n            endpoint: '/oauth/token',\n            userAgent: this.userAgent\n          })\n        }\n      );\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        console.error('[RedditAPI] Edge Function error:', response.status, errorText);\n        throw new Error(`Edge Function failed: ${response.status}`);\n      }\n\n      const data = await response.json();\n\n      if (!data.success) {\n        throw new Error(data.error || 'Unknown error from Edge Function');\n      }\n\n      this.accessToken = {\n        accessToken: data.accessToken,\n        tokenType: data.tokenType,\n        expiresIn: data.expiresIn,\n        scope: data.scope,\n        expiresAt: Date.now() + (data.expiresIn * 1000) - 60000 // 1 min buffer\n      };\n\n      console.log('[RedditAPI] ✅ Access token obtained via Edge Function, expires in', data.expiresIn, 'seconds');\n\n      return this.accessToken.accessToken;\n    } catch (error) {\n      console.error('[RedditAPI] OAuth error:', error);\n      throw new Error('Failed to authenticate with Reddit API');\n    }\n  }\n\n  /**\n   * Make authenticated API request (via Supabase Edge Function to avoid CORS)\n   * Falls back to public API if auth fails\n   */\n  private async fetchAPI(endpoint: string, useAuth = true): Promise<any> {\n    const SUPABASE_URL = import.meta.env.VITE_SUPABASE_URL;\n    const SUPABASE_ANON_KEY = import.meta.env.VITE_SUPABASE_ANON_KEY;\n\n    if (!SUPABASE_URL || !SUPABASE_ANON_KEY) {\n      throw new Error('Supabase configuration missing');\n    }\n\n    try {\n      let accessToken = '';\n      if (useAuth) {\n        try {\n          accessToken = await this.getAccessToken();\n        } catch (authError) {\n          console.warn('[RedditAPI] OAuth failed, falling back to public API:', authError);\n          useAuth = false; // Fall back to public API\n        }\n      }\n\n      const response = await fetch(\n        `${SUPABASE_URL}/functions/v1/reddit-oauth`,\n        {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`\n          },\n          body: JSON.stringify({\n            endpoint,\n            accessToken,\n            userAgent: this.userAgent,\n            useAuth\n          })\n        }\n      );\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        console.error('[RedditAPI] Edge Function error:', response.status, errorText);\n        throw new Error(`Edge Function failed: ${response.status}`);\n      }\n\n      const result = await response.json();\n\n      if (!result.success) {\n        throw new Error(result.error || 'Unknown error from Edge Function');\n      }\n\n      return result.data;\n    } catch (error) {\n      console.error('[RedditAPI] Fetch error:', error);\n      throw error;\n    }\n  }\n\n  // ==========================================================================\n  // PSYCHOLOGICAL TRIGGER EXTRACTION\n  // ==========================================================================\n\n  /**\n   * Analyze text for psychological triggers\n   */\n  private analyzePsychologicalTriggers(\n    text: string,\n    context: {\n      subreddit: string;\n      upvotes: number;\n      url: string;\n    }\n  ): RedditPsychologicalTrigger[] {\n    const triggers: RedditPsychologicalTrigger[] = [];\n    const lowerText = text.toLowerCase();\n\n    // CURIOSITY triggers\n    const curiosityPatterns = [\n      /you (won't|wont) believe/i,\n      /the secret (to|of)/i,\n      /what (actually|really) (happened|works)/i,\n      /turns out/i,\n      /discovered (that|how)/i,\n      /found out (that|how)/i\n    ];\n\n    for (const pattern of curiosityPatterns) {\n      if (pattern.test(text)) {\n        triggers.push({\n          text: this.extractMatchContext(text, pattern),\n          type: 'curiosity',\n          intensity: this.calculateTriggerIntensity(context.upvotes, 'curiosity'),\n          context: text.substring(0, 200),\n          subreddit: context.subreddit,\n          upvotes: context.upvotes,\n          url: context.url\n        });\n      }\n    }\n\n    // FEAR triggers\n    const fearPatterns = [\n      /avoid|warning|mistake|danger|risk|scary|afraid/i,\n      /don't (do|make|try)/i,\n      /be careful/i,\n      /watch out/i\n    ];\n\n    for (const pattern of fearPatterns) {\n      if (pattern.test(text)) {\n        triggers.push({\n          text: this.extractMatchContext(text, pattern),\n          type: 'fear',\n          intensity: this.calculateTriggerIntensity(context.upvotes, 'fear'),\n          context: text.substring(0, 200),\n          subreddit: context.subreddit,\n          upvotes: context.upvotes,\n          url: context.url\n        });\n      }\n    }\n\n    // DESIRE triggers\n    const desirePatterns = [\n      /imagine|dream|wish|want|hope|achieve|accomplish/i,\n      /finally (got|found|achieved)/i,\n      /this changed my life/i\n    ];\n\n    for (const pattern of desirePatterns) {\n      if (pattern.test(text)) {\n        triggers.push({\n          text: this.extractMatchContext(text, pattern),\n          type: 'desire',\n          intensity: this.calculateTriggerIntensity(context.upvotes, 'desire'),\n          context: text.substring(0, 200),\n          subreddit: context.subreddit,\n          upvotes: context.upvotes,\n          url: context.url\n        });\n      }\n    }\n\n    // BELONGING triggers\n    const belongingPatterns = [\n      /join (us|our|the)/i,\n      /community|together|family|tribe|team/i,\n      /one of us|we all/i,\n      /everyone (here|knows)/i\n    ];\n\n    for (const pattern of belongingPatterns) {\n      if (pattern.test(text)) {\n        triggers.push({\n          text: this.extractMatchContext(text, pattern),\n          type: 'belonging',\n          intensity: this.calculateTriggerIntensity(context.upvotes, 'belonging'),\n          context: text.substring(0, 200),\n          subreddit: context.subreddit,\n          upvotes: context.upvotes,\n          url: context.url\n        });\n      }\n    }\n\n    // ACHIEVEMENT triggers\n    const achievementPatterns = [\n      /success|victory|accomplished|proud|finally (did|achieved)/i,\n      /made it|reached|hit (my|the) goal/i,\n      /(beat|overcame|conquered)/i\n    ];\n\n    for (const pattern of achievementPatterns) {\n      if (pattern.test(text)) {\n        triggers.push({\n          text: this.extractMatchContext(text, pattern),\n          type: 'achievement',\n          intensity: this.calculateTriggerIntensity(context.upvotes, 'achievement'),\n          context: text.substring(0, 200),\n          subreddit: context.subreddit,\n          upvotes: context.upvotes,\n          url: context.url\n        });\n      }\n    }\n\n    // TRUST triggers\n    const trustPatterns = [\n      /honest(ly)?|transparent|authentic|genuine/i,\n      /trust me|believe me|i promise/i,\n      /no (bs|bullshit|lie)/i\n    ];\n\n    for (const pattern of trustPatterns) {\n      if (pattern.test(text)) {\n        triggers.push({\n          text: this.extractMatchContext(text, pattern),\n          type: 'trust',\n          intensity: this.calculateTriggerIntensity(context.upvotes, 'trust'),\n          context: text.substring(0, 200),\n          subreddit: context.subreddit,\n          upvotes: context.upvotes,\n          url: context.url\n        });\n      }\n    }\n\n    // URGENCY triggers\n    const urgencyPatterns = [\n      /last chance|running out|limited|now or never/i,\n      /don't wait|act (now|fast|quickly)/i,\n      /hurry|urgent/i\n    ];\n\n    for (const pattern of urgencyPatterns) {\n      if (pattern.test(text)) {\n        triggers.push({\n          text: this.extractMatchContext(text, pattern),\n          type: 'urgency',\n          intensity: this.calculateTriggerIntensity(context.upvotes, 'urgency'),\n          context: text.substring(0, 200),\n          subreddit: context.subreddit,\n          upvotes: context.upvotes,\n          url: context.url\n        });\n      }\n    }\n\n    return triggers;\n  }\n\n  /**\n   * Extract context around matched pattern\n   */\n  private extractMatchContext(text: string, pattern: RegExp): string {\n    const match = text.match(pattern);\n    if (!match) return text.substring(0, 100);\n\n    const matchIndex = match.index || 0;\n    const start = Math.max(0, matchIndex - 50);\n    const end = Math.min(text.length, matchIndex + match[0].length + 50);\n\n    return text.substring(start, end).trim();\n  }\n\n  /**\n   * Calculate trigger intensity based on upvotes and type\n   */\n  private calculateTriggerIntensity(upvotes: number, type: EmotionalTriggerType): number {\n    // Base intensity on upvotes (social validation)\n    let intensity = Math.min(10, Math.floor(upvotes / 10) + 1);\n\n    // Adjust by trigger type (some are naturally stronger)\n    const typeMultipliers: Record<EmotionalTriggerType, number> = {\n      'curiosity': 1.0,\n      'fear': 1.2,\n      'desire': 1.1,\n      'belonging': 0.9,\n      'achievement': 1.0,\n      'trust': 0.8,\n      'urgency': 1.3\n    };\n\n    intensity *= typeMultipliers[type];\n\n    return Math.min(10, Math.max(1, Math.round(intensity)));\n  }\n\n  // ==========================================================================\n  // CUSTOMER INSIGHTS EXTRACTION\n  // ==========================================================================\n\n  /**\n   * Extract pain points and desires from comments\n   */\n  private extractCustomerInsights(\n    text: string,\n    context: {\n      subreddit: string;\n      upvotes: number;\n      url: string;\n    }\n  ): RedditCustomerInsight | null {\n    const lowerText = text.toLowerCase();\n\n    // Pain points: \"I hate...\", \"I can't stand...\", \"frustrating when...\"\n    const painPointPatterns = [\n      /i hate (when|how|that)/i,\n      /i can't stand/i,\n      /frustrating (when|how|that)/i,\n      /annoying (when|how|that)/i,\n      /why (is it so|does)/i,\n      /the problem (is|with)/i\n    ];\n\n    for (const pattern of painPointPatterns) {\n      const match = text.match(pattern);\n      if (match) {\n        const index = match.index || 0;\n        const painPoint = text.substring(index, Math.min(text.length, index + 200));\n\n        return {\n          painPoint,\n          context: text.substring(0, 300),\n          subreddit: context.subreddit,\n          upvotes: context.upvotes,\n          url: context.url\n        };\n      }\n    }\n\n    // Desires: \"I wish...\", \"If only...\", \"I'd love...\"\n    const desirePatterns = [\n      /i wish (there was|i could|someone would)/i,\n      /if only (there was|i could)/i,\n      /i'd love (to|if)/i,\n      /would be (great|amazing|perfect) if/i,\n      /someone (should|needs to) (make|create|build)/i\n    ];\n\n    for (const pattern of desirePatterns) {\n      const match = text.match(pattern);\n      if (match) {\n        const index = match.index || 0;\n        const desire = text.substring(index, Math.min(text.length, index + 200));\n\n        return {\n          desire,\n          context: text.substring(0, 300),\n          subreddit: context.subreddit,\n          upvotes: context.upvotes,\n          url: context.url\n        };\n      }\n    }\n\n    return null;\n  }\n\n  // ==========================================================================\n  // MAIN INTELLIGENCE GATHERING\n  // ==========================================================================\n\n  /**\n   * Search Reddit for psychological triggers and insights\n   *\n   * @param query - Search query (e.g., \"fitness motivation\", \"restaurant problems\")\n   * @param options - Search options\n   */\n  async mineIntelligence(\n    query: string,\n    options: {\n      subreddits?: string[]; // Specific subreddits to search\n      limit?: number; // Number of posts to analyze (default: 25)\n      commentsPerPost?: number; // Comments per post (default: 20)\n      sortBy?: 'relevance' | 'hot' | 'top' | 'new'; // Sort order\n      timeFilter?: 'hour' | 'day' | 'week' | 'month' | 'year' | 'all'; // Time filter\n    } = {}\n  ): Promise<RedditIntelligenceResult> {\n    const {\n      subreddits = [],\n      limit = 25,\n      commentsPerPost = 20,\n      sortBy = 'relevance',\n      timeFilter = 'month'\n    } = options;\n\n    console.log('[RedditAPI] Mining intelligence for:', query);\n\n    const allTriggers: RedditPsychologicalTrigger[] = [];\n    const allInsights: RedditCustomerInsight[] = [];\n    const topicMentions: Map<string, RedditTrendingTopic> = new Map();\n\n    try {\n      // Build search query\n      const subredditFilter = subreddits.length > 0\n        ? ` subreddit:${subreddits.join(' OR subreddit:')}`\n        : '';\n\n      const searchQuery = query + subredditFilter;\n\n      // Search for posts\n      const endpoint = `/search?q=${encodeURIComponent(searchQuery)}&sort=${sortBy}&t=${timeFilter}&limit=${limit}`;\n      const searchResults = await this.fetchAPI(endpoint);\n\n      const posts = searchResults.data?.children || [];\n      console.log('[RedditAPI] Found', posts.length, 'posts');\n\n      // Analyze each post\n      for (const postWrapper of posts) {\n        const post = postWrapper.data;\n        const postUrl = `https://reddit.com${post.permalink}`;\n\n        // Analyze post title and selftext\n        const postText = `${post.title} ${post.selftext || ''}`;\n        const postContext = {\n          subreddit: post.subreddit,\n          upvotes: post.ups,\n          url: postUrl\n        };\n\n        // Extract triggers from post\n        const postTriggers = this.analyzePsychologicalTriggers(postText, postContext);\n        allTriggers.push(...postTriggers);\n\n        // Extract insights from post\n        const postInsight = this.extractCustomerInsights(postText, postContext);\n        if (postInsight) {\n          allInsights.push(postInsight);\n        }\n\n        // Fetch and analyze comments\n        try {\n          const commentsEndpoint = `/r/${post.subreddit}/comments/${post.id}?limit=${commentsPerPost}`;\n          const commentsData = await this.fetchAPI(commentsEndpoint);\n\n          const comments = commentsData[1]?.data?.children || [];\n\n          for (const commentWrapper of comments) {\n            const comment = commentWrapper.data;\n            if (!comment.body || comment.body === '[deleted]') continue;\n\n            const commentContext = {\n              subreddit: post.subreddit,\n              upvotes: comment.ups,\n              url: `${postUrl}${comment.id}`\n            };\n\n            // Extract triggers from comment\n            const commentTriggers = this.analyzePsychologicalTriggers(comment.body, commentContext);\n            allTriggers.push(...commentTriggers);\n\n            // Extract insights from comment\n            const commentInsight = this.extractCustomerInsights(comment.body, commentContext);\n            if (commentInsight) {\n              allInsights.push(commentInsight);\n            }\n          }\n        } catch (err) {\n          console.warn('[RedditAPI] Failed to fetch comments for post:', post.id);\n        }\n      }\n\n      // Sort by social validation (upvotes)\n      allTriggers.sort((a, b) => b.upvotes - a.upvotes);\n      allInsights.sort((a, b) => b.upvotes - a.upvotes);\n\n      console.log('[RedditAPI] ✅ Extracted', allTriggers.length, 'triggers and', allInsights.length, 'insights');\n\n      return {\n        triggers: allTriggers.slice(0, 50), // Top 50 triggers\n        insights: allInsights.slice(0, 30), // Top 30 insights\n        trendingTopics: Array.from(topicMentions.values()),\n        metadata: {\n          searchQuery: query,\n          subreddits: subreddits.length > 0 ? subreddits : ['all'],\n          totalComments: allTriggers.length + allInsights.length,\n          totalPosts: posts.length,\n          timestamp: new Date().toISOString()\n        }\n      };\n    } catch (error) {\n      console.error('[RedditAPI] Mining failed:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Quick search for industry-specific subreddits\n   */\n  async findRelevantSubreddits(industry: string): Promise<string[]> {\n    // Map common industries to subreddit names\n    const industryToSubreddits: Record<string, string[]> = {\n      'fitness': ['fitness', 'bodybuilding', 'xxfitness', 'running', 'yoga'],\n      'restaurant': ['FoodPorn', 'recipes', 'Cooking', 'AskCulinary', 'KitchenConfidential'],\n      'dental': ['Dentistry', 'DentalHygiene', 'askdentists'],\n      'realtor': ['RealEstate', 'FirstTimeHomeBuyer', 'realtors'],\n      'cpa': ['Accounting', 'tax', 'smallbusiness'],\n      'insurance': ['Insurance', 'personalfinance'],\n      'consultant': ['consulting', 'Entrepreneur', 'smallbusiness'],\n      // Add more as needed\n    };\n\n    const normalizedIndustry = industry.toLowerCase();\n\n    for (const [key, subreddits] of Object.entries(industryToSubreddits)) {\n      if (normalizedIndustry.includes(key)) {\n        return subreddits;\n      }\n    }\n\n    // Default: search using industry name\n    return [industry.replace(/\\s+/g, '')];\n  }\n}\n\n// ============================================================================\n// SINGLETON INSTANCE\n// ============================================================================\n\nexport const redditAPI = new RedditAPI();\n","/**\n * Perplexity API Service for UVP Wizard\n *\n * Provides real-time industry insights, market research, and competitive intelligence\n * using Perplexity's Sonar models with web search capabilities.\n *\n * This service helps generate UVP suggestions based on:\n * - Industry trends and best practices\n * - Customer pain points and needs\n * - Competitive differentiation opportunities\n * - Market positioning insights\n */\n\nimport {\n  PerplexityRequest,\n  PerplexityResponse,\n  DraggableSuggestion,\n  SuggestionType,\n} from '@/types/uvp-wizard'\n\n/**\n * Perplexity API configuration\n */\ninterface PerplexityConfig {\n  apiKey: string\n  model: 'sonar-pro' | 'sonar' | 'sonar-medium' | 'sonar-small'\n  temperature: number\n  maxTokens: number\n}\n\n/**\n * Default configuration\n */\nconst DEFAULT_CONFIG: PerplexityConfig = {\n  apiKey: import.meta.env.VITE_OPENROUTER_API_KEY || import.meta.env.VITE_OPENAI_API_KEY || '',\n  model: 'sonar-pro', // Best for deep research\n  temperature: 0.7,\n  maxTokens: 2000,\n}\n\n/**\n * Perplexity API service class\n */\nexport class PerplexityAPI {\n  private config: PerplexityConfig\n  private endpoint = 'https://openrouter.ai/api/v1/chat/completions'\n\n  constructor(config?: Partial<PerplexityConfig>) {\n    this.config = { ...DEFAULT_CONFIG, ...config }\n\n    if (!this.config.apiKey) {\n      console.warn('[PerplexityAPI] No API key provided. Set VITE_OPENROUTER_API_KEY.')\n    }\n  }\n\n  /**\n   * Check if API is available\n   */\n  async isAvailable(): Promise<boolean> {\n    return !!this.config.apiKey\n  }\n\n  /**\n   * Get industry insights for a specific context\n   */\n  async getIndustryInsights(request: PerplexityRequest): Promise<PerplexityResponse> {\n    console.log('[PerplexityAPI] Fetching industry insights:', request)\n\n    try {\n      const prompt = this.buildPrompt(request)\n      const response = await this.makeRequest(prompt)\n\n      return this.parseResponse(response)\n    } catch (error) {\n      console.error('[PerplexityAPI] Failed to get industry insights:', error)\n      throw error\n    }\n  }\n\n  /**\n   * Generate customer problem suggestions\n   */\n  async generateCustomerProblems(\n    industry: string,\n    customerSegment: string\n  ): Promise<DraggableSuggestion[]> {\n    const request: PerplexityRequest = {\n      query: `What are the top 5 most pressing problems and pain points that ${customerSegment} face in the ${industry} industry right now?`,\n      context: { industry },\n      max_results: 5,\n    }\n\n    const response = await this.getIndustryInsights(request)\n\n    return response.insights.map((insight, index) => ({\n      id: `problem-${Date.now()}-${index}`,\n      content: insight,\n      type: 'problem' as SuggestionType,\n      source: 'ai-generated',\n      confidence: response.confidence,\n      is_selected: false,\n      is_customizable: true,\n    }))\n  }\n\n  /**\n   * Generate solution suggestions\n   */\n  async generateSolutions(\n    industry: string,\n    problem: string\n  ): Promise<DraggableSuggestion[]> {\n    const request: PerplexityRequest = {\n      query: `What are the most effective solutions currently being used to solve this problem in the ${industry} industry: \"${problem}\"? Provide 5 specific solution approaches.`,\n      context: { industry },\n      max_results: 5,\n    }\n\n    const response = await this.getIndustryInsights(request)\n\n    return response.insights.map((insight, index) => ({\n      id: `solution-${Date.now()}-${index}`,\n      content: insight,\n      type: 'solution' as SuggestionType,\n      source: 'ai-generated',\n      confidence: response.confidence,\n      is_selected: false,\n      is_customizable: true,\n    }))\n  }\n\n  /**\n   * Generate key benefit suggestions\n   */\n  async generateKeyBenefits(\n    industry: string,\n    solution: string\n  ): Promise<DraggableSuggestion[]> {\n    const request: PerplexityRequest = {\n      query: `What are the top 5 measurable benefits that customers experience from this type of solution in the ${industry} industry: \"${solution}\"? Focus on tangible outcomes.`,\n      context: { industry },\n      max_results: 5,\n    }\n\n    const response = await this.getIndustryInsights(request)\n\n    return response.insights.map((insight, index) => ({\n      id: `benefit-${Date.now()}-${index}`,\n      content: insight,\n      type: 'benefit' as SuggestionType,\n      source: 'ai-generated',\n      confidence: response.confidence,\n      is_selected: false,\n      is_customizable: true,\n    }))\n  }\n\n  /**\n   * Generate differentiation opportunities\n   */\n  async generateDifferentiators(\n    industry: string,\n    competitors: string[]\n  ): Promise<DraggableSuggestion[]> {\n    const competitorList = competitors.length > 0\n      ? `Key competitors include: ${competitors.join(', ')}.`\n      : ''\n\n    const request: PerplexityRequest = {\n      query: `In the ${industry} industry, what are 5 unique ways a company can differentiate itself from competitors? ${competitorList} Focus on sustainable competitive advantages.`,\n      context: { industry, competitors },\n      max_results: 5,\n    }\n\n    const response = await this.getIndustryInsights(request)\n\n    return response.insights.map((insight, index) => ({\n      id: `differentiator-${Date.now()}-${index}`,\n      content: insight,\n      type: 'differentiator' as SuggestionType,\n      source: 'ai-generated',\n      confidence: response.confidence,\n      is_selected: false,\n      is_customizable: true,\n    }))\n  }\n\n  /**\n   * Get customer segment suggestions\n   */\n  async generateCustomerSegments(\n    industry: string,\n    brandName?: string\n  ): Promise<DraggableSuggestion[]> {\n    const brandContext = brandName ? `for a company like ${brandName}` : ''\n\n    const request: PerplexityRequest = {\n      query: `What are the 5 most valuable customer segments in the ${industry} industry ${brandContext}? Describe each segment with demographics and psychographics.`,\n      context: { industry, brand_name: brandName },\n      max_results: 5,\n    }\n\n    const response = await this.getIndustryInsights(request)\n\n    return response.insights.map((insight, index) => ({\n      id: `customer-${Date.now()}-${index}`,\n      content: insight,\n      type: 'customer-segment' as SuggestionType,\n      source: 'ai-generated',\n      confidence: response.confidence,\n      is_selected: false,\n      is_customizable: true,\n    }))\n  }\n\n  /**\n   * Research competitors for context\n   */\n  async researchCompetitors(\n    industry: string,\n    brandName: string\n  ): Promise<string[]> {\n    const request: PerplexityRequest = {\n      query: `Who are the top 10 competitors in the ${industry} industry for ${brandName}? List just the company names.`,\n      context: { industry, brand_name: brandName },\n      max_results: 10,\n    }\n\n    const response = await this.getIndustryInsights(request)\n    return response.insights\n  }\n\n  /**\n   * Build the prompt for Perplexity\n   */\n  private buildPrompt(request: PerplexityRequest): string {\n    let prompt = request.query\n\n    if (request.context) {\n      const contextParts: string[] = []\n\n      if (request.context.industry) {\n        contextParts.push(`Industry: ${request.context.industry}`)\n      }\n\n      if (request.context.brand_name) {\n        contextParts.push(`Brand: ${request.context.brand_name}`)\n      }\n\n      if (request.context.competitors && request.context.competitors.length > 0) {\n        contextParts.push(`Competitors: ${request.context.competitors.join(', ')}`)\n      }\n\n      if (contextParts.length > 0) {\n        prompt += `\\n\\nContext:\\n${contextParts.join('\\n')}`\n      }\n    }\n\n    prompt += `\\n\\nProvide ${request.max_results || 5} specific, actionable insights. Format your response as a JSON array of strings.`\n\n    return prompt\n  }\n\n  /**\n   * Make API request to Perplexity via OpenRouter\n   */\n  private async makeRequest(prompt: string): Promise<any> {\n    const modelName = this.mapModelName(this.config.model)\n\n    const response = await fetch(this.endpoint, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        Authorization: `Bearer ${this.config.apiKey}`,\n        'HTTP-Referer': window.location.origin,\n        'X-Title': 'MARBA UVP Wizard',\n      },\n      body: JSON.stringify({\n        model: modelName,\n        messages: [\n          {\n            role: 'system',\n            content:\n              'You are a marketing intelligence AI with real-time web access. Provide current, accurate insights about industries, markets, and customer needs. Always respond with valid JSON arrays.',\n          },\n          {\n            role: 'user',\n            content: prompt,\n          },\n        ],\n        temperature: this.config.temperature,\n        max_tokens: this.config.maxTokens,\n      }),\n    })\n\n    if (!response.ok) {\n      const error = await response.text()\n      throw new Error(`Perplexity API error: ${response.status} ${error}`)\n    }\n\n    return response.json()\n  }\n\n  /**\n   * Parse API response into PerplexityResponse\n   */\n  private parseResponse(data: any): PerplexityResponse {\n    const content = data.choices[0].message.content\n\n    // Try to parse as JSON array\n    let insights: string[] = []\n    try {\n      const parsed = JSON.parse(content)\n      insights = Array.isArray(parsed) ? parsed : [content]\n    } catch {\n      // If not JSON, split by newlines and filter\n      insights = content\n        .split('\\n')\n        .filter((line: string) => line.trim().length > 0)\n        .map((line: string) => line.replace(/^[\\d.-]+\\s*/, '').trim())\n        .filter((line: string) => line.length > 10)\n    }\n\n    // Calculate confidence based on response quality\n    const confidence = this.calculateConfidence(data)\n\n    return {\n      insights,\n      sources: this.extractSources(data),\n      confidence,\n    }\n  }\n\n  /**\n   * Calculate confidence score\n   */\n  private calculateConfidence(data: any): number {\n    // Base confidence on finish reason and token usage\n    if (data.choices[0].finish_reason === 'stop') {\n      return 0.9\n    }\n\n    if (data.choices[0].finish_reason === 'length') {\n      return 0.7\n    }\n\n    return 0.5\n  }\n\n  /**\n   * Extract sources from response metadata\n   */\n  private extractSources(data: any): Array<{ title: string; url: string; excerpt: string }> {\n    // OpenRouter doesn't return sources in the same format as native Perplexity\n    // Return empty array for now - could be enhanced later\n    return []\n  }\n\n  /**\n   * Map model names to OpenRouter format\n   */\n  private mapModelName(model: string): string {\n    const mapping: Record<string, string> = {\n      'sonar-pro': 'perplexity/sonar-pro',\n      sonar: 'perplexity/sonar',\n      'sonar-medium': 'perplexity/sonar-medium-online',\n      'sonar-small': 'perplexity/sonar-small-online',\n    }\n\n    return mapping[model] || model\n  }\n}\n\n/**\n * Singleton instance\n */\nexport const perplexityAPI = new PerplexityAPI()\n","/**\n * Intelligence Cache Service\n * Caches API responses from intelligence services with smart TTL\n * Reduces API costs and improves performance\n */\n\nimport { supabase } from '@/lib/supabase'\n\ninterface CacheEntry {\n  id: string\n  cache_key: string\n  data: any\n  data_type: string\n  source_api?: string\n  brand_id?: string\n  expires_at: string\n  created_at: string\n  updated_at: string\n}\n\ninterface CacheOptions {\n  dataType: string\n  sourceApi?: string\n  brandId?: string\n  ttlMinutes?: number // Optional override for default TTL\n}\n\n/**\n * Smart TTL configuration based on data type\n * Balances freshness with API cost reduction\n */\nconst TTL_CONFIG: Record<string, number> = {\n  // Long-lived data (7 days)\n  'competitor_profile': 7 * 24 * 60,\n  'website_analysis': 7 * 24 * 60,\n  'industry_profile': 7 * 24 * 60,\n  'company_info': 7 * 24 * 60,\n\n  // Medium-lived data (24 hours)\n  'news': 24 * 60,\n  'youtube_videos': 24 * 60,\n  'local_reviews': 24 * 60,\n\n  // Short-lived data (2 hours)\n  'search_results': 2 * 60,\n  'autocomplete': 2 * 60,\n\n  // Very short-lived data (1 hour)\n  'trend_data': 60,\n  'trending_searches': 60,\n\n  // Real-time data (30 minutes)\n  'weather': 30,\n  'local_events': 30,\n\n  // Default fallback (2 hours)\n  'default': 2 * 60\n}\n\nclass IntelligenceCacheService {\n  /**\n   * Generate a cache key from components\n   */\n  private generateCacheKey(components: string[]): string {\n    return components\n      .map(c => String(c).toLowerCase().trim())\n      .filter(Boolean)\n      .join(':')\n  }\n\n  /**\n   * Get TTL in minutes for a data type\n   */\n  private getTTL(dataType: string, overrideTTL?: number): number {\n    if (overrideTTL) return overrideTTL\n    return TTL_CONFIG[dataType] || TTL_CONFIG.default\n  }\n\n  /**\n   * Calculate expiration timestamp\n   */\n  private getExpiresAt(ttlMinutes: number): string {\n    const expiresAt = new Date()\n    expiresAt.setMinutes(expiresAt.getMinutes() + ttlMinutes)\n    return expiresAt.toISOString()\n  }\n\n  /**\n   * Get cached data by key\n   * Returns null if not found or expired\n   */\n  async get<T = any>(cacheKey: string): Promise<T | null> {\n    try {\n      console.log('[IntelligenceCache] Getting:', cacheKey)\n\n      const { data, error } = await supabase\n        .from('intelligence_cache')\n        .select('*')\n        .eq('cache_key', cacheKey)\n        .single()\n\n      if (error || !data) {\n        console.log('[IntelligenceCache] Cache miss:', cacheKey)\n        return null\n      }\n\n      // Check if expired\n      const expiresAt = new Date(data.expires_at)\n      if (expiresAt < new Date()) {\n        console.log('[IntelligenceCache] Cache expired:', cacheKey)\n        // Optionally delete expired entry\n        await this.invalidate(cacheKey)\n        return null\n      }\n\n      console.log('[IntelligenceCache] Cache hit:', cacheKey)\n      return data.data as T\n    } catch (error) {\n      console.error('[IntelligenceCache] Get error:', error)\n      return null\n    }\n  }\n\n  /**\n   * Set cache data with smart TTL\n   */\n  async set(\n    cacheKey: string,\n    data: any,\n    options: CacheOptions\n  ): Promise<void> {\n    try {\n      const ttlMinutes = this.getTTL(options.dataType, options.ttlMinutes)\n      const expiresAt = this.getExpiresAt(ttlMinutes)\n\n      console.log(`[IntelligenceCache] Setting: ${cacheKey} (TTL: ${ttlMinutes}m)`)\n\n      // Only include brand_id if it's a valid UUID (not \"demo\" or other test values)\n      const isValidUUID = options.brandId && /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(options.brandId)\n\n      const { error } = await supabase\n        .from('intelligence_cache')\n        .upsert({\n          cache_key: cacheKey,\n          data,\n          data_type: options.dataType,\n          source_api: options.sourceApi,\n          brand_id: isValidUUID ? options.brandId : null,\n          expires_at: expiresAt,\n          updated_at: new Date().toISOString()\n        }, {\n          onConflict: 'cache_key'\n        })\n\n      if (error) {\n        console.error('[IntelligenceCache] Set error:', error)\n      }\n    } catch (error) {\n      console.error('[IntelligenceCache] Set error:', error)\n    }\n  }\n\n  /**\n   * Invalidate (delete) cache entry\n   */\n  async invalidate(cacheKey: string): Promise<void> {\n    try {\n      console.log('[IntelligenceCache] Invalidating:', cacheKey)\n\n      const { error } = await supabase\n        .from('intelligence_cache')\n        .delete()\n        .eq('cache_key', cacheKey)\n\n      if (error) {\n        console.error('[IntelligenceCache] Invalidate error:', error)\n      }\n    } catch (error) {\n      console.error('[IntelligenceCache] Invalidate error:', error)\n    }\n  }\n\n  /**\n   * Invalidate all cache entries for a specific brand\n   */\n  async invalidateByBrand(brandId: string): Promise<void> {\n    try {\n      console.log('[IntelligenceCache] Invalidating brand:', brandId)\n\n      const { error } = await supabase\n        .from('intelligence_cache')\n        .delete()\n        .eq('brand_id', brandId)\n\n      if (error) {\n        console.error('[IntelligenceCache] Invalidate by brand error:', error)\n      }\n    } catch (error) {\n      console.error('[IntelligenceCache] Invalidate by brand error:', error)\n    }\n  }\n\n  /**\n   * Invalidate all cache entries of a specific type\n   */\n  async invalidateByType(dataType: string): Promise<void> {\n    try {\n      console.log('[IntelligenceCache] Invalidating type:', dataType)\n\n      const { error } = await supabase\n        .from('intelligence_cache')\n        .delete()\n        .eq('data_type', dataType)\n\n      if (error) {\n        console.error('[IntelligenceCache] Invalidate by type error:', error)\n      }\n    } catch (error) {\n      console.error('[IntelligenceCache] Invalidate by type error:', error)\n    }\n  }\n\n  /**\n   * Invalidate all cache entries from a specific API source\n   */\n  async invalidateBySource(sourceApi: string): Promise<void> {\n    try {\n      console.log('[IntelligenceCache] Invalidating source:', sourceApi)\n\n      const { error } = await supabase\n        .from('intelligence_cache')\n        .delete()\n        .eq('source_api', sourceApi)\n\n      if (error) {\n        console.error('[IntelligenceCache] Invalidate by source error:', error)\n      }\n    } catch (error) {\n      console.error('[IntelligenceCache] Invalidate by source error:', error)\n    }\n  }\n\n  /**\n   * Clean up all expired cache entries\n   * This should be called periodically (e.g., via cron job)\n   */\n  async cleanupExpired(): Promise<number> {\n    try {\n      console.log('[IntelligenceCache] Cleaning up expired entries...')\n\n      const { data, error } = await supabase\n        .from('intelligence_cache')\n        .delete()\n        .lt('expires_at', new Date().toISOString())\n        .select('id')\n\n      if (error) {\n        console.error('[IntelligenceCache] Cleanup error:', error)\n        return 0\n      }\n\n      const deletedCount = data?.length || 0\n      console.log(`[IntelligenceCache] Cleaned up ${deletedCount} expired entries`)\n      return deletedCount\n    } catch (error) {\n      console.error('[IntelligenceCache] Cleanup error:', error)\n      return 0\n    }\n  }\n\n  /**\n   * Get cache statistics\n   */\n  async getStats(): Promise<{\n    total: number\n    byType: Record<string, number>\n    bySource: Record<string, number>\n    expired: number\n  }> {\n    try {\n      const { data, error } = await supabase\n        .from('intelligence_cache')\n        .select('data_type, source_api, expires_at')\n\n      if (error || !data) {\n        return { total: 0, byType: {}, bySource: {}, expired: 0 }\n      }\n\n      const now = new Date()\n      const stats = {\n        total: data.length,\n        byType: {} as Record<string, number>,\n        bySource: {} as Record<string, number>,\n        expired: 0\n      }\n\n      data.forEach(entry => {\n        // Count by type\n        stats.byType[entry.data_type] = (stats.byType[entry.data_type] || 0) + 1\n\n        // Count by source\n        if (entry.source_api) {\n          stats.bySource[entry.source_api] = (stats.bySource[entry.source_api] || 0) + 1\n        }\n\n        // Count expired\n        if (new Date(entry.expires_at) < now) {\n          stats.expired++\n        }\n      })\n\n      return stats\n    } catch (error) {\n      console.error('[IntelligenceCache] Stats error:', error)\n      return { total: 0, byType: {}, bySource: {}, expired: 0 }\n    }\n  }\n\n  /**\n   * Helper: Create cache key for Serper News\n   */\n  cacheKeyNews(topic: string, location?: string): string {\n    return this.generateCacheKey(['serper', 'news', topic, location || 'global'])\n  }\n\n  /**\n   * Helper: Create cache key for Serper Trends\n   */\n  cacheKeyTrends(keyword: string, timeRange?: string): string {\n    return this.generateCacheKey(['serper', 'trends', keyword, timeRange || '30d'])\n  }\n\n  /**\n   * Helper: Create cache key for Serper Places\n   */\n  cacheKeyPlaces(query: string, location: string): string {\n    return this.generateCacheKey(['serper', 'places', query, location])\n  }\n\n  /**\n   * Helper: Create cache key for Serper Videos\n   */\n  cacheKeyVideos(query: string): string {\n    return this.generateCacheKey(['serper', 'videos', query])\n  }\n\n  /**\n   * Helper: Create cache key for Serper Images\n   */\n  cacheKeyImages(query: string): string {\n    return this.generateCacheKey(['serper', 'images', query])\n  }\n\n  /**\n   * Helper: Create cache key for Serper Shopping\n   */\n  cacheKeyShopping(product: string): string {\n    return this.generateCacheKey(['serper', 'shopping', product])\n  }\n\n  /**\n   * Helper: Create cache key for Website Analysis\n   */\n  cacheKeyWebsiteAnalysis(url: string): string {\n    return this.generateCacheKey(['website_analysis', url])\n  }\n\n  /**\n   * Helper: Create cache key for Competitor Profile\n   */\n  cacheKeyCompetitorProfile(domain: string): string {\n    return this.generateCacheKey(['competitor_profile', domain])\n  }\n\n  /**\n   * Helper: Create cache key for OutScraper Reviews\n   */\n  cacheKeyReviews(placeId: string): string {\n    return this.generateCacheKey(['outscraper', 'reviews', placeId])\n  }\n\n  /**\n   * Helper: Create cache key for Weather\n   */\n  cacheKeyWeather(location: string): string {\n    return this.generateCacheKey(['weather', location])\n  }\n\n  /**\n   * Helper: Create cache key for YouTube\n   */\n  cacheKeyYouTube(query: string): string {\n    return this.generateCacheKey(['youtube', query])\n  }\n}\n\nexport const intelligenceCache = new IntelligenceCacheService()\nexport { IntelligenceCacheService, TTL_CONFIG }\nexport type { CacheEntry, CacheOptions }\n","/**\n * DeepContext Builder Service\n *\n * The missing orchestration layer that aggregates data from all intelligence APIs\n * and builds the comprehensive DeepContext required for breakthrough content generation.\n *\n * This service:\n * 1. Fetches brand data from Supabase\n * 2. Calls YouTube API for trending topics and psychological triggers\n * 3. Calls OutScraper for Google Reviews and customer sentiment\n * 4. Calls News API (via Serper) for current events and industry trends\n * 5. Calls Weather API for timing-based opportunities\n * 6. Calls Serper for search trends (7 endpoints: News, Trends, Autocomplete, Places, Images, Videos, Shopping)\n * 7. Calls SEMrush for SEO data, keywords, and rankings\n * 8. Calls Website Analyzer (Claude AI) for authentic brand messaging extraction\n * 9. Uses intelligent caching to reduce API costs\n * 10. Implements graceful degradation when APIs fail\n * 11. Returns fully populated DeepContext for ConnectionDiscoveryEngine\n *\n * Created: 2025-11-13\n */\n\nimport { supabase } from '@/lib/supabase';\nimport { YouTubeAPI } from './youtube-api';\nimport { OutScraperAPI } from './outscraper-api';\nimport { NewsAPI } from './news-api';\nimport { WeatherAPI } from './weather-api';\nimport { SerperAPI } from './serper-api';\nimport { SemrushAPI } from './semrush-api';\nimport { websiteAnalyzer } from './website-analyzer.service';\nimport { redditAPI } from './reddit-api';\nimport { perplexityAPI } from '@/services/uvp-wizard/perplexity-api';\nimport { intelligenceCache } from './intelligence-cache.service';\nimport type { DeepContext } from '@/types/synapse/deepContext.types';\nimport type {\n  DataPoint,\n  DataSource,\n  DataPointType\n} from '@/types/connections.types';\n\n/**\n * DeepContext Builder Configuration\n */\nexport interface DeepContextBuilderConfig {\n  brandId: string;\n  brandData?: any; // Optional: Provide brand data directly for demo mode (skip database lookup)\n  includeYouTube?: boolean;\n  includeOutScraper?: boolean;\n  includeNews?: boolean;\n  includeWeather?: boolean;\n  includeSerper?: boolean;\n  includeSemrush?: boolean;\n  includeWebsiteAnalysis?: boolean;\n  includeReddit?: boolean; // Reddit psychological triggers and customer insights\n  includePerplexity?: boolean; // Perplexity local events and real-time insights\n  includeLinkedIn?: boolean; // LinkedIn B2B intelligence (posts, companies, jobs)\n  cacheResults?: boolean;\n  forceFresh?: boolean; // Skip cache and force fresh API calls\n}\n\n/**\n * DeepContext Build Result\n */\nexport interface DeepContextBuildResult {\n  context: DeepContext;\n  metadata: {\n    buildTimeMs: number;\n    dataSourcesUsed: string[];\n    dataPointsCollected: number;\n    errors: Array<{\n      source: string;\n      error: string;\n      severity: 'warning' | 'error';\n    }>;\n  };\n}\n\n/**\n * DeepContext Builder Service\n */\nclass DeepContextBuilderService {\n\n  /**\n   * Build complete DeepContext for a brand\n   */\n  async buildDeepContext(\n    config: DeepContextBuilderConfig\n  ): Promise<DeepContextBuildResult> {\n    const startTime = Date.now();\n    const errors: Array<{ source: string; error: string; severity: 'warning' | 'error' }> = [];\n    const dataSourcesUsed: string[] = [];\n\n    console.log('[DeepContext] Building context for brand:', config.brandId);\n\n    // Check cache first (unless forceFresh is true)\n    if (config.cacheResults !== false && !config.forceFresh) {\n      const cacheKey = `deepcontext:${config.brandId}`;\n      const cached = await intelligenceCache.get<DeepContext>(cacheKey);\n\n      if (cached) {\n        console.log('[DeepContext] ✅ Returning cached context');\n        return {\n          context: cached,\n          metadata: {\n            buildTimeMs: Date.now() - startTime,\n            dataSourcesUsed: ['cache'],\n            dataPointsCollected: 0,\n            errors: []\n          }\n        };\n      }\n    }\n\n    try {\n      // 1. Load brand data (from config or Supabase)\n      console.log('[DeepContext] Step 1/6: Loading brand data...');\n      const brandData = config.brandData || await this.loadBrandData(config.brandId);\n\n      if (!brandData) {\n        throw new Error(`Brand not found: ${config.brandId}`);\n      }\n\n      console.log('[DeepContext] Brand data loaded:', {\n        name: brandData.name,\n        industry: brandData.industry,\n        location: brandData.location\n      });\n\n      // 2. Gather intelligence from all sources (parallel execution)\n      console.log('[DeepContext] Step 2/10: Gathering intelligence from APIs...');\n      const [\n        youtubeData,\n        outscraperData,\n        newsData,\n        weatherData,\n        serperData,\n        semrushData,\n        websiteData,\n        redditData,\n        perplexityData,\n        linkedinData\n      ] = await Promise.allSettled([\n        config.includeYouTube !== false\n          ? this.fetchYouTubeIntelligence(brandData, errors, dataSourcesUsed)\n          : Promise.resolve(null),\n        config.includeOutScraper !== false\n          ? this.fetchOutScraperIntelligence(brandData, errors, dataSourcesUsed)\n          : Promise.resolve(null),\n        config.includeNews !== false\n          ? this.fetchNewsIntelligence(brandData, errors, dataSourcesUsed)\n          : Promise.resolve(null),\n        config.includeWeather !== false\n          ? this.fetchWeatherIntelligence(brandData, errors, dataSourcesUsed)\n          : Promise.resolve(null),\n        config.includeSerper !== false\n          ? this.fetchSerperIntelligence(brandData, errors, dataSourcesUsed)\n          : Promise.resolve(null),\n        config.includeSemrush !== false\n          ? this.fetchSemrushIntelligence(brandData, errors, dataSourcesUsed)\n          : Promise.resolve(null),\n        config.includeWebsiteAnalysis !== false && brandData.website\n          ? this.fetchWebsiteIntelligence(brandData, errors, dataSourcesUsed)\n          : Promise.resolve(null),\n        config.includeReddit !== false\n          ? this.fetchRedditIntelligence(brandData, errors, dataSourcesUsed)\n          : Promise.resolve(null),\n        config.includePerplexity !== false\n          ? this.fetchPerplexityIntelligence(brandData, errors, dataSourcesUsed)\n          : Promise.resolve(null),\n        config.includeLinkedIn !== false\n          ? this.fetchLinkedInIntelligence(brandData, errors, dataSourcesUsed)\n          : Promise.resolve(null)\n      ]);\n\n      // 3. Extract data points from all sources\n      console.log('[DeepContext] Step 3/7: Extracting data points...');\n      const dataPoints: DataPoint[] = [];\n\n      // Add YouTube data points\n      if (youtubeData.status === 'fulfilled' && youtubeData.value) {\n        dataPoints.push(...youtubeData.value);\n      }\n\n      // Add OutScraper data points\n      if (outscraperData.status === 'fulfilled' && outscraperData.value) {\n        dataPoints.push(...outscraperData.value);\n      }\n\n      // Add News data points\n      if (newsData.status === 'fulfilled' && newsData.value) {\n        dataPoints.push(...newsData.value);\n      }\n\n      // Add Weather data points\n      if (weatherData.status === 'fulfilled' && weatherData.value) {\n        dataPoints.push(...weatherData.value);\n      }\n\n      // Add Serper data points\n      if (serperData.status === 'fulfilled' && serperData.value) {\n        dataPoints.push(...serperData.value);\n      }\n\n      // Add SEMrush data points\n      if (semrushData.status === 'fulfilled' && semrushData.value) {\n        dataPoints.push(...semrushData.value);\n      }\n\n      // Add Website Analysis data points\n      if (websiteData.status === 'fulfilled' && websiteData.value) {\n        dataPoints.push(...websiteData.value);\n      }\n\n      // Add Reddit data points\n      if (redditData.status === 'fulfilled' && redditData.value) {\n        dataPoints.push(...redditData.value);\n      }\n\n      // Add Perplexity data points\n      if (perplexityData.status === 'fulfilled' && perplexityData.value) {\n        dataPoints.push(...perplexityData.value);\n      }\n\n      // Add LinkedIn data points\n      if (linkedinData.status === 'fulfilled' && linkedinData.value) {\n        dataPoints.push(...linkedinData.value);\n      }\n\n      console.log(`[DeepContext] Collected ${dataPoints.length} data points from ${dataSourcesUsed.length} sources`);\n\n      // 4. Build DeepContext structure\n      console.log('[DeepContext] Step 4/7: Building context structure...');\n      const deepContext = await this.buildContextStructure(brandData, dataPoints);\n\n      // 5. Synthesize insights using AI (if we have enough data)\n      console.log('[DeepContext] Step 5/7: Synthesizing insights...');\n      if (dataPoints.length > 0) {\n        await this.synthesizeInsights(deepContext, dataPoints);\n      }\n\n      // 6. Cache the result\n      console.log('[DeepContext] Step 6/7: Caching result...');\n      if (config.cacheResults !== false) {\n        const cacheKey = `deepcontext:${config.brandId}`;\n        await intelligenceCache.set(cacheKey, deepContext, {\n          dataType: 'deepcontext',\n          sourceApi: 'aggregated',\n          brandId: config.brandId,\n          ttlMinutes: 60 // 1 hour for full DeepContext\n        });\n      }\n\n      const buildTimeMs = Date.now() - startTime;\n      console.log(`[DeepContext] ✅ Context built successfully in ${buildTimeMs}ms`);\n\n      return {\n        context: deepContext,\n        metadata: {\n          buildTimeMs,\n          dataSourcesUsed,\n          dataPointsCollected: dataPoints.length,\n          errors,\n          detailedDataPoints: dataPoints  // Include all raw data points for detailed provenance\n        }\n      };\n\n    } catch (error) {\n      console.error('[DeepContext] Fatal error building context:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Load brand data from Supabase\n   */\n  private async loadBrandData(brandId: string): Promise<any> {\n    const { data, error } = await supabase\n      .from('brands')\n      .select('*')\n      .eq('id', brandId)\n      .single();\n\n    if (error) {\n      throw new Error(`Failed to load brand: ${error.message}`);\n    }\n\n    return data;\n  }\n\n  /**\n   * Fetch YouTube intelligence (trending topics, psychological triggers)\n   */\n  private async fetchYouTubeIntelligence(\n    brandData: any,\n    errors: any[],\n    dataSourcesUsed: string[]\n  ): Promise<DataPoint[]> {\n    try {\n      console.log('[DeepContext/YouTube] Fetching trending videos and insights...');\n\n      const keywords = brandData.keywords || [brandData.industry];\n      const trends = await YouTubeAPI.analyzeVideoTrends(brandData.industry, keywords);\n\n      dataSourcesUsed.push('youtube');\n\n      // Convert to data points\n      const dataPoints: DataPoint[] = [];\n\n      // Trending topics\n      trends.trending_topics.forEach((topic, i) => {\n        dataPoints.push({\n          source: 'youtube' as DataSource,\n          type: 'trending_topic' as DataPointType,\n          content: topic,\n          metadata: {\n            platform: 'youtube',\n            rank: i + 1,\n            relevance: 0.8\n          },\n          timestamp: new Date().toISOString(),\n          confidence: 0.8\n        });\n      });\n\n      // Content angles (psychological triggers)\n      trends.content_angles.forEach(angle => {\n        dataPoints.push({\n          source: 'youtube' as DataSource,\n          type: 'customer_trigger' as DataPointType,\n          content: angle,\n          metadata: {\n            platform: 'youtube',\n            type: 'content_angle'\n          },\n          timestamp: new Date().toISOString(),\n          confidence: 0.7\n        });\n      });\n\n      console.log(`[DeepContext/YouTube] ✅ Extracted ${dataPoints.length} data points`);\n      return dataPoints;\n\n    } catch (error) {\n      console.error('[DeepContext/YouTube] Error:', error);\n      errors.push({\n        source: 'youtube',\n        error: error instanceof Error ? error.message : String(error),\n        severity: 'warning'\n      });\n      return [];\n    }\n  }\n\n  /**\n   * Fetch OutScraper intelligence (Google Reviews, customer sentiment)\n   */\n  private async fetchOutScraperIntelligence(\n    brandData: any,\n    errors: any[],\n    dataSourcesUsed: string[]\n  ): Promise<DataPoint[]> {\n    try {\n      console.log('[DeepContext/OutScraper] Fetching competitor reviews...');\n\n      // Format location as string for OutScraper API\n      const location = brandData.location\n        ? typeof brandData.location === 'string'\n          ? brandData.location\n          : `${brandData.location.city}, ${brandData.location.state}`\n        : brandData.city || 'United States';\n\n      const competitors = await OutScraperAPI.discoverCompetitors({\n        businessName: brandData.name,\n        location,\n        industry: brandData.industry,\n        radius: 10\n      });\n\n      dataSourcesUsed.push('outscraper');\n\n      const dataPoints: DataPoint[] = [];\n\n      // Sample reviews from top 3 competitors\n      for (let i = 0; i < Math.min(3, competitors.length); i++) {\n        const competitor = competitors[i];\n\n        try {\n          const reviews = await OutScraperAPI.scrapeGoogleReviews({\n            place_id: competitor.place_id,\n            business_name: competitor.name,  // Pass business name for Serper fallback\n            location: location,              // Pass location for Serper fallback\n            industry: brandData.industry,    // Pass industry for better search specificity\n            limit: 20,\n            sort: 'newest'\n          });\n\n          // Extract psychological triggers from reviews\n          reviews.forEach(review => {\n            if (review.text && review.text.length > 20) {\n              dataPoints.push({\n                source: 'outscraper' as DataSource,\n                type: 'customer_trigger' as DataPointType,\n                content: review.text,\n                metadata: {\n                  competitor: competitor.name,\n                  rating: review.rating,\n                  sentiment: review.rating >= 4 ? 'positive' : review.rating <= 2 ? 'negative' : 'neutral'\n                },\n                timestamp: review.time,\n                confidence: 0.85\n              });\n            }\n          });\n\n        } catch (reviewError) {\n          console.warn(`[DeepContext/OutScraper] Could not fetch reviews for ${competitor.name}`);\n        }\n      }\n\n      console.log(`[DeepContext/OutScraper] ✅ Extracted ${dataPoints.length} data points`);\n      return dataPoints;\n\n    } catch (error) {\n      console.error('[DeepContext/OutScraper] Error:', error);\n      errors.push({\n        source: 'outscraper',\n        error: error instanceof Error ? error.message : String(error),\n        severity: 'warning'\n      });\n      return [];\n    }\n  }\n\n  /**\n   * Fetch News intelligence (industry news, trending stories)\n   */\n  private async fetchNewsIntelligence(\n    brandData: any,\n    errors: any[],\n    dataSourcesUsed: string[]\n  ): Promise<DataPoint[]> {\n    try {\n      console.log('[DeepContext/News] Fetching industry news...');\n\n      const keywords = brandData.keywords || [brandData.industry];\n      const articles = await NewsAPI.getIndustryNews(brandData.industry, keywords);\n\n      dataSourcesUsed.push('news');\n\n      const dataPoints: DataPoint[] = articles.slice(0, 10).map(article => ({\n        source: 'news' as DataSource,\n        type: 'trending_topic' as DataPointType,\n        content: `${article.title}: ${article.description}`,\n        metadata: {\n          url: article.url,\n          source: article.source,\n          publishedAt: article.publishedAt,\n          relevanceScore: article.relevanceScore\n        },\n        timestamp: article.publishedAt,\n        confidence: article.relevanceScore / 100\n      }));\n\n      console.log(`[DeepContext/News] ✅ Extracted ${dataPoints.length} data points`);\n      return dataPoints;\n\n    } catch (error) {\n      console.error('[DeepContext/News] Error:', error);\n      errors.push({\n        source: 'news',\n        error: error instanceof Error ? error.message : String(error),\n        severity: 'warning'\n      });\n      return [];\n    }\n  }\n\n  /**\n   * Fetch Weather intelligence (timing-based opportunities)\n   */\n  private async fetchWeatherIntelligence(\n    brandData: any,\n    errors: any[],\n    dataSourcesUsed: string[]\n  ): Promise<DataPoint[]> {\n    try {\n      console.log('[DeepContext/Weather] Fetching weather opportunities...');\n\n      // Format location as string for weather API (just city name)\n      const location = brandData.location\n        ? typeof brandData.location === 'string'\n          ? brandData.location.split(',')[0].trim() // Extract just city name\n          : brandData.location.city\n        : brandData.city || 'New York';\n\n      const opportunities = await WeatherAPI.detectWeatherOpportunities(\n        location,\n        brandData.industry\n      );\n\n      dataSourcesUsed.push('weather');\n\n      const dataPoints: DataPoint[] = opportunities.map(opp => ({\n        source: 'weather' as DataSource,\n        type: 'timing' as DataPointType,\n        content: `${opp.title}: ${opp.description}`,\n        metadata: {\n          urgency: opp.urgency,\n          impactScore: opp.impact_score,\n          suggestedActions: opp.suggested_actions,\n          type: opp.type\n        },\n        timestamp: new Date().toISOString(),\n        confidence: opp.impact_score / 100\n      }));\n\n      console.log(`[DeepContext/Weather] ✅ Extracted ${dataPoints.length} data points`);\n      return dataPoints;\n\n    } catch (error) {\n      console.error('[DeepContext/Weather] Error:', error);\n      errors.push({\n        source: 'weather',\n        error: error instanceof Error ? error.message : String(error),\n        severity: 'warning'\n      });\n      return [];\n    }\n  }\n\n  /**\n   * Fetch Serper intelligence (7 data sources via one API)\n   * Includes: News, Trends, Autocomplete, Places, Images, Videos, Shopping\n   */\n  private async fetchSerperIntelligence(\n    brandData: any,\n    errors: any[],\n    dataSourcesUsed: string[]\n  ): Promise<DataPoint[]> {\n    try {\n      console.log('[DeepContext/Serper] ⚡ Fetching from 8 Serper endpoints in parallel...');\n\n      const dataPoints: DataPoint[] = [];\n      const keywords = brandData.keywords || [brandData.industry];\n      const location = brandData.location\n        ? typeof brandData.location === 'string'\n          ? brandData.location\n          : `${brandData.location.city}, ${brandData.location.state}`\n        : '';\n\n      // PARALLELIZE all Serper API calls for maximum performance\n      const [\n        newsResult,\n        trendsResult,\n        autocompleteResult,\n        placesResult,\n        videosResult,\n        imagesResult\n      ] = await Promise.allSettled([\n        // 1. News\n        (async () => {\n          const topic = `${brandData.industry} trends`;\n          const cacheKey = intelligenceCache.cacheKeyNews(topic, location);\n          let newsResults = await intelligenceCache.get(cacheKey);\n\n          if (!newsResults) {\n            newsResults = await SerperAPI.getNews(topic, location || undefined);\n            await intelligenceCache.set(cacheKey, newsResults, {\n              dataType: 'news',\n              sourceApi: 'serper',\n              brandId: brandData.id\n            });\n          }\n\n          return newsResults.slice(0, 5).map((article: any) => ({\n            source: 'serper' as DataSource,\n            type: 'trending_topic' as DataPointType,\n            content: `${article.title}: ${article.snippet}`,\n            metadata: {\n              url: article.link,\n              source: article.source,\n              publishedAt: article.date\n            },\n            timestamp: article.date,\n            confidence: 0.85\n          }));\n        })(),\n\n        // 2. Trends\n        (async () => {\n          const keyword = keywords[0];\n          const cacheKey = intelligenceCache.cacheKeyTrends(keyword);\n          let trendData = await intelligenceCache.get(cacheKey);\n\n          if (!trendData) {\n            trendData = await SerperAPI.getTrends(keyword);\n            await intelligenceCache.set(cacheKey, trendData, {\n              dataType: 'trend_data',\n              sourceApi: 'serper',\n              brandId: brandData.id\n            });\n          }\n\n          if (!trendData) return [];\n\n          return [{\n            source: 'serper' as DataSource,\n            type: 'trending_topic' as DataPointType,\n            content: `Trend: \"${keyword}\" is ${trendData.trend} (${trendData.growthPercentage}% growth)`,\n            metadata: {\n              keyword,\n              trend: trendData.trend,\n              growth: trendData.growthPercentage,\n              relatedQueries: trendData.relatedQueries\n            },\n            timestamp: new Date().toISOString(),\n            confidence: 0.8\n          }];\n        })(),\n\n        // 3. Autocomplete\n        (async () => {\n          const query = `${brandData.industry} how to`;\n          const cacheKey = `serper:autocomplete:${query}`;\n          let suggestions = await intelligenceCache.get(cacheKey);\n\n          if (!suggestions) {\n            suggestions = await SerperAPI.getAutocomplete(query);\n            await intelligenceCache.set(cacheKey, suggestions, {\n              dataType: 'autocomplete',\n              sourceApi: 'serper',\n              brandId: brandData.id\n            });\n          }\n\n          return suggestions.slice(0, 3).map((suggestion: string) => ({\n            source: 'serper' as DataSource,\n            type: 'customer_trigger' as DataPointType,\n            content: suggestion,\n            metadata: {\n              type: 'search_intent',\n              query\n            },\n            timestamp: new Date().toISOString(),\n            confidence: 0.75\n          }));\n        })(),\n\n        // 4. Places\n        location ? (async () => {\n          const cacheKey = intelligenceCache.cacheKeyPlaces(brandData.industry, location);\n          let places = await intelligenceCache.get(cacheKey);\n\n          if (!places) {\n            places = await SerperAPI.getPlaces(brandData.industry, location);\n            await intelligenceCache.set(cacheKey, places, {\n              dataType: 'local_reviews',\n              sourceApi: 'serper',\n              brandId: brandData.id\n            });\n          }\n\n          return places.slice(0, 3).map((place: any) => ({\n            source: 'serper' as DataSource,\n            type: 'competitive_gap' as DataPointType,\n            content: `Local competitor: ${place.name} (${place.rating}★, ${place.reviewCount} reviews)`,\n            metadata: {\n              competitor: place.name,\n              rating: place.rating,\n              reviewCount: place.reviewCount,\n              category: place.category\n            },\n            timestamp: new Date().toISOString(),\n            confidence: 0.8\n          }));\n        })() : Promise.resolve([]),\n\n        // 5. Videos\n        (async () => {\n          const query = `${brandData.industry} tips`;\n          const cacheKey = intelligenceCache.cacheKeyVideos(query);\n          let videos = await intelligenceCache.get(cacheKey);\n\n          if (!videos) {\n            videos = await SerperAPI.getVideos(query);\n            await intelligenceCache.set(cacheKey, videos, {\n              dataType: 'youtube_videos',\n              sourceApi: 'serper',\n              brandId: brandData.id\n            });\n          }\n\n          return videos.slice(0, 3).map((video: any) => ({\n            source: 'serper' as DataSource,\n            type: 'trending_topic' as DataPointType,\n            content: video.title,\n            metadata: {\n              url: video.link,\n              channel: video.channel,\n              duration: video.duration\n            },\n            timestamp: video.date,\n            confidence: 0.7\n          }));\n        })(),\n\n        // 6. Images\n        (async () => {\n          const query = `${brandData.industry} inspiration`;\n          const cacheKey = `serper:images:${query}`;\n          let images = await intelligenceCache.get(cacheKey);\n\n          if (!images) {\n            images = await SerperAPI.getImages(query);\n            await intelligenceCache.set(cacheKey, images, {\n              dataType: 'images',\n              sourceApi: 'serper',\n              brandId: brandData.id\n          });\n          }\n\n          return images.slice(0, 3).map((image: any) => ({\n            source: 'serper' as DataSource,\n            type: 'trending_topic' as DataPointType,\n            content: `Visual trend: ${image.title}`,\n            metadata: {\n              url: image.url,\n              imageUrl: image.imageUrl,\n              source: image.source\n            },\n            timestamp: new Date().toISOString(),\n            confidence: 0.7\n          }));\n        })()\n      ]);\n\n      // Collect all results\n      if (newsResult.status === 'fulfilled' && newsResult.value) {\n        dataPoints.push(...newsResult.value);\n      }\n      if (trendsResult.status === 'fulfilled' && trendsResult.value) {\n        dataPoints.push(...trendsResult.value);\n      }\n      if (autocompleteResult.status === 'fulfilled' && autocompleteResult.value) {\n        dataPoints.push(...autocompleteResult.value);\n      }\n      if (placesResult.status === 'fulfilled' && placesResult.value) {\n        dataPoints.push(...placesResult.value);\n      }\n      if (videosResult.status === 'fulfilled' && videosResult.value) {\n        dataPoints.push(...videosResult.value);\n      }\n      if (imagesResult.status === 'fulfilled' && imagesResult.value) {\n        dataPoints.push(...imagesResult.value);\n      }\n\n      dataSourcesUsed.push('serper');\n\n      console.log(`[DeepContext/Serper] ✅ Extracted ${dataPoints.length} data points from 6 parallel endpoints`);\n      return dataPoints;\n\n    } catch (error) {\n      console.error('[DeepContext/Serper] Error:', error);\n      errors.push({\n        source: 'serper',\n        error: error instanceof Error ? error.message : String(error),\n        severity: 'warning'\n      });\n      return [];\n    }\n  }\n\n  /**\n   * Fetch SEMrush SEO and keyword intelligence\n   */\n  private async fetchSemrushIntelligence(\n    brandData: any,\n    errors: any[],\n    dataSourcesUsed: string[]\n  ): Promise<DataPoint[]> {\n    try {\n      console.log('[DeepContext/SEMrush] Fetching SEO and keyword data...');\n\n      const dataPoints: DataPoint[] = [];\n      const domain = brandData.website || brandData.url;\n\n      if (!domain) {\n        console.warn('[DeepContext/SEMrush] No domain provided, skipping');\n        return [];\n      }\n\n      // Get keyword opportunities\n      try {\n        const opportunities = await SemrushAPI.getKeywordOpportunities(domain, brandData.name);\n\n        opportunities.slice(0, 10).forEach(opp => {\n          dataPoints.push({\n            source: 'serper' as DataSource, // Using serper as closest match\n            type: 'competitive_gap' as DataPointType,\n            content: `Keyword opportunity: \"${opp.keyword}\" (${opp.searchVolume} searches/mo) - ${opp.reasoning}`,\n            metadata: {\n              keyword: opp.keyword,\n              searchVolume: opp.searchVolume,\n              difficulty: opp.difficulty,\n              opportunityType: opp.opportunity,\n              estimatedTraffic: opp.estimatedTraffic\n            },\n            timestamp: new Date().toISOString(),\n            confidence: 0.8\n          });\n        });\n      } catch (keywordError) {\n        console.warn('[DeepContext/SEMrush] Keyword opportunities failed');\n      }\n\n      dataSourcesUsed.push('semrush');\n\n      console.log(`[DeepContext/SEMrush] ✅ Extracted ${dataPoints.length} data points`);\n      return dataPoints;\n\n    } catch (error) {\n      console.error('[DeepContext/SEMrush] Error:', error);\n      errors.push({\n        source: 'semrush',\n        error: error instanceof Error ? error.message : String(error),\n        severity: 'warning'\n      });\n      return [];\n    }\n  }\n\n  /**\n   * Fetch Website Analysis intelligence (Claude AI extraction)\n   */\n  private async fetchWebsiteIntelligence(\n    brandData: any,\n    errors: any[],\n    dataSourcesUsed: string[]\n  ): Promise<DataPoint[]> {\n    try {\n      console.log('[DeepContext/Website] Analyzing website with Claude AI...');\n\n      const websiteUrl = brandData.website || brandData.url;\n\n      if (!websiteUrl) {\n        console.warn('[DeepContext/Website] No website URL provided');\n        return [];\n      }\n\n      const dataPoints: DataPoint[] = [];\n\n      // Check cache first\n      const cacheKey = intelligenceCache.cacheKeyWebsiteAnalysis(websiteUrl);\n      let analysis = await intelligenceCache.get(cacheKey);\n\n      if (!analysis) {\n        // Fetch fresh analysis\n        analysis = await websiteAnalyzer.analyzeWebsite(websiteUrl);\n\n        // Cache for 7 days (website messaging rarely changes)\n        await intelligenceCache.set(cacheKey, analysis, {\n          dataType: 'website_analysis',\n          sourceApi: 'claude',\n          brandId: brandData.id\n        });\n      }\n\n      // Convert analysis to data points\n      if (analysis.valuePropositions && analysis.valuePropositions.length > 0) {\n        analysis.valuePropositions.forEach((vp: string) => {\n          dataPoints.push({\n            source: 'website' as DataSource,\n            type: 'value_proposition' as DataPointType,\n            content: vp,\n            metadata: {\n              extracted_from: websiteUrl,\n              confidence: analysis.confidence\n            },\n            timestamp: new Date().toISOString(),\n            confidence: analysis.confidence / 100\n          });\n        });\n      }\n\n      if (analysis.targetAudience && analysis.targetAudience.length > 0) {\n        analysis.targetAudience.forEach((audience: string) => {\n          dataPoints.push({\n            source: 'website' as DataSource,\n            type: 'customer_segment' as DataPointType,\n            content: audience,\n            metadata: {\n              extracted_from: websiteUrl,\n              confidence: analysis.confidence\n            },\n            timestamp: new Date().toISOString(),\n            confidence: analysis.confidence / 100\n          });\n        });\n      }\n\n      if (analysis.customerProblems && analysis.customerProblems.length > 0) {\n        analysis.customerProblems.forEach((problem: string) => {\n          dataPoints.push({\n            source: 'website' as DataSource,\n            type: 'customer_trigger' as DataPointType,\n            content: `Problem: ${problem}`,\n            metadata: {\n              type: 'pain_point',\n              extracted_from: websiteUrl\n            },\n            timestamp: new Date().toISOString(),\n            confidence: analysis.confidence / 100\n          });\n        });\n      }\n\n      if (analysis.differentiators && analysis.differentiators.length > 0) {\n        analysis.differentiators.forEach((diff: string) => {\n          dataPoints.push({\n            source: 'website' as DataSource,\n            type: 'competitive_gap' as DataPointType,\n            content: `Differentiator: ${diff}`,\n            metadata: {\n              type: 'unique_advantage',\n              extracted_from: websiteUrl\n            },\n            timestamp: new Date().toISOString(),\n            confidence: analysis.confidence / 100\n          });\n        });\n      }\n\n      dataSourcesUsed.push('website');\n\n      console.log(`[DeepContext/Website] ✅ Extracted ${dataPoints.length} data points (confidence: ${analysis.confidence}%)`);\n      return dataPoints;\n\n    } catch (error) {\n      console.error('[DeepContext/Website] Error:', error);\n      errors.push({\n        source: 'website',\n        error: error instanceof Error ? error.message : String(error),\n        severity: 'warning'\n      });\n      return [];\n    }\n  }\n\n  /**\n   * Fetch Reddit intelligence (psychological triggers, customer insights)\n   */\n  private async fetchRedditIntelligence(\n    brandData: any,\n    errors: any[],\n    dataSourcesUsed: string[]\n  ): Promise<DataPoint[]> {\n    try {\n      console.log('[DeepContext/Reddit] Mining Reddit for psychological triggers...');\n\n      const dataPoints: DataPoint[] = [];\n\n      // Find relevant subreddits for this industry\n      const subreddits = await redditAPI.findRelevantSubreddits(brandData.industry);\n      console.log(`[DeepContext/Reddit] Targeting ${subreddits.length} subreddits:`, subreddits);\n\n      // Mine intelligence from Reddit\n      const searchQuery = `${brandData.industry} problems`;\n      const intelligence = await redditAPI.mineIntelligence(searchQuery, {\n        subreddits,\n        limit: 25,\n        commentsPerPost: 20,\n        sortBy: 'relevance',\n        timeFilter: 'month'\n      });\n\n      dataSourcesUsed.push('reddit');\n\n      // Convert psychological triggers to data points\n      intelligence.triggers.forEach(trigger => {\n        dataPoints.push({\n          source: 'reddit' as DataSource,\n          type: 'customer_trigger' as DataPointType,\n          content: trigger.text,\n          metadata: {\n            triggerType: trigger.type,\n            intensity: trigger.intensity,\n            subreddit: trigger.subreddit,\n            upvotes: trigger.upvotes,\n            url: trigger.url\n          },\n          timestamp: new Date().toISOString(),\n          confidence: trigger.intensity / 10 // Convert 1-10 to 0-1\n        });\n      });\n\n      // Convert customer insights (pain points & desires) to data points\n      intelligence.insights.forEach(insight => {\n        if (insight.painPoint) {\n          dataPoints.push({\n            source: 'reddit' as DataSource,\n            type: 'customer_trigger' as DataPointType,\n            content: `Pain Point: ${insight.painPoint}`,\n            metadata: {\n              insightType: 'pain_point',\n              subreddit: insight.subreddit,\n              upvotes: insight.upvotes,\n              url: insight.url,\n              context: insight.context\n            },\n            timestamp: new Date().toISOString(),\n            confidence: Math.min(0.9, insight.upvotes / 100)\n          });\n        }\n\n        if (insight.desire) {\n          dataPoints.push({\n            source: 'reddit' as DataSource,\n            type: 'customer_trigger' as DataPointType,\n            content: `Customer Desire: ${insight.desire}`,\n            metadata: {\n              insightType: 'desire',\n              subreddit: insight.subreddit,\n              upvotes: insight.upvotes,\n              url: insight.url,\n              context: insight.context\n            },\n            timestamp: new Date().toISOString(),\n            confidence: Math.min(0.9, insight.upvotes / 100)\n          });\n        }\n      });\n\n      console.log(`[DeepContext/Reddit] ✅ Extracted ${dataPoints.length} data points from ${intelligence.metadata.totalPosts} posts`);\n      return dataPoints;\n\n    } catch (error) {\n      console.error('[DeepContext/Reddit] Error:', error);\n      errors.push({\n        source: 'reddit',\n        error: error instanceof Error ? error.message : String(error),\n        severity: 'warning'\n      });\n      return [];\n    }\n  }\n\n  /**\n   * 9. Fetch Perplexity Intelligence - Local Events & Real-Time Insights\n   */\n  private async fetchPerplexityIntelligence(\n    brandData: any,\n    errors: Array<{ source: string; error: string; severity: 'warning' | 'error' }>,\n    dataSourcesUsed: string[]\n  ): Promise<DataPoint[]> {\n    try {\n      console.log('[DeepContext/Perplexity] Fetching local events and real-time insights...');\n\n      // Check if Perplexity API is available\n      const isAvailable = await perplexityAPI.isAvailable();\n      if (!isAvailable) {\n        console.warn('[DeepContext/Perplexity] Perplexity API not available (missing API key)');\n        return [];\n      }\n\n      // Format location from brandData\n      const location = brandData.location\n        ? typeof brandData.location === 'string'\n          ? brandData.location\n          : `${brandData.location.city}, ${brandData.location.state}`\n        : brandData.city || 'United States';\n\n      // Get current month for seasonal context\n      const now = new Date();\n      const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',\n        'July', 'August', 'September', 'October', 'November', 'December'];\n      const currentMonth = monthNames[now.getMonth()];\n\n      // Query Perplexity for local events\n      const response = await perplexityAPI.getIndustryInsights({\n        query: `What local events, festivals, holidays, and community gatherings are happening in ${location} in ${currentMonth} ${now.getFullYear()} that would be relevant marketing opportunities for ${brandData.industry} businesses? Include specific dates if available.`,\n        context: {\n          industry: brandData.industry,\n          brand_name: brandData.name\n        },\n        max_results: 5\n      });\n\n      dataSourcesUsed.push('perplexity');\n\n      const dataPoints: DataPoint[] = [];\n\n      // Convert insights to data points\n      response.insights.forEach((insight, index) => {\n        dataPoints.push({\n          source: 'perplexity' as DataSource,\n          type: 'local_event' as DataPointType,\n          content: insight,\n          metadata: {\n            location,\n            month: currentMonth,\n            year: now.getFullYear(),\n            confidence: response.confidence\n          },\n          timestamp: new Date().toISOString(),\n          confidence: response.confidence\n        });\n      });\n\n      console.log(`[DeepContext/Perplexity] ✅ Extracted ${dataPoints.length} local event data points`);\n      return dataPoints;\n\n    } catch (error) {\n      console.error('[DeepContext/Perplexity] Error:', error);\n      errors.push({\n        source: 'perplexity',\n        error: error instanceof Error ? error.message : String(error),\n        severity: 'warning'\n      });\n      return [];\n    }\n  }\n\n  /**\n   * 10. Fetch LinkedIn Intelligence - B2B Insights, Trends, and Professional Content\n   */\n  private async fetchLinkedInIntelligence(\n    brandData: any,\n    errors: Array<{ source: string; error: string; severity: 'warning' | 'error' }>,\n    dataSourcesUsed: string[]\n  ): Promise<DataPoint[]> {\n    try {\n      console.log('[DeepContext/LinkedIn] Fetching B2B intelligence via OutScraper...');\n\n      const dataPoints: DataPoint[] = [];\n      const industry = brandData.industry;\n      const keywords = brandData.keywords || [industry];\n\n      // Parallelize LinkedIn API calls for maximum performance\n      const [postsResult, companiesResult] = await Promise.allSettled([\n        // 1. LinkedIn Posts (trending B2B topics and thought leadership)\n        (async () => {\n          try {\n            const cacheKey = `linkedin:posts:${industry}`;\n            let posts = await intelligenceCache.get(cacheKey);\n\n            if (!posts) {\n              // Search for industry-relevant posts\n              const query = `${industry} trends insights tips`;\n              posts = await OutScraperAPI.getLinkedInPosts(query, 10);\n\n              await intelligenceCache.set(cacheKey, posts, {\n                dataType: 'linkedin_posts',\n                sourceApi: 'outscraper',\n                brandId: brandData.id,\n                ttlMinutes: 120 // 2 hours\n              });\n            }\n\n            return posts.slice(0, 5).map((post: any) => ({\n              source: 'linkedin' as DataSource,\n              type: 'trending_topic' as DataPointType,\n              content: `LinkedIn post by ${post.author}: ${post.content}`,\n              metadata: {\n                author: post.author,\n                authorProfile: post.authorProfile,\n                link: post.postUrl,\n                date: post.publishedAt,\n                engagement: post.engagement\n              },\n              timestamp: post.publishedAt || new Date().toISOString(),\n              confidence: 0.80\n            }));\n          } catch (err) {\n            console.warn('[DeepContext/LinkedIn] Posts fetch failed:', err);\n            return [];\n          }\n        })(),\n\n        // 2. LinkedIn Companies (competitor intelligence)\n        (async () => {\n          try {\n            const cacheKey = `linkedin:companies:${industry}`;\n            let companies = await intelligenceCache.get(cacheKey);\n\n            if (!companies) {\n              // Search for industry competitors and leaders\n              const query = `${industry} companies`;\n              companies = await OutScraperAPI.getLinkedInCompanies(query, 10);\n\n              await intelligenceCache.set(cacheKey, companies, {\n                dataType: 'linkedin_companies',\n                sourceApi: 'outscraper',\n                brandId: brandData.id,\n                ttlMinutes: 240 // 4 hours\n              });\n            }\n\n            return companies.slice(0, 3).map((company: any) => ({\n              source: 'linkedin' as DataSource,\n              type: 'competitive_gap' as DataPointType,\n              content: `Competitor: ${company.name} - ${company.description}`,\n              metadata: {\n                company: company.name,\n                link: company.profileUrl,\n                industry: company.industry,\n                size: company.companySize,\n                location: company.location,\n                followers: company.followers\n              },\n              timestamp: new Date().toISOString(),\n              confidence: 0.75\n            }));\n          } catch (err) {\n            console.warn('[DeepContext/LinkedIn] Companies fetch failed:', err);\n            return [];\n          }\n        })()\n      ]);\n\n      // Collect all results\n      if (postsResult.status === 'fulfilled' && postsResult.value) {\n        dataPoints.push(...postsResult.value);\n      }\n      if (companiesResult.status === 'fulfilled' && companiesResult.value) {\n        dataPoints.push(...companiesResult.value);\n      }\n\n      dataSourcesUsed.push('linkedin');\n\n      console.log(`[DeepContext/LinkedIn] ✅ Extracted ${dataPoints.length} B2B intelligence data points`);\n      return dataPoints;\n\n    } catch (error) {\n      console.error('[DeepContext/LinkedIn] Error:', error);\n      errors.push({\n        source: 'linkedin',\n        error: error instanceof Error ? error.message : String(error),\n        severity: 'warning'\n      });\n      return [];\n    }\n  }\n\n  /**\n   * Build DeepContext structure from brand data and data points\n   */\n  private async buildContextStructure(\n    brandData: any,\n    dataPoints: DataPoint[]\n  ): Promise<DeepContext> {\n    // Extract website analysis data points\n    const valuePropositions = dataPoints.filter(dp => dp.type === 'value_proposition');\n    const customerSegments = dataPoints.filter(dp => dp.type === 'customer_segment');\n    const customerTriggers = dataPoints.filter(dp => dp.type === 'customer_trigger');\n    const competitiveGaps = dataPoints.filter(dp => dp.type === 'competitive_gap');\n\n    console.log('[DeepContext] Organizing data points:');\n    console.log('  - Value Propositions:', valuePropositions.length);\n    console.log('  - Customer Segments:', customerSegments.length);\n    console.log('  - Customer Triggers:', customerTriggers.length);\n    console.log('  - Competitive Gaps:', competitiveGaps.length);\n\n    // Build basic structure - will be enhanced by AI synthesis\n    const deepContext: DeepContext = {\n      business: {\n        profile: {\n          id: brandData.id,\n          name: brandData.name,\n          industry: brandData.industry,\n          naicsCode: brandData.naics_code,\n          website: brandData.website || '',\n          location: {\n            city: brandData.city || '',\n            state: brandData.state || '',\n            country: brandData.country || 'US'\n          },\n          keywords: brandData.keywords || [brandData.industry],\n          competitors: []\n        },\n        brandVoice: {\n          tone: brandData.tone || ['professional', 'friendly'],\n          values: brandData.values || [],\n          personality: brandData.personality || [],\n          avoidWords: [],\n          signaturePhrases: []\n        },\n        // CRITICAL: Populate with actual website value propositions!\n        uniqueAdvantages: [\n          ...(brandData.unique_selling_points || []),\n          ...valuePropositions.map(dp => dp.content)\n        ],\n        goals: []\n      },\n      industry: {\n        profile: null,\n        trends: [],\n        seasonality: [],\n        competitiveLandscape: {\n          topCompetitors: [],\n          marketConcentration: 'moderate' as const,\n          barrierToEntry: 'medium' as const\n        },\n        economicFactors: []\n      },\n      realTimeCultural: {\n        trending: {\n          topics: dataPoints\n            .filter(dp => dp.type === 'trending_topic')\n            .slice(0, 10)\n            .map(dp => dp.content),\n          hashtags: [],\n          conversations: []\n        },\n        sentiment: {\n          overall: 0.7,\n          byTopic: {},\n          shifts: []\n        },\n        // CRITICAL: Populate with Perplexity local events!\n        events: dataPoints\n          .filter(dp => dp.type === 'local_event')\n          .map(dp => dp.content),\n        viralContent: []\n      },\n      competitiveIntel: {\n        blindSpots: [],\n        mistakes: [],\n        // CRITICAL: Populate with website differentiators!\n        opportunities: competitiveGaps.map(dp => dp.content),\n        contentGaps: [],\n        positioningWeaknesses: []\n      },\n      customerPsychology: {\n        // CRITICAL: Populate with customer segments!\n        unarticulated: customerSegments.map(dp => dp.content),\n        emotional: [],\n        // CRITICAL: Populate with customer triggers (pain points)!\n        behavioral: customerTriggers.map(dp => dp.content),\n        identityDesires: [],\n        purchaseMotivations: [],\n        objections: []\n      },\n      synthesis: {\n        keyInsights: [],\n        hiddenPatterns: [],\n        opportunityScore: 75,\n        recommendedAngles: [],\n        confidenceLevel: 0.7,\n        generatedAt: new Date()\n      },\n      metadata: {\n        aggregatedAt: new Date(),\n        dataSourcesUsed: Array.from(new Set(dataPoints.map(dp => dp.source))),\n        processingTimeMs: 0,\n        version: '1.0.0'\n      }\n    };\n\n    return deepContext;\n  }\n\n  /**\n   * Synthesize insights using AI (placeholder for now)\n   */\n  private async synthesizeInsights(\n    deepContext: DeepContext,\n    dataPoints: DataPoint[]\n  ): Promise<void> {\n    // Extract key insights from data points\n    const customerTriggers = dataPoints.filter(dp => dp.type === 'customer_trigger');\n    const trendingTopics = dataPoints.filter(dp => dp.type === 'trending_topic');\n    const timingSignals = dataPoints.filter(dp => dp.type === 'timing');\n\n    // Basic synthesis (can be enhanced with OpenAI later)\n    deepContext.synthesis.keyInsights = [\n      `Found ${customerTriggers.length} customer psychological triggers`,\n      `Identified ${trendingTopics.length} trending topics`,\n      `Detected ${timingSignals.length} timing-based opportunities`,\n      `Total data points: ${dataPoints.length} from ${deepContext.metadata.dataSourcesUsed.length} sources`\n    ];\n\n    deepContext.synthesis.opportunityScore = Math.min(\n      100,\n      50 + (dataPoints.length * 2)\n    );\n\n    deepContext.synthesis.confidenceLevel = Math.min(\n      1,\n      0.5 + (dataPoints.length / 100)\n    );\n  }\n\n  /**\n   * Clear cache for a brand (delegates to intelligenceCache)\n   */\n  async clearCache(brandId?: string): Promise<void> {\n    if (brandId) {\n      await intelligenceCache.invalidateByBrand(brandId);\n    } else {\n      // Clear all DeepContext caches\n      await intelligenceCache.invalidateByType('deepcontext');\n    }\n  }\n\n  /**\n   * Get cache stats (delegates to intelligenceCache)\n   */\n  async getCacheStats(): Promise<any> {\n    return await intelligenceCache.getStats();\n  }\n}\n\nexport const deepContextBuilder = new DeepContextBuilderService();\nexport type { DeepContextBuilderConfig, DeepContextBuildResult };\n","/**\n * Consumer Spending Data\n *\n * Database of common consumer expenses for behavioral economics calculations\n * Used to create \"your daily habit = our service\" content hooks\n */\n\nexport interface ConsumerExpense {\n  name: string;\n  category: 'daily' | 'weekly' | 'monthly' | 'annual';\n  costPer: number;\n  frequency: string;\n  annualCost: number;\n  demographics: string[];\n  emotionalValue: 'low' | 'medium' | 'high';\n}\n\n/**\n * Common Daily Expenses\n */\nexport const DAILY_EXPENSES: ConsumerExpense[] = [\n  {\n    name: 'Premium Coffee (Starbucks)',\n    category: 'daily',\n    costPer: 6.50,\n    frequency: '5x/week',\n    annualCost: 1690,\n    demographics: ['professionals', 'urban', 'millennials'],\n    emotionalValue: 'high'\n  },\n  {\n    name: 'Fast Food Lunch',\n    category: 'daily',\n    costPer: 12,\n    frequency: '5x/week',\n    annualCost: 3120,\n    demographics: ['working professionals', 'busy parents'],\n    emotionalValue: 'low'\n  },\n  {\n    name: 'Restaurant Lunch',\n    category: 'daily',\n    costPer: 18,\n    frequency: '3x/week',\n    annualCost: 2808,\n    demographics: ['professionals', 'urban', 'foodies'],\n    emotionalValue: 'medium'\n  },\n  {\n    name: 'Vending Machine Snacks',\n    category: 'daily',\n    costPer: 3,\n    frequency: '5x/week',\n    annualCost: 780,\n    demographics: ['office workers', 'students'],\n    emotionalValue: 'low'\n  },\n  {\n    name: 'Energy Drinks',\n    category: 'daily',\n    costPer: 4,\n    frequency: '5x/week',\n    annualCost: 1040,\n    demographics: ['young professionals', 'shift workers'],\n    emotionalValue: 'low'\n  }\n];\n\n/**\n * Common Monthly Subscriptions\n */\nexport const MONTHLY_SUBSCRIPTIONS: ConsumerExpense[] = [\n  {\n    name: 'Netflix + Streaming Services',\n    category: 'monthly',\n    costPer: 45,\n    frequency: 'monthly',\n    annualCost: 540,\n    demographics: ['all demographics'],\n    emotionalValue: 'medium'\n  },\n  {\n    name: 'Spotify Premium',\n    category: 'monthly',\n    costPer: 11,\n    frequency: 'monthly',\n    annualCost: 132,\n    demographics: ['millennials', 'gen-z'],\n    emotionalValue: 'high'\n  },\n  {\n    name: 'Gym Membership',\n    category: 'monthly',\n    costPer: 50,\n    frequency: 'monthly',\n    annualCost: 600,\n    demographics: ['health-conscious', 'professionals'],\n    emotionalValue: 'medium'\n  },\n  {\n    name: 'Meal Kit Subscription',\n    category: 'monthly',\n    costPer: 120,\n    frequency: 'monthly',\n    annualCost: 1440,\n    demographics: ['busy families', 'foodies'],\n    emotionalValue: 'medium'\n  },\n  {\n    name: 'Amazon Prime',\n    category: 'monthly',\n    costPer: 15,\n    frequency: 'monthly',\n    annualCost: 180,\n    demographics: ['all demographics'],\n    emotionalValue: 'medium'\n  }\n];\n\n/**\n * Common Weekly Expenses\n */\nexport const WEEKLY_EXPENSES: ConsumerExpense[] = [\n  {\n    name: 'Takeout/Delivery Dinner',\n    category: 'weekly',\n    costPer: 45,\n    frequency: '2x/week',\n    annualCost: 4680,\n    demographics: ['busy families', 'professionals'],\n    emotionalValue: 'high'\n  },\n  {\n    name: 'Happy Hour Drinks',\n    category: 'weekly',\n    costPer: 30,\n    frequency: '2x/week',\n    annualCost: 3120,\n    demographics: ['young professionals', 'social'],\n    emotionalValue: 'high'\n  },\n  {\n    name: 'Grocery Store Prepared Foods',\n    category: 'weekly',\n    costPer: 35,\n    frequency: '2x/week',\n    annualCost: 3640,\n    demographics: ['busy professionals', 'families'],\n    emotionalValue: 'low'\n  },\n  {\n    name: 'Drive-Through Coffee',\n    category: 'weekly',\n    costPer: 25,\n    frequency: '5x/week',\n    annualCost: 6500,\n    demographics: ['commuters', 'parents'],\n    emotionalValue: 'high'\n  }\n];\n\n/**\n * Common Annual/Occasional Expenses\n */\nexport const ANNUAL_EXPENSES: ConsumerExpense[] = [\n  {\n    name: 'Concert/Event Tickets',\n    category: 'annual',\n    costPer: 200,\n    frequency: '4x/year',\n    annualCost: 800,\n    demographics: ['millennials', 'entertainment seekers'],\n    emotionalValue: 'high'\n  },\n  {\n    name: 'Vacation Dining',\n    category: 'annual',\n    costPer: 500,\n    frequency: '2x/year',\n    annualCost: 1000,\n    demographics: ['travelers', 'foodies'],\n    emotionalValue: 'high'\n  },\n  {\n    name: 'Cell Phone Upgrade',\n    category: 'annual',\n    costPer: 1000,\n    frequency: '1x/year',\n    annualCost: 1000,\n    demographics: ['tech-savvy', 'all demographics'],\n    emotionalValue: 'medium'\n  }\n];\n\n/**\n * All Consumer Expenses Combined\n */\nexport const ALL_CONSUMER_EXPENSES: ConsumerExpense[] = [\n  ...DAILY_EXPENSES,\n  ...WEEKLY_EXPENSES,\n  ...MONTHLY_SUBSCRIPTIONS,\n  ...ANNUAL_EXPENSES\n];\n\n/**\n * Get expenses relevant to specific demographics\n */\nexport function getExpensesForDemographic(demographic: string): ConsumerExpense[] {\n  return ALL_CONSUMER_EXPENSES.filter(expense =>\n    expense.demographics.some(d =>\n      d.toLowerCase().includes(demographic.toLowerCase())\n    )\n  );\n}\n\n/**\n * Get expenses by emotional value (high emotional value = better for behavioral hooks)\n */\nexport function getHighEmotionalValueExpenses(): ConsumerExpense[] {\n  return ALL_CONSUMER_EXPENSES.filter(expense =>\n    expense.emotionalValue === 'high'\n  );\n}\n\n/**\n * Get expenses in a specific cost range\n */\nexport function getExpensesInRange(minAnnual: number, maxAnnual: number): ConsumerExpense[] {\n  return ALL_CONSUMER_EXPENSES.filter(expense =>\n    expense.annualCost >= minAnnual && expense.annualCost <= maxAnnual\n  );\n}\n","/**\n * Cost Equivalence Calculator\n *\n * Calculates behavioral economics hooks by finding consumer spending equivalents\n * to business services. Enables \"your daily habit = our service\" content style.\n */\n\nimport {\n  ALL_CONSUMER_EXPENSES,\n  getHighEmotionalValueExpenses,\n  getExpensesInRange,\n  type ConsumerExpense\n} from './ConsumerSpendingData';\n\nexport interface ServiceCost {\n  name: string;\n  price: number;\n  unit: string; // 'one-time', 'monthly', 'annual'\n  category?: string;\n}\n\nexport interface CostEquivalence {\n  service: ServiceCost;\n  expense: ConsumerExpense;\n  equivalenceType: 'exact' | 'months' | 'weeks' | 'days';\n  timeframe: string; // e.g., \"3 months of lattes\"\n  hook: string; // Ready-to-use content hook\n  calculation: string; // The math breakdown\n  emotionalWeight: 'high' | 'medium' | 'low';\n}\n\nexport interface CostEquivalenceResult {\n  bestMatches: CostEquivalence[];\n  allEquivalences: CostEquivalence[];\n  totalExpensesAnalyzed: number;\n  highEmotionalMatches: CostEquivalence[];\n}\n\n/**\n * Calculate cost equivalences for a business service\n */\nexport function calculateCostEquivalences(\n  serviceCost: ServiceCost,\n  targetDemographic?: string\n): CostEquivalenceResult {\n  // Convert service cost to annual for comparison\n  const serviceAnnualCost = normalizeToAnnual(serviceCost);\n\n  // Get relevant expenses\n  const expensesToCheck = targetDemographic\n    ? ALL_CONSUMER_EXPENSES.filter(e =>\n        e.demographics.some(d => d.toLowerCase().includes(targetDemographic.toLowerCase()))\n      )\n    : ALL_CONSUMER_EXPENSES;\n\n  // Find equivalences\n  const allEquivalences: CostEquivalence[] = [];\n\n  for (const expense of expensesToCheck) {\n    const equivalences = findEquivalences(serviceCost, serviceAnnualCost, expense);\n    allEquivalences.push(...equivalences);\n  }\n\n  // Sort by relevance (emotional value + time frame reasonableness)\n  allEquivalences.sort((a, b) => {\n    const aScore = getRelevanceScore(a);\n    const bScore = getRelevanceScore(b);\n    return bScore - aScore;\n  });\n\n  // Get best matches (top 5)\n  const bestMatches = allEquivalences.slice(0, 5);\n\n  // Get high emotional matches\n  const highEmotionalMatches = allEquivalences.filter(\n    eq => eq.emotionalWeight === 'high'\n  );\n\n  return {\n    bestMatches,\n    allEquivalences,\n    totalExpensesAnalyzed: expensesToCheck.length,\n    highEmotionalMatches: highEmotionalMatches.slice(0, 3)\n  };\n}\n\n/**\n * Calculate multiple services at once\n */\nexport function calculateMultiServiceEquivalences(\n  services: ServiceCost[],\n  targetDemographic?: string\n): Map<string, CostEquivalenceResult> {\n  const results = new Map<string, CostEquivalenceResult>();\n\n  for (const service of services) {\n    results.set(service.name, calculateCostEquivalences(service, targetDemographic));\n  }\n\n  return results;\n}\n\n/**\n * Normalize service cost to annual for comparison\n */\nfunction normalizeToAnnual(service: ServiceCost): number {\n  switch (service.unit) {\n    case 'one-time':\n      return service.price;\n    case 'monthly':\n      return service.price * 12;\n    case 'annual':\n      return service.price;\n    default:\n      return service.price;\n  }\n}\n\n/**\n * Find all possible equivalences between service and expense\n */\nfunction findEquivalences(\n  service: ServiceCost,\n  serviceAnnualCost: number,\n  expense: ConsumerExpense\n): CostEquivalence[] {\n  const equivalences: CostEquivalence[] = [];\n\n  // Calculate different timeframes\n  const expenseDaily = expense.annualCost / 365;\n  const expenseWeekly = expense.annualCost / 52;\n  const expenseMonthly = expense.annualCost / 12;\n\n  // Check for reasonable timeframes (1 day to 24 months)\n\n  // Daily equivalence\n  const days = Math.round(serviceAnnualCost / expenseDaily);\n  if (days >= 1 && days <= 365) {\n    equivalences.push(createEquivalence(service, expense, days, 'days'));\n  }\n\n  // Weekly equivalence\n  const weeks = Math.round(serviceAnnualCost / expenseWeekly);\n  if (weeks >= 1 && weeks <= 104) {\n    equivalences.push(createEquivalence(service, expense, weeks, 'weeks'));\n  }\n\n  // Monthly equivalence\n  const months = Math.round(serviceAnnualCost / expenseMonthly);\n  if (months >= 1 && months <= 24) {\n    equivalences.push(createEquivalence(service, expense, months, 'months'));\n  }\n\n  // Exact match (within 10%)\n  const diff = Math.abs(serviceAnnualCost - expense.annualCost) / serviceAnnualCost;\n  if (diff <= 0.10) {\n    equivalences.push(createExactEquivalence(service, expense));\n  }\n\n  return equivalences;\n}\n\n/**\n * Create a cost equivalence object\n */\nfunction createEquivalence(\n  service: ServiceCost,\n  expense: ConsumerExpense,\n  amount: number,\n  unit: 'days' | 'weeks' | 'months'\n): CostEquivalence {\n  const timeframe = `${amount} ${unit} of ${expense.name}`;\n\n  // Generate hook based on expense type\n  let hook = '';\n  if (unit === 'months' && amount <= 12) {\n    hook = `Why your ${expense.name.toLowerCase()} habit proves you can afford ${service.name.toLowerCase()}`;\n  } else if (unit === 'weeks' && amount <= 26) {\n    hook = `${amount} ${unit} of ${expense.name.toLowerCase()} = one ${service.name.toLowerCase()}`;\n  } else {\n    hook = `Skip ${expense.name.toLowerCase()} for ${amount} ${unit} → ${service.name.toLowerCase()}`;\n  }\n\n  // Generate calculation breakdown\n  const calculation = generateCalculation(service, expense, amount, unit);\n\n  return {\n    service,\n    expense,\n    equivalenceType: unit,\n    timeframe,\n    hook,\n    calculation,\n    emotionalWeight: expense.emotionalValue\n  };\n}\n\n/**\n * Create exact match equivalence\n */\nfunction createExactEquivalence(\n  service: ServiceCost,\n  expense: ConsumerExpense\n): CostEquivalence {\n  const hook = `Your ${expense.name.toLowerCase()} costs the same as ${service.name.toLowerCase()} - which creates lasting value?`;\n  const calculation = `${expense.name}: $${expense.annualCost}/year = ${service.name}: $${normalizeToAnnual(service)}/year`;\n\n  return {\n    service,\n    expense,\n    equivalenceType: 'exact',\n    timeframe: 'Annual equivalence',\n    hook,\n    calculation,\n    emotionalWeight: expense.emotionalValue\n  };\n}\n\n/**\n * Generate calculation breakdown\n */\nfunction generateCalculation(\n  service: ServiceCost,\n  expense: ConsumerExpense,\n  amount: number,\n  unit: 'days' | 'weeks' | 'months'\n): string {\n  const serviceAnnual = normalizeToAnnual(service);\n  const expensePer = unit === 'days'\n    ? expense.annualCost / 365\n    : unit === 'weeks'\n    ? expense.annualCost / 52\n    : expense.annualCost / 12;\n\n  return `${expense.name}: $${expensePer.toFixed(2)}/${unit.slice(0, -1)} × ${amount} ${unit} = $${(expensePer * amount).toFixed(2)} ≈ ${service.name} ($${serviceAnnual})`;\n}\n\n/**\n * Calculate relevance score for sorting\n */\nfunction getRelevanceScore(equivalence: CostEquivalence): number {\n  let score = 0;\n\n  // Prefer high emotional value\n  if (equivalence.emotionalWeight === 'high') score += 30;\n  else if (equivalence.emotionalWeight === 'medium') score += 15;\n\n  // Prefer reasonable timeframes (3-12 months is sweet spot)\n  if (equivalence.equivalenceType === 'months') {\n    const months = parseInt(equivalence.timeframe);\n    if (months >= 3 && months <= 12) score += 25;\n    else if (months >= 1 && months <= 3) score += 15;\n    else if (months >= 13 && months <= 18) score += 10;\n  } else if (equivalence.equivalenceType === 'weeks') {\n    const weeks = parseInt(equivalence.timeframe);\n    if (weeks >= 4 && weeks <= 26) score += 20;\n  } else if (equivalence.equivalenceType === 'exact') {\n    score += 35; // Exact matches are golden\n  }\n\n  // Prefer shorter, punchier timeframes for days\n  if (equivalence.equivalenceType === 'days') {\n    const days = parseInt(equivalence.timeframe);\n    if (days <= 30) score += 15;\n    else if (days <= 90) score += 10;\n  }\n\n  return score;\n}\n\n/**\n * Generate formatted output for Sonnet\n */\nexport function formatForPrompt(result: CostEquivalenceResult): string {\n  let output = '### Cost Equivalences (Behavioral Economics Hooks)\\n\\n';\n\n  output += '**Best Matches** (ready-to-use in content):\\n';\n  for (const eq of result.bestMatches) {\n    output += `- ${eq.hook}\\n`;\n    output += `  *Calculation*: ${eq.calculation}\\n\\n`;\n  }\n\n  if (result.highEmotionalMatches.length > 0) {\n    output += '\\n**High Emotional Impact** (strongest psychological resonance):\\n';\n    for (const eq of result.highEmotionalMatches.slice(0, 3)) {\n      output += `- ${eq.hook}\\n`;\n    }\n  }\n\n  return output;\n}\n\n/**\n * Generate industry-specific examples\n */\nexport function getIndustryExamples(industry: string): ServiceCost[] {\n  const examples: { [key: string]: ServiceCost[] } = {\n    restaurant: [\n      { name: \"Chef's Tasting Menu\", price: 150, unit: 'one-time', category: 'fine dining' },\n      { name: 'Monthly Date Night Package', price: 200, unit: 'monthly', category: 'romantic' },\n      { name: 'Private Dining Experience', price: 500, unit: 'one-time', category: 'special occasion' }\n    ],\n    dental: [\n      { name: 'Teeth Whitening', price: 400, unit: 'one-time', category: 'cosmetic' },\n      { name: 'Dental Veneers', price: 4500, unit: 'one-time', category: 'cosmetic' },\n      { name: 'Invisalign Treatment', price: 5000, unit: 'one-time', category: 'orthodontic' }\n    ],\n    roofing: [\n      { name: 'Roof Repair Section', price: 2500, unit: 'one-time', category: 'maintenance' },\n      { name: 'Full Roof Replacement', price: 15000, unit: 'one-time', category: 'replacement' },\n      { name: 'Emergency Leak Repair', price: 500, unit: 'one-time', category: 'emergency' }\n    ],\n    salon: [\n      { name: 'Hair Color Treatment', price: 180, unit: 'one-time', category: 'color' },\n      { name: 'Keratin Treatment', price: 350, unit: 'one-time', category: 'treatment' },\n      { name: 'Monthly Maintenance Package', price: 120, unit: 'monthly', category: 'subscription' }\n    ]\n  };\n\n  return examples[industry.toLowerCase()] || [];\n}\n","/**\n * Connection Discovery Types\n * For Phase 6: AI-powered connection discovery between disparate data points\n */\n\n// Data sources for connection discovery\nexport type DataSource =\n  | 'youtube'\n  | 'outscraper'\n  | 'news'\n  | 'weather'\n  | 'serper'\n  | 'reddit'\n  | 'twitter'\n  | 'apify'\n  | 'perplexity'\n  | 'semrush'\n  | 'website'\n  | 'linkedin';  // LinkedIn via Serper\n\n// Data point types for categorization\nexport type DataPointType =\n  | 'customer_trigger'\n  | 'trending_topic'\n  | 'competitive_gap'\n  | 'timing'\n  | 'market_trend'\n  | 'sentiment'\n  | 'behavior_pattern'\n  | 'local_event';\n\n// Embedding model configuration\nexport const EMBEDDING_MODEL = 'text-embedding-3-small';\nexport const EMBEDDING_DIMENSIONS = 1536;\nexport const EMBEDDING_COST_PER_1M_TOKENS = 0.02;\n\n// Data point interface with embeddings\nexport interface DataPoint {\n  source: DataSource;\n  type: DataPointType;\n  content: string;\n  metadata?: Record<string, any>;\n  timestamp: string;\n  confidence: number;\n  embedding?: number[];\n}\n\n// Embedding cache entry\nexport interface EmbeddingCacheEntry {\n  text: string;\n  embedding: number[];\n  cachedAt: Date;\n  model: string;\n}\n\n// Embedding cache stats\nexport interface EmbeddingCacheStats {\n  size: number;\n  hits: number;\n  misses: number;\n  totalCost: number;\n}\n\nexport interface Connection {\n  id: string\n  brand_id: string\n  type: '2-way' | '3-way' | '4-way' | '5-way'\n  title: string\n  description: string\n  data_points: DataPoint[]\n  confidence: number // 0-1\n  impact_score: number // 0-100\n  breakthrough_score: number // 0-1 (how unexpected/valuable)\n  content_angle: string\n  suggested_actions: Array<{\n    action_type: 'create_content' | 'adjust_strategy' | 'target_audience' | 'timing' | 'platform_shift'\n    description: string\n    priority: 'critical' | 'high' | 'medium' | 'low'\n    estimated_effort: string\n    potential_impact: number\n    implementation_steps?: string[]\n  }>\n  created_at: string\n  expires_at?: string\n}\n\nexport interface DeepContext {\n  brand_id: string\n  industry: string\n  keywords: string[]\n  triggers: string[]\n  competitors: any[]\n  content_gaps: any[]\n  current_opportunities: any[]\n  seo_data: any\n  weather_data: any\n  trend_data: any\n  archetype: string\n  brand_voice: string\n  target_personas: any[]\n  benchmarks: any\n}\n\nexport interface ConnectionDiscoveryOptions {\n  minBreakthroughScore?: number // 0-1, default 0.7\n  maxConnections?: number // default 20\n  includeWeakSignals?: boolean // default true\n  focusAreas?: Array<'customer_psychology' | 'market_trends' | 'competitive_gaps' | 'timing' | 'channels'>\n}\n\n// Default options for connection discovery\nexport const DEFAULT_DISCOVERY_OPTIONS: Required<ConnectionDiscoveryOptions> = {\n  minBreakthroughScore: 0.7,\n  maxConnections: 20,\n  includeWeakSignals: true,\n  focusAreas: ['customer_psychology', 'market_trends', 'competitive_gaps', 'timing', 'channels']\n}\n\nexport interface ConnectionDiscoveryResult {\n  connections: Connection[]\n  summary: {\n    total_connections: number\n    high_confidence_count: number\n    breakthrough_insights: number\n    categories: Record<string, number>\n  }\n  processing_time_ms: number\n  data_sources_used: string[]\n}\n\n// Scoring weights for breakthrough potential calculation\nexport interface ScoringWeights {\n  semanticSimilarity: number;\n  unexpectedness: number;\n  psychologyInvolvement: number;\n  competitiveAdvantage: number;\n  timeliness: number;\n  threeWayBonus: number;\n}\n\n// Default scoring weights (must sum to ~100%)\nexport const DEFAULT_SCORING_WEIGHTS: ScoringWeights = {\n  semanticSimilarity: 0.30,\n  unexpectedness: 0.25,\n  psychologyInvolvement: 0.15,\n  competitiveAdvantage: 0.15,\n  timeliness: 0.10,\n  threeWayBonus: 0.40, // Applied separately for 3+ way connections\n};\n\n// Breakthrough potential assessment\nexport interface BreakthroughPotential {\n  score: number; // 0-1\n  reasoning: string;\n  factors: {\n    semanticSimilarity: number;\n    unexpectedness: number;\n    psychologyInvolvement: number;\n    competitiveAdvantage: number;\n    timeliness: number;\n  };\n}\n\n// Expected impact categories\nexport type ExpectedImpact = 'low' | 'medium' | 'high' | 'breakthrough';\n","/**\n * Embedding Service\n *\n * Handles OpenAI Embeddings API integration with:\n * - Batch processing (100 texts at a time)\n * - Aggressive caching to minimize costs\n * - Cost tracking\n * - Error handling and retries\n *\n * Created: 2025-11-10\n */\n\nimport {\n  DataPoint,\n  EmbeddingCacheEntry,\n  EmbeddingCacheStats,\n  EMBEDDING_MODEL,\n  EMBEDDING_COST_PER_1M_TOKENS\n} from '../../../types/connections.types';\n\nexport interface EmbeddingRequest {\n  texts: string[];\n  model?: string;\n}\n\nexport interface EmbeddingResponse {\n  embeddings: number[][];\n  tokensUsed: number;\n  cost: number;\n  cacheHits: number;\n}\n\nexport class EmbeddingService {\n  private cache = new Map<string, EmbeddingCacheEntry>();\n  private apiKey: string;\n  private totalTokensUsed = 0;\n  private totalCost = 0;\n  private cacheHits = 0;\n  private cacheMisses = 0;\n\n  constructor(apiKey?: string) {\n    this.apiKey = apiKey || import.meta.env.VITE_OPENAI_API_KEY || '';\n    if (!this.apiKey) {\n      console.warn('[EmbeddingService] No OpenAI API key provided');\n    }\n  }\n\n  /**\n   * Create embeddings for multiple texts\n   * Uses cache aggressively to minimize API calls\n   */\n  async createEmbeddings(request: EmbeddingRequest): Promise<EmbeddingResponse> {\n    console.log(`[EmbeddingService] Creating embeddings for ${request.texts.length} texts...`);\n\n    const model = request.model || EMBEDDING_MODEL;\n    const embeddings: number[][] = [];\n    const uncachedTexts: { text: string; index: number }[] = [];\n\n    // Check cache first\n    request.texts.forEach((text, index) => {\n      const cached = this.getFromCache(text, model);\n      if (cached) {\n        embeddings[index] = cached.embedding;\n        this.cacheHits++;\n      } else {\n        uncachedTexts.push({ text, index });\n        this.cacheMisses++;\n      }\n    });\n\n    console.log(`[EmbeddingService] Cache: ${this.cacheHits} hits, ${uncachedTexts.length} misses`);\n\n    // If all cached, return immediately\n    if (uncachedTexts.length === 0) {\n      return {\n        embeddings,\n        tokensUsed: 0,\n        cost: 0,\n        cacheHits: this.cacheHits\n      };\n    }\n\n    // Batch process uncached texts (max 100 per request)\n    const batches = this.chunk(uncachedTexts, 100);\n    let totalTokens = 0;\n\n    for (const batch of batches) {\n      try {\n        const response = await this.callOpenAI(\n          batch.map(item => item.text),\n          model\n        );\n\n        // Store results\n        response.data.forEach((item, i) => {\n          const { text, index } = batch[i];\n          const embedding = item.embedding;\n\n          // Add to results\n          embeddings[index] = embedding;\n\n          // Cache for future use\n          this.addToCache(text, embedding, model);\n        });\n\n        totalTokens += response.usage.total_tokens;\n\n      } catch (error) {\n        console.error('[EmbeddingService] Batch failed:', error);\n        // Fill with zeros for failed embeddings\n        batch.forEach(({ index }) => {\n          embeddings[index] = new Array(1536).fill(0);\n        });\n      }\n    }\n\n    const cost = (totalTokens / 1000000) * EMBEDDING_COST_PER_1M_TOKENS;\n    this.totalTokensUsed += totalTokens;\n    this.totalCost += cost;\n\n    console.log(`[EmbeddingService] Generated ${uncachedTexts.length} embeddings. Tokens: ${totalTokens}, Cost: $${cost.toFixed(4)}`);\n\n    return {\n      embeddings,\n      tokensUsed: totalTokens,\n      cost,\n      cacheHits: this.cacheHits\n    };\n  }\n\n  /**\n   * Embed data points in place\n   */\n  async embedDataPoints(dataPoints: DataPoint[]): Promise<void> {\n    const texts = dataPoints.map(dp => dp.content);\n\n    const response = await this.createEmbeddings({ texts });\n\n    dataPoints.forEach((dp, i) => {\n      dp.embedding = response.embeddings[i];\n    });\n\n    console.log(`[EmbeddingService] Embedded ${dataPoints.length} data points`);\n  }\n\n  /**\n   * Get from cache\n   */\n  private getFromCache(text: string, model: string): EmbeddingCacheEntry | null {\n    const key = this.buildCacheKey(text, model);\n    const entry = this.cache.get(key);\n\n    if (!entry) return null;\n\n    // Check if expired (cache for 7 days)\n    const age = Date.now() - entry.cachedAt.getTime();\n    const maxAge = 7 * 24 * 60 * 60 * 1000; // 7 days\n\n    if (age > maxAge) {\n      this.cache.delete(key);\n      return null;\n    }\n\n    return entry;\n  }\n\n  /**\n   * Add to cache\n   */\n  private addToCache(text: string, embedding: number[], model: string): void {\n    const key = this.buildCacheKey(text, model);\n    this.cache.set(key, {\n      text,\n      embedding,\n      cachedAt: new Date(),\n      model\n    });\n  }\n\n  /**\n   * Build cache key\n   */\n  private buildCacheKey(text: string, model: string): string {\n    // Use first 100 chars + length as key (good enough for deduplication)\n    const snippet = text.substring(0, 100);\n    return `${model}:${snippet}:${text.length}`;\n  }\n\n  /**\n   * Call OpenAI API\n   */\n  private async callOpenAI(texts: string[], model: string): Promise<any> {\n    const url = 'https://api.openai.com/v1/embeddings';\n\n    const response = await fetch(url, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${this.apiKey}`\n      },\n      body: JSON.stringify({\n        model,\n        input: texts\n      })\n    });\n\n    if (!response.ok) {\n      const error = await response.text();\n      throw new Error(`OpenAI API error: ${response.status} ${error}`);\n    }\n\n    return await response.json();\n  }\n\n  /**\n   * Chunk array into batches\n   */\n  private chunk<T>(array: T[], size: number): T[][] {\n    const chunks: T[][] = [];\n    for (let i = 0; i < array.length; i += size) {\n      chunks.push(array.slice(i, i + size));\n    }\n    return chunks;\n  }\n\n  /**\n   * Get cache statistics\n   */\n  getCacheStats(): EmbeddingCacheStats {\n    const totalRequests = this.cacheHits + this.cacheMisses;\n    const hitRate = totalRequests > 0 ? this.cacheHits / totalRequests : 0;\n\n    // Estimate cost saved (assuming average 100 tokens per embedding)\n    const embeddingsSaved = this.cacheHits;\n    const tokensSaved = embeddingsSaved * 100;\n    const costSaved = (tokensSaved / 1000000) * EMBEDDING_COST_PER_1M_TOKENS;\n\n    // Estimate memory usage (1536 dimensions × 4 bytes per float)\n    const memoryMB = (this.cache.size * 1536 * 4) / (1024 * 1024);\n\n    return {\n      size: this.cache.size,\n      hitRate,\n      costSaved,\n      memoryMB\n    };\n  }\n\n  /**\n   * Get total cost\n   */\n  getTotalCost(): number {\n    return this.totalCost;\n  }\n\n  /**\n   * Clear cache\n   */\n  clearCache(): void {\n    this.cache.clear();\n    console.log('[EmbeddingService] Cache cleared');\n  }\n\n  /**\n   * Export cache to JSON (for persistence)\n   */\n  exportCache(): string {\n    const entries = Array.from(this.cache.entries()).map(([key, value]) => ({\n      key,\n      ...value,\n      cachedAt: value.cachedAt.toISOString()\n    }));\n\n    return JSON.stringify(entries);\n  }\n\n  /**\n   * Import cache from JSON\n   */\n  importCache(json: string): void {\n    try {\n      const entries = JSON.parse(json);\n      this.cache.clear();\n\n      entries.forEach((entry: any) => {\n        this.cache.set(entry.key, {\n          text: entry.text,\n          embedding: entry.embedding,\n          cachedAt: new Date(entry.cachedAt),\n          model: entry.model\n        });\n      });\n\n      console.log(`[EmbeddingService] Imported ${entries.length} cache entries`);\n    } catch (error) {\n      console.error('[EmbeddingService] Failed to import cache:', error);\n    }\n  }\n}\n","/**\n * Connection Hint Generator\n *\n * Uses embeddings to find non-obvious semantic connections across data sources\n * Returns \"hints\" for Sonnet to expand on, not complete connections\n */\n\nimport { EmbeddingService } from '../connections/EmbeddingService';\n\nexport interface DataSource {\n  type: 'weather' | 'event' | 'review' | 'trend' | 'keyword' | 'social' | 'news';\n  text: string;\n  metadata?: any;\n}\n\nexport interface ConnectionHint {\n  similarity: number; // 0-1 cosine similarity\n  sourceA: DataSource;\n  sourceB: DataSource;\n  hint: string; // Brief description for Sonnet\n  unexpectedness: number; // 0-1, higher = more unexpected connection\n  actionable: boolean;\n}\n\nexport interface ConnectionHintResult {\n  hints: ConnectionHint[];\n  totalComparisons: number;\n  averageSimilarity: number;\n  processingTimeMs: number;\n  cost: number;\n}\n\n/**\n * Generate connection hints from multiple data sources\n */\nexport async function generateConnectionHints(\n  dataSources: DataSource[],\n  options: {\n    minSimilarity?: number;\n    maxHints?: number;\n    prioritizeCrossDomain?: boolean;\n  } = {}\n): Promise<ConnectionHintResult> {\n  const startTime = Date.now();\n\n  const {\n    minSimilarity = 0.65, // Only show moderately similar or higher\n    maxHints = 5,\n    prioritizeCrossDomain = true // Prefer connections across different types\n  } = options;\n\n  console.log(`[ConnectionHints] Analyzing ${dataSources.length} data sources...`);\n\n  // Initialize embedding service\n  const embeddingService = new EmbeddingService();\n\n  // Extract texts for embedding\n  const texts = dataSources.map(ds => ds.text);\n\n  // Generate embeddings\n  const embeddingResponse = await embeddingService.createEmbeddings({ texts });\n  const embeddings = embeddingResponse.embeddings;\n\n  console.log(`[ConnectionHints] Generated ${embeddings.length} embeddings, cost: $${embeddingResponse.cost.toFixed(4)}`);\n\n  // Find connections via cosine similarity\n  const potentialHints: ConnectionHint[] = [];\n  let totalSimilarity = 0;\n  let comparisons = 0;\n\n  for (let i = 0; i < dataSources.length; i++) {\n    for (let j = i + 1; j < dataSources.length; j++) {\n      const similarity = cosineSimilarity(embeddings[i], embeddings[j]);\n      comparisons++;\n      totalSimilarity += similarity;\n\n      // Only consider above threshold\n      if (similarity >= minSimilarity) {\n        const sourceA = dataSources[i];\n        const sourceB = dataSources[j];\n\n        // Calculate unexpectedness (cross-domain = more unexpected)\n        const unexpectedness = sourceA.type !== sourceB.type\n          ? 0.8 + (similarity - minSimilarity) * 0.2\n          : 0.3 + (similarity - minSimilarity) * 0.2;\n\n        // Generate hint\n        const hint = generateHintText(sourceA, sourceB, similarity);\n\n        // Check if actionable (requires temporal or specific elements)\n        const actionable = isActionable(sourceA, sourceB);\n\n        potentialHints.push({\n          similarity,\n          sourceA,\n          sourceB,\n          hint,\n          unexpectedness,\n          actionable\n        });\n      }\n    }\n  }\n\n  // Sort by relevance\n  potentialHints.sort((a, b) => {\n    // Prioritize cross-domain connections if requested\n    if (prioritizeCrossDomain) {\n      const aCrossDomain = a.sourceA.type !== a.sourceB.type;\n      const bCrossDomain = b.sourceA.type !== b.sourceB.type;\n      if (aCrossDomain !== bCrossDomain) {\n        return bCrossDomain ? 1 : -1;\n      }\n    }\n\n    // Then by unexpectedness\n    if (Math.abs(a.unexpectedness - b.unexpectedness) > 0.1) {\n      return b.unexpectedness - a.unexpectedness;\n    }\n\n    // Then by similarity\n    return b.similarity - a.similarity;\n  });\n\n  // Take top hints\n  const topHints = potentialHints.slice(0, maxHints);\n\n  const processingTimeMs = Date.now() - startTime;\n  const averageSimilarity = comparisons > 0 ? totalSimilarity / comparisons : 0;\n\n  console.log(`[ConnectionHints] Found ${topHints.length} hints in ${processingTimeMs}ms`);\n  console.log(`[ConnectionHints] Average similarity: ${averageSimilarity.toFixed(3)}`);\n\n  return {\n    hints: topHints,\n    totalComparisons: comparisons,\n    averageSimilarity,\n    processingTimeMs,\n    cost: embeddingResponse.cost\n  };\n}\n\n/**\n * Calculate cosine similarity between two embeddings\n */\nfunction cosineSimilarity(a: number[], b: number[]): number {\n  if (a.length !== b.length) {\n    throw new Error('Embeddings must have same length');\n  }\n\n  let dotProduct = 0;\n  let magnitudeA = 0;\n  let magnitudeB = 0;\n\n  for (let i = 0; i < a.length; i++) {\n    dotProduct += a[i] * b[i];\n    magnitudeA += a[i] * a[i];\n    magnitudeB += b[i] * b[i];\n  }\n\n  magnitudeA = Math.sqrt(magnitudeA);\n  magnitudeB = Math.sqrt(magnitudeB);\n\n  if (magnitudeA === 0 || magnitudeB === 0) {\n    return 0;\n  }\n\n  return dotProduct / (magnitudeA * magnitudeB);\n}\n\n/**\n * Generate human-readable hint text\n */\nfunction generateHintText(sourceA: DataSource, sourceB: DataSource, similarity: number): string {\n  const cleanA = cleanText(sourceA.text);\n  const cleanB = cleanText(sourceB.text);\n\n  // Format based on types\n  const typeA = formatSourceType(sourceA.type);\n  const typeB = formatSourceType(sourceB.type);\n\n  if (sourceA.type === sourceB.type) {\n    return `${typeA}: \"${cleanA}\" + \"${cleanB}\" (${Math.round(similarity * 100)}% similar)`;\n  } else {\n    return `${typeA}: \"${cleanA}\" ↔ ${typeB}: \"${cleanB}\"`;\n  }\n}\n\n/**\n * Clean text for display\n */\nfunction cleanText(text: string): string {\n  // Truncate long text\n  if (text.length > 80) {\n    return text.substring(0, 77) + '...';\n  }\n  return text;\n}\n\n/**\n * Format source type for display\n */\nfunction formatSourceType(type: string): string {\n  const typeMap: { [key: string]: string } = {\n    weather: 'Weather',\n    event: 'Local Event',\n    review: 'Customer Review',\n    trend: 'Trend',\n    keyword: 'Search Keyword',\n    social: 'Social Media',\n    news: 'Industry News'\n  };\n  return typeMap[type] || type;\n}\n\n/**\n * Check if connection is actionable (has timing or specificity)\n */\nfunction isActionable(sourceA: DataSource, sourceB: DataSource): boolean {\n  // Temporal connections are actionable\n  if (sourceA.type === 'weather' || sourceB.type === 'weather') return true;\n  if (sourceA.type === 'event' || sourceB.type === 'event') return true;\n\n  // Trend + Review = actionable\n  if (\n    (sourceA.type === 'trend' && sourceB.type === 'review') ||\n    (sourceA.type === 'review' && sourceB.type === 'trend')\n  ) return true;\n\n  return false;\n}\n\n/**\n * Format connection hints for Sonnet prompt\n */\nexport function formatHintsForPrompt(result: ConnectionHintResult): string {\n  if (result.hints.length === 0) {\n    return '### Connection Hints\\n\\nNo strong semantic connections detected.\\n';\n  }\n\n  let output = '### Connection Hints (Semantic Similarities)\\n\\n';\n  output += `Found ${result.hints.length} unexpected connections across data sources:\\n\\n`;\n\n  for (let i = 0; i < result.hints.length; i++) {\n    const hint = result.hints[i];\n    const icon = hint.actionable ? '⚡' : '💡';\n\n    output += `${i + 1}. ${icon} ${hint.hint}\\n`;\n    output += `   *Unexpectedness*: ${Math.round(hint.unexpectedness * 100)}% | *Similarity*: ${Math.round(hint.similarity * 100)}%\\n`;\n\n    if (i < result.hints.length - 1) {\n      output += '\\n';\n    }\n  }\n\n  output += '\\n**Use these hints to create synapse content that competitors would never think of.**\\n';\n\n  return output;\n}\n\n/**\n * Helper: Create data sources from business intelligence (DeepContext)\n */\nexport function createDataSourcesFromIntelligence(intelligence: any): DataSource[] {\n  const sources: DataSource[] = [];\n\n  // Trending topics from realTimeCultural\n  if (intelligence.realTimeCultural?.trending?.topics) {\n    for (const topic of intelligence.realTimeCultural.trending.topics.slice(0, 10)) {\n      sources.push({\n        type: 'trend',\n        text: typeof topic === 'string' ? topic : topic.term || topic.topic,\n        metadata: topic\n      });\n    }\n  }\n\n  // Competitive opportunities/gaps\n  if (intelligence.competitiveIntel?.opportunities) {\n    for (const opportunity of intelligence.competitiveIntel.opportunities.slice(0, 10)) {\n      sources.push({\n        type: 'competitive',\n        text: typeof opportunity === 'string' ? opportunity : opportunity.description || opportunity,\n        metadata: opportunity\n      });\n    }\n  }\n\n  // Customer psychology - behavioral triggers (pain points, desires)\n  if (intelligence.customerPsychology?.behavioral) {\n    for (const trigger of intelligence.customerPsychology.behavioral.slice(0, 8)) {\n      sources.push({\n        type: 'customer',\n        text: typeof trigger === 'string' ? trigger : trigger.trigger || trigger.description || trigger,\n        metadata: trigger\n      });\n    }\n  }\n\n  // Customer segments - unarticulated needs\n  if (intelligence.customerPsychology?.unarticulated) {\n    for (const need of intelligence.customerPsychology.unarticulated.slice(0, 5)) {\n      sources.push({\n        type: 'customer_need',\n        text: typeof need === 'string' ? need : need.need || need.description || need,\n        metadata: need\n      });\n    }\n  }\n\n  // Business unique advantages\n  if (intelligence.business?.uniqueAdvantages) {\n    for (const advantage of intelligence.business.uniqueAdvantages.slice(0, 5)) {\n      sources.push({\n        type: 'advantage',\n        text: typeof advantage === 'string' ? advantage : advantage.advantage || advantage.description || advantage,\n        metadata: advantage\n      });\n    }\n  }\n\n  // Synthesis insights\n  if (intelligence.synthesis?.keyInsights) {\n    for (const insight of intelligence.synthesis.keyInsights.slice(0, 5)) {\n      sources.push({\n        type: 'insight',\n        text: typeof insight === 'string' ? insight : insight.insight || insight.description || insight,\n        metadata: insight\n      });\n    }\n  }\n\n  console.log(`[ConnectionHints] Created ${sources.length} data sources from intelligence`);\n\n  return sources;\n}\n","/**\n * Simple Synapse Generator\n *\n * Replaces the complex multi-model orchestra with a single Claude 3.5 Sonnet call\n * Integrates cost equivalences calculator and semantic connection hints\n * Produces synapse content in the original behavioral economics style\n */\n\nimport {\n  calculateCostEquivalences,\n  formatForPrompt as formatCostEquivalences,\n  getIndustryExamples,\n  type ServiceCost\n} from './helpers/CostEquivalenceCalculator';\n\nimport {\n  generateConnectionHints,\n  formatHintsForPrompt,\n  createDataSourcesFromIntelligence\n} from './helpers/ConnectionHintGenerator';\n\nimport type { SynapseInsight } from '@/types/synapse/synapse.types';\n\nexport interface SynapseInput {\n  business: {\n    name: string;\n    industry: string;\n    location: {\n      city: string;\n      state: string;\n    };\n    services?: ServiceCost[];\n  };\n  intelligence: any; // BusinessIntelligence or similar\n  detailedDataPoints?: any[]; // Raw data points from DeepContext for provenance\n}\n\nexport interface SynapseResult {\n  synapses: SynapseInsight[];\n  metadata: {\n    generationTimeMs: number;\n    costEquivalencesUsed: number;\n    connectionHintsUsed: number;\n    totalCost: number;\n    model: string;\n  };\n}\n\n/**\n * Clean meta-instructions from content\n * Removes common instruction patterns like \"Start with 'secret'\", \"Begin with...\", etc.\n */\nfunction cleanMetaInstructions(text: string): string {\n  if (!text) return text;\n\n  // Log if we find meta-instructions\n  if (text.toLowerCase().includes('start with') || text.toLowerCase().includes('secret')) {\n    console.warn('[SynapseGenerator] Found meta-instruction in text:', text.substring(0, 100));\n  }\n\n  // AGGRESSIVE cleaning - match all variants\n  const patterns = [\n    /^Start with [\"']?secret[\"']?\\s*/i,  // Specific \"secret\" pattern FIRST\n    /^Start with [\"'][^\"']*[\"']\\s*/i,    // Any quoted phrase after \"Start with\"\n    /^Start with\\s+/i,                   // Just \"Start with\"\n    /^Begin with\\s+/i,\n    /^Open with\\s+/i,\n    /^Create (a|an)\\s+/i,\n    /^Write (a|an)\\s+/i,\n    /^Make (a|an)\\s+/i,\n    /^Build (a|an)\\s+/i,\n    /^Use (a|an)\\s+/i,\n    /^Try (a|an)\\s+/i,\n    /^Consider (a|an)\\s+/i,\n    /^Post (a|an)\\s+/i,\n    /^Share (a|an)\\s+/i,\n    /^Show (a|an)\\s+/i,\n    /^POV:\\s*/i,\n    /^Video series:\\s*/i,\n    /^\"?secret\"?\\s*/i  // Any remaining \"secret\" at start\n  ];\n\n  let cleaned = text;\n  for (const pattern of patterns) {\n    const before = cleaned;\n    cleaned = cleaned.replace(pattern, '');\n    if (before !== cleaned) {\n      console.warn('[SynapseGenerator] Removed pattern:', pattern.toString().substring(0, 50));\n    }\n  }\n\n  // Remove \"secret\" from anywhere in the text (it's a meta-instruction artifact)\n  if (cleaned.toLowerCase().includes('secret')) {\n    console.warn('[SynapseGenerator] Removing \"secret\" from text');\n    cleaned = cleaned.replace(/\\bsecret\\b\\s*/gi, '');\n  }\n\n  // If we removed something, capitalize the first letter\n  if (cleaned !== text && cleaned.length > 0) {\n    cleaned = cleaned.charAt(0).toUpperCase() + cleaned.slice(1);\n  }\n\n  // Clean up multiple spaces\n  cleaned = cleaned.replace(/\\s{2,}/g, ' ').trim();\n\n  if (cleaned !== text) {\n    console.log('[SynapseGenerator] Cleaned text:', text.substring(0, 80), '→', cleaned.substring(0, 80));\n  }\n\n  return cleaned;\n}\n\n/**\n * Transform raw data points into detailed data sources for provenance\n */\nfunction transformToDetailedDataSources(dataPoints: any[]): any[] {\n  if (!dataPoints || dataPoints.length === 0) return [];\n\n  // Group data points by source\n  const grouped = new Map<string, any[]>();\n\n  for (const point of dataPoints) {\n    const source = point.source || 'unknown';\n    if (!grouped.has(source)) {\n      grouped.set(source, []);\n    }\n    grouped.get(source)!.push({\n      type: point.type,\n      content: point.content,\n      metadata: point.metadata,\n      confidence: point.confidence,\n      timestamp: point.timestamp\n    });\n  }\n\n  // Convert to array format\n  return Array.from(grouped.entries()).map(([source, dataPoints]) => ({\n    source,\n    dataPoints\n  }));\n}\n\n/**\n * Generate synapses using simple single-model approach\n */\nexport async function generateSynapses(\n  input: SynapseInput\n): Promise<SynapseResult> {\n  const startTime = Date.now();\n  console.log(`[Synapse] Starting generation for ${input.business.name}...`);\n\n  // ==========================================================================\n  // STEP 0: Transform detailed data points for provenance\n  // ==========================================================================\n  const detailedDataSources = input.detailedDataPoints\n    ? transformToDetailedDataSources(input.detailedDataPoints)\n    : [];\n\n  if (detailedDataSources.length > 0) {\n    console.log(`[Synapse] Transformed ${input.detailedDataPoints?.length} data points into ${detailedDataSources.length} source groups for provenance`);\n  }\n\n  // ==========================================================================\n  // STEP 1: Calculate Cost Equivalences\n  // ==========================================================================\n  console.log('[Synapse] Step 1: Calculating cost equivalences...');\n\n  const services = input.business.services || getIndustryExamples(input.business.industry);\n  const costEquivalences = services.length > 0\n    ? services.map(service => calculateCostEquivalences(service))\n    : [];\n\n  const costEquivalenceText = costEquivalences.length > 0\n    ? costEquivalences.map(eq => formatCostEquivalences(eq)).join('\\n\\n')\n    : 'No service costs provided for equivalence calculation.';\n\n  console.log(`[Synapse] Found ${costEquivalences.length} cost equivalence sets`);\n\n  // ==========================================================================\n  // STEP 2: Generate Semantic Connection Hints\n  // ==========================================================================\n  console.log('[Synapse] Step 2: Generating connection hints...');\n\n  const dataSources = createDataSourcesFromIntelligence(input.intelligence);\n  const connectionResult = await generateConnectionHints(dataSources, {\n    minSimilarity: 0.65,\n    maxHints: 5,\n    prioritizeCrossDomain: true\n  });\n\n  const connectionHintText = formatHintsForPrompt(connectionResult);\n  console.log(`[Synapse] Found ${connectionResult.hints.length} connection hints`);\n\n  // ==========================================================================\n  // STEP 3: Build Comprehensive Data Context\n  // ==========================================================================\n  console.log('[Synapse] Step 3: Building data context...');\n\n  const dataContext = buildDataContext(input.intelligence);\n\n  // ==========================================================================\n  // STEP 4: Build Synapse Prompt\n  // ==========================================================================\n  console.log('[Synapse] Step 4: Building prompt...');\n\n  const prompt = buildSynapsePrompt({\n    business: input.business,\n    dataContext,\n    costEquivalenceText,\n    connectionHintText\n  });\n\n  // ==========================================================================\n  // STEP 5: Call Claude 3.5 Sonnet\n  // ==========================================================================\n  console.log('[Synapse] Step 5: Calling Claude 3.5 Sonnet...');\n\n  const claudeResponse = await callClaude(prompt);\n\n  // ==========================================================================\n  // STEP 6: Parse Response into Synapses\n  // ==========================================================================\n  console.log('[Synapse] Step 6: Parsing response...');\n\n  const synapses = parseClaudeResponse(claudeResponse, input.business, detailedDataSources);\n\n  const generationTimeMs = Date.now() - startTime;\n  const totalCost = connectionResult.cost + (claudeResponse.usage?.total_tokens || 0) * 0.000015; // Sonnet pricing\n\n  console.log(`[Synapse] ✓ Generated ${synapses.length} synapses in ${generationTimeMs}ms`);\n  console.log(`[Synapse] Total cost: $${totalCost.toFixed(4)}`);\n\n  return {\n    synapses,\n    metadata: {\n      generationTimeMs,\n      costEquivalencesUsed: costEquivalences.length,\n      connectionHintsUsed: connectionResult.hints.length,\n      totalCost,\n      model: 'claude-3-5-sonnet-20241022'\n    }\n  };\n}\n\n/**\n * Extract business specialization from DeepContext\n */\nfunction extractBusinessSpecialization(intelligence: any): {\n  specialization: string;\n  targetAudience: string[];\n  valueProps: string[];\n  differentiators: string[];\n} {\n  const result = {\n    specialization: '',\n    targetAudience: [] as string[],\n    valueProps: [] as string[],\n    differentiators: [] as string[]\n  };\n\n  console.log('[SynapseGenerator] Extracting specialization from DeepContext...');\n  console.log('[SynapseGenerator] Available sections:', Object.keys(intelligence || {}));\n\n  // Try multiple possible locations for website data\n  const sections = [\n    intelligence?.business?.uniqueAdvantages || [],\n    intelligence?.competitiveIntel?.opportunities || [],\n    intelligence?.competitiveIntel?.blindSpots || [],\n    intelligence?.customerPsychology?.behavioral || [],\n    intelligence?.customerPsychology?.unarticulated || [],\n    intelligence?.customerPsychology?.emotional || [],\n    intelligence?.synthesis?.keyInsights || []\n  ];\n\n  sections.forEach(section => {\n    if (Array.isArray(section)) {\n      section.forEach((item: any) => {\n        const content = typeof item === 'string' ? item : item.content || item;\n        if (!content || typeof content !== 'string') return;\n\n        const lower = content.toLowerCase();\n\n        // Target audience patterns (broader)\n        if (lower.match(/(owner|collector|enthusiast|client|customer|reader|book lover|community|local|neighborhood)/i)) {\n          result.targetAudience.push(content);\n        }\n\n        // Specialization/differentiator patterns (MUCH BROADER)\n        if (lower.match(/(specialist|expert|premium|luxury|rare|classic|exotic|vintage|unique|specialized|exclusive|independent|locally[-\\s]owned|curated|handpicked|personal|custom|boutique|artisan|family[-\\s]owned|authentic|original|established|trusted|experienced|dedicated|passionate|community|local)/i)) {\n          result.differentiators.push(content);\n        }\n\n        // Value prop patterns (broader)\n        if (lower.match(/(coverage|protection|value|service|guarantee|ensure|support|help|provide|offer|deliver|create|experience|selection|quality|expertise|knowledge|advice|guidance)/i)) {\n          result.valueProps.push(content);\n        }\n\n        // If no matches but content seems valuable, add to differentiators anyway\n        if (!lower.match(/(owner|collector|enthusiast|client|customer|reader|book lover|community|local|neighborhood|specialist|expert|premium|luxury|rare|classic|exotic|vintage|unique|specialized|exclusive|independent|locally[-\\s]owned|curated|handpicked|personal|custom|boutique|artisan|family[-\\s]owned|authentic|original|established|trusted|experienced|dedicated|passionate|community|local|coverage|protection|value|service|guarantee|ensure|support|help|provide|offer|deliver|create|experience|selection|quality|expertise|knowledge|advice|guidance)/i) &&\n            content.length > 20 && content.length < 200) {\n          result.differentiators.push(content);\n        }\n      });\n    }\n  });\n\n  // Build specialization from differentiators\n  if (result.differentiators.length > 0) {\n    result.specialization = result.differentiators[0];\n    console.log('[SynapseGenerator] Found specialization:', result.specialization);\n  } else {\n    console.warn('[SynapseGenerator] NO SPECIALIZATION FOUND - will use generic industry');\n  }\n\n  console.log('[SynapseGenerator] Extraction results:', {\n    specialization: result.specialization,\n    targetAudience: result.targetAudience.length,\n    valueProps: result.valueProps.length,\n    differentiators: result.differentiators.length\n  });\n\n  return result;\n}\n\n/**\n * Build data context from intelligence\n */\nfunction buildDataContext(intelligence: any): string {\n  let context = '';\n\n  // CRITICAL: Extract business specialization from website analysis FIRST\n  const specialization = extractBusinessSpecialization(intelligence);\n\n  if (specialization.specialization || specialization.targetAudience.length > 0 ||\n      specialization.valueProps.length > 0 || specialization.differentiators.length > 0) {\n    context += '### BUSINESS SPECIALIZATION (from website analysis)\\n';\n\n    if (specialization.specialization) {\n      context += `**What They Actually Specialize In:** ${specialization.specialization}\\n`;\n    }\n\n    if (specialization.targetAudience.length > 0) {\n      context += `**Their Actual Target Audience:** ${specialization.targetAudience.slice(0, 3).join(', ')}\\n`;\n    }\n\n    if (specialization.differentiators.length > 0) {\n      context += `**What Makes Them Unique:** ${specialization.differentiators.slice(0, 3).join(', ')}\\n`;\n    }\n\n    context += '\\n**CRITICAL: Generate content about THEIR SPECIALIZATION, not generic industry content!**\\n\\n';\n  }\n\n  // Trending Topics (from realTimeCultural)\n  if (intelligence.realTimeCultural?.trending?.topics && intelligence.realTimeCultural.trending.topics.length > 0) {\n    context += '### Trending Topics\\n';\n    for (const topic of intelligence.realTimeCultural.trending.topics.slice(0, 10)) {\n      const topicText = typeof topic === 'string' ? topic : topic.term || topic.topic || topic;\n      context += `- ${topicText}\\n`;\n    }\n    context += '\\n';\n  }\n\n  // Competitive Opportunities (from competitiveIntel)\n  if (intelligence.competitiveIntel?.opportunities && intelligence.competitiveIntel.opportunities.length > 0) {\n    context += '### What Competitors Are Missing (Opportunities)\\n';\n    for (const opp of intelligence.competitiveIntel.opportunities.slice(0, 10)) {\n      const oppText = typeof opp === 'string' ? opp : opp.opportunity || opp.description || opp;\n      context += `- ${oppText}\\n`;\n    }\n    context += '\\n';\n  }\n\n  // Customer Psychology - Behavioral Triggers\n  if (intelligence.customerPsychology?.behavioral && intelligence.customerPsychology.behavioral.length > 0) {\n    context += '### Customer Behavioral Triggers\\n';\n    for (const trigger of intelligence.customerPsychology.behavioral.slice(0, 8)) {\n      const triggerText = typeof trigger === 'string' ? trigger : trigger.trigger || trigger.description || trigger;\n      context += `- ${triggerText}\\n`;\n    }\n    context += '\\n';\n  }\n\n  // Customer Psychology - Unarticulated Needs\n  if (intelligence.customerPsychology?.unarticulated && intelligence.customerPsychology.unarticulated.length > 0) {\n    context += '### Customer Unarticulated Needs\\n';\n    for (const need of intelligence.customerPsychology.unarticulated.slice(0, 5)) {\n      const needText = typeof need === 'string' ? need : need.need || need.description || need;\n      context += `- ${needText}\\n`;\n    }\n    context += '\\n';\n  }\n\n  // Synthesis Insights\n  if (intelligence.synthesis?.keyInsights && intelligence.synthesis.keyInsights.length > 0) {\n    context += '### Key Insights\\n';\n    for (const insight of intelligence.synthesis.keyInsights.slice(0, 5)) {\n      const insightText = typeof insight === 'string' ? insight : insight.insight || insight;\n      context += `- ${insightText}\\n`;\n    }\n    context += '\\n';\n  }\n\n  return context || 'No real-time intelligence data available.';\n}\n\n/**\n * Build the synapse prompt\n */\nfunction buildSynapsePrompt(params: {\n  business: any;\n  dataContext: string;\n  costEquivalenceText: string;\n  connectionHintText: string;\n}): string {\n  // Get current date for seasonal context\n  const now = new Date();\n  const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',\n    'July', 'August', 'September', 'October', 'November', 'December'];\n  const currentDate = `${monthNames[now.getMonth()]} ${now.getDate()}, ${now.getFullYear()}`;\n\n  return `You are a business marketing strategist who creates engaging content that DRIVES CUSTOMER ACTION.\n\nYour job: Find insights that are BOTH engaging AND business-focused, with clear calls-to-action that drive visits, bookings, purchases, or inquiries.\n\nBUSINESS: ${params.business.name} (${params.business.industry})\nLOCATION: ${params.business.location.city}, ${params.business.location.state}\nTODAY'S DATE: ${currentDate}\n\n${params.dataContext}\n\n${params.costEquivalenceText}\n\n${params.connectionHintText}\n\n---\n\nCRITICAL FACT-CHECKING RULES:\n\n1. WEATHER & SEASONS: Use CURRENT weather and season data from the context above. It is ${currentDate} - do NOT reference summer, heat waves, or hot weather unless the weather data specifically shows that. Use actual current conditions and upcoming seasonal transitions.\n\n2. NO FALSE URGENCY: Do NOT create fake deadlines or urgency unless there's ACTUAL supporting data:\n   ❌ \"The next 72 hours are crucial\" (unless there's actual weather/event data showing this)\n   ❌ \"You only have until Friday\" (unless there's a real deadline)\n   ❌ \"Winter is coming\" in November in Austin, TX (it doesn't freeze there until late December/January)\n   ✅ \"Holiday entertaining season is starting\" (factually true in November)\n   ✅ \"Fall planting window is closing\" (if weather data supports this)\n\n3. VERIFY CLAIMS: Only make claims you can support with the data provided. If you don't have weather data showing freezing temps, don't claim urgency around freezing. If you don't have event data, don't invent events.\n\nYOUR TASK: Generate 3 business-focused content ideas that connect behavioral insights to customer action.\n\nWHAT MAKES GREAT BUSINESS CONTENT:\n\nFor a Bar/Pub:\n❌ \"Getting drunk at our bar is your toxic trait\" (irresponsible, legal liability)\n❌ \"Taylor Swift Eras cocktails\" (dated reference, no business purpose)\n✅ \"Thursday nights in Uptown - when 'one drink' turns into reconnecting with your college friends. That's why we added the nostalgia playlist. Reserve your table.\" (relatable + clear CTA)\n\nFor a Coffee Cart:\n❌ \"We're the wedding crashers but everyone loves us\" (no clear value)\n❌ \"Save $500 on coffee service vs venue pricing\" (ROI/cost-saving angle)\n✅ \"Wedding planners: Your 3pm ceremony energy slump? We handle it. Mobile espresso bar shows up at golden hour. Guests stay energized through speeches. DM to add us to your next event.\" (problem + solution + CTA)\n\nFor a Local Business:\n❌ \"Mercury Retrograde vibes at the office\" (random, no purpose)\n✅ \"Dallas mornings hit different when your usual spot is packed. We're the quiet alternative with the strong cold brew locals know about. Find us on Oak Lawn.\" (relatable + clear direction)\n\nRULES FOR BUSINESS CONTENT:\n1. ✅ BUSINESS PURPOSE - Every insight must lead to a clear action (visit, book, try, join, inquire)\n2. ✅ PROFESSIONAL TONE - Match small business owner voice, not Gen Z social media manager\n3. ✅ LEGALLY SAFE - No irresponsible messaging (avoid \"get drunk\", liability issues)\n4. ✅ BEHAVIORAL INSIGHTS - Focus on customer behavior patterns, timing, needs\n5. ✅ CLEAR VALUE - What problem does this solve? What experience does it create?\n6. ✅ ACTIONABLE CTA - Every insight needs a next step (visit, book, DM, try, find us)\n7. ✅ RELEVANT HOOKS - Weather, local events, seasonal moments (but not memes)\n8. ❌ NO VIRAL MEMES - No TikTok sounds, dated trends (Taylor Swift Eras), Gen Z slang\n9. ❌ NO IRRESPONSIBLE CONTENT - No encouraging excessive drinking, risky behavior\n10. ❌ NO ROI/COST-SAVING ANGLES - No \"save money\", \"cut costs\", \"increase productivity\", \"improve ROI\"\n11. ✅ FRAMEWORK-READY - Insights should work with Hook-Story-Offer, AIDA, PAS structures\n\nTONE GUIDELINES BY INDUSTRY:\n- Bar/Pub: Welcoming, community-focused, responsible (\"great night out\" not \"get drunk\")\n- Coffee/Food: Service-focused, problem-solving, professional\n- Events: Value-demonstrating, reliability-focused\n- Professional Services: Authority-building, trust-focused\n\nCRITICAL RULES FOR contentAngle:\n1. Write the ACTUAL CONTENT HOOK - exactly what the headline should say\n2. NEVER include meta-instructions like \"Start with\", \"Begin with\", \"Create a\", etc.\n3. NEVER use the word \"secret\" anywhere in your content (it's a meta-instruction artifact)\n4. Write as if you're posting directly to social media\n\nBAD contentAngle: \"Start with 'secret' Video series showing...\"\nGOOD contentAngle: \"The quiet coffee shop locals know about when the main street is packed\"\n\nBAD contentAngle: \"Guest room isn't secret ready\" (uses \"secret\" as a word)\nGOOD contentAngle: \"When your in-laws announce their visit and your guest room needs an upgrade\"\n\nBAD insight: \"Taylor Swift fans love themed cocktails\"\nGOOD insight: \"Thursday nights in Dallas - when coworkers become friends over drinks, not just small talk\"\n\nOUTPUT FORMAT (JSON):\n\n{\n  \"synapses\": [\n    {\n      \"title\": \"Hook-style title that captures attention\",\n      \"insight\": \"The behavioral insight (customer-focused, business-appropriate)\",\n      \"whyProfound\": \"Why this matters to the customer and business\",\n      \"whyNow\": \"2-3 sentences explaining why this timing/moment matters with specific details (seasonal, local, behavioral)\",\n      \"evidencePoints\": [\"Specific example or proof point 1\", \"Specific example or proof point 2\", \"Specific example or proof point 3\"],\n      \"psychologyPrinciple\": \"The psychological/behavioral principle at work\",\n      \"contentAngle\": \"THE ACTUAL CONTENT HOOK - ready to use as headline\",\n      \"expectedReaction\": \"What customer action or emotional response this drives\",\n      \"callToAction\": \"Clear next step (visit, book, DM, try, find us, call)\",\n      \"dataUsed\": [\"weather\", \"local event\", \"behavioral pattern\", \"seasonal timing\"],\n      \"confidence\": 0.85,\n\n      \"provenance\": {\n        \"rawDataSources\": [\n          {\n            \"platform\": \"google-reviews\",\n            \"content\": \"Actual quote from review that triggered this\",\n            \"sentiment\": \"negative\"\n          }\n        ],\n        \"reasoning\": \"1-2 sentence explanation of how the data led to this insight\"\n      }\n    }\n  ]\n}\n\nCRITICAL REQUIREMENTS:\n1. Make whyNow 2-3 full sentences with specific details\n2. Include evidencePoints with 2-3 concrete examples\n3. Include provenance with 1-2 actual data quotes and brief reasoning\n4. Each synapse should be complete but concise\n\nGenerate EXACTLY 3 business-focused insights that DRIVE CUSTOMER ACTION. Content must be engaging but professional, with clear CTAs that lead to visits, bookings, or inquiries.`;\n}\n\n/**\n * Call Claude 3.5 Sonnet via OpenRouter\n */\nasync function callClaude(prompt: string): Promise<any> {\n  const openRouterKey = import.meta.env.VITE_OPENROUTER_API_KEY;\n\n  if (!openRouterKey) {\n    throw new Error('No OpenRouter API key found');\n  }\n\n  const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {\n    method: 'POST',\n    headers: {\n      'Authorization': `Bearer ${openRouterKey}`,\n      'Content-Type': 'application/json',\n      'HTTP-Referer': 'https://marba-agent.app',\n      'X-Title': 'MARBA.ai Synapse Generator'\n    },\n    body: JSON.stringify({\n      model: 'anthropic/claude-3.5-sonnet',\n      max_tokens: 16384,  // Increased to allow 3 synapses with full provenance (~5k tokens each)\n      temperature: 0.8,\n      messages: [{\n        role: 'user',\n        content: prompt\n      }]\n    })\n  });\n\n  if (!response.ok) {\n    const errorText = await response.text();\n    throw new Error(`OpenRouter API error: ${response.statusText} - ${errorText}`);\n  }\n\n  const data = await response.json();\n\n  // OpenRouter returns the response in data.choices[0].message.content\n  if (!data.choices || data.choices.length === 0) {\n    throw new Error('No response from OpenRouter');\n  }\n\n  // Log finish reason to detect truncation\n  const finishReason = data.choices[0].finish_reason;\n  if (finishReason === 'length') {\n    console.warn('[Synapse] ⚠️ Response truncated due to max_tokens limit!');\n    console.warn('[Synapse] Consider increasing max_tokens or simplifying the prompt');\n  }\n\n  console.log('[Synapse] Response finish_reason:', finishReason);\n  console.log('[Synapse] Response length:', data.choices[0].message.content.length, 'characters');\n\n  // Return in the same format as before\n  return {\n    content: [{\n      text: data.choices[0].message.content\n    }],\n    usage: data.usage\n  };\n}\n\n/**\n * Parse Claude response into SynapseInsight objects\n */\nfunction parseClaudeResponse(response: any, business: any, detailedDataSources: any[]): SynapseInsight[] {\n  try {\n    // Extract text content\n    const content = response.content[0]?.text || '';\n\n    // Find JSON in response\n    const jsonMatch = content.match(/\\{[\\s\\S]*\"synapses\"[\\s\\S]*\\}/);\n    if (!jsonMatch) {\n      console.error('[Synapse] No JSON found in response');\n      console.error('[Synapse] Response content:', content.substring(0, 500));\n      return [];\n    }\n\n    let parsed;\n    try {\n      parsed = JSON.parse(jsonMatch[0]);\n    } catch (parseError) {\n      // Try to fix common JSON issues\n      console.error('[Synapse] Initial JSON parse failed, attempting recovery...');\n      let fixedJson = jsonMatch[0];\n\n      // 1. Remove comments (both // and /* */)\n      fixedJson = fixedJson.replace(/\\/\\/.*$/gm, ''); // Remove // comments\n      fixedJson = fixedJson.replace(/\\/\\*[\\s\\S]*?\\*\\//g, ''); // Remove /* */ comments\n\n      // 2. Fix trailing commas\n      fixedJson = fixedJson.replace(/,(\\s*[}\\]])/g, '$1');\n\n      // 3. Handle incomplete JSON by trying to close arrays/objects\n      const openBraces = (fixedJson.match(/{/g) || []).length;\n      const closeBraces = (fixedJson.match(/}/g) || []).length;\n      const openBrackets = (fixedJson.match(/\\[/g) || []).length;\n      const closeBrackets = (fixedJson.match(/\\]/g) || []).length;\n\n      // Add missing closing brackets\n      if (openBrackets > closeBrackets) {\n        for (let i = 0; i < openBrackets - closeBrackets; i++) {\n          fixedJson += ']';\n        }\n      }\n\n      // Add missing closing braces\n      if (openBraces > closeBraces) {\n        for (let i = 0; i < openBraces - closeBraces; i++) {\n          fixedJson += '}';\n        }\n      }\n\n      try {\n        parsed = JSON.parse(fixedJson);\n        console.log('[Synapse] ✅ JSON recovery successful!');\n      } catch (secondError) {\n        console.error('[Synapse] ❌ JSON recovery failed after fixes');\n        console.error('[Synapse] JSON length:', jsonMatch[0].length, 'characters');\n        console.error('[Synapse] First 1000 chars:', jsonMatch[0].substring(0, 1000));\n        console.error('[Synapse] Last 500 chars:', jsonMatch[0].substring(jsonMatch[0].length - 500));\n        return [];\n      }\n    }\n\n    const synapses = parsed.synapses || [];\n\n    // Convert to SynapseInsight format\n    return synapses.map((bt: any, index: number) => ({\n      id: `simple-${Date.now()}-${index}`,\n      type: 'counter_intuitive',\n      thinkingStyle: 'analytical',\n      insight: cleanMetaInstructions(bt.insight || ''),\n      whyProfound: bt.whyProfound || bt.psychologyPrinciple || '',\n      whyNow: bt.whyNow || `Based on current ${(bt.dataUsed || []).join(', ')}`,\n      contentAngle: cleanMetaInstructions(bt.contentAngle || ''),\n      expectedReaction: bt.expectedReaction,\n      // Use evidencePoints from Claude response if available\n      evidence: bt.evidencePoints || [],\n      confidence: bt.confidence || 0.75,\n      metadata: {\n        generatedAt: new Date(),\n        model: 'claude-3-5-sonnet-20241022',\n        tokensUsed: response.usage?.total_tokens,\n        generationTimeMs: 0\n      },\n      // Additional fields for display\n      title: bt.title,\n      psychologyPrinciple: bt.psychologyPrinciple,\n      dataUsed: bt.dataUsed,\n      callToAction: bt.callToAction,  // Capture CTA from prompt response\n\n      // DEEP PROVENANCE: Capture the provenance data from Claude + add detailedDataSources\n      deepProvenance: {\n        ...(bt.provenance || {}),\n        detailedDataSources  // Add the transformed data sources for complete transparency\n      }\n    } as any));\n\n  } catch (error) {\n    console.error('[Synapse] Error parsing response:', error);\n    return [];\n  }\n}\n","/**\n * Power Word Optimizer\n *\n * Enhances content by identifying opportunities to use power words\n * and optimizing for psychological impact.\n *\n * Created: 2025-11-10\n */\n\nimport type {\n  ContentDraft,\n  PowerWord,\n  PowerWordCategory,\n  PowerWordSuggestion,\n  OptimizationOpportunity,\n  BusinessProfile\n} from '@/types/synapseContent.types';\n\n// Import power words database\nimport powerWordsData from '@/data/synapse/powerWords.json';\n\nexport class PowerWordOptimizer {\n  private powerWords: Map<PowerWordCategory, PowerWord[]>;\n  private phrases: typeof powerWordsData.phrases;\n  private industryWords: typeof powerWordsData.industry_specific;\n\n  constructor() {\n    this.powerWords = this.loadPowerWords();\n    this.phrases = powerWordsData.phrases;\n    this.industryWords = powerWordsData.industry_specific;\n  }\n\n  /**\n   * Load power words from database\n   */\n  private loadPowerWords(): Map<PowerWordCategory, PowerWord[]> {\n    const map = new Map<PowerWordCategory, PowerWord[]>();\n\n    Object.entries(powerWordsData.categories).forEach(([category, data]) => {\n      const words = data.words.map(w => ({\n        word: w.word,\n        category: category as PowerWordCategory,\n        impact: w.impact,\n        context: w.context,\n        alternatives: w.alternatives\n      }));\n\n      map.set(category as PowerWordCategory, words);\n    });\n\n    return map;\n  }\n\n  /**\n   * Optimize content draft\n   */\n  async optimize(\n    content: ContentDraft,\n    business?: BusinessProfile\n  ): Promise<ContentDraft> {\n    console.log('[PowerWordOptimizer] Optimizing content...');\n\n    // Find optimization opportunities\n    const opportunities = this.findOpportunities(content, business);\n\n    console.log(`[PowerWordOptimizer] Found ${opportunities.length} optimization opportunities`);\n\n    // Sort by impact (highest first)\n    const sortedOpportunities = opportunities\n      .sort((a, b) => b.suggestion.impact - a.suggestion.impact);\n\n    // Apply top 5-7 suggestions (don't over-optimize)\n    const toApply = sortedOpportunities\n      .filter(opp => opp.suggestion.impact > 0.3)\n      .slice(0, 7);\n\n    console.log(`[PowerWordOptimizer] Applying ${toApply.length} optimizations`);\n\n    let optimized = { ...content };\n\n    // Apply suggestions\n    toApply.forEach(opp => {\n      if (opp.location === 'headline') {\n        optimized.headline = this.applySuggestion(optimized.headline, opp.suggestion);\n      } else if (opp.location === 'hook') {\n        optimized.hook = this.applySuggestion(optimized.hook, opp.suggestion);\n      } else if (opp.location === 'body') {\n        optimized.body = this.applySuggestion(optimized.body, opp.suggestion);\n      } else if (opp.location === 'cta') {\n        optimized.cta = this.applySuggestion(optimized.cta, opp.suggestion);\n      }\n    });\n\n    // Add industry-specific power words if available\n    if (business?.industry) {\n      optimized = this.addIndustryWords(optimized, business);\n    }\n\n    return optimized;\n  }\n\n  /**\n   * Find optimization opportunities\n   */\n  private findOpportunities(\n    content: ContentDraft,\n    business?: BusinessProfile\n  ): OptimizationOpportunity[] {\n    const opportunities: OptimizationOpportunity[] = [];\n\n    // Check each content section\n    opportunities.push(...this.analyzeSection(content.headline, 'headline', business));\n    opportunities.push(...this.analyzeSection(content.hook, 'hook', business));\n    opportunities.push(...this.analyzeSection(content.body, 'body', business));\n    opportunities.push(...this.analyzeSection(content.cta, 'cta', business));\n\n    return opportunities;\n  }\n\n  /**\n   * Analyze content section for opportunities\n   */\n  private analyzeSection(\n    text: string,\n    location: string,\n    business?: BusinessProfile\n  ): OptimizationOpportunity[] {\n    const opportunities: OptimizationOpportunity[] = [];\n    const words = text.toLowerCase().split(/\\s+/);\n\n    // Check for weak words that can be replaced\n    const weakWords = [\n      'very', 'really', 'quite', 'pretty', 'somewhat', 'fairly',\n      'good', 'bad', 'nice', 'great', 'thing', 'stuff'\n    ];\n\n    words.forEach((word, index) => {\n      if (weakWords.includes(word)) {\n        const context = words.slice(Math.max(0, index - 2), index + 3).join(' ');\n        const suggestion = this.suggestPowerWord(word, context, location);\n\n        if (suggestion) {\n          opportunities.push({\n            location,\n            phrase: word,\n            context,\n            suggestion,\n            priority: suggestion.impact > 0.6 ? 'high' : suggestion.impact > 0.4 ? 'medium' : 'low'\n          });\n        }\n      }\n    });\n\n    // Check for missing power words in key positions\n    if (location === 'headline' || location === 'hook') {\n      const hasPowerWord = this.containsPowerWord(text);\n      if (!hasPowerWord) {\n        const suggestion = this.suggestPowerWordForPosition(location, text);\n        if (suggestion) {\n          opportunities.push({\n            location,\n            phrase: text.substring(0, 30),\n            context: text,\n            suggestion,\n            priority: 'high'\n          });\n        }\n      }\n    }\n\n    return opportunities;\n  }\n\n  /**\n   * Suggest power word replacement\n   */\n  private suggestPowerWord(\n    originalWord: string,\n    context: string,\n    location: string\n  ): PowerWordSuggestion | null {\n    // Determine appropriate category based on location\n    let targetCategory: PowerWordCategory;\n\n    if (location === 'headline' || location === 'hook') {\n      targetCategory = 'curiosity';\n    } else if (location === 'cta') {\n      targetCategory = 'urgency';\n    } else {\n      targetCategory = 'transformation';\n    }\n\n    const categoryWords = this.powerWords.get(targetCategory) || [];\n\n    // Find appropriate replacement\n    const candidates = categoryWords.filter(pw =>\n      pw.context.some(c => context.toLowerCase().includes(c.toLowerCase()))\n    );\n\n    if (candidates.length === 0) {\n      // Fallback to any power word in category\n      const fallback = categoryWords[0];\n      if (fallback) {\n        return {\n          original: originalWord,\n          suggestion: fallback.word,\n          category: targetCategory,\n          impact: fallback.impact * 0.5, // Lower impact for generic replacement\n          reason: `Replace weak word \"${originalWord}\" with power word \"${fallback.word}\"`\n        };\n      }\n      return null;\n    }\n\n    // Use highest impact candidate\n    const best = candidates.sort((a, b) => b.impact - a.impact)[0];\n\n    return {\n      original: originalWord,\n      suggestion: best.word,\n      category: targetCategory,\n      impact: best.impact,\n      reason: `\"${best.word}\" (${targetCategory}) is ${(best.impact * 100).toFixed(0)}% more impactful than \"${originalWord}\"`\n    };\n  }\n\n  /**\n   * Suggest power word for specific position\n   *\n   * NOTE: DO NOT suggest adding power words to headlines - it creates meta-instruction artifacts\n   * like \"Start with 'secret'\" which leak into content. Headlines should be generated clean.\n   */\n  private suggestPowerWordForPosition(\n    location: string,\n    text: string\n  ): PowerWordSuggestion | null {\n    // DISABLED: This was causing \"Start with 'secret'\" to be prepended to headlines\n    // Headlines are already optimized during generation\n    return null;\n\n    /* ORIGINAL CODE - REMOVED DUE TO META-INSTRUCTION LEAKAGE:\n    if (location === 'headline') {\n      // Suggest curiosity or transformation words\n      const curiosityWords = this.powerWords.get('curiosity') || [];\n      const best = curiosityWords[0];\n\n      if (best) {\n        return {\n          original: '',\n          suggestion: `Start with \"${best.word}\"`,  // BUG: This creates meta-instructions!\n          category: 'curiosity',\n          impact: best.impact,\n          reason: `Headlines with curiosity words get ${(best.impact * 100).toFixed(0)}% more engagement`\n        };\n      }\n    }\n\n    return null;\n    */\n  }\n\n  /**\n   * Check if text contains power word\n   */\n  private containsPowerWord(text: string): boolean {\n    const lowerText = text.toLowerCase();\n\n    for (const words of this.powerWords.values()) {\n      for (const pw of words) {\n        if (lowerText.includes(pw.word.toLowerCase())) {\n          return true;\n        }\n      }\n    }\n\n    return false;\n  }\n\n  /**\n   * Apply suggestion to text\n   */\n  private applySuggestion(text: string, suggestion: PowerWordSuggestion): string {\n    if (!suggestion.original) {\n      // Adding new power word\n      return `${suggestion.suggestion} ${text}`;\n    }\n\n    // Replace original with suggestion\n    const regex = new RegExp(`\\\\b${suggestion.original}\\\\b`, 'gi');\n    return text.replace(regex, suggestion.suggestion);\n  }\n\n  /**\n   * Add industry-specific power words\n   */\n  private addIndustryWords(\n    content: ContentDraft,\n    business: BusinessProfile\n  ): ContentDraft {\n    const industryKey = this.getIndustryKey(business.industry);\n    const industryData = this.industryWords[industryKey as keyof typeof this.industryWords];\n\n    if (!industryData) {\n      return content;\n    }\n\n    // Try to incorporate industry power words naturally\n    const industryPowerWords = industryData.power_words || [];\n\n    // Check if body already contains industry words\n    const bodyLower = content.body.toLowerCase();\n    const missingWords = industryPowerWords.filter(\n      word => !bodyLower.includes(word.toLowerCase())\n    );\n\n    // Add 1-2 missing industry words if appropriate\n    if (missingWords.length > 0 && content.body.length < 500) {\n      const wordsToAdd = missingWords.slice(0, 2);\n      // Simple addition (in real implementation, use NLP to find natural insertion points)\n      console.log(`[PowerWordOptimizer] Consider adding industry words: ${wordsToAdd.join(', ')}`);\n    }\n\n    return content;\n  }\n\n  /**\n   * Get industry key from business industry\n   */\n  private getIndustryKey(industry: string): string {\n    const lowerIndustry = industry.toLowerCase();\n\n    if (lowerIndustry.includes('roof')) return 'roofing';\n    if (lowerIndustry.includes('legal') || lowerIndustry.includes('law')) return 'legal';\n    if (lowerIndustry.includes('health') || lowerIndustry.includes('medical')) return 'healthcare';\n    if (lowerIndustry.includes('real estate') || lowerIndustry.includes('property')) return 'real_estate';\n\n    return 'general_business';\n  }\n\n  /**\n   * Extract all power words from content\n   */\n  extractPowerWords(text: string): string[] {\n    const found: string[] = [];\n    const lowerText = text.toLowerCase();\n\n    for (const words of this.powerWords.values()) {\n      for (const pw of words) {\n        if (lowerText.includes(pw.word.toLowerCase())) {\n          found.push(pw.word);\n        }\n      }\n    }\n\n    return found;\n  }\n\n  /**\n   * Get power words by category\n   */\n  getPowerWordsByCategory(category: PowerWordCategory): PowerWord[] {\n    return this.powerWords.get(category) || [];\n  }\n\n  /**\n   * Get curiosity gap phrases\n   */\n  getCuriosityGapPhrases(): string[] {\n    return this.phrases.curiosity_gaps;\n  }\n\n  /**\n   * Get urgency trigger phrases\n   */\n  getUrgencyTriggerPhrases(): string[] {\n    return this.phrases.urgency_triggers;\n  }\n\n  /**\n   * Get social proof phrases\n   */\n  getSocialProofPhrases(): string[] {\n    return this.phrases.social_proof;\n  }\n\n  /**\n   * Get transformation promise phrases\n   */\n  getTransformationPhrases(): string[] {\n    return this.phrases.transformation_promises;\n  }\n\n  /**\n   * Get CTAs for specific goal\n   */\n  getCTAsForGoal(goal: 'engagement' | 'lead_generation' | 'viral'): string[] {\n    const ctas = powerWordsData.cta_formulas;\n    return ctas[goal] || ctas.engagement;\n  }\n\n  /**\n   * Predict impact of content\n   */\n  predictImpact(content: ContentDraft): number {\n    const powerWords = this.extractPowerWords(\n      `${content.headline} ${content.hook} ${content.body} ${content.cta}`\n    );\n\n    // Base score\n    let impact = 0.5;\n\n    // Add points for power words (max 0.3)\n    impact += Math.min(powerWords.length * 0.05, 0.3);\n\n    // Add points for headline power word\n    if (this.containsPowerWord(content.headline)) {\n      impact += 0.1;\n    }\n\n    // Add points for hook power word\n    if (this.containsPowerWord(content.hook)) {\n      impact += 0.1;\n    }\n\n    return Math.min(impact, 1.0);\n  }\n}\n","/**\n * Content Framework Library\n *\n * Comprehensive library of proven copywriting and content frameworks\n * for conversion-optimized content generation.\n *\n * Frameworks organized by:\n * - Social Media (LinkedIn, Twitter, Instagram)\n * - Email Marketing\n * - Blog Posts\n * - Landing Pages\n *\n * Each framework includes:\n * - Structure definition\n * - Psychology principles\n * - Use case recommendations\n * - Platform optimizations\n *\n * Created: 2025-11-11\n */\n\nimport type { SynapseInsight } from '@/types/synapse.types';\n\n// ============================================================================\n// FRAMEWORK TYPES\n// ============================================================================\n\nexport type FrameworkType =\n  // Social Media Frameworks\n  | 'hook-story-offer'\n  | 'problem-agitate-solution'\n  | 'aida'\n  | 'before-after-bridge'\n  | 'curiosity-gap'\n  | 'controversy-debate'\n\n  // Email Frameworks\n  | 'email-aida'\n  | 'email-pas'\n  | 'email-4ps'\n  | 'email-story'\n\n  // Blog Frameworks\n  | 'blog-how-to'\n  | 'blog-listicle'\n  | 'blog-ultimate-guide'\n  | 'blog-case-study'\n  | 'blog-comparison'\n\n  // Landing Page Frameworks\n  | 'landing-hero'\n  | 'landing-pastor'\n  | 'landing-storybrand'\n  | 'landing-problem-promise-proof-proposal';\n\nexport type ContentChannel = 'social' | 'email' | 'blog' | 'landing-page';\n\nexport type Platform = 'linkedin' | 'twitter' | 'instagram' | 'facebook' | 'generic';\n\nexport type ContentGoal =\n  | 'engagement'\n  | 'conversion'\n  | 'awareness'\n  | 'education'\n  | 'trust-building'\n  | 'lead-generation';\n\n// ============================================================================\n// FRAMEWORK DEFINITIONS\n// ============================================================================\n\nexport interface FrameworkStage {\n  name: string;\n  purpose: string;\n  guidelines: string[];\n  psychologyPrinciple?: string;\n  exampleFormulas?: string[];\n}\n\nexport interface ContentFramework {\n  id: FrameworkType;\n  name: string;\n  channel: ContentChannel;\n  description: string;\n  bestFor: string[];\n  stages: FrameworkStage[];\n  platforms?: Platform[];\n  lengthGuideline?: string;\n  conversionFocus: number; // 0-1, how conversion-focused\n  engagementFocus: number; // 0-1, how engagement-focused\n}\n\n// ============================================================================\n// SOCIAL MEDIA FRAMEWORKS\n// ============================================================================\n\nexport const HOOK_STORY_OFFER: ContentFramework = {\n  id: 'hook-story-offer',\n  name: 'Hook-Story-Offer',\n  channel: 'social',\n  description: 'Social media standard: grab attention, build connection, drive action',\n  bestFor: ['LinkedIn posts', 'Twitter threads', 'Instagram captions'],\n  platforms: ['linkedin', 'twitter', 'instagram'],\n  lengthGuideline: '200-500 words',\n  conversionFocus: 0.7,\n  engagementFocus: 0.9,\n  stages: [\n    {\n      name: 'Hook',\n      purpose: 'Stop the scroll - create pattern interrupt',\n      psychologyPrinciple: 'Curiosity Gap + Pattern Interrupt',\n      guidelines: [\n        'First 1-2 lines must grab attention',\n        'Use curiosity, controversy, or unexpected statement',\n        'Make it about the reader, not you',\n        'Avoid generic openings'\n      ],\n      exampleFormulas: [\n        '[Surprising Fact] that changes everything about [Topic]',\n        'I just realized [Uncomfortable Truth] about [Industry]',\n        'Stop [Common Action]. Here\\'s what to do instead.',\n        '[Big Number/Stat] + [Unexpected Insight]'\n      ]\n    },\n    {\n      name: 'Story',\n      purpose: 'Build connection through narrative',\n      psychologyPrinciple: 'Narrative Transportation + Empathy',\n      guidelines: [\n        'Share personal experience or case study',\n        'Make it relatable - show vulnerability',\n        'Include transformation or discovery',\n        'Use concrete details, not abstractions'\n      ],\n      exampleFormulas: [\n        'Here\\'s what happened when I [Action]...',\n        'I used to believe [Old Belief]. Then I discovered [New Truth]',\n        'Last week, I [Experience]. It revealed [Insight]'\n      ]\n    },\n    {\n      name: 'Offer',\n      purpose: 'Clear call-to-action with value',\n      psychologyPrinciple: 'Commitment + Reciprocity',\n      guidelines: [\n        'One clear CTA - don\\'t give too many options',\n        'Frame as opportunity, not demand',\n        'Provide clear next step',\n        'Optional: Add urgency or scarcity'\n      ],\n      exampleFormulas: [\n        'Want [Outcome]? [Simple Action]',\n        'I\\'m sharing [Resource]. Comment [Word] to get it',\n        'Ready to [Benefit]? Here\\'s how: [Action]'\n      ]\n    }\n  ]\n};\n\nexport const PROBLEM_AGITATE_SOLUTION: ContentFramework = {\n  id: 'problem-agitate-solution',\n  name: 'Problem-Agitate-Solution (PAS)',\n  channel: 'social',\n  description: 'Pain-focused framework: identify problem, amplify pain, provide solution',\n  bestFor: ['High-intent audiences', 'Problem-aware markets', 'Solution positioning'],\n  platforms: ['linkedin', 'twitter'],\n  lengthGuideline: '250-400 words',\n  conversionFocus: 0.9,\n  engagementFocus: 0.7,\n  stages: [\n    {\n      name: 'Problem',\n      purpose: 'Identify specific, relatable pain point',\n      psychologyPrinciple: 'Loss Aversion + Recognition',\n      guidelines: [\n        'Be specific - avoid generic problems',\n        'Use reader\\'s language (words they use)',\n        'Make it urgent and relevant now',\n        'Qualify your audience'\n      ],\n      exampleFormulas: [\n        'If you\\'re struggling with [Specific Problem]...',\n        '[Audience] face this challenge every day: [Problem]',\n        'You know that feeling when [Frustration]?'\n      ]\n    },\n    {\n      name: 'Agitate',\n      purpose: 'Amplify the pain - make problem feel urgent',\n      psychologyPrinciple: 'Loss Aversion Amplification',\n      guidelines: [\n        'Show what\\'s at stake (cost of inaction)',\n        'Use emotional language',\n        'Connect to bigger consequences',\n        'Don\\'t be manipulative - be honest'\n      ],\n      exampleFormulas: [\n        'Every day you don\\'t solve this, you\\'re losing [Cost]',\n        'Here\\'s what happens if this continues...',\n        'The worst part? [Compounding Consequence]'\n      ]\n    },\n    {\n      name: 'Solution',\n      purpose: 'Present clear path forward',\n      psychologyPrinciple: 'Relief + Hope',\n      guidelines: [\n        'Make solution feel achievable',\n        'Be specific about what changes',\n        'Include proof if possible',\n        'Clear call-to-action'\n      ],\n      exampleFormulas: [\n        'Here\\'s what works: [Solution]',\n        'I solved this by [Approach]. Here\\'s how you can too',\n        'The solution is simpler than you think: [Steps]'\n      ]\n    }\n  ]\n};\n\nexport const AIDA_SOCIAL: ContentFramework = {\n  id: 'aida',\n  name: 'AIDA (Attention-Interest-Desire-Action)',\n  channel: 'social',\n  description: 'Classic conversion framework adapted for social',\n  bestFor: ['Product launches', 'Service announcements', 'Event promotion'],\n  platforms: ['linkedin', 'twitter', 'instagram', 'facebook'],\n  lengthGuideline: '200-350 words',\n  conversionFocus: 0.8,\n  engagementFocus: 0.7,\n  stages: [\n    {\n      name: 'Attention',\n      purpose: 'Grab attention immediately',\n      psychologyPrinciple: 'Pattern Interrupt',\n      guidelines: [\n        'Use bold statement or question',\n        'Make it relevant to audience',\n        'Create curiosity or surprise'\n      ],\n      exampleFormulas: [\n        '[Bold Claim] (and here\\'s proof)',\n        'What if [Desired Outcome] was possible?',\n        '[Surprising Stat] about [Topic]'\n      ]\n    },\n    {\n      name: 'Interest',\n      purpose: 'Build interest with relevant details',\n      psychologyPrinciple: 'Relevance + Specificity',\n      guidelines: [\n        'Show why they should care',\n        'Use concrete details',\n        'Connect to their situation'\n      ]\n    },\n    {\n      name: 'Desire',\n      purpose: 'Create want through benefits',\n      psychologyPrinciple: 'Desire + Visualization',\n      guidelines: [\n        'Paint picture of transformation',\n        'Show benefits, not features',\n        'Use emotional language'\n      ]\n    },\n    {\n      name: 'Action',\n      purpose: 'Clear, simple next step',\n      psychologyPrinciple: 'Commitment',\n      guidelines: [\n        'One clear CTA',\n        'Remove friction',\n        'Add urgency if appropriate'\n      ]\n    }\n  ]\n};\n\nexport const BEFORE_AFTER_BRIDGE: ContentFramework = {\n  id: 'before-after-bridge',\n  name: 'Before-After-Bridge (BAB)',\n  channel: 'social',\n  description: 'Transformation framework showing the journey',\n  bestFor: ['Transformation stories', 'Results showcases', 'Method reveals'],\n  platforms: ['linkedin', 'instagram'],\n  lengthGuideline: '300-500 words',\n  conversionFocus: 0.7,\n  engagementFocus: 0.8,\n  stages: [\n    {\n      name: 'Before',\n      purpose: 'Establish the starting point (relatable struggle)',\n      psychologyPrinciple: 'Empathy + Recognition',\n      guidelines: [\n        'Be specific about the struggle',\n        'Make it relatable',\n        'Show vulnerability',\n        'Avoid exaggeration'\n      ],\n      exampleFormulas: [\n        'Six months ago, I was [Struggle]',\n        'Like most [Audience], I used to [Problem Behavior]',\n        'The old me would [Limiting Behavior]'\n      ]\n    },\n    {\n      name: 'After',\n      purpose: 'Show the transformation achieved',\n      psychologyPrinciple: 'Aspiration + Proof',\n      guidelines: [\n        'Show specific results',\n        'Use numbers/metrics if possible',\n        'Make transformation feel achievable',\n        'Be credible, not boastful'\n      ],\n      exampleFormulas: [\n        'Now I [New Reality]',\n        'Today, [Positive Outcome]',\n        'The difference: [Metric Improvement]'\n      ]\n    },\n    {\n      name: 'Bridge',\n      purpose: 'Reveal the method/path to transformation',\n      psychologyPrinciple: 'Solution + Hope',\n      guidelines: [\n        'Explain what changed',\n        'Make path feel clear',\n        'Offer to help others cross bridge',\n        'Include clear CTA'\n      ],\n      exampleFormulas: [\n        'Here\\'s what changed everything: [Method]',\n        'The bridge: [Approach/Strategy]',\n        'Want to make this shift? Here\\'s how [Action]'\n      ]\n    }\n  ]\n};\n\n// ============================================================================\n// EMAIL FRAMEWORKS\n// ============================================================================\n\nexport const EMAIL_AIDA: ContentFramework = {\n  id: 'email-aida',\n  name: 'Email AIDA',\n  channel: 'email',\n  description: 'Classic AIDA optimized for email format',\n  bestFor: ['Newsletter', 'Product emails', 'Announcement emails'],\n  lengthGuideline: '150-300 words',\n  conversionFocus: 0.9,\n  engagementFocus: 0.6,\n  stages: [\n    {\n      name: 'Subject Line (Attention)',\n      purpose: 'Get email opened',\n      psychologyPrinciple: 'Curiosity + Relevance',\n      guidelines: [\n        '6-10 words ideal',\n        'Create curiosity or urgency',\n        'Personalize when possible',\n        'Test with/without emojis'\n      ],\n      exampleFormulas: [\n        '[Name], this changes [Topic]',\n        'The [Outcome] you\\'ve been waiting for',\n        '⚡ [Benefit] in [Timeframe]',\n        'Your [Problem] solution (finally)'\n      ]\n    },\n    {\n      name: 'Opening (Interest)',\n      purpose: 'Hook them in first 2 lines',\n      guidelines: [\n        'Deliver on subject line promise',\n        'Make it about them, not you',\n        'Create pattern interrupt'\n      ]\n    },\n    {\n      name: 'Body (Desire)',\n      purpose: 'Build want for outcome',\n      guidelines: [\n        'Show benefits clearly',\n        'Use short paragraphs',\n        'Include social proof if possible',\n        'Address objections'\n      ]\n    },\n    {\n      name: 'CTA (Action)',\n      purpose: 'Clear, single action',\n      guidelines: [\n        'One primary CTA button/link',\n        'Action-oriented language',\n        'Add urgency if appropriate',\n        'Include P.S. with additional value'\n      ]\n    }\n  ]\n};\n\nexport const EMAIL_PAS: ContentFramework = {\n  id: 'email-pas',\n  name: 'Email PAS',\n  channel: 'email',\n  description: 'Problem-Agitate-Solution for email',\n  bestFor: ['Problem-aware audiences', 'Solution emails', 'Educational series'],\n  lengthGuideline: '200-350 words',\n  conversionFocus: 0.85,\n  engagementFocus: 0.7,\n  stages: [\n    {\n      name: 'Subject Line',\n      purpose: 'Call out the problem',\n      guidelines: [\n        'Reference their pain point',\n        'Create recognition',\n        'Make it feel urgent'\n      ],\n      exampleFormulas: [\n        'Still struggling with [Problem]?',\n        'The [Problem] no one talks about',\n        'Why [Problem] keeps happening'\n      ]\n    },\n    {\n      name: 'Problem Identification',\n      purpose: 'Show you understand their pain',\n      guidelines: [\n        'Be specific',\n        'Use their language',\n        'Show empathy'\n      ]\n    },\n    {\n      name: 'Agitate',\n      purpose: 'Amplify urgency',\n      guidelines: [\n        'Show cost of inaction',\n        'Use emotional language',\n        'Don\\'t be manipulative'\n      ]\n    },\n    {\n      name: 'Solution + CTA',\n      purpose: 'Present clear path forward',\n      guidelines: [\n        'Make solution feel achievable',\n        'Clear next step',\n        'Add P.S. with benefit reminder'\n      ]\n    }\n  ]\n};\n\n// ============================================================================\n// BLOG FRAMEWORKS\n// ============================================================================\n\nexport const BLOG_HOW_TO: ContentFramework = {\n  id: 'blog-how-to',\n  name: 'How-To Guide',\n  channel: 'blog',\n  description: 'Educational content with step-by-step instructions',\n  bestFor: ['Tutorials', 'Process explanations', 'Skill building'],\n  lengthGuideline: '1000-2000 words',\n  conversionFocus: 0.5,\n  engagementFocus: 0.8,\n  stages: [\n    {\n      name: 'SEO-Optimized Headline',\n      purpose: 'Rank for search + get clicks',\n      guidelines: [\n        'Include target keyword',\n        'Promise clear outcome',\n        'Use power words',\n        'Keep under 60 characters'\n      ],\n      exampleFormulas: [\n        'How to [Outcome] in [Timeframe]: [Method] Guide',\n        '[Number] Steps to [Outcome] (Even if [Obstacle])',\n        'The Complete Guide to [Topic]: [Benefit]'\n      ]\n    },\n    {\n      name: 'Introduction',\n      purpose: 'Set context and promise value',\n      guidelines: [\n        'Hook with problem or opportunity',\n        'Preview what they\\'ll learn',\n        'Establish credibility',\n        'Keep under 200 words'\n      ]\n    },\n    {\n      name: 'Step-by-Step Content',\n      purpose: 'Deliver actionable instructions',\n      guidelines: [\n        'Use H2/H3 subheadings for each step',\n        'Include examples and visuals',\n        'Make steps actionable',\n        'Link to related resources'\n      ]\n    },\n    {\n      name: 'Conclusion + CTA',\n      purpose: 'Reinforce value and drive action',\n      guidelines: [\n        'Summarize key points',\n        'Encourage action',\n        'Offer next step/upgrade path',\n        'Include related content links'\n      ]\n    }\n  ]\n};\n\nexport const BLOG_LISTICLE: ContentFramework = {\n  id: 'blog-listicle',\n  name: 'Listicle',\n  channel: 'blog',\n  description: 'Numbered list format for easy scanning',\n  bestFor: ['Tips compilations', 'Best practices', 'Resource roundups'],\n  lengthGuideline: '800-1500 words',\n  conversionFocus: 0.6,\n  engagementFocus: 0.9,\n  stages: [\n    {\n      name: 'Number + Benefit Headline',\n      purpose: 'Set clear expectations',\n      guidelines: [\n        'Use odd numbers (perceived as more authentic)',\n        'Promise specific outcome',\n        'Include qualifying phrase'\n      ],\n      exampleFormulas: [\n        '[Odd Number] [Topic] That [Benefit]',\n        '[Number] Ways to [Outcome] Without [Common Obstacle]',\n        '[Number] [Topic] Every [Audience] Should Know'\n      ]\n    },\n    {\n      name: 'Brief Intro',\n      purpose: 'Set up the list value',\n      guidelines: [\n        'Keep to 100-150 words',\n        'Explain why list matters',\n        'Promise what they\\'ll gain'\n      ]\n    },\n    {\n      name: 'List Items',\n      purpose: 'Deliver numbered value points',\n      guidelines: [\n        'Use H2/H3 for each item',\n        'Make each item standalone',\n        '100-200 words per item',\n        'Include examples',\n        'Add visuals where helpful'\n      ]\n    },\n    {\n      name: 'Wrap-Up + CTA',\n      purpose: 'Synthesize and drive action',\n      guidelines: [\n        'Quick summary',\n        'Pick your favorite or start here',\n        'Clear next step'\n      ]\n    }\n  ]\n};\n\n// ============================================================================\n// LANDING PAGE FRAMEWORKS\n// ============================================================================\n\nexport const LANDING_HERO: ContentFramework = {\n  id: 'landing-hero',\n  name: 'Hero Section Formula',\n  channel: 'landing-page',\n  description: 'Above-the-fold conversion optimization',\n  bestFor: ['Product pages', 'Service pages', 'Lead gen pages'],\n  lengthGuideline: 'Above fold: 50-100 words',\n  conversionFocus: 1.0,\n  engagementFocus: 0.5,\n  stages: [\n    {\n      name: 'Value Proposition Headline',\n      purpose: 'Communicate core value in 10 words or less',\n      psychologyPrinciple: 'Clarity + Relevance',\n      guidelines: [\n        'Focus on outcome, not method',\n        'Be specific, avoid jargon',\n        'Make it about them',\n        'Test multiple versions'\n      ],\n      exampleFormulas: [\n        '[Outcome] Without [Common Obstacle]',\n        'Get [Desired Result] in [Timeframe]',\n        'The [Benefit] [Audience] Needs'\n      ]\n    },\n    {\n      name: 'Supporting Subheadline',\n      purpose: 'Clarify who it\\'s for and how it works',\n      guidelines: [\n        '15-25 words',\n        'Add clarity to headline',\n        'Qualify your audience',\n        'Hint at the method'\n      ]\n    },\n    {\n      name: 'Primary CTA',\n      purpose: 'Drive single clear action',\n      guidelines: [\n        'Action-oriented button text',\n        'High contrast color',\n        'Benefit-focused copy',\n        'Remove friction'\n      ],\n      exampleFormulas: [\n        'Get [Benefit] Now',\n        'Start [Action] Free',\n        'See How It Works'\n      ]\n    },\n    {\n      name: 'Trust Indicators',\n      purpose: 'Build credibility immediately',\n      guidelines: [\n        'Social proof (user count, ratings)',\n        'Logos of known clients/media',\n        'Risk reversal (guarantee)',\n        'Keep minimal - don\\'t clutter'\n      ]\n    }\n  ]\n};\n\nexport const LANDING_PASTOR: ContentFramework = {\n  id: 'landing-pastor',\n  name: 'PASTOR Framework',\n  channel: 'landing-page',\n  description: 'Problem-Amplify-Story-Testimonial-Offer-Response',\n  bestFor: ['Long-form sales pages', 'Course launches', 'High-ticket offers'],\n  lengthGuideline: '1500-3000 words',\n  conversionFocus: 0.95,\n  engagementFocus: 0.7,\n  stages: [\n    {\n      name: 'Problem',\n      purpose: 'Identify the core pain point',\n      psychologyPrinciple: 'Recognition + Empathy',\n      guidelines: [\n        'Be specific about the problem',\n        'Use their language',\n        'Show understanding'\n      ]\n    },\n    {\n      name: 'Amplify',\n      purpose: 'Deepen understanding of problem cost',\n      psychologyPrinciple: 'Loss Aversion',\n      guidelines: [\n        'Show what\\'s at stake',\n        'Emotional + logical costs',\n        'Future consequences'\n      ]\n    },\n    {\n      name: 'Story',\n      purpose: 'Share transformation journey',\n      psychologyPrinciple: 'Narrative Transportation',\n      guidelines: [\n        'Personal or customer story',\n        'Show before/after',\n        'Make it relatable'\n      ]\n    },\n    {\n      name: 'Testimonials & Proof',\n      purpose: 'Provide social proof',\n      psychologyPrinciple: 'Social Proof + Authority',\n      guidelines: [\n        'Real customer results',\n        'Specific outcomes',\n        'Photos/videos if possible',\n        'Address common objections'\n      ]\n    },\n    {\n      name: 'Offer',\n      purpose: 'Present your solution clearly',\n      psychologyPrinciple: 'Value Perception',\n      guidelines: [\n        'What they get (features → benefits)',\n        'How it works',\n        'What makes it unique',\n        'Price positioning'\n      ]\n    },\n    {\n      name: 'Response',\n      purpose: 'Clear CTA with urgency',\n      psychologyPrinciple: 'Scarcity + Commitment',\n      guidelines: [\n        'Remove friction',\n        'Add urgency if authentic',\n        'Risk reversal (guarantee)',\n        'Make action easy'\n      ]\n    }\n  ]\n};\n\n// ============================================================================\n// FRAMEWORK SELECTOR\n// ============================================================================\n\nexport class ContentFrameworkLibrary {\n  private frameworks: Map<FrameworkType, ContentFramework>;\n\n  constructor() {\n    this.frameworks = new Map([\n      // Social Media\n      [HOOK_STORY_OFFER.id, HOOK_STORY_OFFER],\n      [PROBLEM_AGITATE_SOLUTION.id, PROBLEM_AGITATE_SOLUTION],\n      [AIDA_SOCIAL.id, AIDA_SOCIAL],\n      [BEFORE_AFTER_BRIDGE.id, BEFORE_AFTER_BRIDGE],\n\n      // Email\n      [EMAIL_AIDA.id, EMAIL_AIDA],\n      [EMAIL_PAS.id, EMAIL_PAS],\n\n      // Blog\n      [BLOG_HOW_TO.id, BLOG_HOW_TO],\n      [BLOG_LISTICLE.id, BLOG_LISTICLE],\n\n      // Landing Page\n      [LANDING_HERO.id, LANDING_HERO],\n      [LANDING_PASTOR.id, LANDING_PASTOR]\n    ]);\n  }\n\n  /**\n   * Get framework by ID\n   */\n  getFramework(id: FrameworkType): ContentFramework | undefined {\n    return this.frameworks.get(id);\n  }\n\n  /**\n   * Get all frameworks for a channel\n   */\n  getFrameworksByChannel(channel: ContentChannel): ContentFramework[] {\n    return Array.from(this.frameworks.values()).filter(f => f.channel === channel);\n  }\n\n  /**\n   * Select best framework based on insight type, channel, and goal\n   */\n  selectFramework(\n    insight: SynapseInsight,\n    channel: ContentChannel,\n    goal: ContentGoal,\n    platform?: Platform\n  ): ContentFramework {\n    const channelFrameworks = this.getFrameworksByChannel(channel);\n\n    // Filter by platform if specified\n    let candidates = platform\n      ? channelFrameworks.filter(f =>\n          !f.platforms || f.platforms.includes(platform) || f.platforms.includes('generic')\n        )\n      : channelFrameworks;\n\n    // Score frameworks based on goal\n    const scored = candidates.map(framework => {\n      let score = 0;\n\n      // Score based on goal alignment\n      if (goal === 'conversion' || goal === 'lead-generation') {\n        score += framework.conversionFocus * 10;\n      } else if (goal === 'engagement') {\n        score += framework.engagementFocus * 10;\n      } else {\n        // Balanced for awareness/education/trust\n        score += (framework.conversionFocus + framework.engagementFocus) * 5;\n      }\n\n      // Boost based on insight type\n      if (insight.type === 'counter_intuitive' && framework.id.includes('problem')) {\n        score += 5;\n      }\n      if (insight.type === 'predictive_opportunity' && framework.id.includes('before-after')) {\n        score += 5;\n      }\n      if (insight.type === 'deep_psychology' && framework.id.includes('story')) {\n        score += 5;\n      }\n\n      return { framework, score };\n    });\n\n    // Return highest scoring framework\n    scored.sort((a, b) => b.score - a.score);\n    return scored[0]?.framework || channelFrameworks[0];\n  }\n\n  /**\n   * Get all available frameworks\n   */\n  getAllFrameworks(): ContentFramework[] {\n    return Array.from(this.frameworks.values());\n  }\n\n  /**\n   * Get framework recommendations for an insight\n   */\n  getRecommendations(\n    insight: SynapseInsight,\n    channel: ContentChannel\n  ): {\n    primary: ContentFramework;\n    alternatives: ContentFramework[];\n    reasoning: string;\n  } {\n    const allForChannel = this.getFrameworksByChannel(channel);\n    const primary = this.selectFramework(insight, channel, 'conversion');\n    const alternatives = allForChannel.filter(f => f.id !== primary.id).slice(0, 2);\n\n    let reasoning = `Selected ${primary.name} because `;\n    if (insight.type === 'counter_intuitive') {\n      reasoning += 'this insight challenges conventional wisdom, making problem-focused frameworks effective.';\n    } else if (insight.type === 'predictive_opportunity') {\n      reasoning += 'this insight shows future trends, making transformation frameworks compelling.';\n    } else if (insight.type === 'deep_psychology') {\n      reasoning += 'this insight reveals psychological drivers, making story-based frameworks engaging.';\n    } else {\n      reasoning += 'this framework balances conversion and engagement effectively.';\n    }\n\n    return {\n      primary,\n      alternatives,\n      reasoning\n    };\n  }\n}\n\n// Export singleton instance\nexport const frameworkLibrary = new ContentFrameworkLibrary();\n","/**\n * Target Audience Detection Utility\n *\n * Properly identifies the target audience for content generation\n * to avoid generic industry-based audience targeting.\n *\n * Created: 2025-11-11\n */\n\nimport type { BusinessProfile as SynapseBusinessProfile } from '@/types/synapseContent.types';\nimport type { BusinessProfile as DeepBusinessProfile } from '@/types/deepContext.types';\n\n/**\n * Detect the actual target audience from business data\n *\n * CRITICAL: This determines WHO the content is speaking TO, not ABOUT.\n * Example: For a wedding coffee service, the audience is \"couples planning weddings\",\n * NOT \"coffee shop owners\".\n */\nexport function detectTargetAudience(\n  business: SynapseBusinessProfile | DeepBusinessProfile\n): string {\n  // Check if using simplified BusinessProfile with targetAudience field\n  if ('targetAudience' in business && business.targetAudience) {\n    let audience = business.targetAudience;\n\n    // Clean up comma-separated lists or invalid formats\n    if (audience.includes(',')) {\n      const parts = audience.split(',').map(s => s.trim());\n\n      if (parts.length > 3) {\n        // This looks like a comma-separated list of event types/services, not a target audience\n        // Force industry inference instead of using this bad data\n        console.warn('[audienceDetection] targetAudience contains comma-separated list (>3 parts), forcing industry inference:', audience.substring(0, 100));\n        // Don't return - fall through to industry inference\n      } else if (parts.length === 2) {\n        // Two parts like \"Uptown residents,professionals\" - combine with \"and\"\n        audience = `${parts[0]} and ${parts[1]}`;\n        console.log('[audienceDetection] Cleaned comma-separated audience:', audience);\n        return audience;\n      } else if (parts.length === 3) {\n        // Three parts - combine with commas and \"and\"\n        audience = `${parts[0]}, ${parts[1]}, and ${parts[2]}`;\n        console.log('[audienceDetection] Cleaned 3-part audience:', audience);\n        return audience;\n      } else {\n        return audience;\n      }\n    } else {\n      return audience;\n    }\n  }\n\n  // Fallback: attempt to infer from industry\n  // This is a last resort and should be improved with actual audience data\n  const industryToAudience: Record<string, string> = {\n    'bar': 'locals looking for a great night out',\n    'pub': 'friends and groups looking for a relaxed atmosphere',\n    'bar/pub': 'people looking for drinks and good times',\n    'nightclub': 'party-goers and groups celebrating',\n    'brewery': 'craft beer enthusiasts and groups',\n    'wine bar': 'wine lovers and date night crowds',\n    'mobile coffee': 'event planners and people hosting special occasions',\n    'coffee cart': 'event organizers and hosts',\n    'wedding': 'couples planning weddings',\n    'event': 'event planners and hosts',\n    'coffee shop': 'coffee lovers and local community members',\n    'cafe': 'people seeking quality coffee and community spaces',\n    'restaurant': 'diners and food enthusiasts',\n    'bakery': 'people who love fresh baked goods',\n    'retail': 'shoppers looking for quality products',\n    'saas': 'business professionals seeking software solutions',\n    'consulting': 'business leaders seeking expert guidance',\n    'marketing': 'business owners looking to grow their brand',\n    'real estate': 'home buyers and property investors',\n    'fitness': 'people seeking health and wellness improvements',\n    'education': 'students and lifelong learners',\n    'healthcare': 'patients seeking quality care',\n    'legal': 'clients needing legal services',\n    'financial services': 'individuals and businesses managing finances',\n    'e-commerce': 'online shoppers',\n    'hospitality': 'travelers and guests',\n    'cleaning': 'business owners seeking professional cleaning services',\n    'janitorial': 'facility managers looking for reliable janitorial services',\n    'facility services': 'property managers and business owners maintaining professional spaces'\n  };\n\n  const industry = business.industry.toLowerCase();\n\n  // Check for exact match\n  if (industryToAudience[industry]) {\n    return industryToAudience[industry];\n  }\n\n  // Check for partial match\n  for (const [key, audience] of Object.entries(industryToAudience)) {\n    if (industry.includes(key) || key.includes(industry)) {\n      return audience;\n    }\n  }\n\n  // Generic fallback (should rarely hit this)\n  return `people interested in ${business.industry}`;\n}\n\n/**\n * Validate evidence array to ensure it contains actual proof points,\n * not search keywords or other artifacts\n */\nexport function validateEvidence(evidence: string[]): string[] {\n  return evidence.filter(item => {\n    // Filter out items that look like search keywords\n    const isSearchKeyword = item.split(' ').length <= 4 &&\n                           !item.includes('.') &&\n                           !item.includes('%') &&\n                           !item.match(/[A-Z][a-z]/); // No proper capitalization\n\n    // Filter out items that are too short to be meaningful\n    const isTooShort = item.length < 15;\n\n    // Keep items that look like actual evidence\n    return !isSearchKeyword && !isTooShort;\n  });\n}\n\n/**\n * Get clean evidence for use in content\n * Returns up to maxItems validated evidence points\n */\nexport function getCleanEvidence(evidence: string[], maxItems: number = 3): string[] {\n  const validated = validateEvidence(evidence);\n  return validated.slice(0, maxItems);\n}\n","/**\n * Hook Post Generator\n *\n * Generates social media content using the Hook-Story-Offer framework\n * for maximum engagement and conversion.\n *\n * Framework: Hook-Story-Offer (Social Media Standard)\n * - Hook: Stop the scroll with pattern interrupt\n * - Story: Build connection through narrative\n * - Offer: Clear call-to-action with value\n *\n * Created: 2025-11-10\n * Updated: 2025-11-11 - COMPLETE REWRITE to use framework-guided generation\n */\n\nimport type { BreakthroughInsight } from '@/types/breakthrough.types';\nimport type {\n  ContentDraft,\n  SynapseContent,\n  BusinessProfile\n} from '@/types/synapseContent.types';\nimport { PowerWordOptimizer } from '../PowerWordOptimizer';\nimport { HOOK_STORY_OFFER, type ContentFramework } from '../ContentFrameworkLibrary';\nimport { detectTargetAudience, getCleanEvidence } from '../utils/audienceDetection';\n\nexport class HookPostGenerator {\n  private powerWordOptimizer: PowerWordOptimizer;\n  private framework: ContentFramework;\n\n  constructor() {\n    this.powerWordOptimizer = new PowerWordOptimizer();\n    this.framework = HOOK_STORY_OFFER;\n  }\n\n  /**\n   * Generate a hook-based post from an insight\n   */\n  async generate(\n    insight: BreakthroughInsight,\n    business: BusinessProfile\n  ): Promise<SynapseContent> {\n    // Detect actual target audience\n    const targetAudience = detectTargetAudience(business);\n\n    // Generate draft following Hook-Story-Offer framework stages\n    const draft = this.generateFrameworkGuidedDraft(insight, business, targetAudience);\n\n    // Optimize with power words\n    const optimized = await this.powerWordOptimizer.optimize(draft, business);\n\n    // Build complete content object\n    const content: SynapseContent = {\n      id: `content-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n      insightId: insight.id,\n      format: 'hook-post',\n\n      content: {\n        headline: optimized.headline,\n        hook: optimized.hook,\n        body: optimized.body,\n        cta: optimized.cta,\n        hashtags: this.generateHashtags(insight, business)\n      },\n\n      psychology: {\n        principle: 'Curiosity Gap',\n        trigger: {\n          type: 'curiosity',\n          strength: 0.9,\n          target: 'discovery'\n        },\n        persuasionTechnique: 'Pattern Interrupt',\n        expectedReaction: insight.expectedReaction || 'I need to know more about this'\n      },\n\n      optimization: {\n        powerWords: this.powerWordOptimizer.extractPowerWords(\n          `${optimized.headline} ${optimized.hook} ${optimized.body}`\n        ),\n        framingDevice: this.framework.name,\n        narrativeStructure: this.framework.stages.map(s => s.name).join(' → '),\n        pacing: 'Fast (curiosity-driven)'\n      },\n\n      meta: {\n        platform: ['LinkedIn', 'Instagram'],\n        tone: 'professional',\n        targetAudience\n      },\n\n      prediction: {\n        engagementScore: this.predictEngagement(insight, optimized),\n        viralPotential: this.predictViralPotential(insight),\n        leadGeneration: this.predictLeadGeneration(targetAudience),\n        brandImpact: 'positive' as const,\n        confidenceLevel: insight.confidence\n      },\n\n      framework: {\n        id: this.framework.id,\n        name: this.framework.name,\n        stages: this.framework.stages.map(s => s.name),\n        reasoning: 'Hook-Story-Offer is the gold standard for social media engagement. Creates pattern interrupt, builds connection, drives action.'\n      },\n\n      metadata: {\n        generatedAt: new Date(),\n        model: 'HookPostGenerator',\n        iterationCount: 1,\n        impactScore: insight.confidence\n      }\n    };\n\n    return content;\n  }\n\n  /**\n   * Generate draft following Hook-Story-Offer framework stages\n   *\n   * This is the KEY METHOD - it walks through the framework stages\n   * and uses the stage guidelines to construct content from the insight\n   */\n  private generateFrameworkGuidedDraft(\n    insight: BreakthroughInsight,\n    business: BusinessProfile,\n    targetAudience: string\n  ): ContentDraft {\n    // Get clean evidence (filter out search keywords)\n    const cleanEvidence = getCleanEvidence(insight.evidence, 3);\n\n    // STAGE 1: HOOK\n    // Purpose: Stop the scroll - create pattern interrupt\n    // Guidelines: First 1-2 lines must grab attention\n    const hook = this.buildHookStage(insight, targetAudience);\n\n    // STAGE 2: STORY\n    // Purpose: Build connection through narrative\n    // Guidelines: Use insight as story driver, show transformation\n    const story = this.buildStoryStage(insight, cleanEvidence);\n\n    // STAGE 3: OFFER\n    // Purpose: Clear call-to-action with value\n    // Guidelines: Make offer clear and specific\n    const offer = this.buildOfferStage(insight, business, targetAudience);\n\n    // Assemble into content structure\n    const headline = this.extractHeadline(insight);\n    const body = `${story}`;\n    const cta = offer;\n\n    return {\n      format: 'hook-post',\n      headline,\n      hook,\n      body,\n      cta\n    };\n  }\n\n  /**\n   * STAGE 1: Build Hook\n   *\n   * Framework guideline: \"Stop the scroll - create pattern interrupt\"\n   * Uses: insight.insight, insight.contentAngle\n   */\n  private buildHookStage(insight: BreakthroughInsight, targetAudience: string): string {\n    // Use the content angle as the primary hook\n    if (insight.contentAngle && insight.contentAngle.length > 10) {\n      return insight.contentAngle;\n    }\n\n    // Fall back to the core insight\n    return insight.insight.split('.')[0] + '.';\n  }\n\n  /**\n   * STAGE 2: Build Story\n   *\n   * Framework guideline: \"Build connection through narrative\"\n   * Uses: insight.whyProfound, evidence, whyNow\n   */\n  private buildStoryStage(insight: BreakthroughInsight, cleanEvidence: string[]): string {\n    const parts: string[] = [];\n\n    // Start with why this is profound\n    if (insight.whyProfound) {\n      parts.push(insight.whyProfound);\n    }\n\n    // Add evidence if available (real evidence, not search keywords)\n    if (cleanEvidence.length > 0) {\n      parts.push('\\n\\nWhat we\\'re seeing:');\n      cleanEvidence.forEach(evidence => {\n        parts.push(`• ${evidence}`);\n      });\n    }\n\n    // Add urgency/timing if present\n    if (insight.whyNow && insight.whyNow.length > 15) {\n      parts.push(`\\n\\n${insight.whyNow}`);\n    }\n\n    return parts.join('\\n');\n  }\n\n  /**\n   * STAGE 3: Build Offer\n   *\n   * Framework guideline: \"Clear call-to-action with value\"\n   * Uses: business context, targetAudience\n   */\n  private buildOfferStage(\n    insight: BreakthroughInsight,\n    business: BusinessProfile,\n    targetAudience: string\n  ): string {\n    // Create specific, value-driven CTAs\n    const offers = [\n      `Want to explore how this applies to your business? Let's connect.`,\n      `This insight changes everything. DM me to discuss how ${business.name} can help.`,\n      `Ready to capitalize on this? Reach out and let's talk strategy.`,\n      `${business.name} specializes in helping ${targetAudience} leverage insights like this. Let's chat.`\n    ];\n\n    // Select based on insight type\n    if (insight.type === 'predictive_opportunity') {\n      return `This opportunity won't last forever. ${offers[2]}`;\n    } else if (insight.type === 'counter_intuitive') {\n      return offers[1];\n    } else {\n      return offers[0];\n    }\n  }\n\n  /**\n   * Extract headline from insight\n   */\n  private extractHeadline(insight: BreakthroughInsight): string {\n    // Priority: contentAngle > first sentence of insight\n    if (insight.contentAngle && insight.contentAngle.length > 10) {\n      return insight.contentAngle.split('.')[0];\n    }\n\n    // Use first sentence of core insight\n    const firstSentence = insight.insight.split('.')[0];\n    return firstSentence.length > 100 ? firstSentence.substring(0, 97) + '...' : firstSentence;\n  }\n\n  /**\n   * Generate relevant hashtags\n   */\n  private generateHashtags(\n    insight: BreakthroughInsight,\n    business: BusinessProfile\n  ): string[] {\n    const industry = business.industry.toLowerCase().replace(/\\s+/g, '');\n    const baseHashtags = [\n      industry,\n      'business',\n      'growth'\n    ];\n\n    const insightHashtags: Record<string, string[]> = {\n      'unexpected_connection': ['innovation', 'insights'],\n      'counter_intuitive': ['mindset', 'strategy'],\n      'predictive_opportunity': ['trends', 'opportunity'],\n      'deep_psychology': ['psychology', 'customers'],\n      'cultural_moment': ['trending', 'relevant']\n    };\n\n    const relevantHashtags = insightHashtags[insight.type] || ['insights'];\n\n    return [...baseHashtags, ...relevantHashtags].slice(0, 5);\n  }\n\n  /**\n   * Predict engagement score\n   */\n  private predictEngagement(\n    insight: BreakthroughInsight,\n    draft: ContentDraft\n  ): number {\n    let score = 0.7; // Base score for curiosity gap format\n\n    // Boost for high confidence insights\n    score += insight.confidence * 0.2;\n\n    // Boost for power words in headline\n    const powerWords = this.powerWordOptimizer.extractPowerWords(draft.headline);\n    score += Math.min(powerWords.length * 0.02, 0.1);\n\n    return Math.min(score, 1.0);\n  }\n\n  /**\n   * Predict viral potential\n   */\n  private predictViralPotential(insight: BreakthroughInsight): number {\n    let score = 0.6; // Base score for hook posts\n\n    // Counter-intuitive insights have higher viral potential\n    if (insight.type === 'counter_intuitive') {\n      score += 0.15;\n    }\n\n    // Unexpected connections are shareable\n    if (insight.type === 'unexpected_connection') {\n      score += 0.2;\n    }\n\n    return Math.min(score, 1.0);\n  }\n\n  /**\n   * Predict lead generation potential\n   */\n  private predictLeadGeneration(targetAudience: string): number {\n    let score = 0.65; // Base score for curiosity-driven content\n\n    // B2B audiences see higher lead gen from educational content\n    if (targetAudience.toLowerCase().includes('business') ||\n        targetAudience.toLowerCase().includes('professional')) {\n      score += 0.15;\n    }\n\n    return Math.min(score, 1.0);\n  }\n}\n","/**\n * Story Post Generator\n *\n * Generates narrative-driven content using the Before-After-Bridge framework\n * to create emotional connection through transformation stories.\n *\n * Framework: Before-After-Bridge (BAB)\n * - Before: The old situation/problem\n * - After: The new reality/solution\n * - Bridge: How the transformation happened\n *\n * Created: 2025-11-10\n * Updated: 2025-11-11 - COMPLETE REWRITE to use framework-guided generation\n */\n\nimport type { BreakthroughInsight } from '@/types/breakthrough.types';\nimport type {\n  ContentDraft,\n  SynapseContent,\n  BusinessProfile\n} from '@/types/synapseContent.types';\nimport { PowerWordOptimizer } from '../PowerWordOptimizer';\nimport { BEFORE_AFTER_BRIDGE, type ContentFramework } from '../ContentFrameworkLibrary';\nimport { detectTargetAudience, getCleanEvidence } from '../utils/audienceDetection';\n\nexport class StoryPostGenerator {\n  private powerWordOptimizer: PowerWordOptimizer;\n  private framework: ContentFramework;\n\n  constructor() {\n    this.powerWordOptimizer = new PowerWordOptimizer();\n    this.framework = BEFORE_AFTER_BRIDGE;\n  }\n\n  /**\n   * Generate a story-based post from an insight\n   */\n  async generate(\n    insight: BreakthroughInsight,\n    business: BusinessProfile\n  ): Promise<SynapseContent> {\n    // Detect actual target audience\n    const targetAudience = detectTargetAudience(business);\n\n    // Generate draft following Before-After-Bridge framework\n    const draft = this.generateFrameworkGuidedDraft(insight, business, targetAudience);\n\n    // Optimize with power words\n    const optimized = await this.powerWordOptimizer.optimize(draft, business);\n\n    // Build complete content object\n    const content: SynapseContent = {\n      id: `content-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n      insightId: insight.id,\n      format: 'story-post',\n\n      content: {\n        headline: optimized.headline,\n        hook: optimized.hook,\n        body: optimized.body,\n        cta: optimized.cta,\n        hashtags: this.generateHashtags(insight, business)\n      },\n\n      psychology: {\n        principle: 'Narrative Transportation',\n        trigger: {\n          type: 'aspiration',\n          strength: 0.85,\n          target: 'connection'\n        },\n        persuasionTechnique: 'Storytelling',\n        expectedReaction: insight.expectedReaction || 'I can relate to this journey'\n      },\n\n      optimization: {\n        powerWords: this.powerWordOptimizer.extractPowerWords(\n          `${optimized.headline} ${optimized.hook} ${optimized.body}`\n        ),\n        framingDevice: this.framework.name,\n        narrativeStructure: this.framework.stages.map(s => s.name).join(' → '),\n        pacing: 'Medium (story-driven)'\n      },\n\n      meta: {\n        platform: ['LinkedIn', 'Facebook'],\n        tone: 'inspirational',\n        targetAudience\n      },\n\n      prediction: {\n        engagementScore: 0.75,\n        viralPotential: 0.65,\n        leadGeneration: 0.7,\n        brandImpact: 'positive' as const,\n        confidenceLevel: insight.confidence\n      },\n\n      framework: {\n        id: this.framework.id,\n        name: this.framework.name,\n        stages: this.framework.stages.map(s => s.name),\n        reasoning: 'Before-After-Bridge perfect for showing transformation and building emotional connection'\n      },\n\n      metadata: {\n        generatedAt: new Date(),\n        model: 'StoryPostGenerator',\n        iterationCount: 1,\n        impactScore: insight.confidence\n      }\n    };\n\n    return content;\n  }\n\n  /**\n   * Generate draft following Before-After-Bridge framework\n   */\n  private generateFrameworkGuidedDraft(\n    insight: BreakthroughInsight,\n    business: BusinessProfile,\n    targetAudience: string\n  ): ContentDraft {\n    // Get clean evidence\n    const cleanEvidence = getCleanEvidence(insight.evidence, 3);\n\n    // STAGE 1: BEFORE\n    // Purpose: Show the old situation/problem\n    const before = this.buildBeforeStage(insight, targetAudience);\n\n    // STAGE 2: AFTER\n    // Purpose: Show the new reality/solution\n    const after = this.buildAfterStage(insight, cleanEvidence);\n\n    // STAGE 3: BRIDGE\n    // Purpose: Explain how the transformation happened\n    const bridge = this.buildBridgeStage(insight, business, targetAudience);\n\n    // Assemble into content structure\n    const headline = this.buildHeadline(insight);\n    const hook = before;\n    const body = `${after}\n\n${bridge}`;\n    const cta = `Want to make this transformation yourself? Let's connect.`;\n\n    return {\n      format: 'story-post',\n      headline,\n      hook,\n      body,\n      cta\n    };\n  }\n\n  /**\n   * STAGE 1: Build Before (The Old Situation)\n   */\n  private buildBeforeStage(insight: BreakthroughInsight, targetAudience: string): string {\n    // Frame the pre-insight state as the hook\n    return `Here's what I see happening with many ${targetAudience}...`;\n  }\n\n  /**\n   * STAGE 2: Build After (The New Reality)\n   */\n  private buildAfterStage(insight: BreakthroughInsight, cleanEvidence: string[]): string {\n    const parts: string[] = [];\n\n    // Present the insight as the transformation\n    parts.push(`**The Insight:**\\n${insight.insight}`);\n\n    // Show why this creates a new reality\n    if (insight.whyProfound) {\n      parts.push(`\\n**Why This Changes Everything:**\\n${insight.whyProfound}`);\n    }\n\n    // Add evidence if available\n    if (cleanEvidence.length > 0) {\n      parts.push(`\\n**What I've Seen:**`);\n      cleanEvidence.forEach(evidence => {\n        parts.push(`• ${evidence}`);\n      });\n    }\n\n    return parts.join('\\n');\n  }\n\n  /**\n   * STAGE 3: Build Bridge (How Transformation Happens)\n   */\n  private buildBridgeStage(\n    insight: BreakthroughInsight,\n    business: BusinessProfile,\n    targetAudience: string\n  ): string {\n    const parts: string[] = [];\n\n    // Show timing/opportunity if present\n    if (insight.whyNow && insight.whyNow.length > 15) {\n      parts.push(`**The Timing:**\\n${insight.whyNow}`);\n    }\n\n    // Connect to business value\n    parts.push(`\\n${business.name} is built on helping ${targetAudience} make transformations like this.`);\n\n    return parts.join('\\n');\n  }\n\n  /**\n   * Build headline\n   */\n  private buildHeadline(insight: BreakthroughInsight): string {\n    // Use contentAngle if available\n    if (insight.contentAngle && insight.contentAngle.length > 10) {\n      return insight.contentAngle;\n    }\n\n    // Use first sentence of insight\n    const firstSentence = insight.insight.split('.')[0];\n    return firstSentence.length > 100 ? firstSentence.substring(0, 97) + '...' : firstSentence;\n  }\n\n  /**\n   * Generate relevant hashtags\n   */\n  private generateHashtags(\n    insight: BreakthroughInsight,\n    business: BusinessProfile\n  ): string[] {\n    const industry = business.industry.toLowerCase().replace(/\\s+/g, '');\n\n    return [\n      industry,\n      'transformation',\n      'growth',\n      'journey',\n      'success'\n    ].slice(0, 5);\n  }\n}\n","/**\n * Data Post Generator\n *\n * Generates data-driven, authority-building content using the AIDA framework\n * with evidence-based arguments and statistics.\n *\n * Framework: AIDA (Attention-Interest-Desire-Action)\n * - Attention: Lead with compelling data/stat\n * - Interest: Explain what it means\n * - Desire: Show why it matters\n * - Action: Clear next step\n *\n * Created: 2025-11-10\n * Updated: 2025-11-11 - COMPLETE REWRITE to use framework-guided generation\n */\n\nimport type { BreakthroughInsight } from '@/types/breakthrough.types';\nimport type {\n  ContentDraft,\n  SynapseContent,\n  BusinessProfile\n} from '@/types/synapseContent.types';\nimport { PowerWordOptimizer } from '../PowerWordOptimizer';\nimport { AIDA_SOCIAL, type ContentFramework } from '../ContentFrameworkLibrary';\nimport { detectTargetAudience, getCleanEvidence } from '../utils/audienceDetection';\n\nexport class DataPostGenerator {\n  private powerWordOptimizer: PowerWordOptimizer;\n  private framework: ContentFramework;\n\n  constructor() {\n    this.powerWordOptimizer = new PowerWordOptimizer();\n    this.framework = AIDA_SOCIAL;\n  }\n\n  /**\n   * Generate a data-driven post from an insight\n   */\n  async generate(\n    insight: BreakthroughInsight,\n    business: BusinessProfile\n  ): Promise<SynapseContent> {\n    // Detect actual target audience\n    const targetAudience = detectTargetAudience(business);\n\n    // Get clean evidence for provenance tracking\n    const cleanEvidence = getCleanEvidence(insight.evidence, 5);\n\n    // Generate draft following AIDA framework\n    const draft = this.generateFrameworkGuidedDraft(insight, business, targetAudience);\n\n    // Optimize with power words (light touch for data posts)\n    const optimized = await this.powerWordOptimizer.optimize(draft, business);\n\n    // Build complete content object\n    const content: SynapseContent = {\n      id: `content-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n      insightId: insight.id,\n      format: 'data-post',\n\n      content: {\n        headline: optimized.headline,\n        hook: optimized.hook,\n        body: optimized.body,\n        cta: optimized.cta,\n        hashtags: this.generateHashtags(insight, business)\n      },\n\n      psychology: {\n        principle: 'Social Proof + Authority',\n        trigger: {\n          type: 'curiosity',\n          strength: 0.8,\n          target: 'credibility'\n        },\n        persuasionTechnique: 'Data-Driven Authority',\n        expectedReaction: insight.expectedReaction || 'These numbers tell a compelling story'\n      },\n\n      optimization: {\n        powerWords: this.powerWordOptimizer.extractPowerWords(\n          `${optimized.headline} ${optimized.hook} ${optimized.body}`\n        ),\n        framingDevice: this.framework.name,\n        narrativeStructure: this.framework.stages.map(s => s.name).join(' → '),\n        pacing: 'Medium-Fast (data-driven)'\n      },\n\n      meta: {\n        platform: ['LinkedIn', 'Twitter'],\n        tone: 'authoritative',\n        targetAudience\n      },\n\n      prediction: {\n        engagementScore: 0.7,\n        viralPotential: 0.6,\n        leadGeneration: 0.75,\n        brandImpact: 'positive' as const,\n        confidenceLevel: insight.confidence\n      },\n\n      framework: {\n        id: this.framework.id,\n        name: this.framework.name,\n        stages: this.framework.stages.map(s => s.name),\n        reasoning: 'AIDA framework perfect for data-driven content that builds authority and drives action'\n      },\n\n      provenance: {\n        // DEEP PROVENANCE: Merge from insight generation\n        ...((insight as any).deepProvenance || {}),\n\n        // Standard provenance tracking\n        dataSourcesUsed: insight.dataUsed || [],\n        psychologyTrigger: 'Social Proof + Authority - Data-driven credibility',\n        trendingTopicMatched: insight.title,\n\n        frameworkStagesUsed: [\n          {\n            stage: 'Attention (Hook)',\n            sourceField: insight.whyProfound && insight.whyProfound.length > 30 ? 'whyProfound' : 'insight',\n            content: draft.hook.substring(0, 100)\n          },\n          {\n            stage: 'Interest + Desire (Body)',\n            sourceField: cleanEvidence.length > 0 ? 'evidence + whyNow' : 'insight + whyNow',\n            content: draft.body.substring(0, 100)\n          },\n          {\n            stage: 'Action (CTA)',\n            sourceField: 'business.industry (industry-specific CTA)',\n            content: draft.cta\n          }\n        ],\n\n        contentAssembly: {\n          headline: {\n            source: 'insight.contentAngle (first sentence, 120 char limit)',\n            field: 'contentAngle',\n            preview: optimized.headline.substring(0, 80)\n          },\n          hook: {\n            source: insight.whyProfound && insight.whyProfound.length > 30\n              ? 'insight.whyProfound'\n              : 'insight.insight',\n            field: insight.whyProfound && insight.whyProfound.length > 30 ? 'whyProfound' : 'insight',\n            preview: optimized.hook.substring(0, 80)\n          },\n          body: {\n            source: cleanEvidence.length > 0\n              ? 'insight.evidence + insight.whyNow'\n              : 'insight.insight + insight.whyNow',\n            field: cleanEvidence.length > 0 ? 'evidence + whyNow' : 'insight + whyNow',\n            preview: optimized.body.substring(0, 80)\n          },\n          cta: {\n            source: `Industry: ${business.industry}`,\n            field: 'business.industry',\n            preview: optimized.cta\n          }\n        },\n\n        decisions: {\n          whyThisFormat: 'Data post format chosen for evidence-based insights that build authority',\n          whyThisTone: 'Authoritative tone to establish credibility with data and statistics',\n          whyThisCTA: this.explainCTAChoice(business)\n        }\n      },\n\n      metadata: {\n        generatedAt: new Date(),\n        model: 'DataPostGenerator',\n        iterationCount: 1,\n        impactScore: insight.confidence\n      }\n    };\n\n    return content;\n  }\n\n  /**\n   * Generate draft following AIDA framework\n   */\n  private generateFrameworkGuidedDraft(\n    insight: BreakthroughInsight,\n    business: BusinessProfile,\n    targetAudience: string\n  ): ContentDraft {\n    // Get clean evidence\n    const cleanEvidence = getCleanEvidence(insight.evidence, 5);\n\n    // STAGE 1: ATTENTION\n    // Purpose: Grab attention with compelling data\n    const attention = this.buildAttentionStage(insight, targetAudience);\n\n    // STAGE 2: INTEREST\n    // Purpose: Explain what the data means\n    const interest = this.buildInterestStage(insight);\n\n    // STAGE 3: DESIRE\n    // Purpose: Show why it matters (evidence)\n    const desire = this.buildDesireStage(insight, cleanEvidence);\n\n    // STAGE 4: ACTION\n    // Purpose: Clear next step\n    const action = this.buildActionStage(business, targetAudience);\n\n    // Assemble into content structure\n    const headline = this.buildHeadline(insight);\n    const hook = attention;\n\n    // Build body from non-empty parts\n    const bodyParts = [interest, desire].filter(part => part.length > 0);\n    const body = bodyParts.join('\\n\\n');\n\n    const cta = action;\n\n    return {\n      format: 'data-post',\n      headline,\n      hook,\n      body,\n      cta\n    };\n  }\n\n  /**\n   * STAGE 1: Build Attention (The Data Hook)\n   *\n   * IMPORTANT: Hook should be different from headline - provide context/setup\n   */\n  private buildAttentionStage(insight: BreakthroughInsight, targetAudience: string): string {\n    // Use whyProfound as the hook to provide context (not repeat the headline)\n    if (insight.whyProfound && insight.whyProfound.length > 30) {\n      return insight.whyProfound;\n    }\n\n    // Fall back to insight\n    return insight.insight;\n  }\n\n  /**\n   * STAGE 2: Build Interest (What It Means)\n   *\n   * NO TEMPLATES - Just output the actual content\n   * IMPORTANT: Provide evidence/data, not repeat the hook\n   */\n  private buildInterestStage(insight: BreakthroughInsight): string {\n    // Return empty - we'll put all content in the Desire stage to avoid repetition\n    return '';\n  }\n\n  /**\n   * STAGE 3: Build Desire (Why It Matters)\n   *\n   * NO TEMPLATES - Just output the actual content\n   * IMPORTANT: Build substantial body content to avoid thin posts\n   * CRITICAL: Avoid repeating what's already in the hook\n   */\n  private buildDesireStage(insight: BreakthroughInsight, cleanEvidence: string[]): string {\n    const parts: string[] = [];\n\n    // Skip insight entirely if whyProfound was used for hook (they're related concepts)\n    // This prevents repetition between hook and body\n\n    // Prioritize evidence (provides concrete substantiation without repeating concepts)\n    if (cleanEvidence.length > 0) {\n      cleanEvidence.forEach(evidence => {\n        parts.push(evidence);\n      });\n    }\n\n    // Add timing/urgency if present\n    if (insight.whyNow && insight.whyNow.length > 15) {\n      parts.push(insight.whyNow);\n    }\n\n    // Only if we have NOTHING else, fall back to insight\n    if (parts.length === 0 && insight.insight) {\n      parts.push(insight.insight);\n    }\n\n    return parts.join('\\n\\n');\n  }\n\n  /**\n   * STAGE 4: Build Action (The CTA)\n   *\n   * NO TEMPLATES - Industry-specific actionable CTAs\n   * Checks INDUSTRY FIRST to prevent content keywords from triggering wrong CTAs\n   */\n  private buildActionStage(business: BusinessProfile, targetAudience: string): string {\n    const industry = business.industry.toLowerCase();\n\n    // Industry-specific CTAs - check business type FIRST\n    if (industry.includes('cleaning') || industry.includes('janitorial') || industry.includes('facility')) {\n      return `${business.name} delivers professional results every time. Schedule your service today.`;\n    } else if (industry.includes('bar') || industry.includes('pub') || industry.includes('nightclub')) {\n      return `Experience it at ${business.name}. Stop by and see for yourself.`;\n    } else if (industry.includes('coffee') || industry.includes('cafe')) {\n      return `Try ${business.name} and taste the difference. Visit us today.`;\n    } else if (industry.includes('mattress') || industry.includes('furniture')) {\n      return `Visit ${business.name} and find your perfect match. We're here to help.`;\n    } else if (industry.includes('restaurant') || industry.includes('food')) {\n      return `Taste it at ${business.name}. Reserve your table today.`;\n    } else if (industry.includes('event')) {\n      return `${business.name} handles the details. Let's talk about your next event.`;\n    }\n\n    // Generic fallback - more direct\n    return `Visit ${business.name} today. We're ready when you are.`;\n  }\n\n  /**\n   * Build headline\n   */\n  private buildHeadline(insight: BreakthroughInsight): string {\n    // Clean meta-instructions helper\n    const cleanInstructions = (text: string): string => {\n      let cleaned = text;\n\n      // Log original for debugging\n      if (cleaned.toLowerCase().includes('start with') || cleaned.toLowerCase().includes('secret')) {\n        console.warn('[DataPost] Found meta-instruction in contentAngle:', cleaned);\n      }\n\n      // More aggressive patterns - match any variant\n      const patterns = [\n        /^Start with [\"']?secret[\"']?\\s*/i,\n        /^Start with [\"'][^\"']*[\"']\\s*/i,\n        /^Start with\\s+/i,\n        /^Begin with\\s+/i,\n        /^Create (a|an)\\s+/i,\n        /^Post (a|an)\\s+/i,\n        /^Share (a|an)\\s+/i,\n        /^Video series:\\s*/i,\n        /^POV:\\s*/i,\n        /^\"?secret\"?\\s*/i\n      ];\n\n      for (const pattern of patterns) {\n        const before = cleaned;\n        cleaned = cleaned.replace(pattern, '');\n        if (before !== cleaned) {\n          console.warn('[DataPost] Pattern matched and removed:', pattern, 'Result:', cleaned.substring(0, 50));\n        }\n      }\n\n      // Capitalize first letter if we cleaned something\n      if (cleaned !== text && cleaned.length > 0) {\n        cleaned = cleaned.charAt(0).toUpperCase() + cleaned.slice(1);\n      }\n\n      return cleaned;\n    };\n\n    // Use contentAngle if available (cleaned)\n    if (insight.contentAngle && insight.contentAngle.length > 10) {\n      let cleaned = cleanInstructions(insight.contentAngle);\n\n      // Headlines should be punchy, not paragraphs - take first sentence only\n      const firstSentence = cleaned.split('.')[0];\n\n      // Limit to 120 characters max (social media best practice)\n      if (firstSentence.length > 120) {\n        cleaned = firstSentence.substring(0, 117) + '...';\n      } else {\n        cleaned = firstSentence;\n      }\n\n      console.log('[DataPost] Built headline from contentAngle:', cleaned);\n      return cleaned;\n    }\n\n    // Use first sentence of insight (cleaned)\n    const firstSentence = cleanInstructions(insight.insight.split('.')[0]);\n    return firstSentence.length > 120 ? firstSentence.substring(0, 117) + '...' : firstSentence;\n  }\n\n  /**\n   * Generate relevant hashtags\n   */\n  private generateHashtags(\n    insight: BreakthroughInsight,\n    business: BusinessProfile\n  ): string[] {\n    const industry = business.industry.toLowerCase().replace(/\\s+/g, '');\n\n    return [\n      industry,\n      'data',\n      'insights',\n      'research',\n      'trends'\n    ].slice(0, 5);\n  }\n\n  /**\n   * Explain why a specific CTA was chosen\n   */\n  private explainCTAChoice(business: BusinessProfile): string {\n    const industry = business.industry.toLowerCase();\n\n    if (industry.includes('cleaning') || industry.includes('janitorial') || industry.includes('facility')) {\n      return 'Cleaning service CTA emphasizes professional results and reliability - key factors for commercial clients';\n    } else if (industry.includes('bar') || industry.includes('pub') || industry.includes('nightclub')) {\n      return 'Bar/pub CTA invites immediate experience - driving foot traffic with social proof';\n    } else if (industry.includes('coffee') || industry.includes('cafe')) {\n      return 'Coffee CTA focuses on taste differentiation - sensory appeal for quality-conscious customers';\n    } else if (industry.includes('mattress') || industry.includes('furniture')) {\n      return 'Furniture CTA emphasizes personal fit and help - crucial for high-consideration purchases';\n    } else if (industry.includes('restaurant') || industry.includes('food')) {\n      return 'Restaurant CTA drives reservations - immediate action for dining experience';\n    } else if (industry.includes('event')) {\n      return 'Event service CTA focuses on detail handling - key trust factor for important occasions';\n    }\n\n    // Generic\n    return 'Generic CTA chosen - using direct action prompt as no industry-specific pattern matched';\n  }\n}\n","/**\n * PREMIUM CONTENT WRITER\n *\n * High-quality content generation using advanced copywriting frameworks\n * and storytelling techniques for engaging, professional content.\n */\n\nimport { chat } from '@/lib/openrouter';\nimport type { BreakthroughInsight } from '@/types/synapse.types';\nimport type { BusinessProfile } from '@/types/synapseContent.types';\n\nexport interface PremiumContent {\n  headline: string;\n  hook: string;\n  body: string;\n  cta: string;\n  hashtags: string[];\n}\n\nexport class PremiumContentWriter {\n  /**\n   * Generate high-quality content using Claude Opus for superior writing\n   */\n  async generatePremiumContent(\n    insight: BreakthroughInsight,\n    business: BusinessProfile,\n    platform: 'linkedin' | 'facebook' | 'instagram' | 'twitter'\n  ): Promise<PremiumContent> {\n    const prompt = this.buildPremiumPrompt(insight, business, platform);\n\n    try {\n      // Use Sonnet 4.5 for fast, high-quality writing\n      const response = await chat([\n        {\n          role: 'user',\n          content: prompt\n        }\n      ], {\n        model: 'anthropic/claude-sonnet-4.5',\n        temperature: 0.7,\n        max_tokens: 1500\n      });\n\n      return this.parseResponse(response);\n    } catch (error) {\n      console.error('[PremiumContentWriter] Generation failed:', error);\n      // Fallback to basic content if premium fails\n      return this.generateFallbackContent(insight, business);\n    }\n  }\n\n  private buildPremiumPrompt(\n    insight: BreakthroughInsight,\n    business: BusinessProfile,\n    platform: string\n  ): string {\n    const platformConfigs = {\n      linkedin: {\n        tone: 'professional yet personable',\n        length: '1200-1500 characters',\n        style: 'thought leadership',\n        hashtagCount: 5\n      },\n      facebook: {\n        tone: 'friendly and conversational',\n        length: '800-1000 characters',\n        style: 'storytelling',\n        hashtagCount: 3\n      },\n      instagram: {\n        tone: 'inspiring and visual',\n        length: '500-800 characters',\n        style: 'emotional storytelling',\n        hashtagCount: 10\n      },\n      twitter: {\n        tone: 'punchy and provocative',\n        length: '250-280 characters',\n        style: 'hook-driven',\n        hashtagCount: 2\n      }\n    };\n\n    const platformConfig = platformConfigs[platform as keyof typeof platformConfigs] || platformConfigs.linkedin;\n\n    return `You are a world-class copywriter specializing in ${platform} content for ${business.industry} businesses.\n\nBUSINESS CONTEXT:\n- Business: ${business.name}\n- Industry: ${business.industry}\n- Location: ${business.location?.city}, ${business.location?.state}\n\nBREAKTHROUGH INSIGHT TO LEVERAGE:\n- Core Insight: ${insight.insight}\n- Why It Matters: ${insight.whyProfound}\n- Content Angle: ${insight.contentAngle || insight.insight}\n- Evidence: ${insight.evidence?.join('; ')}\n- Timing: ${insight.whyNow}\n\nWRITING REQUIREMENTS:\n- Platform: ${platform}\n- Tone: ${platformConfig.tone}\n- Length: ${platformConfig.length}\n- Style: ${platformConfig.style}\n\nCreate compelling content using the StoryBrand framework:\n\n1. HEADLINE (one powerful line that stops scrolling)\n   - Hook attention immediately\n   - Make them curious\n   - Promise value\n\n2. HOOK (2-3 sentences that create emotional connection)\n   - Identify the problem\n   - Empathize with their pain\n   - Hint at the solution\n\n3. BODY (flowing narrative, NOT bullet points)\n   - Tell a mini-story or paint a picture\n   - Use specific examples and scenarios\n   - Build desire for the solution\n   - Include social proof if relevant\n   - Create urgency without being pushy\n   - Write in active voice\n   - Use power words and emotional triggers\n   - Include transitions between ideas\n\n4. CTA (clear, specific action)\n   - Tell them exactly what to do\n   - Make it easy and appealing\n   - Create FOMO if appropriate\n\n5. HASHTAGS (${platformConfig.hashtagCount} relevant tags)\n   - Mix branded, industry, and trending\n\nCRITICAL RULES:\n- Write flowing paragraphs, NOT disconnected bullet points\n- Use storytelling and emotion, not just facts\n- Connect ideas with smooth transitions\n- Be specific, not generic\n- Show, don't tell\n- Use \"you\" to speak directly to the reader\n- Include sensory details when relevant\n\nCRITICAL: Respond with ONLY valid JSON. No preamble, no explanation, no markdown. Just the JSON object.\n\n{\n  \"headline\": \"attention-grabbing headline\",\n  \"hook\": \"emotional hook that creates connection\",\n  \"body\": \"compelling narrative body (multiple paragraphs)\",\n  \"cta\": \"specific call to action\",\n  \"hashtags\": [\"tag1\", \"tag2\", ...]\n}`;\n  }\n\n  private parseResponse(response: string): PremiumContent {\n    try {\n      let jsonStr = response.trim();\n\n      // Try 1: Remove markdown code blocks\n      if (jsonStr.includes('```json')) {\n        const match = jsonStr.match(/```json\\s*([\\s\\S]*?)\\s*```/);\n        if (match) {\n          jsonStr = match[1].trim();\n        }\n      } else if (jsonStr.includes('```')) {\n        const match = jsonStr.match(/```\\s*([\\s\\S]*?)\\s*```/);\n        if (match) {\n          jsonStr = match[1].trim();\n        }\n      }\n\n      // Try 2: Extract JSON object even if there's text before/after\n      if (!jsonStr.startsWith('{')) {\n        const match = jsonStr.match(/\\{[\\s\\S]*\\}/);\n        if (match) {\n          jsonStr = match[0];\n        }\n      }\n\n      // Try 3: Fix common JSON errors before parsing\n      // This is a more robust approach to fix JSON with embedded newlines\n      try {\n        // First attempt: direct parse\n        const json = JSON.parse(jsonStr);\n        return {\n          headline: json.headline || '',\n          hook: json.hook || '',\n          body: json.body || '',\n          cta: json.cta || '',\n          hashtags: json.hashtags || []\n        };\n      } catch (firstError) {\n        // Second attempt: Fix newlines inside string values\n        // Match each field and escape newlines within it\n        const fixedJson = jsonStr.replace(\n          /\"(headline|hook|body|cta)\":\\s*\"((?:[^\"\\\\]|\\\\.)*)\"/g,\n          (match, key, value) => {\n            // Escape unescaped newlines\n            const escapedValue = value\n              .replace(/\\n/g, '\\\\n')\n              .replace(/\\r/g, '\\\\r')\n              .replace(/\\t/g, '\\\\t');\n            return `\"${key}\": \"${escapedValue}\"`;\n          }\n        );\n\n        const json = JSON.parse(fixedJson);\n        return {\n          headline: json.headline || '',\n          hook: json.hook || '',\n          body: json.body || '',\n          cta: json.cta || '',\n          hashtags: json.hashtags || []\n        };\n      }\n    } catch (error) {\n      console.error('[PremiumContentWriter] Failed to parse response:', error);\n      console.log('[PremiumContentWriter] Raw response:', response.substring(0, 500));\n\n      // Try to return partial data if some fields are present\n      try {\n        // Sometimes the response is truncated - try to extract what we can\n        const headlineMatch = response.match(/\"headline\":\\s*\"([^\"]+)\"/);\n        const hookMatch = response.match(/\"hook\":\\s*\"([^\"]+)\"/);\n        const bodyMatch = response.match(/\"body\":\\s*\"([^\"]+)\"/);\n        const ctaMatch = response.match(/\"cta\":\\s*\"([^\"]+)\"/);\n\n        if (headlineMatch || hookMatch) {\n          console.warn('[PremiumContentWriter] Using partial response data');\n          return {\n            headline: headlineMatch?.[1] || 'Content ready',\n            hook: hookMatch?.[1] || '',\n            body: bodyMatch?.[1] || '',\n            cta: ctaMatch?.[1] || 'Learn more',\n            hashtags: []\n          };\n        }\n      } catch (recoveryError) {\n        // Ignore recovery errors\n      }\n\n      throw error;\n    }\n  }\n\n  private generateFallbackContent(\n    insight: BreakthroughInsight,\n    business: BusinessProfile\n  ): PremiumContent {\n    // Basic fallback if API fails\n    return {\n      headline: insight.contentAngle || insight.insight,\n      hook: insight.whyProfound || 'Discover what matters most.',\n      body: `${insight.evidence?.join('. ')}. ${insight.whyNow}`,\n      cta: `Learn more at ${business.name}.`,\n      hashtags: business.industry.toLowerCase().split(' ').filter(w => w.length > 3)\n    };\n  }\n\n  /**\n   * Enhance existing content with better writing\n   */\n  async enhanceContent(\n    existingContent: {\n      headline: string;\n      hook: string;\n      body: string;\n      cta: string;\n    },\n    business: BusinessProfile,\n    platform: string\n  ): Promise<PremiumContent> {\n    const prompt = `You are a world-class copy editor. Rewrite this content to be more engaging and professional.\n\nCURRENT CONTENT:\nHeadline: ${existingContent.headline}\nHook: ${existingContent.hook}\nBody: ${existingContent.body}\nCTA: ${existingContent.cta}\n\nREQUIREMENTS:\n- Platform: ${platform}\n- Business: ${business.name} (${business.industry})\n- Transform choppy bullet points into flowing narrative\n- Add emotional resonance and storytelling\n- Use active voice and power words\n- Create smooth transitions\n- Make it conversational yet professional\n\nRewrite this content to be compelling and engaging. Focus on storytelling, emotion, and clear value.\n\nCRITICAL: Respond with ONLY valid JSON. No preamble, no explanation, no markdown. Just the JSON object.\n\n{\n  \"headline\": \"improved headline\",\n  \"hook\": \"improved hook\",\n  \"body\": \"improved body with flowing narrative\",\n  \"cta\": \"improved cta\",\n  \"hashtags\": [\"relevant\", \"tags\"]\n}`;\n\n    try {\n      const response = await chat([\n        {\n          role: 'user',\n          content: prompt\n        }\n      ], {\n        model: 'anthropic/claude-sonnet-4.5',\n        temperature: 0.7,\n        max_tokens: 1000\n      });\n\n      return this.parseResponse(response);\n    } catch (error) {\n      console.error('[PremiumContentWriter] Enhancement failed:', error);\n      return {\n        ...existingContent,\n        hashtags: []\n      };\n    }\n  }\n}","/**\n * Controversial Post Generator\n *\n * Generates debate-starting content that challenges conventional wisdom\n * using the Problem-Agitate-Solution (PAS) framework.\n *\n * Framework: Problem-Agitate-Solution\n * - Problem: Identify the flawed conventional wisdom\n * - Agitate: Amplify the cost of believing it\n * - Solution: Present the counter-intuitive truth\n *\n * Created: 2025-11-10\n * Updated: 2025-11-11 - COMPLETE REWRITE to use framework-guided generation\n */\n\nimport type { BreakthroughInsight } from '@/types/breakthrough.types';\nimport type {\n  ContentDraft,\n  SynapseContent,\n  BusinessProfile\n} from '@/types/synapseContent.types';\nimport { PowerWordOptimizer } from '../PowerWordOptimizer';\nimport { PROBLEM_AGITATE_SOLUTION, type ContentFramework } from '../ContentFrameworkLibrary';\nimport { detectTargetAudience, getCleanEvidence } from '../utils/audienceDetection';\nimport { PremiumContentWriter } from './PremiumContentWriter';\n\nexport class ControversialPostGenerator {\n  private powerWordOptimizer: PowerWordOptimizer;\n  private framework: ContentFramework;\n  private premiumWriter: PremiumContentWriter;\n\n  constructor() {\n    this.powerWordOptimizer = new PowerWordOptimizer();\n    this.framework = PROBLEM_AGITATE_SOLUTION;\n    this.premiumWriter = new PremiumContentWriter();\n  }\n\n  /**\n   * Generate a controversial post from an insight\n   */\n  async generate(\n    insight: BreakthroughInsight,\n    business: BusinessProfile,\n    platform: 'linkedin' | 'facebook' | 'instagram' | 'twitter' = 'linkedin'\n  ): Promise<SynapseContent> {\n    // Detect actual target audience\n    const targetAudience = detectTargetAudience(business);\n\n    // Get clean evidence for provenance tracking\n    const cleanEvidence = getCleanEvidence(insight.evidence, 3);\n\n    // Use PremiumContentWriter for high-quality content generation\n    const premiumContent = await this.premiumWriter.generatePremiumContent(\n      insight,\n      business,\n      platform\n    );\n\n    // Extract the optimized content\n    const optimized = {\n      headline: premiumContent.headline,\n      hook: premiumContent.hook,\n      body: premiumContent.body,\n      cta: premiumContent.cta\n    };\n\n    // Build complete content object\n    const content: SynapseContent = {\n      id: `content-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n      insightId: insight.id,\n      format: 'controversial-post',\n\n      content: {\n        headline: optimized.headline,\n        hook: optimized.hook,\n        body: optimized.body,\n        cta: optimized.cta,\n        hashtags: premiumContent.hashtags || this.generateHashtags(insight, business)\n      },\n\n      psychology: {\n        principle: 'Cognitive Dissonance',\n        trigger: {\n          type: 'anger',\n          strength: 0.85,\n          target: 'engagement'\n        },\n        persuasionTechnique: 'Contrarian Challenge',\n        expectedReaction: insight.expectedReaction || 'This challenges what I believe... let me think about it'\n      },\n\n      optimization: {\n        powerWords: this.powerWordOptimizer.extractPowerWords(\n          `${optimized.headline} ${optimized.hook} ${optimized.body}`\n        ),\n        framingDevice: this.framework.name,\n        narrativeStructure: this.framework.stages.map(s => s.name).join(' → '),\n        pacing: 'Fast (debate-driving)'\n      },\n\n      meta: {\n        platform: ['LinkedIn', 'Twitter'],\n        tone: 'controversial',\n        targetAudience\n      },\n\n      prediction: {\n        engagementScore: this.predictEngagement(insight),\n        viralPotential: this.predictViralPotential(insight),\n        leadGeneration: 0.55,\n        brandImpact: this.predictBrandImpact(insight),\n        confidenceLevel: insight.confidence\n      },\n\n      framework: {\n        id: this.framework.id,\n        name: this.framework.name,\n        stages: this.framework.stages.map(s => s.name),\n        reasoning: 'PAS framework perfect for challenging conventional wisdom with substantive arguments'\n      },\n\n      provenance: {\n        // DEEP PROVENANCE: Merge from insight generation\n        ...((insight as any).deepProvenance || {}),\n\n        // Standard provenance tracking\n        dataSourcesUsed: insight.dataUsed || [],\n        psychologyTrigger: 'Cognitive Dissonance - Challenge conventional wisdom',\n        trendingTopicMatched: insight.title,\n\n        frameworkStagesUsed: [\n          {\n            stage: 'Problem (Hook)',\n            sourceField: insight.whyProfound && insight.whyProfound.length > 30 ? 'whyProfound' : 'insight',\n            content: optimized.hook.substring(0, 100)\n          },\n          {\n            stage: 'Agitate (Body)',\n            sourceField: cleanEvidence.length > 0 ? 'evidence + whyNow' : 'insight + whyNow',\n            content: optimized.body.substring(0, 100)\n          },\n          {\n            stage: 'Solution (CTA)',\n            sourceField: 'business.industry (industry-specific CTA)',\n            content: optimized.cta\n          }\n        ],\n\n        contentAssembly: {\n          headline: {\n            source: 'insight.contentAngle (first sentence, 120 char limit)',\n            field: 'contentAngle',\n            preview: optimized.headline.substring(0, 80)\n          },\n          hook: {\n            source: insight.whyProfound && insight.whyProfound.length > 30\n              ? 'insight.whyProfound'\n              : 'insight.insight',\n            field: insight.whyProfound && insight.whyProfound.length > 30 ? 'whyProfound' : 'insight',\n            preview: optimized.hook.substring(0, 80)\n          },\n          body: {\n            source: cleanEvidence.length > 0\n              ? 'insight.evidence + insight.whyNow'\n              : 'insight.insight + insight.whyNow',\n            field: cleanEvidence.length > 0 ? 'evidence + whyNow' : 'insight + whyNow',\n            preview: optimized.body.substring(0, 80)\n          },\n          cta: {\n            source: `Industry: ${business.industry}`,\n            field: 'business.industry',\n            preview: optimized.cta\n          }\n        },\n\n        decisions: {\n          whyThisFormat: 'Controversial format chosen for counter-intuitive insights that challenge conventional wisdom',\n          whyThisTone: 'Controversial tone to drive debate and engagement',\n          whyThisCTA: this.explainCTAChoice(business, insight)\n        }\n      },\n\n      metadata: {\n        generatedAt: new Date(),\n        model: 'ControversialPostGenerator',\n        iterationCount: 1,\n        impactScore: insight.confidence\n      }\n    };\n\n    return content;\n  }\n\n  /**\n   * Generate draft following Problem-Agitate-Solution framework\n   *\n   * This is the KEY METHOD - it walks through PAS framework stages\n   * and uses the stage guidelines to construct controversial content\n   */\n  private generateFrameworkGuidedDraft(\n    insight: BreakthroughInsight,\n    business: BusinessProfile,\n    targetAudience: string\n  ): ContentDraft {\n    // Get clean evidence (filter out search keywords)\n    const cleanEvidence = getCleanEvidence(insight.evidence, 3);\n\n    // STAGE 1: PROBLEM\n    // Purpose: Identify the flawed conventional wisdom\n    const problem = this.buildProblemStage(insight, targetAudience);\n\n    // STAGE 2: AGITATE\n    // Purpose: Amplify the cost/pain of believing the flawed wisdom\n    const agitate = this.buildAgitateStage(insight, cleanEvidence);\n\n    // STAGE 3: SOLUTION\n    // Purpose: Present the counter-intuitive truth with evidence\n    const solution = this.buildSolutionStage(insight);\n\n    // Build business-specific CTA\n    const cta = this.buildInsightSpecificCTA(insight, business, targetAudience);\n\n    // Assemble into content structure\n    const headline = this.buildHeadline(insight);\n    const hook = problem;\n\n    // Build body from non-empty parts\n    const bodyParts = [agitate, solution].filter(part => part.length > 0);\n    const body = bodyParts.join('\\n\\n');\n\n    return {\n      format: 'controversial-post',\n      headline,\n      hook,\n      body,\n      cta\n    };\n  }\n\n  /**\n   * STAGE 1: Build Problem (The Conventional Wisdom)\n   *\n   * Framework guideline: \"Identify the problem\"\n   * Uses: insight as the truth, so we need to present what people WRONGLY believe\n   *\n   * IMPORTANT: Hook should provide CONTEXT/SETUP, not repeat the headline\n   */\n  private buildProblemStage(insight: BreakthroughInsight, targetAudience: string): string {\n    // The hook should set up the problem/context, not repeat the headline\n    // Use whyProfound or insight as setup if contentAngle is too similar to headline\n\n    // If we have whyProfound, use that as the hook (it provides context)\n    if (insight.whyProfound && insight.whyProfound.length > 30) {\n      return insight.whyProfound;\n    }\n\n    // Otherwise, use the insight itself (not contentAngle, which is used for headline)\n    return insight.insight;\n  }\n\n  /**\n   * STAGE 2: Build Agitate (Amplify the Pain)\n   *\n   * Framework guideline: \"Amplify the pain of the problem\"\n   * Uses: evidence, timing, and insight to build the case\n   *\n   * NO TEMPLATES - Just output the actual content\n   * IMPORTANT: Build substantial body content to avoid thin posts\n   * CRITICAL: Avoid repeating what's already in the hook\n   */\n  private buildAgitateStage(insight: BreakthroughInsight, cleanEvidence: string[]): string {\n    const parts: string[] = [];\n\n    // Skip insight entirely if whyProfound was used for hook (they're related concepts)\n    // This prevents repetition like \"timing anxiety\" in hook and \"worry about timing\" in body\n\n    // Prioritize evidence (provides concrete substantiation without repeating concepts)\n    // Format evidence as cohesive paragraphs, not bullet points\n    if (cleanEvidence.length > 0) {\n      // Group evidence into flowing narrative\n      if (cleanEvidence.length === 1) {\n        // Single evidence point - make it a complete sentence\n        const evidence = cleanEvidence[0];\n        parts.push(evidence.endsWith('.') ? evidence : evidence + '.');\n      } else if (cleanEvidence.length === 2) {\n        // Two evidence points - connect with transition\n        parts.push(`${cleanEvidence[0]}. ${cleanEvidence[1]}.`);\n      } else {\n        // Multiple evidence points - create flowing paragraph\n        const formatted = cleanEvidence\n          .map(e => e.endsWith('.') ? e : e + '.')\n          .join(' ');\n        parts.push(formatted);\n      }\n    }\n\n    // Add timing/urgency if present\n    if (insight.whyNow && insight.whyNow.length > 15) {\n      parts.push(insight.whyNow);\n    }\n\n    // Only if we have NOTHING else, fall back to insight\n    if (parts.length === 0 && insight.insight) {\n      parts.push(insight.insight);\n    }\n\n    return parts.join('\\n\\n');\n  }\n\n  /**\n   * STAGE 3: Build Solution (The Path Forward)\n   *\n   * Framework guideline: \"Provide the solution\"\n   * This stage is optional - CTA provides the actual solution/action\n   *\n   * NO TEMPLATES - Just output the actual content\n   * IMPORTANT: Keep this minimal - the CTA is the real solution\n   */\n  private buildSolutionStage(insight: BreakthroughInsight): string {\n    // Solution stage is optional for social posts - the CTA is the real solution\n    // Return empty to avoid repetition with body content\n    return '';\n  }\n\n  /**\n   * Build an insight-specific CTA rather than generic \"helps X do Y\"\n   */\n  private buildInsightSpecificCTA(\n    insight: BreakthroughInsight,\n    business: BusinessProfile,\n    targetAudience: string\n  ): string {\n    const industry = business.industry.toLowerCase();\n    const angle = (insight.contentAngle || insight.insight).toLowerCase();\n\n    // INDUSTRY FIRST - check business type before content matching\n    // This prevents \"office\" content from triggering wrong CTAs for cleaning services\n    if (industry.includes('cleaning') || industry.includes('janitorial') || industry.includes('facility')) {\n      return `${business.name} keeps your space spotless and professional. Book your service today.`;\n    } else if (industry.includes('bar') || industry.includes('pub') || industry.includes('nightclub')) {\n      return `Stop by ${business.name} and experience it yourself. See you soon.`;\n    } else if (industry.includes('coffee') || industry.includes('cafe')) {\n      return `Try ${business.name} and taste the difference. Visit us today.`;\n    } else if (industry.includes('mattress') || industry.includes('furniture')) {\n      return `Visit ${business.name} and find your perfect match. Stop by today.`;\n    } else if (industry.includes('restaurant') || industry.includes('food')) {\n      return `Experience it at ${business.name}. Reserve your table today.`;\n    }\n\n    // Content-based CTAs only if industry didn't match\n    if (angle.includes('wedding')) {\n      return `Want this at your next event? ${business.name} brings the experience. DM us to book.`;\n    } else if (angle.includes('office') || angle.includes('corporate')) {\n      return `${business.name} handles the details. Let's talk about your needs.`;\n    } else if (angle.includes('event')) {\n      return `Planning something special? ${business.name} creates experiences people remember. Reach out.`;\n    }\n\n    // Generic fallback - more direct and actionable\n    return `Visit ${business.name} and see the difference. We're ready when you are.`;\n  }\n\n  /**\n   * Build headline\n   */\n  private buildHeadline(insight: BreakthroughInsight): string {\n    // Clean meta-instructions helper\n    const cleanInstructions = (text: string): string => {\n      let cleaned = text;\n\n      // Log original for debugging\n      if (cleaned.toLowerCase().includes('start with') || cleaned.toLowerCase().includes('secret')) {\n        console.warn('[ControversialPost] Found meta-instruction in contentAngle:', cleaned);\n      }\n\n      // More aggressive patterns - match any variant\n      const patterns = [\n        /^Start with [\"']?secret[\"']?\\s*/i,\n        /^Start with [\"'][^\"']*[\"']\\s*/i,\n        /^Start with\\s+/i,\n        /^Begin with\\s+/i,\n        /^Create (a|an)\\s+/i,\n        /^Post (a|an)\\s+/i,\n        /^Share (a|an)\\s+/i,\n        /^Video series:\\s*/i,\n        /^POV:\\s*/i,\n        /^\"?secret\"?\\s*/i\n      ];\n\n      for (const pattern of patterns) {\n        const before = cleaned;\n        cleaned = cleaned.replace(pattern, '');\n        if (before !== cleaned) {\n          console.warn('[ControversialPost] Pattern matched and removed:', pattern, 'Result:', cleaned.substring(0, 50));\n        }\n      }\n\n      // Capitalize first letter if we cleaned something\n      if (cleaned !== text && cleaned.length > 0) {\n        cleaned = cleaned.charAt(0).toUpperCase() + cleaned.slice(1);\n      }\n\n      return cleaned;\n    };\n\n    // Priority: contentAngle if it exists (cleaned)\n    if (insight.contentAngle && insight.contentAngle.length > 10) {\n      let cleaned = cleanInstructions(insight.contentAngle);\n\n      // Headlines should be punchy, not paragraphs - take first sentence only\n      const firstSentence = cleaned.split('.')[0];\n\n      // Limit to 120 characters max (social media best practice)\n      if (firstSentence.length > 120) {\n        cleaned = firstSentence.substring(0, 117) + '...';\n      } else {\n        cleaned = firstSentence;\n      }\n\n      console.log('[ControversialPost] Built headline from contentAngle:', cleaned);\n      return cleaned;\n    }\n\n    // Use first sentence of core insight (cleaned)\n    const firstSentence = cleanInstructions(insight.insight.split('.')[0]);\n    return firstSentence.length > 120 ? firstSentence.substring(0, 117) + '...' : firstSentence;\n  }\n\n  /**\n   * Generate relevant hashtags\n   */\n  private generateHashtags(\n    insight: BreakthroughInsight,\n    business: BusinessProfile\n  ): string[] {\n    // Extract meaningful keywords from industry name\n    const industryWords = business.industry\n      .toLowerCase()\n      .replace(/[()]/g, '') // Remove parentheses\n      .split(/\\s+/)\n      .filter(word => word.length > 3) // Skip short words like \"and\", \"of\", \"the\"\n      .filter(word => !['except', 'other', 'services', 'general'].includes(word)); // Skip generic words\n\n    // Take top 2 industry keywords\n    const industryTags = industryWords.slice(0, 2);\n\n    // Add engaging hashtags based on content type\n    const engagementTags = ['truth', 'mindset', 'insights'];\n\n    return [\n      ...industryTags,\n      ...engagementTags\n    ].slice(0, 5);\n  }\n\n  /**\n   * Predict engagement score\n   */\n  private predictEngagement(insight: BreakthroughInsight): number {\n    let score = 0.8; // Base score for controversial content\n\n    // Counter-intuitive insights drive higher engagement\n    if (insight.type === 'counter_intuitive') {\n      score += 0.15;\n    }\n\n    // High confidence means defensible position = more engagement\n    if (insight.confidence > 0.8) {\n      score += 0.05;\n    }\n\n    return Math.min(score, 1.0);\n  }\n\n  /**\n   * Predict viral potential\n   */\n  private predictViralPotential(insight: BreakthroughInsight): number {\n    let score = 0.75; // Base score for controversial content\n\n    // Counter-intuitive insights are highly shareable\n    if (insight.type === 'counter_intuitive') {\n      score += 0.2;\n    }\n\n    return Math.min(score, 1.0);\n  }\n\n  /**\n   * Predict brand impact\n   */\n  private predictBrandImpact(insight: BreakthroughInsight): 'positive' | 'neutral' | 'risky' {\n    // High confidence controversial = positive (thought leadership)\n    if (insight.confidence > 0.8) {\n      return 'positive';\n    }\n\n    // Medium confidence = neutral (some risk but manageable)\n    if (insight.confidence > 0.6) {\n      return 'neutral';\n    }\n\n    // Lower confidence controversial = risky\n    return 'risky';\n  }\n\n  /**\n   * Explain why a specific CTA was chosen\n   */\n  private explainCTAChoice(business: BusinessProfile, insight: BreakthroughInsight): string {\n    const industry = business.industry.toLowerCase();\n\n    if (industry.includes('cleaning') || industry.includes('janitorial') || industry.includes('facility')) {\n      return 'Cleaning service CTA emphasizes professionalism and reliability - key trust factors for commercial clients';\n    } else if (industry.includes('bar') || industry.includes('pub') || industry.includes('nightclub')) {\n      return 'Bar/pub CTA invites experience and visit - social proof driven for hospitality';\n    } else if (industry.includes('coffee') || industry.includes('cafe')) {\n      return 'Coffee CTA focuses on taste and quality differentiation - sensory appeal for beverage business';\n    } else if (industry.includes('mattress') || industry.includes('furniture')) {\n      return 'Furniture CTA emphasizes finding perfect match - personal fit is crucial for big purchases';\n    } else if (industry.includes('restaurant') || industry.includes('food')) {\n      return 'Restaurant CTA focuses on experience and reservation - driving immediate action';\n    }\n\n    // Generic\n    return 'Generic CTA chosen - industry-specific patterns not found, using direct action prompt';\n  }\n}\n","/**\n * Email Generator\n *\n * Generates conversion-optimized email content using proven frameworks:\n * - Email AIDA: Classic attention-interest-desire-action\n * - Email PAS: Problem-agitate-solution for pain-driven conversion\n *\n * Created: 2025-11-11\n */\n\nimport type { BreakthroughInsight } from '@/types/breakthrough.types';\nimport type {\n  ContentDraft,\n  SynapseContent,\n  BusinessProfile\n} from '@/types/synapseContent.types';\nimport { frameworkLibrary, EMAIL_AIDA, EMAIL_PAS } from '../ContentFrameworkLibrary';\n\nexport class EmailGenerator {\n  /**\n   * Generate email content from insight\n   */\n  async generate(\n    insight: BreakthroughInsight,\n    business: BusinessProfile,\n    emailType: 'newsletter' | 'promo' | 'sequence' = 'newsletter'\n  ): Promise<SynapseContent> {\n    // Select framework based on insight type and goal\n    const framework = insight.type === 'counter_intuitive'\n      ? EMAIL_PAS\n      : EMAIL_AIDA;\n\n    // Generate content following framework stages\n    const subjectLine = this.generateSubjectLine(insight, business, framework.id);\n    const preheader = this.generatePreheader(insight);\n    const body = this.generateEmailBody(insight, business, framework.id);\n    const cta = this.generateCTA(insight, business);\n    const ps = this.generatePS(insight);\n\n    const format = emailType === 'newsletter'\n      ? 'email-newsletter'\n      : emailType === 'promo'\n        ? 'email-promo'\n        : 'email-sequence';\n\n    return {\n      id: `email-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n      insightId: insight.id,\n      format: format as any,\n\n      content: {\n        headline: subjectLine,\n        hook: preheader,\n        body,\n        cta,\n        subjectLine,\n        preheader,\n        ps\n      },\n\n      psychology: {\n        principle: framework.id === 'email-pas' ? 'Loss Aversion' : 'Curiosity Gap',\n        trigger: {\n          type: framework.id === 'email-pas' ? 'fear' : 'curiosity',\n          strength: 0.85,\n          target: 'conversion'\n        },\n        persuasionTechnique: framework.id === 'email-pas' ? 'Problem Amplification' : 'AIDA',\n        expectedReaction: 'I need to click this and learn more'\n      },\n\n      optimization: {\n        powerWords: this.extractPowerWords(subjectLine + body),\n        framingDevice: framework.name,\n        narrativeStructure: framework.stages.map(s => s.name).join(' → '),\n        pacing: 'Medium (email-optimized)'\n      },\n\n      meta: {\n        platform: ['Email'],\n        tone: 'professional',\n        targetAudience: business.targetAudience\n      },\n\n      prediction: {\n        engagementScore: 0.75,\n        viralPotential: 0.3, // Email doesn't go viral\n        leadGeneration: 0.9, // Email is excellent for lead gen\n        brandImpact: 'positive',\n        confidenceLevel: insight.confidence\n      },\n\n      framework: {\n        id: framework.id,\n        name: framework.name,\n        stages: framework.stages.map(s => s.name),\n        reasoning: `${framework.name} selected because it's proven for ${emailType} emails`\n      },\n\n      metadata: {\n        generatedAt: new Date(),\n        model: 'EmailGenerator',\n        iterationCount: 1,\n        impactScore: insight.confidence\n      }\n    };\n  }\n\n  private generateSubjectLine(\n    insight: BreakthroughInsight,\n    business: BusinessProfile,\n    frameworkId: string\n  ): string {\n    if (frameworkId === 'email-pas') {\n      return `${business.name}: ${insight.insight.split('.')[0].substring(0, 50)}?`;\n    }\n    return insight.contentAngle || insight.insight.substring(0, 60);\n  }\n\n  private generatePreheader(insight: BreakthroughInsight): string {\n    return insight.whyProfound.substring(0, 100);\n  }\n\n  private generateEmailBody(\n    insight: BreakthroughInsight,\n    business: BusinessProfile,\n    frameworkId: string\n  ): string {\n    if (frameworkId === 'email-pas') {\n      return `Hey there,\n\n${insight.insight}\n\n${insight.whyProfound}\n\n${insight.evidence.slice(0, 2).map(e => `• ${e}`).join('\\n')}\n\n${insight.whyNow ? `Why this matters now: ${insight.whyNow}` : ''}\n\nReady to take action?`;\n    }\n\n    // AIDA structure\n    return `Hi,\n\n${insight.insight}\n\nHere's why this matters:\n${insight.whyProfound}\n\nThe evidence:\n${insight.evidence.slice(0, 3).map(e => `• ${e}`).join('\\n')}\n\n${insight.whyNow ? `\\n${insight.whyNow}` : ''}`;\n  }\n\n  private generateCTA(insight: BreakthroughInsight, business: BusinessProfile): string {\n    return `Learn more about how ${business.name} can help →`;\n  }\n\n  private generatePS(insight: BreakthroughInsight): string {\n    return `P.S. ${insight.expectedReaction}`;\n  }\n\n  private extractPowerWords(text: string): string[] {\n    const powerWords = ['discover', 'proven', 'exclusive', 'new', 'secret', 'now', 'today'];\n    return powerWords.filter(word => text.toLowerCase().includes(word));\n  }\n}\n","/**\n * Blog Generator\n *\n * Generates SEO-optimized blog content using proven frameworks:\n * - How-To Guide: Step-by-step educational content\n * - Listicle: Numbered list format for easy scanning\n *\n * Created: 2025-11-11\n */\n\nimport type { BreakthroughInsight } from '@/types/breakthrough.types';\nimport type {\n  SynapseContent,\n  BusinessProfile\n} from '@/types/synapseContent.types';\nimport { BLOG_HOW_TO, BLOG_LISTICLE } from '../ContentFrameworkLibrary';\n\nexport class BlogGenerator {\n  async generate(\n    insight: BreakthroughInsight,\n    business: BusinessProfile,\n    blogType: 'how-to' | 'listicle' | 'case-study' = 'how-to'\n  ): Promise<SynapseContent> {\n    const framework = blogType === 'listicle' ? BLOG_LISTICLE : BLOG_HOW_TO;\n\n    const headline = this.generateSEOHeadline(insight, business, blogType);\n    const metaDescription = this.generateMetaDescription(insight);\n    const slug = this.generateSlug(headline);\n    const body = this.generateBlogBody(insight, business, blogType);\n\n    const format = blogType === 'how-to'\n      ? 'blog-how-to'\n      : blogType === 'listicle'\n        ? 'blog-listicle'\n        : 'blog-case-study';\n\n    return {\n      id: `blog-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n      insightId: insight.id,\n      format: format as any,\n\n      content: {\n        headline,\n        hook: `## Introduction\\n\\n${insight.whyProfound}`,\n        body,\n        cta: `\\n\\n## Conclusion\\n\\nReady to implement these insights? [Contact ${business.name}](#) to learn more.`,\n        seoTitle: headline,\n        metaDescription,\n        slug\n      },\n\n      psychology: {\n        principle: 'Social Proof + Authority',\n        trigger: {\n          type: 'curiosity',\n          strength: 0.75,\n          target: 'education'\n        },\n        persuasionTechnique: 'Educational Authority',\n        expectedReaction: 'This is valuable, actionable content'\n      },\n\n      optimization: {\n        powerWords: this.extractPowerWords(headline + body),\n        framingDevice: framework.name,\n        narrativeStructure: framework.stages.map(s => s.name).join(' → '),\n        pacing: 'Slow (comprehensive)'\n      },\n\n      meta: {\n        platform: ['Blog', 'LinkedIn'],\n        tone: 'educational',\n        targetAudience: business.targetAudience\n      },\n\n      prediction: {\n        engagementScore: 0.7,\n        viralPotential: 0.5,\n        leadGeneration: 0.8,\n        brandImpact: 'positive',\n        confidenceLevel: insight.confidence\n      },\n\n      framework: {\n        id: framework.id,\n        name: framework.name,\n        stages: framework.stages.map(s => s.name),\n        reasoning: `${framework.name} selected for SEO and educational value`\n      },\n\n      metadata: {\n        generatedAt: new Date(),\n        model: 'BlogGenerator',\n        iterationCount: 1,\n        impactScore: insight.confidence\n      }\n    };\n  }\n\n  private generateSEOHeadline(\n    insight: BreakthroughInsight,\n    business: BusinessProfile,\n    type: string\n  ): string {\n    if (type === 'listicle') {\n      return `5 ${business.industry} Insights That ${insight.expectedReaction}`;\n    }\n    return `How to ${insight.contentAngle || insight.insight.substring(0, 60)}`;\n  }\n\n  private generateMetaDescription(insight: BreakthroughInsight): string {\n    return `${insight.insight.substring(0, 140)}...`;\n  }\n\n  private generateSlug(headline: string): string {\n    return headline\n      .toLowerCase()\n      .replace(/[^a-z0-9]+/g, '-')\n      .replace(/^-+|-+$/g, '')\n      .substring(0, 60);\n  }\n\n  private generateBlogBody(\n    insight: BreakthroughInsight,\n    business: BusinessProfile,\n    type: string\n  ): string {\n    if (type === 'listicle') {\n      return `## The Insights\n\n### 1. ${insight.insight}\n\n${insight.whyProfound}\n\n${insight.evidence.map((e, i) => `**Evidence ${i + 1}:** ${e}`).join('\\n\\n')}\n\n### 2-5. [Additional insights would be generated from other synapses]\n\n## Why This Matters\n\n${insight.whyNow || insight.expectedReaction}`;\n    }\n\n    return `## Understanding the Challenge\n\n${insight.insight}\n\n## Why This Matters\n\n${insight.whyProfound}\n\n## The Evidence\n\n${insight.evidence.map((e, i) => `${i + 1}. ${e}`).join('\\n')  }\n\n## Taking Action\n\n${insight.contentAngle || 'Here\\'s how to apply this insight to your business.'}\n\n${insight.whyNow ? `\\n## Timing is Critical\\n\\n${insight.whyNow}` : ''}`;\n  }\n\n  private extractPowerWords(text: string): string[] {\n    const powerWords = ['ultimate', 'complete', 'proven', 'essential', 'powerful', 'expert'];\n    return powerWords.filter(word => text.toLowerCase().includes(word));\n  }\n}\n","/**\n * Landing Page Generator\n *\n * Generates conversion-optimized landing page content using:\n * - Hero Section: Above-the-fold conversion formula\n * - PASTOR: Full sales page framework\n *\n * Created: 2025-11-11\n */\n\nimport type { BreakthroughInsight } from '@/types/breakthrough.types';\nimport type {\n  SynapseContent,\n  BusinessProfile\n} from '@/types/synapseContent.types';\nimport { LANDING_HERO, LANDING_PASTOR } from '../ContentFrameworkLibrary';\n\nexport class LandingPageGenerator {\n  async generate(\n    insight: BreakthroughInsight,\n    business: BusinessProfile,\n    pageType: 'hero' | 'sales' = 'hero'\n  ): Promise<SynapseContent> {\n    const framework = pageType === 'sales' ? LANDING_PASTOR : LANDING_HERO;\n\n    const headline = this.generateHeadline(insight, business);\n    const subheadline = this.generateSubheadline(insight, business);\n    const body = this.generateLandingPageBody(insight, business, pageType);\n    const cta = this.generateCTA(business);\n    const bulletPoints = this.generateBulletPoints(insight);\n    const socialProof = this.generateSocialProof(business);\n\n    const format = pageType === 'hero' ? 'landing-hero' : 'landing-sales';\n\n    return {\n      id: `landing-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n      insightId: insight.id,\n      format: format as any,\n\n      content: {\n        headline,\n        hook: subheadline,\n        body,\n        cta,\n        subheadline,\n        bulletPoints,\n        socialProof\n      },\n\n      psychology: {\n        principle: pageType === 'sales' ? 'Loss Aversion' : 'Clarity + Relevance',\n        trigger: {\n          type: pageType === 'sales' ? 'fear' : 'aspiration',\n          strength: 0.95,\n          target: 'conversion'\n        },\n        persuasionTechnique: framework.name,\n        expectedReaction: 'This is exactly what I need'\n      },\n\n      optimization: {\n        powerWords: this.extractPowerWords(headline + body),\n        framingDevice: framework.name,\n        narrativeStructure: framework.stages.map(s => s.name).join(' → '),\n        pacing: 'Fast (conversion-focused)'\n      },\n\n      meta: {\n        platform: ['Web'],\n        tone: 'professional',\n        targetAudience: business.targetAudience\n      },\n\n      prediction: {\n        engagementScore: 0.6,\n        viralPotential: 0.2,\n        leadGeneration: 1.0, // Maximum conversion focus\n        brandImpact: 'positive',\n        confidenceLevel: insight.confidence\n      },\n\n      framework: {\n        id: framework.id,\n        name: framework.name,\n        stages: framework.stages.map(s => s.name),\n        reasoning: `${framework.name} is proven for ${pageType} landing page conversion`\n      },\n\n      metadata: {\n        generatedAt: new Date(),\n        model: 'LandingPageGenerator',\n        iterationCount: 1,\n        impactScore: insight.confidence\n      }\n    };\n  }\n\n  private generateHeadline(insight: BreakthroughInsight, business: BusinessProfile): string {\n    return `${insight.contentAngle || insight.insight} | ${business.name}`;\n  }\n\n  private generateSubheadline(insight: BreakthroughInsight, business: BusinessProfile): string {\n    return `${business.name} helps ${business.targetAudience} ${insight.whyProfound.toLowerCase()}`;\n  }\n\n  private generateLandingPageBody(\n    insight: BreakthroughInsight,\n    business: BusinessProfile,\n    pageType: string\n  ): string {\n    if (pageType === 'sales') {\n      return `## The Problem\n\n${insight.insight}\n\n## Why It Matters\n\n${insight.whyProfound}\n\n## The Proof\n\n${insight.evidence.map((e, i) => `**${i + 1}.** ${e}`).join('\\n\\n')}\n\n## How ${business.name} Solves This\n\nWe've developed a proven approach that delivers results.\n\n${insight.whyNow ? `\\n## Act Now\\n\\n${insight.whyNow}` : ''}`;\n    }\n\n    return `${insight.whyProfound}\n\n${insight.evidence.map(e => `✓ ${e}`).join('\\n')}\n\n${insight.whyNow || ''}`;\n  }\n\n  private generateCTA(business: BusinessProfile): string {\n    return `Get Started with ${business.name}`;\n  }\n\n  private generateBulletPoints(insight: BreakthroughInsight): string[] {\n    return insight.evidence.slice(0, 3);\n  }\n\n  private generateSocialProof(business: BusinessProfile): string[] {\n    return [\n      `Trusted by ${business.industry} leaders`,\n      'Proven results',\n      '100% satisfaction guarantee'\n    ];\n  }\n\n  private extractPowerWords(text: string): string[] {\n    const powerWords = ['proven', 'guaranteed', 'results', 'now', 'limited', 'exclusive'];\n    return powerWords.filter(word => text.toLowerCase().includes(word));\n  }\n}\n","/**\n * A/B Variant Generator\n *\n * Generates multiple variations of the same content with different psychological angles\n * for A/B testing. Each variant emphasizes a different strategy (scarcity, FOMO, exclusivity).\n *\n * Created: 2025-11-11\n */\n\nimport type {\n  SynapseContent,\n  ContentVariant,\n  ABTestGroup,\n  VariantStrategy,\n  BusinessProfile\n} from '@/types/synapseContent.types';\n\nconst OPENROUTER_API_KEY = import.meta.env.VITE_OPENROUTER_API_KEY;\n\nif (!OPENROUTER_API_KEY) {\n  throw new Error('VITE_OPENROUTER_API_KEY is not set in .env file');\n}\n\nexport class VariantGenerator {\n  /**\n   * Generate A/B test variants from original content\n   */\n  async generateVariants(\n    originalContent: SynapseContent,\n    business: BusinessProfile,\n    strategies: VariantStrategy[] = ['scarcity', 'fomo', 'exclusivity']\n  ): Promise<ABTestGroup> {\n    console.log('[VariantGenerator] Generating variants with strategies:', strategies);\n\n    const variants: ContentVariant[] = [];\n\n    // Generate each variant\n    for (let i = 0; i < strategies.length; i++) {\n      const strategy = strategies[i];\n      const variantLetter = ['A', 'B', 'C'][i] as 'A' | 'B' | 'C';\n\n      try {\n        const variant = await this.generateSingleVariant(\n          originalContent,\n          business,\n          strategy,\n          variantLetter\n        );\n        variants.push(variant);\n      } catch (error) {\n        console.error(`[VariantGenerator] Error generating ${strategy} variant:`, error);\n      }\n    }\n\n    // Determine recommended test order\n    const recommended = this.recommendTestOrder(variants);\n\n    return {\n      testId: `test-${Date.now()}`,\n      originalInsightId: originalContent.insightId,\n      variants,\n      recommendedTest: recommended\n    };\n  }\n\n  /**\n   * Generate a single variant with specific strategy\n   */\n  private async generateSingleVariant(\n    original: SynapseContent,\n    business: BusinessProfile,\n    strategy: VariantStrategy,\n    variantLetter: 'A' | 'B' | 'C'\n  ): Promise<ContentVariant> {\n    const prompt = this.buildVariantPrompt(original, business, strategy);\n\n    const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {\n      method: 'POST',\n      headers: {\n        'Authorization': `Bearer ${OPENROUTER_API_KEY}`,\n        'Content-Type': 'application/json',\n        'HTTP-Referer': window.location.origin,\n        'X-Title': 'MARBA Variant Generator'\n      },\n      body: JSON.stringify({\n        model: 'anthropic/claude-3.5-sonnet',\n        messages: [{ role: 'user', content: prompt }],\n        temperature: 0.8,\n        max_tokens: 2000\n      })\n    });\n\n    if (!response.ok) {\n      throw new Error(`OpenRouter API error: ${response.status}`);\n    }\n\n    const data = await response.json();\n    const variantText = data.choices[0].message.content;\n\n    // Parse variant content\n    const parsed = this.parseVariantContent(variantText);\n\n    // Create new content object with variant\n    const variantContent: SynapseContent = {\n      ...original,\n      id: `${original.id}-variant-${variantLetter}`,\n      content: {\n        ...original.content,\n        headline: parsed.headline,\n        hook: parsed.hook,\n        body: parsed.body,\n        cta: parsed.cta\n      }\n    };\n\n    // Detect differences\n    const differences = this.detectDifferences(original, variantContent);\n\n    return {\n      id: variantContent.id,\n      variantLetter,\n      strategy,\n      content: variantContent,\n      differenceFromOriginal: differences\n    };\n  }\n\n  /**\n   * Build variant generation prompt\n   */\n  private buildVariantPrompt(\n    original: SynapseContent,\n    business: BusinessProfile,\n    strategy: VariantStrategy\n  ): string {\n    const strategyGuidelines = this.getStrategyGuidelines(strategy);\n\n    return `You are a conversion copywriter creating an A/B test variant of existing content.\n\nBUSINESS: ${business.name} (${business.industry})\nSTRATEGY: ${strategy.toUpperCase()}\n\nORIGINAL CONTENT:\nHeadline: ${original.content.headline}\nHook: ${original.content.hook}\nBody: ${original.content.body}\nCTA: ${original.content.cta}\n\n---\n\nYOUR TASK: Create a ${strategy} variant of this content.\n\n${strategyGuidelines}\n\nCRITICAL RULES:\n1. Keep the core message and value proposition\n2. Adjust the psychological angle to emphasize ${strategy}\n3. Maintain the same length (+/- 20%)\n4. Keep it brand-safe and professional\n5. Make the changes subtle but measurable\n\nOUTPUT FORMAT (return ONLY the variant content, no explanations):\n\nHEADLINE: [${strategy} variant headline]\nHOOK: [${strategy} variant hook]\nBODY: [${strategy} variant body]\nCTA: [${strategy} variant CTA]`;\n  }\n\n  /**\n   * Get strategy-specific guidelines\n   */\n  private getStrategyGuidelines(strategy: VariantStrategy): string {\n    switch (strategy) {\n      case 'scarcity':\n        return `SCARCITY STRATEGY:\n- Emphasize limited availability or spots\n- Use phrases like \"limited\", \"only X left\", \"filling up fast\"\n- Create urgency around supply constraints\n- Maintain authenticity (don't manufacture fake scarcity)\n\nEXAMPLES:\n❌ \"Book your event today\"\n✅ \"Only 3 December slots remaining\"\n\n❌ \"We're available for corporate events\"\n✅ \"Last week for December bookings before we're fully booked\"`;\n\n      case 'fomo':\n        return `FOMO STRATEGY (Fear of Missing Out):\n- Emphasize what they'll miss if they don't act\n- Use social proof and bandwagon effect\n- Highlight others who have already acted\n- Create urgency around opportunity cost\n\nEXAMPLES:\n❌ \"Book your holiday party\"\n✅ \"While your competitors are securing their December dates, will you be left scrambling?\"\n\n❌ \"Call us today\"\n✅ \"Don't be the team without a venue this holiday season\"`;\n\n      case 'exclusivity':\n        return `EXCLUSIVITY STRATEGY:\n- Position as VIP or exclusive opportunity\n- Emphasize quality over quantity\n- Use \"insider\", \"select\", \"preferred\" language\n- Make them feel special for being considered\n\nEXAMPLES:\n❌ \"We're available for bookings\"\n✅ \"Accepting a select number of corporate events for discerning teams\"\n\n❌ \"Book now\"\n✅ \"For serious event planners who won't settle for the usual\"`;\n\n      case 'urgency':\n        return `URGENCY STRATEGY:\n- Emphasize time-sensitive nature\n- Use deadlines and countdowns\n- Create pressure around timing\n- Maintain credibility (real deadlines only)\n\nEXAMPLES:\n❌ \"Contact us\"\n✅ \"Spots close Friday at 5pm\"\n\n❌ \"Book your event\"\n✅ \"This week only: December availability\"`;\n\n      case 'social-proof':\n        return `SOCIAL PROOF STRATEGY:\n- Emphasize popularity and trust\n- Reference other customers or usage\n- Use testimonials or statistics\n- Build credibility through numbers\n\nEXAMPLES:\n❌ \"Great venue\"\n✅ \"Trusted by 50+ Dallas companies for their holiday events\"\n\n❌ \"Book with us\"\n✅ \"Join the teams who refuse to settle for crowded chain restaurants\"`;\n\n      default:\n        return '';\n    }\n  }\n\n  /**\n   * Parse variant content from Claude response\n   */\n  private parseVariantContent(text: string): {\n    headline: string;\n    hook: string;\n    body: string;\n    cta: string;\n  } {\n    const lines = text.split('\\n').filter(l => l.trim());\n\n    const result = {\n      headline: '',\n      hook: '',\n      body: '',\n      cta: ''\n    };\n\n    let currentSection = '';\n    let bodyLines: string[] = [];\n\n    for (const line of lines) {\n      if (line.startsWith('HEADLINE:')) {\n        currentSection = 'headline';\n        result.headline = line.replace('HEADLINE:', '').trim();\n      } else if (line.startsWith('HOOK:')) {\n        currentSection = 'hook';\n        result.hook = line.replace('HOOK:', '').trim();\n      } else if (line.startsWith('BODY:')) {\n        currentSection = 'body';\n        const bodyStart = line.replace('BODY:', '').trim();\n        if (bodyStart) bodyLines.push(bodyStart);\n      } else if (line.startsWith('CTA:')) {\n        currentSection = 'cta';\n        result.cta = line.replace('CTA:', '').trim();\n      } else if (currentSection === 'headline' && !result.headline) {\n        result.headline = line.trim();\n      } else if (currentSection === 'hook' && !result.hook) {\n        result.hook = line.trim();\n      } else if (currentSection === 'body') {\n        bodyLines.push(line.trim());\n      } else if (currentSection === 'cta' && !result.cta) {\n        result.cta = line.trim();\n      }\n    }\n\n    result.body = bodyLines.join('\\n\\n');\n\n    return result;\n  }\n\n  /**\n   * Detect differences between original and variant\n   */\n  private detectDifferences(original: SynapseContent, variant: SynapseContent): string[] {\n    const differences: string[] = [];\n\n    if (original.content.headline !== variant.content.headline) {\n      differences.push(`Headline: Changed from \"${original.content.headline.substring(0, 50)}...\" to \"${variant.content.headline.substring(0, 50)}...\"`);\n    }\n\n    if (original.content.hook !== variant.content.hook) {\n      differences.push(`Hook: Adjusted psychological angle`);\n    }\n\n    if (original.content.body !== variant.content.body) {\n      differences.push(`Body: Reframed with variant strategy`);\n    }\n\n    if (original.content.cta !== variant.content.cta) {\n      differences.push(`CTA: Modified call-to-action`);\n    }\n\n    return differences.length > 0 ? differences : ['Minor refinements applied'];\n  }\n\n  /**\n   * Recommend test order\n   */\n  private recommendTestOrder(variants: ContentVariant[]): string {\n    // Recommend starting with scarcity (usually highest converting)\n    const scarcityVariant = variants.find(v => v.strategy === 'scarcity');\n    if (scarcityVariant) {\n      return `Test Variant ${scarcityVariant.variantLetter} (Scarcity) first - typically highest converting`;\n    }\n\n    // Fall back to first variant\n    return variants.length > 0\n      ? `Test Variant ${variants[0].variantLetter} (${variants[0].strategy}) first`\n      : 'No variants generated';\n  }\n}\n","/**\n * Platform Character Limits Configuration\n *\n * Defines character limits for different social media and content platforms.\n * Used for validating content length during generation.\n *\n * Created: 2025-11-11\n */\n\nimport type { PlatformLimits, Platform } from '@/types/synapseContent.types';\n\n/**\n * Character limits by platform\n *\n * Each platform has min/max/optimal for:\n * - headline: Short attention-grabbing title\n * - body: Main content text\n * - total: Combined character count\n */\nexport const PLATFORM_LIMITS: Record<string, PlatformLimits> = {\n  'linkedin': {\n    platform: 'linkedin',\n    headline: { min: 40, max: 150, optimal: 120 },\n    body: { min: 200, max: 3000, optimal: 1300 },\n    total: { min: 300, max: 3000, optimal: 1400 }\n  },\n\n  'twitter': {\n    platform: 'twitter',\n    headline: { min: 30, max: 100, optimal: 80 },\n    body: { min: 50, max: 280, optimal: 240 },\n    total: { min: 100, max: 280, optimal: 250 }\n  },\n\n  'facebook': {\n    platform: 'facebook',\n    headline: { min: 40, max: 150, optimal: 120 },\n    body: { min: 100, max: 5000, optimal: 1500 },\n    total: { min: 200, max: 5000, optimal: 1600 }\n  },\n\n  'instagram': {\n    platform: 'instagram',\n    headline: { min: 30, max: 100, optimal: 80 },\n    body: { min: 100, max: 2200, optimal: 1000 },\n    total: { min: 150, max: 2200, optimal: 1100 }\n  },\n\n  'tiktok': {\n    platform: 'tiktok',\n    headline: { min: 30, max: 100, optimal: 80 },\n    body: { min: 80, max: 2200, optimal: 800 },\n    total: { min: 120, max: 2200, optimal: 900 }\n  },\n\n  'youtube': {\n    platform: 'youtube',\n    headline: { min: 40, max: 100, optimal: 70 },  // Video title\n    body: { min: 100, max: 5000, optimal: 2000 },  // Description\n    total: { min: 150, max: 5000, optimal: 2100 }\n  }\n};\n\n/**\n * Get platform limits by name\n */\nexport function getPlatformLimits(platform: Platform): PlatformLimits {\n  return PLATFORM_LIMITS[platform];\n}\n\n/**\n * Get all supported platforms\n */\nexport function getSupportedPlatforms(): Platform[] {\n  return Object.keys(PLATFORM_LIMITS) as Platform[];\n}\n\n/**\n * Check if a platform is supported\n */\nexport function isPlatformSupported(platform: string): platform is Platform {\n  return platform in PLATFORM_LIMITS;\n}\n\n/**\n * Get optimal character count for a specific section\n */\nexport function getOptimalCount(\n  platform: Platform,\n  section: 'headline' | 'body' | 'total'\n): number {\n  return PLATFORM_LIMITS[platform][section].optimal;\n}\n\n/**\n * Check if character count is within acceptable range\n */\nexport function isWithinRange(\n  platform: Platform,\n  section: 'headline' | 'body' | 'total',\n  count: number\n): boolean {\n  const limits = PLATFORM_LIMITS[platform][section];\n  return count >= limits.min && count <= limits.max;\n}\n","/**\n * Character Count Validator\n *\n * Validates content character counts against platform-specific limits.\n * Provides detailed validation results with status and recommendations.\n *\n * Created: 2025-11-11\n */\n\nimport type {\n  SynapseContent,\n  Platform,\n  CharacterValidation,\n  ContentValidationResult\n} from '@/types/synapse/synapseContent.types';\nimport { PLATFORM_LIMITS, getPlatformLimits } from '@/config/synapse/platformLimits';\n\nexport class CharacterValidator {\n  /**\n   * Validate content against platform limits\n   */\n  validateContent(\n    content: SynapseContent,\n    platforms: Platform[] = ['linkedin', 'twitter']\n  ): ContentValidationResult {\n    const validations: CharacterValidation[] = [];\n\n    for (const platform of platforms) {\n      // Validate each section\n      validations.push(this.validateHeadline(content, platform));\n      validations.push(this.validateHook(content, platform));\n      validations.push(this.validateBody(content, platform));\n      validations.push(this.validateCTA(content, platform));\n      validations.push(this.validateTotal(content, platform));\n    }\n\n    // Determine overall status\n    const hasErrors = validations.some(v => v.status === 'error');\n    const hasWarnings = validations.some(v => v.status === 'warning');\n\n    const overallStatus = hasErrors ? 'error' : hasWarnings ? 'warning' : 'valid';\n\n    // Generate recommendations\n    const recommendations = this.generateRecommendations(validations);\n\n    return {\n      contentId: content.id,\n      isValid: !hasErrors,\n      validations,\n      overallStatus,\n      recommendations\n    };\n  }\n\n  /**\n   * Validate headline length\n   */\n  private validateHeadline(content: SynapseContent, platform: Platform): CharacterValidation {\n    const text = content.content?.headline || '';\n    const count = text.length;\n    const limits = getPlatformLimits(platform);\n\n    if (!limits || !limits.headline) {\n      return {\n        platform,\n        section: 'headline',\n        characterCount: count,\n        limit: 1000,\n        optimal: 100,\n        status: 'valid',\n        message: `${count} chars`\n      };\n    }\n\n    const { min, max, optimal } = limits.headline;\n\n    return this.createValidation(platform, 'headline', count, min, max, optimal, text);\n  }\n\n  /**\n   * Validate hook length\n   */\n  private validateHook(content: SynapseContent, platform: Platform): CharacterValidation {\n    const text = content.content?.hook || '';\n    const count = text.length;\n    const limits = getPlatformLimits(platform);\n\n    if (!limits || !limits.body) {\n      return {\n        platform,\n        section: 'hook',\n        characterCount: count,\n        limit: 3000,\n        optimal: 300,\n        status: 'valid',\n        message: `${count} chars`\n      };\n    }\n\n    const { min, max, optimal } = limits.body;\n\n    return this.createValidation(platform, 'hook', count, min, max, optimal, text);\n  }\n\n  /**\n   * Validate body length\n   */\n  private validateBody(content: SynapseContent, platform: Platform): CharacterValidation {\n    const text = content.content?.body || '';\n    const count = text.length;\n    const limits = getPlatformLimits(platform);\n\n    if (!limits || !limits.body) {\n      return {\n        platform,\n        section: 'body',\n        characterCount: count,\n        limit: 5000,\n        optimal: 1500,\n        status: 'valid',\n        message: `${count} chars`\n      };\n    }\n\n    const { min, max, optimal } = limits.body;\n\n    return this.createValidation(platform, 'body', count, min, max, optimal, text);\n  }\n\n  /**\n   * Validate CTA length\n   */\n  private validateCTA(content: SynapseContent, platform: Platform): CharacterValidation {\n    const text = content.content?.cta || '';\n    const count = text.length;\n    const limits = getPlatformLimits(platform);\n\n    if (!limits || !limits.headline) {\n      return {\n        platform,\n        section: 'cta',\n        characterCount: count,\n        limit: 150,\n        optimal: 100,\n        status: 'valid',\n        message: `${count} chars`\n      };\n    }\n\n    const { min, max, optimal } = limits.headline;\n\n    return this.createValidation(platform, 'cta', count, min, max, optimal, text);\n  }\n\n  /**\n   * Validate total content length\n   */\n  private validateTotal(content: SynapseContent, platform: Platform): CharacterValidation {\n    const total =\n      (content.content?.headline?.length || 0) +\n      (content.content?.hook?.length || 0) +\n      (content.content?.body?.length || 0) +\n      (content.content?.cta?.length || 0);\n\n    const limits = getPlatformLimits(platform);\n\n    if (!limits || !limits.total) {\n      return {\n        platform,\n        section: 'total',\n        characterCount: total,\n        limit: 5000,\n        optimal: 2000,\n        status: 'valid',\n        message: `Total: ${total} chars`\n      };\n    }\n\n    const { min, max, optimal } = limits.total;\n\n    return this.createValidation(\n      platform,\n      'total',\n      total,\n      min,\n      max,\n      optimal,\n      `Total: ${total} chars`\n    );\n  }\n\n  /**\n   * Create validation result\n   */\n  private createValidation(\n    platform: Platform,\n    section: 'headline' | 'hook' | 'body' | 'cta' | 'total',\n    count: number,\n    min: number,\n    max: number,\n    optimal: number,\n    text: string\n  ): CharacterValidation {\n    let status: 'valid' | 'warning' | 'error';\n    let message: string;\n\n    if (count < min) {\n      status = 'error';\n      message = `Too short: ${count}/${min} chars (needs ${min - count} more)`;\n    } else if (count > max) {\n      status = 'error';\n      message = `Too long: ${count}/${max} chars (over by ${count - max})`;\n    } else if (count < optimal * 0.8 || count > optimal * 1.2) {\n      status = 'warning';\n      const deviation = Math.abs(count - optimal);\n      message = `${count} chars (${deviation} from optimal ${optimal})`;\n    } else {\n      status = 'valid';\n      message = `${count} chars ✓`;\n    }\n\n    return {\n      platform,\n      section,\n      characterCount: count,\n      limit: max,\n      optimal,\n      status,\n      message\n    };\n  }\n\n  /**\n   * Generate recommendations based on validations\n   */\n  private generateRecommendations(validations: CharacterValidation[]): string[] {\n    const recommendations: string[] = [];\n    const errors = validations.filter(v => v.status === 'error');\n    const warnings = validations.filter(v => v.status === 'warning');\n\n    if (errors.length === 0 && warnings.length === 0) {\n      recommendations.push('✅ All content meets platform requirements');\n      return recommendations;\n    }\n\n    // Group by platform\n    const platformErrors = this.groupByPlatform(errors);\n    const platformWarnings = this.groupByPlatform(warnings);\n\n    // Generate error recommendations\n    for (const [platform, items] of Object.entries(platformErrors)) {\n      for (const item of items) {\n        if (item.characterCount < PLATFORM_LIMITS[item.platform].headline.min) {\n          recommendations.push(\n            `❌ ${platform} ${item.section}: Add ${PLATFORM_LIMITS[item.platform].headline.min - item.characterCount} more characters`\n          );\n        } else {\n          recommendations.push(\n            `❌ ${platform} ${item.section}: Reduce by ${item.characterCount - item.limit} characters`\n          );\n        }\n      }\n    }\n\n    // Generate warning recommendations\n    for (const [platform, items] of Object.entries(platformWarnings)) {\n      for (const item of items) {\n        const diff = Math.abs(item.characterCount - item.optimal);\n        if (item.characterCount < item.optimal) {\n          recommendations.push(\n            `⚠️ ${platform} ${item.section}: Consider adding ${diff} characters for optimal engagement`\n          );\n        } else {\n          recommendations.push(\n            `⚠️ ${platform} ${item.section}: Consider reducing by ${diff} characters for optimal engagement`\n          );\n        }\n      }\n    }\n\n    return recommendations;\n  }\n\n  /**\n   * Group validations by platform\n   */\n  private groupByPlatform(\n    validations: CharacterValidation[]\n  ): Record<Platform, CharacterValidation[]> {\n    const grouped: Record<string, CharacterValidation[]> = {};\n\n    for (const validation of validations) {\n      if (!grouped[validation.platform]) {\n        grouped[validation.platform] = [];\n      }\n      grouped[validation.platform].push(validation);\n    }\n\n    return grouped as Record<Platform, CharacterValidation[]>;\n  }\n\n  /**\n   * Quick check if content is valid for a platform\n   */\n  isValidForPlatform(content: SynapseContent, platform: Platform): boolean {\n    const result = this.validateContent(content, [platform]);\n    return result.isValid;\n  }\n\n  /**\n   * Get character count summary for content\n   */\n  getCharacterSummary(content: SynapseContent): {\n    headline: number;\n    hook: number;\n    body: number;\n    cta: number;\n    total: number;\n  } {\n    return {\n      headline: content.content.headline.length,\n      hook: content.content.hook.length,\n      body: content.content.body.length,\n      cta: content.content.cta.length,\n      total:\n        content.content.headline.length +\n        content.content.hook.length +\n        content.content.body.length +\n        content.content.cta.length\n    };\n  }\n}\n","/**\n * Section Regenerator\n *\n * Regenerates individual content sections (headline, hook, body, CTA)\n * without regenerating the entire content piece. Provides 3-5 alternative\n * options to choose from.\n *\n * Created: 2025-11-11\n */\n\nimport type {\n  SynapseContent,\n  BusinessProfile,\n  ContentSection,\n  RegenerationRequest,\n  RegenerationResult,\n  RegenerationHistory\n} from '@/types/synapseContent.types';\nimport type { BreakthroughInsight } from '@/types/breakthrough.types';\n\nconst OPENROUTER_API_KEY = import.meta.env.VITE_OPENROUTER_API_KEY;\n\nif (!OPENROUTER_API_KEY) {\n  throw new Error('VITE_OPENROUTER_API_KEY is not set in .env file');\n}\n\nexport class SectionRegenerator {\n  /**\n   * Regenerate a specific section of content\n   */\n  async regenerateSection(\n    content: SynapseContent,\n    section: ContentSection,\n    business: BusinessProfile,\n    insight: BreakthroughInsight,\n    improvementDirection?: string\n  ): Promise<RegenerationResult> {\n    console.log(`[SectionRegenerator] Regenerating ${section} for content ${content.id}`);\n\n    const currentContent = this.getCurrentSectionContent(content, section);\n\n    const prompt = this.buildRegenerationPrompt(\n      content,\n      section,\n      currentContent,\n      business,\n      insight,\n      improvementDirection\n    );\n\n    try {\n      const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {\n        method: 'POST',\n        headers: {\n          Authorization: `Bearer ${OPENROUTER_API_KEY}`,\n          'Content-Type': 'application/json',\n          'HTTP-Referer': window.location.origin,\n          'X-Title': 'MARBA Section Regenerator'\n        },\n        body: JSON.stringify({\n          model: 'anthropic/claude-3.5-sonnet',\n          messages: [{ role: 'user', content: prompt }],\n          temperature: 0.8,\n          max_tokens: 1500\n        })\n      });\n\n      if (!response.ok) {\n        throw new Error(`OpenRouter API error: ${response.status}`);\n      }\n\n      const data = await response.json();\n      const alternatives = this.parseRegeneratedOptions(\n        data.choices[0].message.content,\n        section\n      );\n\n      return {\n        section,\n        original: currentContent,\n        regenerated: alternatives,\n        selectedIndex: undefined,\n        reasoning: improvementDirection || `Regenerated ${section} with fresh variations`\n      };\n    } catch (error) {\n      console.error('[SectionRegenerator] Error:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Get current content for a section\n   */\n  private getCurrentSectionContent(content: SynapseContent, section: ContentSection): string {\n    switch (section) {\n      case 'headline':\n        return content.content.headline;\n      case 'hook':\n        return content.content.hook;\n      case 'body':\n        return content.content.body;\n      case 'cta':\n        return content.content.cta;\n      default:\n        return '';\n    }\n  }\n\n  /**\n   * Build regeneration prompt\n   */\n  private buildRegenerationPrompt(\n    content: SynapseContent,\n    section: ContentSection,\n    currentContent: string,\n    business: BusinessProfile,\n    insight: BreakthroughInsight,\n    improvementDirection?: string\n  ): string {\n    const sectionGuidelines = this.getSectionGuidelines(section, content.format);\n    const improvementNote = improvementDirection\n      ? `\\n\\nIMPROVEMENT DIRECTION: ${improvementDirection}`\n      : '';\n\n    return `You are a master copywriter regenerating a single section of existing content.\n\nBUSINESS: ${business.name} (${business.industry})\nCONTENT FORMAT: ${content.format}\nSECTION TO REGENERATE: ${section}\n\nCONTEXT (DO NOT REGENERATE):\n${this.buildContextSection(content, section)}\n\nCURRENT ${section.toUpperCase()}:\n\"${currentContent}\"\n\nORIGINAL INSIGHT:\n${insight.insight}\n\nWHY IT'S PROFOUND:\n${insight.whyProfound || 'Strong emotional resonance'}\n\n${sectionGuidelines}${improvementNote}\n\nCRITICAL REQUIREMENTS:\n1. Generate EXACTLY 3-5 variations\n2. Each must be distinctly different from the others\n3. Maintain the same core message and psychology\n4. Keep similar length to original (+/- 20%)\n5. Number each variation clearly (OPTION 1, OPTION 2, etc.)\n6. NO explanations or commentary - just the variations\n\nOUTPUT FORMAT:\n\nOPTION 1:\n[First variation here]\n\nOPTION 2:\n[Second variation here]\n\nOPTION 3:\n[Third variation here]\n\nOPTION 4:\n[Fourth variation here - optional]\n\nOPTION 5:\n[Fifth variation here - optional]`;\n  }\n\n  /**\n   * Build context section showing other parts of content\n   */\n  private buildContextSection(content: SynapseContent, regeneratingSection: ContentSection): string {\n    const parts: string[] = [];\n\n    if (regeneratingSection !== 'headline') {\n      parts.push(`Headline: \"${content.content.headline}\"`);\n    }\n    if (regeneratingSection !== 'hook') {\n      parts.push(`Hook: \"${content.content.hook.substring(0, 100)}...\"`);\n    }\n    if (regeneratingSection !== 'body') {\n      parts.push(`Body: \"${content.content.body.substring(0, 100)}...\"`);\n    }\n    if (regeneratingSection !== 'cta') {\n      parts.push(`CTA: \"${content.content.cta}\"`);\n    }\n\n    return parts.join('\\n');\n  }\n\n  /**\n   * Get section-specific guidelines\n   */\n  private getSectionGuidelines(section: ContentSection, format: string): string {\n    switch (section) {\n      case 'headline':\n        return `HEADLINE GUIDELINES:\n- Grab attention in 10-15 words\n- Create curiosity or intrigue\n- Should work standalone (people read headlines first)\n- Avoid clickbait or misleading angles\n- Match the ${format} format's style\n\nGOOD HEADLINES:\n✅ \"The parking spot strategy nobody talks about\"\n✅ \"Why December bookings happen in November\"\n✅ \"What 50+ event planners know about venues\"`;\n\n      case 'hook':\n        return `HOOK GUIDELINES:\n- First 1-2 sentences that pull reader in\n- Build on headline's promise\n- Create \"I need to read this\" feeling\n- Use pattern interrupts or surprising facts\n- Lead naturally into body\n\nGOOD HOOKS:\n✅ \"Most event planners make this mistake every year...\"\n✅ \"Here's what nobody tells you about holiday bookings...\"\n✅ \"The data reveals something surprising...\"`;\n\n      case 'body':\n        return `BODY GUIDELINES:\n- Deliver on hook's promise with substance\n- Use 2-4 paragraphs for ${format}\n- Include specific details or evidence\n- Build credibility and trust\n- Connect emotionally while staying factual\n\nGOOD BODY CONTENT:\n✅ Includes specific numbers or examples\n✅ Addresses reader's situation directly\n✅ Builds logical case for your point\n✅ Uses paragraph breaks for readability`;\n\n      case 'cta':\n        return `CTA GUIDELINES:\n- Clear, direct action step\n- Reduce friction (make it easy)\n- Create urgency without pressure\n- Connect to the content's promise\n- ${format === 'controversial-post' ? 'Can be softer/educational' : 'Should be direct'}\n\nGOOD CTAs:\n✅ \"Book your December event before spots fill up\"\n✅ \"Schedule a consultation today\"\n✅ \"See why 50+ teams choose [Business]\"\n✅ \"Visit us and experience the difference\"`;\n\n      default:\n        return '';\n    }\n  }\n\n  /**\n   * Parse regenerated options from Claude response\n   */\n  private parseRegeneratedOptions(text: string, section: ContentSection): string[] {\n    const options: string[] = [];\n    const lines = text.split('\\n');\n\n    let currentOption = '';\n    let collectingContent = false;\n\n    for (const line of lines) {\n      const trimmedLine = line.trim();\n\n      // Check if this is an option header\n      if (/^OPTION\\s+\\d+:?$/i.test(trimmedLine)) {\n        // Save previous option if exists\n        if (currentOption.trim()) {\n          options.push(currentOption.trim());\n        }\n        currentOption = '';\n        collectingContent = true;\n      } else if (/^OPTION\\s+\\d+:\\s+.+/i.test(trimmedLine)) {\n        // Option header with content on same line\n        if (currentOption.trim()) {\n          options.push(currentOption.trim());\n        }\n        currentOption = trimmedLine.replace(/^OPTION\\s+\\d+:\\s*/i, '');\n        collectingContent = true;\n      } else if (collectingContent && trimmedLine) {\n        // Collect content for current option\n        if (currentOption) {\n          currentOption += '\\n\\n' + trimmedLine;\n        } else {\n          currentOption = trimmedLine;\n        }\n      }\n    }\n\n    // Don't forget last option\n    if (currentOption.trim()) {\n      options.push(currentOption.trim());\n    }\n\n    // If parsing failed, try alternate format\n    if (options.length === 0) {\n      const sections = text.split(/\\n\\n+/);\n      return sections\n        .map(s => s.trim())\n        .filter(s => s.length > 10)\n        .slice(0, 5);\n    }\n\n    return options.slice(0, 5); // Max 5 options\n  }\n\n  /**\n   * Apply regenerated section to content\n   */\n  applyRegeneration(\n    content: SynapseContent,\n    result: RegenerationResult,\n    selectedIndex: number\n  ): SynapseContent {\n    if (selectedIndex < 0 || selectedIndex >= result.regenerated.length) {\n      throw new Error(`Invalid selection index: ${selectedIndex}`);\n    }\n\n    const newContent = { ...content };\n    const selectedText = result.regenerated[selectedIndex];\n\n    switch (result.section) {\n      case 'headline':\n        newContent.content = { ...newContent.content, headline: selectedText };\n        break;\n      case 'hook':\n        newContent.content = { ...newContent.content, hook: selectedText };\n        break;\n      case 'body':\n        newContent.content = { ...newContent.content, body: selectedText };\n        break;\n      case 'cta':\n        newContent.content = { ...newContent.content, cta: selectedText };\n        break;\n    }\n\n    // Update metadata\n    newContent.metadata = {\n      ...newContent.metadata,\n      iterationCount: (newContent.metadata.iterationCount || 0) + 1,\n      generatedAt: new Date()\n    };\n\n    return newContent;\n  }\n\n  /**\n   * Track regeneration history\n   */\n  createHistoryEntry(\n    content: SynapseContent,\n    result: RegenerationResult,\n    selectedIndex: number\n  ): RegenerationHistory {\n    return {\n      contentId: content.id,\n      section: result.section,\n      timestamp: new Date(),\n      original: result.original,\n      regenerated: result.regenerated,\n      selected: result.regenerated[selectedIndex],\n      reason: result.reasoning\n    };\n  }\n\n  /**\n   * Batch regenerate multiple sections\n   */\n  async regenerateMultipleSections(\n    content: SynapseContent,\n    sections: ContentSection[],\n    business: BusinessProfile,\n    insight: BreakthroughInsight\n  ): Promise<RegenerationResult[]> {\n    const results: RegenerationResult[] = [];\n\n    for (const section of sections) {\n      try {\n        const result = await this.regenerateSection(content, section, business, insight);\n        results.push(result);\n      } catch (error) {\n        console.error(`[SectionRegenerator] Error regenerating ${section}:`, error);\n      }\n    }\n\n    return results;\n  }\n}\n","/**\n * Contrarian Angle Detector\n *\n * Analyzes competitor claims and content to identify opportunities for\n * contrarian positioning. Finds \"everyone says X, but actually Y\" angles\n * that differentiate your brand.\n *\n * Created: 2025-11-11\n */\n\nimport type {\n  BreakthroughInsight,\n  CompetitorClaim,\n  ContrarianAngle,\n  ContrarianDetectionResult\n} from '@/types/synapseContent.types';\n\nconst OPENROUTER_API_KEY = import.meta.env.VITE_OPENROUTER_API_KEY;\n\nif (!OPENROUTER_API_KEY) {\n  throw new Error('VITE_OPENROUTER_API_KEY is not set in .env file');\n}\n\nexport class ContrarianAngleDetector {\n  /**\n   * Detect contrarian angles from insights\n   */\n  async detectContrarianAngles(\n    insights: BreakthroughInsight[]\n  ): Promise<ContrarianDetectionResult> {\n    console.log('[ContrarianDetector] Analyzing', insights.length, 'insights for contrarian angles');\n\n    // Extract competitor claims from insights\n    const competitorClaims = this.extractCompetitorClaims(insights);\n\n    // Find contrarian angles\n    const contrarianAngles: ContrarianAngle[] = [];\n\n    for (const claim of competitorClaims) {\n      try {\n        const angle = await this.generateContrarianAngle(claim, insights);\n        if (angle) {\n          contrarianAngles.push(angle);\n        }\n      } catch (error) {\n        console.error('[ContrarianDetector] Error generating angle for claim:', claim, error);\n      }\n    }\n\n    // Rank by differentiation potential\n    const ranked = this.rankByDifferentiation(contrarianAngles);\n\n    return {\n      competitorClaims,\n      contrarianAngles: ranked,\n      topOpportunity: ranked[0] || null\n    };\n  }\n\n  /**\n   * Extract common competitor claims from insights\n   */\n  private extractCompetitorClaims(insights: BreakthroughInsight[]): CompetitorClaim[] {\n    const claims: CompetitorClaim[] = [];\n    const claimMap = new Map<string, { count: number; confidence: number }>();\n\n    for (const insight of insights) {\n      // Look for competitive analysis in evidence\n      if (insight.evidence && Array.isArray(insight.evidence)) {\n        for (const evidence of insight.evidence) {\n          if (\n            typeof evidence === 'string' &&\n            (evidence.toLowerCase().includes('competitor') ||\n              evidence.toLowerCase().includes('everyone') ||\n              evidence.toLowerCase().includes('industry') ||\n              evidence.toLowerCase().includes('typical'))\n          ) {\n            const key = this.normalizeClaimText(evidence);\n            const existing = claimMap.get(key);\n\n            if (existing) {\n              claimMap.set(key, {\n                count: existing.count + 1,\n                confidence: Math.min(existing.confidence + 0.1, 1.0)\n              });\n            } else {\n              claimMap.set(key, {\n                count: 1,\n                confidence: insight.confidence || 0.7\n              });\n            }\n          }\n        }\n      }\n\n      // Also check insight text for competitive framing\n      if (\n        insight.insight &&\n        (insight.insight.toLowerCase().includes('unlike') ||\n          insight.insight.toLowerCase().includes('while others') ||\n          insight.insight.toLowerCase().includes('most'))\n      ) {\n        const key = this.normalizeClaimText(insight.insight);\n        const existing = claimMap.get(key);\n\n        if (existing) {\n          claimMap.set(key, {\n            count: existing.count + 1,\n            confidence: Math.min(existing.confidence + 0.1, 1.0)\n          });\n        } else {\n          claimMap.set(key, {\n            count: 1,\n            confidence: insight.confidence || 0.7\n          });\n        }\n      }\n    }\n\n    // Convert to array\n    for (const [claim, data] of claimMap.entries()) {\n      claims.push({\n        claim,\n        competitor: 'Industry consensus',\n        frequency: data.count,\n        confidence: data.confidence\n      });\n    }\n\n    return claims.sort((a, b) => b.frequency - a.frequency).slice(0, 10);\n  }\n\n  /**\n   * Normalize claim text for deduplication\n   */\n  private normalizeClaimText(text: string): string {\n    return text\n      .toLowerCase()\n      .replace(/[^a-z0-9\\s]/g, '')\n      .substring(0, 200);\n  }\n\n  /**\n   * Generate contrarian angle for a claim\n   */\n  private async generateContrarianAngle(\n    claim: CompetitorClaim,\n    insights: BreakthroughInsight[]\n  ): Promise<ContrarianAngle | null> {\n    const prompt = this.buildContrarianPrompt(claim, insights);\n\n    try {\n      const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {\n        method: 'POST',\n        headers: {\n          Authorization: `Bearer ${OPENROUTER_API_KEY}`,\n          'Content-Type': 'application/json',\n          'HTTP-Referer': window.location.origin,\n          'X-Title': 'MARBA Contrarian Detector'\n        },\n        body: JSON.stringify({\n          model: 'anthropic/claude-3.5-sonnet',\n          messages: [{ role: 'user', content: prompt }],\n          temperature: 0.7,\n          max_tokens: 1500\n        })\n      });\n\n      if (!response.ok) {\n        throw new Error(`OpenRouter API error: ${response.status}`);\n      }\n\n      const data = await response.json();\n      const result = this.parseContrarianResponse(data.choices[0].message.content);\n\n      if (!result) return null;\n\n      return {\n        id: `contrarian-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n        competitorClaim: claim.claim,\n        contrarianAngle: result.angle,\n        reasoning: result.reasoning,\n        evidenceSupport: result.evidence,\n        riskLevel: this.assessRiskLevel(result.angle),\n        differentiationScore: this.calculateDifferentiationScore(result.angle, claim)\n      };\n    } catch (error) {\n      console.error('[ContrarianDetector] Error calling API:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Build prompt for contrarian angle generation\n   */\n  private buildContrarianPrompt(\n    claim: CompetitorClaim,\n    insights: BreakthroughInsight[]\n  ): string {\n    const supportingInsights = insights\n      .filter(i => i.confidence > 0.7)\n      .slice(0, 3)\n      .map(i => i.insight)\n      .join('\\n- ');\n\n    return `You are a strategic marketing analyst specializing in contrarian positioning.\n\nCOMPETITOR CLAIM: \"${claim.claim}\"\n\nSUPPORTING INSIGHTS:\n- ${supportingInsights}\n\nYOUR TASK: Create a contrarian angle that challenges this claim in an authentic, evidence-based way.\n\nREQUIREMENTS:\n1. The contrarian angle must be TRUE and defensible (not just provocative)\n2. Should flip the conventional wisdom in an interesting way\n3. Must be specific and actionable (not vague)\n4. Should feel fresh, not cynical or negative\n\nFORMAT YOUR RESPONSE EXACTLY AS:\n\nCONTRARIAN ANGLE: [Your contrarian positioning statement]\n\nREASONING: [Why this challenges the competitor claim and why it's true]\n\nEVIDENCE:\n- [Supporting evidence point 1]\n- [Supporting evidence point 2]\n- [Supporting evidence point 3]\n\nEXAMPLES OF GOOD CONTRARIAN ANGLES:\n❌ \"We're better than competitors\" (too vague)\n✅ \"While competitors optimize for 'cleanliness,' we optimize for health outcomes\"\n\n❌ \"Everyone is wrong about X\" (too negative)\n✅ \"What most call 'customer service' is actually just problem management. We prevent problems.\"`;\n  }\n\n  /**\n   * Parse contrarian response from Claude\n   */\n  private parseContrarianResponse(text: string): {\n    angle: string;\n    reasoning: string;\n    evidence: string[];\n  } | null {\n    try {\n      const lines = text.split('\\n').filter(l => l.trim());\n\n      let angle = '';\n      let reasoning = '';\n      const evidence: string[] = [];\n      let currentSection = '';\n\n      for (const line of lines) {\n        if (line.startsWith('CONTRARIAN ANGLE:')) {\n          currentSection = 'angle';\n          angle = line.replace('CONTRARIAN ANGLE:', '').trim();\n        } else if (line.startsWith('REASONING:')) {\n          currentSection = 'reasoning';\n          reasoning = line.replace('REASONING:', '').trim();\n        } else if (line.startsWith('EVIDENCE:')) {\n          currentSection = 'evidence';\n        } else if (currentSection === 'angle' && !angle) {\n          angle = line.trim();\n        } else if (currentSection === 'reasoning' && line.trim() && !line.startsWith('-')) {\n          reasoning += ' ' + line.trim();\n        } else if (currentSection === 'evidence' && line.trim().startsWith('-')) {\n          evidence.push(line.replace(/^-\\s*/, '').trim());\n        }\n      }\n\n      if (!angle || !reasoning) {\n        return null;\n      }\n\n      return {\n        angle,\n        reasoning: reasoning.trim(),\n        evidence: evidence.length > 0 ? evidence : ['No specific evidence provided']\n      };\n    } catch (error) {\n      console.error('[ContrarianDetector] Error parsing response:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Assess risk level of contrarian angle\n   */\n  private assessRiskLevel(angle: string): 'low' | 'medium' | 'high' {\n    const lowercaseAngle = angle.toLowerCase();\n\n    // High risk indicators\n    const highRiskWords = [\n      'never',\n      'always',\n      'impossible',\n      'wrong',\n      'lie',\n      'scam',\n      'fake',\n      'fraud'\n    ];\n    if (highRiskWords.some(word => lowercaseAngle.includes(word))) {\n      return 'high';\n    }\n\n    // Medium risk indicators\n    const mediumRiskWords = ['most', 'everyone', 'nobody', 'all', 'none'];\n    if (mediumRiskWords.some(word => lowercaseAngle.includes(word))) {\n      return 'medium';\n    }\n\n    // Low risk\n    return 'low';\n  }\n\n  /**\n   * Calculate differentiation score\n   */\n  private calculateDifferentiationScore(angle: string, claim: CompetitorClaim): number {\n    let score = 0.5; // Base score\n\n    // Higher frequency claim = higher differentiation potential\n    score += Math.min(claim.frequency * 0.05, 0.2);\n\n    // Higher confidence = better differentiation\n    score += claim.confidence * 0.15;\n\n    // Length and specificity bonus\n    if (angle.length > 50 && angle.length < 200) {\n      score += 0.1;\n    }\n\n    // Contains specific differentiators\n    const differentiators = ['while', 'unlike', 'instead of', 'rather than', 'actually'];\n    if (differentiators.some(word => angle.toLowerCase().includes(word))) {\n      score += 0.05;\n    }\n\n    return Math.min(score, 1.0);\n  }\n\n  /**\n   * Rank contrarian angles by differentiation potential\n   */\n  private rankByDifferentiation(angles: ContrarianAngle[]): ContrarianAngle[] {\n    return angles\n      .sort((a, b) => {\n        // Prefer low risk\n        if (a.riskLevel !== b.riskLevel) {\n          const riskOrder = { low: 3, medium: 2, high: 1 };\n          return riskOrder[b.riskLevel] - riskOrder[a.riskLevel];\n        }\n\n        // Then by differentiation score\n        return b.differentiationScore - a.differentiationScore;\n      })\n      .slice(0, 5); // Top 5\n  }\n\n  /**\n   * Get contrarian angle for specific insight\n   */\n  async getContrarianAngleForInsight(\n    insight: BreakthroughInsight\n  ): Promise<ContrarianAngle | null> {\n    const result = await this.detectContrarianAngles([insight]);\n    return result.topOpportunity;\n  }\n}\n","/**\n * Breakthrough Content Generator\n *\n * Main orchestrator that coordinates all 4 format generators to transform\n * breakthrough insights into exceptional, psychologically-optimized content.\n *\n * Process:\n * 1. Takes breakthrough insights from Multi-Model Orchestra\n * 2. Selects optimal content format(s) for each insight\n * 3. Generates content using specialized format generators\n * 4. Ranks content by predicted impact\n * 5. Returns top content pieces with psychology explanations\n *\n * Created: 2025-11-10\n */\n\nimport type { BreakthroughInsight } from '@/types/breakthrough.types';\nimport type {\n  BusinessProfile,\n  SynapseContent,\n  ContentFormat,\n  GenerationOptions,\n  GenerationResult,\n  ABTestGroup,\n  VariantStrategy,\n  Platform,\n  ContentSection,\n  RegenerationResult,\n  ContrarianDetectionResult\n} from '@/types/synapseContent.types';\nimport { HookPostGenerator } from './formats/HookPostGenerator';\nimport { StoryPostGenerator } from './formats/StoryPostGenerator';\nimport { DataPostGenerator } from './formats/DataPostGenerator';\nimport { ControversialPostGenerator } from './formats/ControversialPostGenerator';\nimport { EmailGenerator } from './formats/EmailGenerator';\nimport { BlogGenerator } from './formats/BlogGenerator';\nimport { LandingPageGenerator } from './formats/LandingPageGenerator';\nimport { VariantGenerator } from './VariantGenerator';\nimport { CharacterValidator } from '../validation/CharacterValidator';\nimport { SectionRegenerator } from './SectionRegenerator';\nimport { ContrarianAngleDetector } from '../analysis/ContrarianAngleDetector';\n\nexport class SynapseContentGenerator {\n  private hookGenerator: HookPostGenerator;\n  private storyGenerator: StoryPostGenerator;\n  private dataGenerator: DataPostGenerator;\n  private controversialGenerator: ControversialPostGenerator;\n  private emailGenerator: EmailGenerator;\n  private blogGenerator: BlogGenerator;\n  private landingPageGenerator: LandingPageGenerator;\n  private variantGenerator: VariantGenerator;\n  private characterValidator: CharacterValidator;\n  private sectionRegenerator: SectionRegenerator;\n  private contrarianDetector: ContrarianAngleDetector;\n\n  constructor() {\n    this.hookGenerator = new HookPostGenerator();\n    this.storyGenerator = new StoryPostGenerator();\n    this.dataGenerator = new DataPostGenerator();\n    this.controversialGenerator = new ControversialPostGenerator();\n    this.emailGenerator = new EmailGenerator();\n    this.blogGenerator = new BlogGenerator();\n    this.landingPageGenerator = new LandingPageGenerator();\n    this.variantGenerator = new VariantGenerator();\n    this.characterValidator = new CharacterValidator();\n    this.sectionRegenerator = new SectionRegenerator();\n    this.contrarianDetector = new ContrarianAngleDetector();\n  }\n\n  /**\n   * Generate breakthrough content from insights\n   */\n  async generate(\n    insights: BreakthroughInsight[],\n    business: BusinessProfile,\n    options: GenerationOptions = {}\n  ): Promise<GenerationResult> {\n    const startTime = Date.now();\n\n    // Apply defaults\n    const opts: Required<GenerationOptions> = {\n      maxContent: options.maxContent || 10,\n      formats: options.formats || ['hook-post', 'story-post', 'data-post', 'controversial-post'],\n      multiFormat: options.multiFormat !== undefined ? options.multiFormat : false,\n      minImpactScore: options.minImpactScore || 0.7,\n      platform: (options as any).platform || 'linkedin'\n    };\n\n    // Get all platforms to generate for\n    const platforms = (options as any).platforms || [opts.platform];\n\n    console.log(`🎨 Generating breakthrough content for ${insights.length} insights across ${platforms.length} platforms...`);\n\n    // Generate content for each insight\n    const allContent: SynapseContent[] = [];\n    const errors: string[] = [];\n\n    for (const insight of insights) {\n      try {\n        if (opts.multiFormat) {\n          // Generate multiple formats for this insight\n          const formats = this.selectFormats(insight, opts.formats);\n          for (const format of formats) {\n            // Generate for ALL selected platforms\n            const content = await this.generateForAllPlatforms(insight, business, format, platforms);\n            if (content) {\n              allContent.push(content);\n            }\n          }\n        } else {\n          // Generate single best format for all platforms\n          const format = this.selectBestFormat(insight, opts.formats);\n          const content = await this.generateForAllPlatforms(insight, business, format, platforms);\n          if (content) {\n            allContent.push(content);\n          }\n        }\n      } catch (error) {\n        const errorMessage = error instanceof Error ? error.message : String(error);\n        console.error(`Error generating content for insight ${insight.id}:`, error);\n        errors.push(`Insight ${insight.id}: ${errorMessage}`);\n      }\n    }\n\n    // Filter by impact score\n    const filtered = allContent.filter(\n      content => (content.metadata.impactScore || 0) >= opts.minImpactScore\n    );\n\n    console.log(`✅ Generated ${filtered.length} content pieces (filtered from ${allContent.length})`);\n\n    // Rank content by predicted performance\n    const ranked = this.rankContent(filtered);\n\n    // Take top N\n    const topContent = ranked.slice(0, opts.maxContent);\n\n    // Calculate statistics\n    const stats = this.calculateStats(topContent, allContent.length);\n\n    const processingTime = Date.now() - startTime;\n\n    return {\n      content: topContent,\n      stats,\n      metadata: {\n        generatedAt: new Date(),\n        processingTimeMs: processingTime,\n        insightsProcessed: insights.length,\n        contentGenerated: topContent.length,\n        errors: errors.length > 0 ? errors : undefined\n      }\n    };\n  }\n\n  /**\n   * Select best format for an insight\n   */\n  private selectBestFormat(\n    insight: BreakthroughInsight,\n    availableFormats: ContentFormat[]\n  ): ContentFormat {\n    // Map insight types to best formats\n    const formatMap: Record<string, ContentFormat> = {\n      'unexpected_connection': 'hook-post',\n      'counter_intuitive': 'controversial-post',\n      'predictive_opportunity': 'data-post',\n      'deep_psychology': 'story-post',\n      'cultural_moment': 'story-post',\n      'hidden_pattern': 'data-post',\n      'strategic_implication': 'data-post',\n      'behavioral_contradiction': 'controversial-post'\n    };\n\n    const recommended = formatMap[insight.type] || 'hook-post';\n\n    // Return recommended if available, otherwise first available\n    return availableFormats.includes(recommended)\n      ? recommended\n      : availableFormats[0];\n  }\n\n  /**\n   * Select multiple formats for an insight\n   */\n  private selectFormats(\n    insight: BreakthroughInsight,\n    availableFormats: ContentFormat[]\n  ): ContentFormat[] {\n    const best = this.selectBestFormat(insight, availableFormats);\n\n    // Generate 2-3 formats: best + complementary\n    const formats: ContentFormat[] = [best];\n\n    // Add complementary formats based on insight type\n    if (insight.type === 'counter_intuitive') {\n      // Controversial insights also work as data posts and hook posts\n      if (availableFormats.includes('data-post') && !formats.includes('data-post')) {\n        formats.push('data-post');\n      }\n      if (availableFormats.includes('hook-post') && !formats.includes('hook-post')) {\n        formats.push('hook-post');\n      }\n    } else if (insight.type === 'deep_psychology') {\n      // Psychology insights also work as hook posts\n      if (availableFormats.includes('hook-post') && !formats.includes('hook-post')) {\n        formats.push('hook-post');\n      }\n    } else if (insight.type === 'unexpected_connection') {\n      // Connections work as stories and controversial posts\n      if (availableFormats.includes('story-post') && !formats.includes('story-post')) {\n        formats.push('story-post');\n      }\n    }\n\n    return formats.slice(0, 2); // Max 2 formats per insight (reduces repetition)\n  }\n\n  /**\n   * Generate content for all platforms\n   */\n  private async generateForAllPlatforms(\n    insight: BreakthroughInsight,\n    business: BusinessProfile,\n    format: ContentFormat,\n    platforms: string[]\n  ): Promise<SynapseContent | null> {\n    // Generate for the first platform (primary)\n    const primaryPlatform = platforms[0] || 'linkedin';\n    const primaryContent = await this.generateForFormat(insight, business, format, primaryPlatform as any);\n\n    if (!primaryContent) {\n      return null;\n    }\n\n    // Generate platform-specific variations for ALL selected platforms\n    const platformVariants: Record<string, any> = {};\n\n    for (const platform of platforms) {\n      const platformKey = platform === 'x' ? 'twitter' : platform;\n      const variant = await this.generateForFormat(insight, business, format, platformKey as any);\n      console.log(`[SynapseContentGenerator] Variant generated for ${platform}:`, variant);\n      if (variant) {\n        // Extract content from the nested content property\n        const extractedContent = {\n          headline: variant.content.headline,\n          hook: variant.content.hook,\n          body: variant.content.body,\n          cta: variant.content.cta,\n          hashtags: variant.content.hashtags || []\n        };\n        console.log(`[SynapseContentGenerator] Extracted content for ${platform}:`, extractedContent);\n        platformVariants[platform] = extractedContent;\n      } else {\n        console.warn(`[SynapseContentGenerator] No variant generated for ${platform}`);\n      }\n    }\n\n    // Store all platform variants in the content metadata\n    return {\n      ...primaryContent,\n      platformVariants,\n      // Also store which platforms this content is for\n      platforms: platforms as Platform[]\n    };\n  }\n\n  /**\n   * Generate content for a specific format\n   */\n  private async generateForFormat(\n    insight: BreakthroughInsight,\n    business: BusinessProfile,\n    format: ContentFormat,\n    platform: 'linkedin' | 'facebook' | 'instagram' | 'twitter' | 'generic' = 'linkedin'\n  ): Promise<SynapseContent | null> {\n    try {\n      switch (format) {\n        // Social Media Formats\n        case 'hook-post':\n          return await this.hookGenerator.generate(insight, business);\n\n        case 'story-post':\n          return await this.storyGenerator.generate(insight, business);\n\n        case 'data-post':\n          return await this.dataGenerator.generate(insight, business);\n\n        case 'controversial-post':\n          return await this.controversialGenerator.generate(insight, business, platform as 'linkedin' | 'facebook' | 'instagram' | 'twitter');\n\n        // Email Formats\n        case 'email-newsletter':\n          return await this.emailGenerator.generate(insight, business, 'newsletter');\n\n        case 'email-promo':\n          return await this.emailGenerator.generate(insight, business, 'promo');\n\n        case 'email-sequence':\n          return await this.emailGenerator.generate(insight, business, 'sequence');\n\n        // Blog Formats\n        case 'blog-post':\n        case 'blog-how-to':\n          return await this.blogGenerator.generate(insight, business, 'how-to');\n\n        case 'blog-listicle':\n          return await this.blogGenerator.generate(insight, business, 'listicle');\n\n        case 'blog-case-study':\n          return await this.blogGenerator.generate(insight, business, 'case-study');\n\n        // Landing Page Formats\n        case 'landing-page':\n        case 'landing-hero':\n          return await this.landingPageGenerator.generate(insight, business, 'hero');\n\n        case 'landing-sales':\n          return await this.landingPageGenerator.generate(insight, business, 'sales');\n\n        default:\n          console.warn(`Unknown format: ${format}`);\n          return null;\n      }\n    } catch (error) {\n      console.error(`[ContentGen] Error generating ${format} for insight ${insight.id}:`, error);\n      throw error; // Re-throw to see the actual error\n    }\n  }\n\n  /**\n   * Rank content by predicted impact\n   */\n  private rankContent(content: SynapseContent[]): SynapseContent[] {\n    return content.sort((a, b) => {\n      // Calculate composite score\n      const scoreA = this.calculateCompositeScore(a);\n      const scoreB = this.calculateCompositeScore(b);\n      return scoreB - scoreA;\n    });\n  }\n\n  /**\n   * Calculate composite score for ranking\n   */\n  private calculateCompositeScore(content: SynapseContent): number {\n    const weights = {\n      engagement: 0.3,\n      viral: 0.25,\n      leadGen: 0.25,\n      brand: 0.2\n    };\n\n    return (\n      content.prediction.engagementScore * weights.engagement +\n      content.prediction.viralPotential * weights.viral +\n      content.prediction.leadGeneration * weights.leadGen +\n      content.prediction.brandImpact * weights.brand\n    );\n  }\n\n  /**\n   * Calculate generation statistics\n   */\n  private calculateStats(\n    topContent: SynapseContent[],\n    totalGenerated: number\n  ): GenerationResult['stats'] {\n    if (topContent.length === 0) {\n      return {\n        totalGenerated: 0,\n        byFormat: {},\n        averageScores: {\n          engagement: 0,\n          viral: 0,\n          leadGen: 0,\n          brand: 0\n        },\n        topFormats: []\n      };\n    }\n\n    // Count by format\n    const byFormat: Record<ContentFormat, number> = {\n      'hook-post': 0,\n      'story-post': 0,\n      'data-post': 0,\n      'controversial-post': 0,\n      'thread': 0,\n      'carousel': 0\n    };\n\n    topContent.forEach(content => {\n      byFormat[content.format] = (byFormat[content.format] || 0) + 1;\n    });\n\n    // Calculate average scores\n    const avgEngagement = topContent.reduce((sum, c) => sum + c.prediction.engagementScore, 0) / topContent.length;\n    const avgViral = topContent.reduce((sum, c) => sum + c.prediction.viralPotential, 0) / topContent.length;\n    const avgLeadGen = topContent.reduce((sum, c) => sum + c.prediction.leadGeneration, 0) / topContent.length;\n    const avgBrand = topContent.reduce((sum, c) => sum + c.prediction.brandImpact, 0) / topContent.length;\n\n    // Get top formats\n    const topFormats = Object.entries(byFormat)\n      .filter(([_, count]) => count > 0)\n      .sort(([_, a], [__, b]) => b - a)\n      .map(([format]) => format as ContentFormat);\n\n    return {\n      totalGenerated,\n      byFormat,\n      averageScores: {\n        engagement: avgEngagement,\n        viral: avgViral,\n        leadGen: avgLeadGen,\n        brand: avgBrand\n      },\n      topFormats\n    };\n  }\n\n  /**\n   * Generate content for a single insight (convenience method)\n   */\n  async generateSingle(\n    insight: BreakthroughInsight,\n    business: BusinessProfile,\n    format?: ContentFormat\n  ): Promise<SynapseContent | null> {\n    const selectedFormat = format || this.selectBestFormat(insight, [\n      'hook-post',\n      'story-post',\n      'data-post',\n      'controversial-post'\n    ]);\n\n    return await this.generateForFormat(insight, business, selectedFormat);\n  }\n\n  /**\n   * Generate all possible formats for an insight\n   */\n  async generateAll(\n    insight: BreakthroughInsight,\n    business: BusinessProfile\n  ): Promise<SynapseContent[]> {\n    const allFormats: ContentFormat[] = ['hook-post', 'story-post', 'data-post', 'controversial-post'];\n    const content: SynapseContent[] = [];\n\n    for (const format of allFormats) {\n      try {\n        const generated = await this.generateForFormat(insight, business, format);\n        if (generated) {\n          content.push(generated);\n        }\n      } catch (error) {\n        console.error(`Error generating ${format}:`, error);\n        // Continue with other formats\n      }\n    }\n\n    return content;\n  }\n\n  /**\n   * Get format recommendation for an insight\n   */\n  getFormatRecommendation(insight: BreakthroughInsight): {\n    primary: ContentFormat;\n    alternatives: ContentFormat[];\n    reason: string;\n  } {\n    const primary = this.selectBestFormat(insight, [\n      'hook-post',\n      'story-post',\n      'data-post',\n      'controversial-post'\n    ]);\n\n    const allFormats = this.selectFormats(insight, [\n      'hook-post',\n      'story-post',\n      'data-post',\n      'controversial-post'\n    ]);\n\n    const alternatives = allFormats.filter(f => f !== primary);\n\n    const reasons: Record<ContentFormat, string> = {\n      'hook-post': 'Creates curiosity gap that drives engagement',\n      'story-post': 'Builds emotional connection through narrative',\n      'data-post': 'Establishes authority with evidence',\n      'controversial-post': 'Sparks debate and challenges assumptions',\n      'thread': 'Deep-dive exploration',\n      'carousel': 'Visual storytelling'\n    };\n\n    return {\n      primary,\n      alternatives,\n      reason: reasons[primary]\n    };\n  }\n\n  /**\n   * Generate A/B test variants from content\n   */\n  async generateVariants(\n    content: SynapseContent,\n    business: BusinessProfile,\n    strategies?: VariantStrategy[]\n  ): Promise<ABTestGroup> {\n    console.log('[ContentGenerator] Generating A/B variants for content:', content.id);\n    return await this.variantGenerator.generateVariants(content, business, strategies);\n  }\n\n  /**\n   * Validate content character counts\n   */\n  validateContent(\n    content: SynapseContent,\n    platforms?: Platform[]\n  ) {\n    return this.characterValidator.validateContent(content, platforms);\n  }\n\n  /**\n   * Get character count summary\n   */\n  getCharacterSummary(content: SynapseContent) {\n    return this.characterValidator.getCharacterSummary(content);\n  }\n\n  /**\n   * Regenerate a specific section\n   */\n  async regenerateSection(\n    content: SynapseContent,\n    section: ContentSection,\n    business: BusinessProfile,\n    insight: BreakthroughInsight,\n    improvementDirection?: string\n  ): Promise<RegenerationResult> {\n    return await this.sectionRegenerator.regenerateSection(\n      content,\n      section,\n      business,\n      insight,\n      improvementDirection\n    );\n  }\n\n  /**\n   * Apply regeneration result to content\n   */\n  applyRegeneration(\n    content: SynapseContent,\n    result: RegenerationResult,\n    selectedIndex: number\n  ): SynapseContent {\n    return this.sectionRegenerator.applyRegeneration(content, result, selectedIndex);\n  }\n\n  /**\n   * Detect contrarian angles from insights\n   */\n  async detectContrarianAngles(\n    insights: BreakthroughInsight[]\n  ): Promise<ContrarianDetectionResult> {\n    return await this.contrarianDetector.detectContrarianAngles(insights);\n  }\n}\n","/**\n * Humor Optimizer\n *\n * Adds professional humor to content based on edginess level (0-100 scale).\n * Uses Claude to enhance content while maintaining brand safety and professionalism.\n *\n * Edginess Scale:\n * - 0-25: Professional (subtle, polished, corporate-safe)\n * - 26-50: Approachable (warm, relatable, friendly)\n * - 51-75: Casual (conversational, witty, personable)\n * - 76-100: Edgy (bold, playful, attention-grabbing)\n *\n * Created: 2025-11-11\n */\n\nimport type {\n  SynapseContent,\n  BusinessProfile,\n  EdginessLevel,\n  HumorEnhancementResult,\n  EDGINESS_RANGES\n} from '@/types/synapseContent.types';\n\nconst OPENROUTER_API_KEY = import.meta.env.VITE_OPENROUTER_API_KEY;\n\nif (!OPENROUTER_API_KEY) {\n  throw new Error('VITE_OPENROUTER_API_KEY is not set in .env file');\n}\n\nexport class HumorOptimizer {\n  /**\n   * Add humor to content based on edginess level\n   */\n  async enhance(\n    content: SynapseContent,\n    business: BusinessProfile,\n    edginessLevel: EdginessLevel\n  ): Promise<HumorEnhancementResult> {\n    const edginessLabel = this.getEdginessLabel(edginessLevel);\n\n    const prompt = this.buildEnhancementPrompt(content, business, edginessLevel, edginessLabel);\n\n    console.log('[HumorOptimizer] Enhancing content with edginess level:', edginessLevel, edginessLabel);\n\n    try {\n      const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${OPENROUTER_API_KEY}`,\n          'Content-Type': 'application/json',\n          'HTTP-Referer': window.location.origin,\n          'X-Title': 'MARBA Synapse Humor Optimizer'\n        },\n        body: JSON.stringify({\n          model: 'anthropic/claude-3.5-sonnet',\n          messages: [\n            {\n              role: 'user',\n              content: prompt\n            }\n          ],\n          temperature: 0.7,\n          max_tokens: 2000\n        })\n      });\n\n      if (!response.ok) {\n        throw new Error(`OpenRouter API error: ${response.status} ${response.statusText}`);\n      }\n\n      const data = await response.json();\n      const enhancedText = data.choices[0].message.content;\n\n      console.log('[HumorOptimizer] Enhanced content received:', enhancedText.substring(0, 200));\n\n      // Parse the enhanced content\n      const enhanced = this.parseEnhancedContent(enhancedText);\n\n      return {\n        original: {\n          headline: content.content.headline,\n          hook: content.content.hook,\n          body: content.content.body,\n          cta: content.content.cta\n        },\n        enhanced,\n        edginessLevel,\n        enhancementsApplied: this.detectEnhancements(content, enhanced)\n      };\n    } catch (error) {\n      console.error('[HumorOptimizer] Enhancement failed:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Get edginess range label\n   */\n  private getEdginessLabel(level: EdginessLevel): string {\n    if (level <= 25) return 'Professional';\n    if (level <= 50) return 'Approachable';\n    if (level <= 75) return 'Casual';\n    return 'Edgy';\n  }\n\n  /**\n   * Build enhancement prompt for Claude\n   */\n  private buildEnhancementPrompt(\n    content: SynapseContent,\n    business: BusinessProfile,\n    edginessLevel: EdginessLevel,\n    edginessLabel: string\n  ): string {\n    // Get edginess-specific guidelines\n    const guidelines = this.getEdginessGuidelines(edginessLevel, business.industry);\n\n    return `You are a professional copywriter enhancing content with humor for a ${business.industry} business.\n\nBUSINESS: ${business.name}\nINDUSTRY: ${business.industry}\nEDGINESS LEVEL: ${edginessLevel}/100 (${edginessLabel})\n\nCURRENT CONTENT:\n\nHeadline: ${content.content.headline}\nHook: ${content.content.hook}\nBody: ${content.content.body}\nCTA: ${content.content.cta}\n\n---\n\nYOUR TASK: Enhance this content with ${edginessLabel.toLowerCase()} humor while maintaining professionalism and brand safety.\n\n${guidelines}\n\nCRITICAL RULES:\n1. ✅ MAINTAIN CLARITY - Humor should enhance, not obscure the message\n2. ✅ BRAND SAFE - No offensive, controversial, or risky humor\n3. ✅ INDUSTRY APPROPRIATE - Match the ${business.industry} tone\n4. ✅ PRESERVE CTA - Keep the call-to-action clear and actionable\n5. ❌ NO FORCED HUMOR - If it doesn't flow naturally, leave it unchanged\n6. ❌ NO MEMES/TRENDS - No dated references or TikTok-speak\n7. ❌ NO PUNS FOR PUNS' SAKE - Only use wordplay if it strengthens the message\n\nOUTPUT FORMAT (return ONLY the enhanced content, no explanations):\n\nHEADLINE: [enhanced headline]\nHOOK: [enhanced hook]\nBODY: [enhanced body - preserve line breaks with \\\\n\\\\n]\nCTA: [enhanced CTA]`;\n  }\n\n  /**\n   * Get edginess-specific guidelines\n   */\n  private getEdginessGuidelines(level: EdginessLevel, industry: string): string {\n    if (level <= 25) {\n      // Professional (0-25)\n      return `PROFESSIONAL TONE (Edginess: ${level}/100):\n- Use subtle, sophisticated observations\n- Employ light irony or understatement\n- Keep it polished and corporate-safe\n- Think \"knowing smile\" not \"laugh out loud\"\n\nGOOD EXAMPLES:\n❌ \"Your lawn is a hot mess!\"\n✅ \"Your lawn has strong opinions about summer\"\n\n❌ \"That meeting could've been an email\"\n✅ \"Efficient meetings start with great coffee\"`;\n    } else if (level <= 50) {\n      // Approachable (26-50)\n      return `APPROACHABLE TONE (Edginess: ${level}/100):\n- Use relatable, warm observations\n- Gentle self-deprecation or shared experiences\n- Conversational and friendly\n- Think \"coffee chat with a colleague\"\n\nGOOD EXAMPLES:\n❌ \"Adulting is hard\"\n✅ \"When 'I'll handle it tomorrow' becomes a lifestyle choice\"\n\n❌ \"Monday vibes\"\n✅ \"Monday mornings hit different when your coffee is right\"`;\n    } else if (level <= 75) {\n      // Casual (51-75)\n      return `CASUAL TONE (Edginess: ${level}/100):\n- Use witty, conversational language\n- Playful observations about common situations\n- More personality, less formality\n- Think \"text from a clever friend\"\n\nGOOD EXAMPLES:\n❌ \"We're the best!\"\n✅ \"We're the 'where have you been all my life' of lawn care\"\n\n❌ \"Professional service\"\n✅ \"Because 'I'll mow it this weekend' is the adult version of 'my dog ate my homework'\"`;\n    } else {\n      // Edgy (76-100)\n      return `EDGY TONE (Edginess: ${level}/100):\n- Use bold, attention-grabbing language\n- Push boundaries while staying brand-safe\n- More irreverent, less corporate\n- Think \"the friend who tells it like it is\"\n\nGOOD EXAMPLES:\n❌ \"We're amazing!\"\n✅ \"That lawn isn't going to passive-aggressively grow itself into an HOA violation. Oh wait, it is.\"\n\n❌ \"Quality coffee\"\n✅ \"Because your coworkers deserve better than whatever's happening in that break room pot\"\n\nSAFETY LIMITS (DO NOT CROSS):\n- No profanity or crude language\n- No controversial topics (politics, religion, etc.)\n- No making fun of customers\n- No liability-creating content (alcohol excess, etc.)`;\n    }\n  }\n\n  /**\n   * Parse Claude's enhanced content response\n   */\n  private parseEnhancedContent(text: string): { headline: string; hook: string; body: string; cta: string } {\n    const lines = text.split('\\n').filter(l => l.trim());\n\n    const result = {\n      headline: '',\n      hook: '',\n      body: '',\n      cta: ''\n    };\n\n    let currentSection = '';\n    let bodyLines: string[] = [];\n\n    for (const line of lines) {\n      if (line.startsWith('HEADLINE:')) {\n        currentSection = 'headline';\n        result.headline = line.replace('HEADLINE:', '').trim();\n      } else if (line.startsWith('HOOK:')) {\n        currentSection = 'hook';\n        result.hook = line.replace('HOOK:', '').trim();\n      } else if (line.startsWith('BODY:')) {\n        currentSection = 'body';\n        const bodyStart = line.replace('BODY:', '').trim();\n        if (bodyStart) bodyLines.push(bodyStart);\n      } else if (line.startsWith('CTA:')) {\n        currentSection = 'cta';\n        result.cta = line.replace('CTA:', '').trim();\n      } else if (currentSection === 'headline' && !result.headline) {\n        result.headline = line.trim();\n      } else if (currentSection === 'hook' && !result.hook) {\n        result.hook = line.trim();\n      } else if (currentSection === 'body') {\n        bodyLines.push(line.trim());\n      } else if (currentSection === 'cta' && !result.cta) {\n        result.cta = line.trim();\n      }\n    }\n\n    // Join body lines with double line breaks\n    result.body = bodyLines.join('\\n\\n');\n\n    return result;\n  }\n\n  /**\n   * Detect what was enhanced\n   */\n  private detectEnhancements(\n    original: SynapseContent,\n    enhanced: { headline: string; hook: string; body: string; cta: string }\n  ): string[] {\n    const changes: string[] = [];\n\n    if (enhanced.headline !== original.content.headline) {\n      changes.push('Headline enhanced');\n    }\n    if (enhanced.hook !== original.content.hook) {\n      changes.push('Hook enhanced');\n    }\n    if (enhanced.body !== original.content.body) {\n      changes.push('Body enhanced');\n    }\n    if (enhanced.cta !== original.content.cta) {\n      changes.push('CTA enhanced');\n    }\n\n    return changes.length > 0 ? changes : ['No changes made'];\n  }\n}\n","/**\n * Competitive Intelligence Service\n * Discovers competitors, profiles them, finds gaps, and scores opportunities\n * Combines data from Serper, SEMrush, Apify, and Website Analyzer\n */\n\nimport { SerperAPI } from './serper-api'\nimport { SemrushAPI } from './semrush-api'\nimport { ApifyAPI } from './apify-api'\nimport { websiteAnalyzer } from './website-analyzer.service'\nimport { intelligenceCache } from './intelligence-cache.service'\n\nexport interface Competitor {\n  domain: string\n  name: string\n  url: string\n  source: 'serper' | 'semrush' | 'manual'\n}\n\nexport interface CompetitorProfile {\n  domain: string\n  name: string\n  url: string\n\n  // Website Analysis (Claude AI)\n  messaging?: {\n    valuePropositions: string[]\n    targetAudience: string[]\n    problems: string[]\n    solutions: string[]\n    differentiators: string[]\n    confidence: number\n  }\n\n  // SEO Data (SEMrush)\n  seo?: {\n    organicTraffic: number\n    paidTraffic: number\n    backlinks: number\n    keywords: number\n    authorityScore: number\n  }\n\n  // Reviews (Apify Google Maps)\n  reviews?: {\n    rating: number\n    count: number\n    recentReviews: Array<{\n      text: string\n      stars: number\n      date: string\n    }>\n  }\n\n  // Content Analysis (Serper)\n  content?: {\n    topRankingKeywords: string[]\n    recentNews: string[]\n    videoContent: string[]\n  }\n\n  lastUpdated: string\n}\n\nexport interface ContentGap {\n  keyword: string\n  searchVolume: number\n  difficulty: number\n  currentRank?: number\n  competitorRank: number\n  competitor: string\n  opportunity: 'easy_win' | 'medium' | 'hard'\n  estimatedTraffic: number\n}\n\nexport interface MessagingGap {\n  category: 'value_prop' | 'target_audience' | 'problem' | 'solution' | 'differentiator'\n  competitorClaim: string\n  competitor: string\n  ourClaim?: string\n  opportunity: string\n  confidence: number\n}\n\nexport interface PerformanceGap {\n  metric: 'rating' | 'review_count' | 'response_time' | 'authority'\n  ourValue: number\n  competitorValue: number\n  competitor: string\n  gap: number\n  opportunityType: 'underperforming' | 'parity' | 'advantage'\n}\n\nexport interface ScoredOpportunity {\n  type: 'content' | 'messaging' | 'performance'\n  title: string\n  description: string\n  roiScore: number // 0-100\n  difficulty: 'easy' | 'medium' | 'hard'\n  estimatedImpact: {\n    traffic?: number\n    conversions?: number\n    authority?: number\n  }\n  actionable: string // What to do about it\n  data: ContentGap | MessagingGap | PerformanceGap\n}\n\nclass CompetitiveIntelligenceService {\n  /**\n   * Discover competitors using Serper search + SEMrush data\n   */\n  async discoverCompetitors(options: {\n    industry: string\n    location?: string\n    ourDomain?: string\n    limit?: number\n  }): Promise<Competitor[]> {\n    try {\n      console.log('[CompetitiveIntel] Discovering competitors for:', options.industry)\n\n      const competitors: Competitor[] = []\n      const uniqueDomains = new Set<string>()\n\n      // 1. Find competitors via Serper search\n      try {\n        const searchQuery = `top ${options.industry} companies ${options.location || ''}`\n        const searchResults = await SerperAPI.searchGoogle(searchQuery)\n\n        searchResults.slice(0, 10).forEach(result => {\n          try {\n            const url = new URL(result.link)\n            const domain = url.hostname.replace('www.', '')\n\n            if (!uniqueDomains.has(domain) && domain !== options.ourDomain) {\n              uniqueDomains.add(domain)\n              competitors.push({\n                domain,\n                name: result.title.split(' - ')[0].split(' | ')[0].trim(),\n                url: result.link,\n                source: 'serper'\n              })\n            }\n          } catch (err) {\n            // Invalid URL, skip\n          }\n        })\n      } catch (err) {\n        console.warn('[CompetitiveIntel] Serper search failed:', err)\n      }\n\n      // 2. Find competitors via Serper Places (if location provided)\n      if (options.location) {\n        try {\n          const places = await SerperAPI.getPlaces(options.industry, options.location)\n\n          places.slice(0, 10).forEach(place => {\n            if (place.website) {\n              try {\n                const url = new URL(place.website)\n                const domain = url.hostname.replace('www.', '')\n\n                if (!uniqueDomains.has(domain) && domain !== options.ourDomain) {\n                  uniqueDomains.add(domain)\n                  competitors.push({\n                    domain,\n                    name: place.name,\n                    url: place.website,\n                    source: 'serper'\n                  })\n                }\n              } catch (err) {\n                // Invalid URL, skip\n              }\n            }\n          })\n        } catch (err) {\n          console.warn('[CompetitiveIntel] Serper Places failed:', err)\n        }\n      }\n\n      // 3. Find competitors via SEMrush (if our domain provided)\n      // Note: SEMrush doesn't have direct competitor discovery, so we use keyword overlap\n      // This is a lightweight approach - we skip this in favor of Serper-based discovery\n      if (options.ourDomain && false) { // Disabled for now - Serper provides better results\n        try {\n          const keywords = await SemrushAPI.getCompetitorKeywords(options.ourDomain)\n          // Would need additional API calls to find who else ranks for these keywords\n          console.log('[CompetitiveIntel] SEMrush competitor discovery skipped - using Serper')\n        } catch (err) {\n          console.warn('[CompetitiveIntel] SEMrush lookup failed:', err)\n        }\n      }\n\n      const limit = options.limit || 10\n      const result = competitors.slice(0, limit)\n\n      console.log(`[CompetitiveIntel] Discovered ${result.length} competitors`)\n      return result\n\n    } catch (error) {\n      console.error('[CompetitiveIntel] Competitor discovery failed:', error)\n      throw error\n    }\n  }\n\n  /**\n   * Profile a competitor using all available intelligence sources\n   */\n  async profileCompetitor(competitor: Competitor): Promise<CompetitorProfile> {\n    try {\n      console.log('[CompetitiveIntel] Profiling competitor:', competitor.domain)\n\n      const profile: CompetitorProfile = {\n        domain: competitor.domain,\n        name: competitor.name,\n        url: competitor.url,\n        lastUpdated: new Date().toISOString()\n      }\n\n      // Check cache first\n      const cacheKey = intelligenceCache.cacheKeyCompetitorProfile(competitor.domain)\n      const cached = await intelligenceCache.get<CompetitorProfile>(cacheKey)\n\n      if (cached) {\n        console.log('[CompetitiveIntel] Returning cached profile')\n        return cached\n      }\n\n      // Gather all data in parallel with graceful fallbacks\n      const [messaging, seo, reviews, content] = await Promise.allSettled([\n        this.fetchCompetitorMessaging(competitor.url),\n        this.fetchCompetitorSEO(competitor.domain),\n        this.fetchCompetitorReviews(competitor.name),\n        this.fetchCompetitorContent(competitor.domain)\n      ])\n\n      if (messaging.status === 'fulfilled') profile.messaging = messaging.value\n      if (seo.status === 'fulfilled') profile.seo = seo.value\n      if (reviews.status === 'fulfilled') profile.reviews = reviews.value\n      if (content.status === 'fulfilled') profile.content = content.value\n\n      // Cache profile for 7 days\n      await intelligenceCache.set(cacheKey, profile, {\n        dataType: 'competitor_profile',\n        sourceApi: 'aggregated'\n      })\n\n      console.log('[CompetitiveIntel] Profile complete:', {\n        hasMessaging: !!profile.messaging,\n        hasSEO: !!profile.seo,\n        hasReviews: !!profile.reviews,\n        hasContent: !!profile.content\n      })\n\n      return profile\n\n    } catch (error) {\n      console.error('[CompetitiveIntel] Competitor profiling failed:', error)\n      throw error\n    }\n  }\n\n  /**\n   * Fetch competitor messaging via Website Analyzer\n   */\n  private async fetchCompetitorMessaging(url: string): Promise<CompetitorProfile['messaging']> {\n    const analysis = await websiteAnalyzer.analyzeWebsite(url)\n\n    return {\n      valuePropositions: analysis.valuePropositions,\n      targetAudience: analysis.targetAudience,\n      problems: analysis.customerProblems,\n      solutions: analysis.solutions,\n      differentiators: analysis.differentiators,\n      confidence: analysis.confidence\n    }\n  }\n\n  /**\n   * Fetch competitor SEO data via SEMrush\n   */\n  private async fetchCompetitorSEO(domain: string): Promise<CompetitorProfile['seo']> {\n    const overview = await SemrushAPI.getDomainOverview(domain)\n\n    return {\n      organicTraffic: overview.organic_traffic,\n      paidTraffic: overview.paid_keywords, // Using paid keywords as proxy\n      backlinks: overview.backlinks,\n      keywords: overview.organic_keywords,\n      authorityScore: overview.authority_score\n    }\n  }\n\n  /**\n   * Fetch competitor reviews via Apify Google Maps\n   */\n  private async fetchCompetitorReviews(name: string): Promise<CompetitorProfile['reviews']> {\n    const places = await ApifyAPI.scrapeGoogleMapsReviews({\n      searchQuery: name,\n      maxReviews: 20\n    })\n\n    if (places.length === 0) {\n      return undefined\n    }\n\n    const place = places[0]\n\n    return {\n      rating: place.rating,\n      count: place.reviewsCount,\n      recentReviews: (place.reviews || []).slice(0, 10).map(review => ({\n        text: review.text,\n        stars: review.stars,\n        date: review.publishedAtDate\n      }))\n    }\n  }\n\n  /**\n   * Fetch competitor content data via Serper\n   */\n  private async fetchCompetitorContent(domain: string): Promise<CompetitorProfile['content']> {\n    const [keywords, news, videos] = await Promise.allSettled([\n      SemrushAPI.getKeywordRankings(domain).then(rankings => rankings.slice(0, 10)),\n      SerperAPI.getNews(`${domain} news`),\n      SerperAPI.getVideos(domain)\n    ])\n\n    return {\n      topRankingKeywords: keywords.status === 'fulfilled' ? keywords.value.map(k => k.keyword) : [],\n      recentNews: news.status === 'fulfilled' ? news.value.slice(0, 5).map(n => n.title) : [],\n      videoContent: videos.status === 'fulfilled' ? videos.value.slice(0, 5).map(v => v.title) : []\n    }\n  }\n\n  /**\n   * Find content gaps (keywords competitors rank for that we don't)\n   */\n  async findContentGaps(options: {\n    ourDomain: string\n    competitors: string[]\n    limit?: number\n  }): Promise<ContentGap[]> {\n    try {\n      console.log('[CompetitiveIntel] Finding content gaps...')\n\n      const gaps: ContentGap[] = []\n\n      // Get our top keywords\n      const ourKeywords = await SemrushAPI.getKeywordRankings(options.ourDomain)\n      const ourKeywordSet = new Set(ourKeywords.map(k => k.keyword.toLowerCase()))\n\n      // Check each competitor\n      for (const competitorDomain of options.competitors) {\n        try {\n          const compKeywords = await SemrushAPI.getKeywordRankings(competitorDomain)\n\n          compKeywords.slice(0, 50).forEach(kw => {\n            const keyword = kw.keyword.toLowerCase()\n\n            // If they rank for it and we don't, it's a gap\n            if (!ourKeywordSet.has(keyword)) {\n              const opportunity =\n                kw.difficulty < 30 ? 'easy_win' :\n                kw.difficulty < 60 ? 'medium' : 'hard'\n\n              gaps.push({\n                keyword: kw.keyword,\n                searchVolume: kw.searchVolume,\n                difficulty: kw.difficulty,\n                competitorRank: kw.position,\n                competitor: competitorDomain,\n                opportunity,\n                estimatedTraffic: Math.round(kw.searchVolume * (kw.position <= 3 ? 0.3 : kw.position <= 10 ? 0.1 : 0.05))\n              })\n            }\n          })\n        } catch (err) {\n          console.warn(`[CompetitiveIntel] Failed to get keywords for ${competitorDomain}`)\n        }\n      }\n\n      // Sort by estimated traffic potential\n      const sorted = gaps.sort((a, b) => b.estimatedTraffic - a.estimatedTraffic)\n\n      const limit = options.limit || 20\n      return sorted.slice(0, limit)\n\n    } catch (error) {\n      console.error('[CompetitiveIntel] Content gap analysis failed:', error)\n      throw error\n    }\n  }\n\n  /**\n   * Find messaging gaps (claims/positioning competitors use that we don't)\n   */\n  async findMessagingGaps(options: {\n    ourProfile: CompetitorProfile\n    competitorProfiles: CompetitorProfile[]\n  }): Promise<MessagingGap[]> {\n    const gaps: MessagingGap[] = []\n\n    const ourMessaging = options.ourProfile.messaging\n    if (!ourMessaging) {\n      console.warn('[CompetitiveIntel] No messaging data for our profile')\n      return gaps\n    }\n\n    // Track what we claim\n    const ourClaims = new Set([\n      ...ourMessaging.valuePropositions.map(v => v.toLowerCase()),\n      ...ourMessaging.differentiators.map(d => d.toLowerCase())\n    ])\n\n    // Check each competitor\n    options.competitorProfiles.forEach(comp => {\n      if (!comp.messaging) return\n\n      // Value proposition gaps\n      comp.messaging.valuePropositions.forEach(vp => {\n        if (!ourClaims.has(vp.toLowerCase())) {\n          gaps.push({\n            category: 'value_prop',\n            competitorClaim: vp,\n            competitor: comp.domain,\n            opportunity: `Consider offering: \"${vp}\"`,\n            confidence: comp.messaging!.confidence\n          })\n        }\n      })\n\n      // Differentiator gaps\n      comp.messaging.differentiators.forEach(diff => {\n        if (!ourClaims.has(diff.toLowerCase())) {\n          gaps.push({\n            category: 'differentiator',\n            competitorClaim: diff,\n            competitor: comp.domain,\n            opportunity: `Potential differentiator: \"${diff}\"`,\n            confidence: comp.messaging!.confidence\n          })\n        }\n      })\n    })\n\n    // Sort by confidence\n    return gaps.sort((a, b) => b.confidence - a.confidence)\n  }\n\n  /**\n   * Find performance gaps (metrics where competitors outperform us)\n   */\n  async findPerformanceGaps(options: {\n    ourProfile: CompetitorProfile\n    competitorProfiles: CompetitorProfile[]\n  }): Promise<PerformanceGap[]> {\n    const gaps: PerformanceGap[] = []\n\n    // Rating gaps\n    if (options.ourProfile.reviews) {\n      const ourRating = options.ourProfile.reviews.rating\n\n      options.competitorProfiles.forEach(comp => {\n        if (comp.reviews) {\n          const gap = comp.reviews.rating - ourRating\n\n          if (gap > 0.2) {\n            gaps.push({\n              metric: 'rating',\n              ourValue: ourRating,\n              competitorValue: comp.reviews.rating,\n              competitor: comp.domain,\n              gap,\n              opportunityType: 'underperforming'\n            })\n          }\n        }\n      })\n    }\n\n    // Authority gaps\n    if (options.ourProfile.seo) {\n      const ourAuthority = options.ourProfile.seo.authorityScore\n\n      options.competitorProfiles.forEach(comp => {\n        if (comp.seo) {\n          const gap = comp.seo.authorityScore - ourAuthority\n\n          if (gap > 10) {\n            gaps.push({\n              metric: 'authority',\n              ourValue: ourAuthority,\n              competitorValue: comp.seo.authorityScore,\n              competitor: comp.domain,\n              gap,\n              opportunityType: 'underperforming'\n            })\n          }\n        }\n      })\n    }\n\n    return gaps.sort((a, b) => b.gap - a.gap)\n  }\n\n  /**\n   * Score all opportunities by ROI potential\n   */\n  async scoreOpportunities(options: {\n    contentGaps: ContentGap[]\n    messagingGaps: MessagingGap[]\n    performanceGaps: PerformanceGap[]\n  }): Promise<ScoredOpportunity[]> {\n    const scored: ScoredOpportunity[] = []\n\n    // Score content gaps\n    options.contentGaps.forEach(gap => {\n      const roiScore = this.calculateROI({\n        trafficPotential: gap.estimatedTraffic,\n        difficulty: gap.difficulty,\n        competitiveGap: gap.competitorRank\n      })\n\n      scored.push({\n        type: 'content',\n        title: `Rank for \"${gap.keyword}\"`,\n        description: `${gap.competitor} ranks #${gap.competitorRank} for this ${gap.searchVolume.toLocaleString()}/mo keyword`,\n        roiScore,\n        difficulty: gap.opportunity === 'easy_win' ? 'easy' : gap.opportunity === 'medium' ? 'medium' : 'hard',\n        estimatedImpact: {\n          traffic: gap.estimatedTraffic\n        },\n        actionable: `Create content targeting \"${gap.keyword}\" - ${gap.opportunity} opportunity`,\n        data: gap\n      })\n    })\n\n    // Score messaging gaps\n    options.messagingGaps.forEach(gap => {\n      const roiScore = this.calculateROI({\n        trafficPotential: 0,\n        difficulty: 50,\n        competitiveGap: gap.confidence\n      })\n\n      scored.push({\n        type: 'messaging',\n        title: gap.opportunity,\n        description: `${gap.competitor} claims: \"${gap.competitorClaim}\"`,\n        roiScore,\n        difficulty: 'medium',\n        estimatedImpact: {\n          conversions: 5 // Arbitrary, hard to estimate\n        },\n        actionable: `Test messaging: \"${gap.competitorClaim}\"`,\n        data: gap\n      })\n    })\n\n    // Score performance gaps\n    options.performanceGaps.forEach(gap => {\n      const roiScore = this.calculateROI({\n        trafficPotential: 100,\n        difficulty: 70,\n        competitiveGap: gap.gap\n      })\n\n      scored.push({\n        type: 'performance',\n        title: `Improve ${gap.metric}`,\n        description: `${gap.competitor} has ${gap.competitorValue} vs our ${gap.ourValue}`,\n        roiScore,\n        difficulty: 'hard',\n        estimatedImpact: {\n          authority: gap.metric === 'authority' ? gap.gap : undefined\n        },\n        actionable: `Focus on improving ${gap.metric} to match ${gap.competitor}`,\n        data: gap\n      })\n    })\n\n    // Sort by ROI score\n    return scored.sort((a, b) => b.roiScore - a.roiScore)\n  }\n\n  /**\n   * Calculate ROI score (0-100) for an opportunity\n   */\n  calculateROI(factors: {\n    trafficPotential: number\n    difficulty: number\n    competitiveGap: number\n  }): number {\n    // Normalize inputs to 0-1 scale\n    const trafficScore = Math.min(factors.trafficPotential / 1000, 1) // Cap at 1000/mo\n    const difficultyPenalty = 1 - (factors.difficulty / 100)\n    const gapBonus = Math.min(factors.competitiveGap / 100, 1)\n\n    // Weighted formula: Traffic (50%), Ease (30%), Gap (20%)\n    const score = (\n      trafficScore * 0.5 +\n      difficultyPenalty * 0.3 +\n      gapBonus * 0.2\n    ) * 100\n\n    return Math.round(Math.max(0, Math.min(100, score)))\n  }\n}\n\nexport const competitiveIntelligence = new CompetitiveIntelligenceService()\nexport { CompetitiveIntelligenceService }\n"],"names":["APIFY_API_KEY","APIFY_API_URL","ACTORS","ApifyAPIService","actorId","input","timeout","runResponse","runId","startTime","resolve","statusResponse","statusData","status","datasetId","datasetResponse","results","error","url","page","_a","_b","_c","_e","_d","_g","_f","options","place","review","username","maxPosts","profile","post","handle","ApifyAPI","OUTSCRAPER_API_KEY","OUTSCRAPER_API_URL","OutScraperAPIService","__publicField","endpoint","params","key","value","response","errorText","apiParams","listings","item","limit","reviewsData","reviews","query","placeId","businessName","location","searchQuery","apifyPlaces","place_id","enriched","listing","competitor","positive","r","negative","neutral","totalSentiment","sum","allText","phrases","rankings","keyword","position","l","profiles","companies","posts","advantages","text","words","w","frequency","word","a","b","theme","mentions","avgSentiment","t","OutScraperAPI","LocationDetectionService","industryHint","result","normalizedUrl","domain","cityPatterns","pattern","data","supabase","fullUrl","prompt","chat","jsonMatch","suffixes","suffix","regex","locationSet","allLocations","addressParts","p","city","state","i","stateMatch","baseUrl","locationPages","locationPageUrl","contentObj","content","locationDetectionService","YOUTUBE_API_KEY","CACHE_TTL","YouTubeAPIService","cached","category","region","cacheKey","categoryParam","videos","keywords","maxResults","searchUrl","searchResponse","videosUrl","industry","tagFrequency","v","acc","tag","trendingTopics","formats","popularFormats","format","avgViewCount","avgEngagementRate","engagement","contentAngles","title","analysis","YouTubeAPI","NewsAPIService","broaderTerms","k","stopWords","terms","SUPABASE_URL","SUPABASE_ANON_KEY","searchTerms","errorData","relevantArticles","article","fallbackResponse","fallbackData","score","NewsAPI","WeatherAPIService","weather","dailyForecasts","forecast","opportunities","temp","isRaining","upcomingHeavyRain","day","upcomingModerateRain","tempSwing","maxSwing","swing","month","seasonalOpp","WeatherAPI","SERPER_API_KEY","SerperAPIService","index","excludeBrand","domains","e","topic","body","timeRange","searchResults","relatedSearches","hasRecentResults","suggestions","image","video","product","SerperAPI","SemrushAPIService","row","traffic","ads","backlinks","brandName","isBranded","searchVolume","difficulty","trend","ranking","overview","healthScore","top10Rankings","SemrushAPI","OPENROUTER_API_KEY","WebsiteAnalyzerService","fullText","websiteContent","truncatedContent","analysisText","totalDataPoints","count","confidence","_h","_i","_j","_k","_l","websiteAnalyzer","RedditAPI","config","useAuth","accessToken","authError","context","triggers","curiosityPatterns","fearPatterns","desirePatterns","belongingPatterns","achievementPatterns","trustPatterns","urgencyPatterns","match","matchIndex","start","end","upvotes","type","intensity","painPointPatterns","subreddits","commentsPerPost","sortBy","timeFilter","allTriggers","allInsights","topicMentions","subredditFilter","postWrapper","postUrl","postText","postContext","postTriggers","postInsight","commentsEndpoint","comments","commentWrapper","comment","commentContext","commentTriggers","commentInsight","industryToSubreddits","normalizedIndustry","redditAPI","DEFAULT_CONFIG","PerplexityAPI","request","customerSegment","insight","problem","solution","competitors","competitorList","brandContext","contextParts","modelName","insights","parsed","line","model","perplexityAPI","TTL_CONFIG","IntelligenceCacheService","components","c","dataType","overrideTTL","ttlMinutes","expiresAt","isValidUUID","brandId","sourceApi","deletedCount","now","stats","entry","intelligenceCache","DeepContextBuilderService","errors","dataSourcesUsed","brandData","youtubeData","outscraperData","newsData","weatherData","serperData","semrushData","websiteData","redditData","perplexityData","linkedinData","dataPoints","deepContext","buildTimeMs","trends","angle","articles","opp","newsResult","trendsResult","autocompleteResult","placesResult","videosResult","imagesResult","newsResults","trendData","suggestion","places","images","websiteUrl","vp","audience","diff","intelligence","trigger","currentMonth","postsResult","companiesResult","err","company","valuePropositions","dp","customerSegments","customerTriggers","competitiveGaps","timingSignals","deepContextBuilder","DAILY_EXPENSES","MONTHLY_SUBSCRIPTIONS","WEEKLY_EXPENSES","ANNUAL_EXPENSES","ALL_CONSUMER_EXPENSES","calculateCostEquivalences","serviceCost","targetDemographic","serviceAnnualCost","normalizeToAnnual","expensesToCheck","d","allEquivalences","expense","equivalences","findEquivalences","aScore","getRelevanceScore","bestMatches","highEmotionalMatches","eq","service","expenseDaily","expenseWeekly","expenseMonthly","days","createEquivalence","weeks","months","createExactEquivalence","amount","unit","timeframe","hook","calculation","generateCalculation","serviceAnnual","expensePer","equivalence","formatForPrompt","output","getIndustryExamples","EMBEDDING_MODEL","EMBEDDING_COST_PER_1M_TOKENS","EmbeddingService","apiKey","embeddings","uncachedTexts","batches","totalTokens","batch","embedding","cost","texts","age","maxAge","snippet","array","size","chunks","totalRequests","hitRate","costSaved","memoryMB","entries","json","generateConnectionHints","dataSources","minSimilarity","maxHints","prioritizeCrossDomain","embeddingService","ds","embeddingResponse","potentialHints","totalSimilarity","comparisons","j","similarity","cosineSimilarity","sourceA","sourceB","unexpectedness","hint","generateHintText","actionable","isActionable","aCrossDomain","bCrossDomain","topHints","processingTimeMs","averageSimilarity","dotProduct","magnitudeA","magnitudeB","cleanA","cleanText","cleanB","typeA","formatSourceType","typeB","formatHintsForPrompt","icon","createDataSourcesFromIntelligence","sources","opportunity","need","advantage","cleanMetaInstructions","patterns","cleaned","before","transformToDetailedDataSources","grouped","point","source","generateSynapses","detailedDataSources","services","costEquivalences","costEquivalenceText","formatCostEquivalences","connectionResult","connectionHintText","dataContext","buildDataContext","buildSynapsePrompt","claudeResponse","callClaude","synapses","parseClaudeResponse","generationTimeMs","totalCost","extractBusinessSpecialization","section","lower","specialization","topicText","oppText","triggerText","needText","insightText","currentDate","finishReason","business","fixedJson","openBraces","closeBraces","openBrackets","closeBrackets","bt","PowerWordOptimizer","powerWordsData","map","toApply","optimized","weakWords","originalWord","targetCategory","categoryWords","candidates","pw","fallback","best","lowerText","industryKey","industryData","industryPowerWords","bodyLower","missingWords","wordsToAdd","lowerIndustry","found","goal","ctas","powerWords","impact","HOOK_STORY_OFFER","PROBLEM_AGITATE_SOLUTION","AIDA_SOCIAL","BEFORE_AFTER_BRIDGE","EMAIL_AIDA","EMAIL_PAS","BLOG_HOW_TO","BLOG_LISTICLE","LANDING_HERO","LANDING_PASTOR","ContentFrameworkLibrary","id","channel","f","platform","channelFrameworks","scored","framework","allForChannel","primary","alternatives","reasoning","detectTargetAudience","parts","s","industryToAudience","validateEvidence","evidence","isSearchKeyword","isTooShort","getCleanEvidence","maxItems","HookPostGenerator","targetAudience","draft","cleanEvidence","story","offer","headline","offers","firstSentence","baseHashtags","relevantHashtags","StoryPostGenerator","after","bridge","DataPostGenerator","attention","interest","desire","action","part","cleanInstructions","PremiumContentWriter","platformConfigs","platformConfig","jsonStr","escapedValue","headlineMatch","hookMatch","bodyMatch","ctaMatch","existingContent","ControversialPostGenerator","premiumContent","agitate","cta","formatted","industryTags","engagementTags","EmailGenerator","emailType","subjectLine","preheader","ps","frameworkId","BlogGenerator","blogType","metaDescription","slug","LandingPageGenerator","pageType","subheadline","bulletPoints","socialProof","VariantGenerator","originalContent","strategies","variants","strategy","variantLetter","variant","recommended","original","variantText","variantContent","differences","strategyGuidelines","lines","currentSection","bodyLines","bodyStart","scarcityVariant","PLATFORM_LIMITS","getPlatformLimits","CharacterValidator","platforms","validations","hasErrors","hasWarnings","overallStatus","recommendations","limits","min","max","optimal","total","message","deviation","warnings","platformErrors","platformWarnings","items","validation","SectionRegenerator","improvementDirection","currentContent","sectionGuidelines","improvementNote","regeneratingSection","currentOption","collectingContent","trimmedLine","selectedIndex","newContent","selectedText","sections","ContrarianAngleDetector","competitorClaims","contrarianAngles","claim","ranked","claims","claimMap","existing","supportingInsights","lowercaseAngle","angles","riskOrder","SynapseContentGenerator","opts","allContent","errorMessage","filtered","topContent","processingTime","availableFormats","primaryPlatform","primaryContent","platformVariants","platformKey","extractedContent","scoreA","weights","totalGenerated","byFormat","avgEngagement","avgViral","avgLeadGen","avgBrand","topFormats","_","__","selectedFormat","allFormats","generated","HumorOptimizer","edginessLevel","edginessLabel","enhancedText","enhanced","level","guidelines","changes","CompetitiveIntelligenceService","uniqueDomains","messaging","seo","name","news","n","gaps","ourKeywords","ourKeywordSet","competitorDomain","kw","sorted","ourMessaging","ourClaims","comp","ourRating","gap","ourAuthority","roiScore","factors","trafficScore","difficultyPenalty","gapBonus","competitiveIntelligence"],"mappings":"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"}