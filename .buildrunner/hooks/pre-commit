#!/bin/bash
# BR3 Pre-commit Hook
# Validates code before commit

set -e

echo "ğŸ” BR3 Pre-commit checks..."

# Check for blocked patterns
if grep -r "DISABLE ROW LEVEL SECURITY" --include="*.sql" . 2>/dev/null; then
    echo "âŒ BLOCKED: Found 'DISABLE ROW LEVEL SECURITY' - this is forbidden"
    exit 1
fi

# Check for blocked imports in package.json changes
if git diff --cached --name-only | grep -q "package.json"; then
    for lib in "@chakra-ui" "@mui/material" "antd" "@nextui-org" "@mantine"; do
        if git diff --cached package.json | grep -q "$lib"; then
            echo "âŒ BLOCKED: Adding blocked library $lib"
            exit 1
        fi
    done
fi

# Validate features.json if changed
if git diff --cached --name-only | grep -q "features.json"; then
    if ! python3 -c "import json; json.load(open('.buildrunner/features.json'))" 2>/dev/null; then
        echo "âŒ features.json is not valid JSON"
        exit 1
    fi
fi

echo "âœ… Pre-commit checks passed"
