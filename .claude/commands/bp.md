---
description: Build Plan - Create or update build plans from conversation context
allowed-tools: Read, Write, Edit, Bash, AskUserQuestion
---

# Build Plan Creator

You are creating or updating a build plan based on the conversation.

---

## Step 1: Detect Mode

Check if a current build plan exists:

```bash
ls -la .buildrunner/builds/BUILD_*.md 2>/dev/null | head -5
```

**If build plans exist:** This is likely an UPDATE (confirm with user)
**If no build plans:** This is a CREATE

---

## Step 2: Scan Conversation

Extract from the conversation above:

### Requirements
- What features are being requested?
- What problems are being solved?
- What integrations are needed?

### Technical Decisions
- What stack/framework?
- What architecture patterns?
- What APIs/services?

### Success Criteria
- How do we know it's done?
- What are the acceptance criteria?
- What metrics matter?

### Constraints
- What can't change?
- What's out of scope?
- What dependencies exist?

---

## Step 3: Ask Clarifying Questions (If Needed)

If any of the following are unclear, use AskUserQuestion:

- **Scope:** "Should this include X or is that out of scope?"
- **Priority:** "Which features are must-have vs nice-to-have?"
- **Technical:** "Should we use X or Y approach?"
- **Timeline:** "Is this a quick MVP or full implementation?"

Only ask if truly ambiguous. Don't ask about things already discussed.

---

## Step 4: Generate Summary

**CRITICAL: Do NOT write any files yet. Present this summary and wait for "go".**

Present in this EXACT format:

```markdown
## Build Plan: [Name]

**Mode:** Create New / Update Existing
**Based on:** [Brief description of what was discussed]

---

### Features

| # | Feature | Description | Priority |
|---|---------|-------------|----------|
| 1 | [Name] | [What it does] | High/Med/Low |
| 2 | [Name] | [What it does] | High/Med/Low |

---

### Phases

| Phase | Name | Deliverables | Estimate |
|-------|------|--------------|----------|
| 1 | [Name] | [What's delivered] | [X hours/days] |
| 2 | [Name] | [What's delivered] | [X hours/days] |
| 3 | [Name] | [What's delivered] | [X hours/days] |

**Total Estimate:** [Sum of phases]

---

### Success Criteria

- [ ] [Criterion 1 - measurable]
- [ ] [Criterion 2 - measurable]
- [ ] [Criterion 3 - measurable]

---

### Technical Approach

- **Stack:** [Framework, language, etc.]
- **Architecture:** [Key patterns]
- **Integrations:** [External services]
- **Key Decisions:** [Important choices made]

---

### Files to Update

- `.buildrunner/builds/BUILD_[name].md` - [create/update]
- `PROJECT_SPEC.md` - Add [X] features
- `features.json` - Add [X] items as planned
- `decisions.log` - Log plan creation

---

**Type "go" to execute, or provide feedback to adjust.**
```

---

## Step 5: Wait for "go"

**DO NOT PROCEED until user says "go" or equivalent (yes, do it, proceed, etc.)**

If user provides feedback:
1. Adjust the plan based on feedback
2. Re-present the summary
3. Wait for "go" again

---

## Step 6: Execute (Only After "go")

### 6.1 Create/Update Build Plan

Write to `.buildrunner/builds/BUILD_[name].md`:

```markdown
# Build Plan: [Name]

**Created:** [DATE]
**Status:** In Progress
**Estimated Completion:** [Based on phases]

## Overview

[Brief description of what this build accomplishes]

## Features

### Feature 1: [Name]
**Priority:** [High/Med/Low]
**Status:** planned

[Description]

**Acceptance Criteria:**
- [ ] [Criterion]
- [ ] [Criterion]

[Repeat for each feature]

## Phases

### Phase 1: [Name]
**Estimate:** [X hours/days]
**Status:** not_started

**Deliverables:**
- [ ] [Deliverable 1]
- [ ] [Deliverable 2]

[Repeat for each phase]

## Success Criteria

- [ ] [Criterion 1]
- [ ] [Criterion 2]

## Technical Notes

[Key decisions, architecture notes, constraints]

---

*Generated by /bp command*
```

### 6.2 Update PROJECT_SPEC.md

Add or update features section. Read current file first:

@.buildrunner/PROJECT_SPEC.md

Then edit to add new features in the Features section.

### 6.3 Update features.json

```bash
br feature add "[Feature Name]" --priority [high/medium/low] --status planned
```

Run for each feature in the plan.

### 6.4 Log Decision

```bash
br decision log "Created build plan: [Name] with [X] features across [Y] phases" --type ARCHITECTURE
```

---

## Step 7: Confirm Completion

Tell the user:

> "âœ… Build plan created/updated.
>
> **Files updated:**
> - `.buildrunner/builds/BUILD_[name].md`
> - `PROJECT_SPEC.md` - Added [X] features
> - `features.json` - Added [X] planned items
> - `decisions.log` - Logged plan creation
>
> **Next steps:**
> 1. Review the build plan: `br build show [name]`
> 2. Start Phase 1 when ready
> 3. Use `/gaps` to track progress"

---

## Rules

1. **Always show summary first** - Never write without user confirmation
2. **Include time estimates** - Give realistic estimates for each phase
3. **Be concise** - Summary should fit on one screen
4. **Detect mode** - Auto-detect create vs update, confirm with user
5. **Ask if unclear** - Don't guess on ambiguous requirements
6. **Sync all files** - Build plan, PROJECT_SPEC, features.json must stay in sync
